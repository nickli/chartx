"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _hierarchy=_interopRequireDefault(require("../hierarchy")),_mmvis=require("mmvis"),TREE=function(){var f=(0,_hierarchy.default)().sort(null).value(null),_=layout_treeSeparation,y=[1,1],d=null;function t(e,t){var r=f.call(this,e,t),n=r[0],l=function(e){var t,r={A:null,children:[e]},n=[r];for(;null!=(t=n.pop());)for(var l,a=t.children,i=0,u=a.length;i<u;++i)n.push((a[i]=l={_:a[i],parent:t,children:(l=a[i].children)&&l.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:i}).a=l);return r.children[0]}(n);if(_hierarchy.default.layout_hierarchyVisitAfter(l,p),l.parent.m=-l.z,_hierarchy.default.layout_hierarchyVisitBefore(l,s),d)_hierarchy.default.layout_hierarchyVisitBefore(n,m);else{var a=n,i=n,u=n;_hierarchy.default.layout_hierarchyVisitBefore(n,function(e){e.x<a.x&&(a=e),e.x>i.x&&(i=e),e.depth>u.depth&&(u=e)});var o=_(a,i)/2-a.x,h=y[0]/(i.x+_(i,a)/2+o),c=y[1]/(u.depth||1);_hierarchy.default.layout_hierarchyVisitBefore(n,function(e){e.x=(e.x+o)*h,e.y=e.depth*c})}return r}function p(e){var t=e.children,r=e.parent.children,n=e.i?r[e.i-1]:null;if(t.length){layout_treeShift(e);var l=(t[0].z+t[t.length-1].z)/2;n?(e.z=n.z+_(e._,n._),e.m=e.z-l):e.z=l}else n&&(e.z=n.z+_(e._,n._));e.parent.A=function(e,t,r){if(t){for(var n,l=e,a=e,i=t,u=l.parent.children[0],o=l.m,h=a.m,c=i.m,f=u.m;i=layout_treeRight(i),l=layout_treeLeft(l),i&&l;)u=layout_treeLeft(u),(a=layout_treeRight(a)).a=e,0<(n=i.z+c-l.z-o+_(i._,l._))&&(layout_treeMove(layout_treeAncestor(i,e,r),e,n),o+=n,h+=n),c+=i.m,o+=l.m,f+=u.m,h+=a.m;i&&!layout_treeRight(a)&&(a.t=i,a.m+=c-h),l&&!layout_treeLeft(u)&&(u.t=l,u.m+=o-f,r=e)}return r}(e,n,e.parent.A||r[0])}function s(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function m(e){e.x*=y[0],e.y=e.depth*y[1]}return t.separation=function(e){return arguments.length?(_=e,t):_},t.size=function(e){return arguments.length?(d=null==(y=e)?m:null,t):d?null:y},t.nodeSize=function(e){return arguments.length?(d=null==(y=e)?null:m,t):d?y:null},_hierarchy.default.layout_hierarchyRebind(t,f)};function layout_treeSeparation(e,t){return e.parent==t.parent?1:2}function layout_treeLeft(e){var t=e.children;return t.length?t[0]:e.t}function layout_treeRight(e){var t,r=e.children;return(t=r.length)?r[t-1]:e.t}function layout_treeMove(e,t,r){var n=r/(t.i-e.i);t.c-=n,t.s+=r,e.c+=n,t.z+=r,t.m+=r}function layout_treeShift(e){for(var t,r=0,n=0,l=e.children,a=l.length;0<=--a;)(t=l[a]).z+=r,t.m+=r,r+=t.s+(n+=t.c)}function layout_treeAncestor(e,t,r){return e.a.parent===t.parent?e.a:r}_mmvis.global.registerLayout("tree",TREE);var _default=TREE;exports.default=_default;