"use strict";!function(e,r){if("function"==typeof define&&define.amd)define(["exports","./utils/rebind","./utils/arrays"],r);else if("undefined"!=typeof exports)r(exports,require("./utils/rebind"),require("./utils/arrays"));else{var n={};r(n,e.rebind,e.arrays),e.undefined=n}}(void 0,function(e,r,n){Object.defineProperty(e,"__esModule",{value:!0});var u=l(r),t=l(n);function l(e){return e&&e.__esModule?e:{default:e}}function h(){var o=v,f=i,c=a;function d(e){var r,n=[e],u=[];for(e.depth=0;null!=(r=n.pop());)if(u.push(r),(l=f.call(d,r,r.depth))&&(t=l.length)){for(var t,l,i;0<=--t;)n.push(i=l[t]),i.parent=r,i.depth=r.depth+1;if(c){var a=+c.call(d,r,r.depth);a&&!isNaN(a)&&(r._value=a)}c&&(r.value=0),r.children=l}else c&&(r.value=+c.call(d,r,r.depth)||0),delete r.children;return h.layout_hierarchyVisitAfter(e,function(e){var r,n;o&&(r=e.children)&&r.sort(o),c&&(n=e.parent)&&(n.value+=e.value),e._value&&e._value>e.value&&(e.value=e._value),delete e._value}),u}return d.sort=function(e){return arguments.length?(o=e,d):o},d.children=function(e){return arguments.length?(f=e,d):f},d.value=function(e){return arguments.length?(c=e,d):c},d.revalue=function(e){return c&&(h.layout_hierarchyVisitBefore(e,function(e){e.children&&(e.value=0)}),h.layout_hierarchyVisitAfter(e,function(e){var r;e.children||(e.value=+c.call(d,e,e.depth)||0),(r=e.parent)&&(r.value+=e.value),e._value&&e._value>e.value&&(e.value=e._value),delete e._value})),e},d}function i(e){return e.children}function a(e){return e.value}function v(e,r){return r.value-e.value}function o(e){return t.default.merge(e.map(function(r){return(r.children||[]).map(function(e){return{source:r,target:e}})}))}h.layout_hierarchyRebind=function(e,r){return(0,u.default)(e,r,"sort","children","value"),(e.nodes=e).links=o,e},h.layout_hierarchyVisitBefore=function(e,r){for(var n=[e];null!=(e=n.pop());)if(r(e),(t=e.children)&&(u=t.length))for(var u,t;0<=--u;)n.push(t[u])},h.layout_hierarchyVisitAfter=function(e,r){for(var n=[e],u=[];null!=(e=n.pop());)if(u.push(e),(l=e.children)&&(t=l.length))for(var t,l,i=-1;++i<t;)n.push(l[i]);for(;null!=(e=u.pop());)r(e)},e.default=h});