"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _intersect2=_interopRequireDefault(require("./intersect")),_grid=_interopRequireDefault(require("./grid")),_format=_interopRequireDefault(require("./format")),_convex=_interopRequireDefault(require("./convex"));function _filterDuplicates(e){for(var t=[e[0]],r=e[0],n=1;n<e.length;n++){var o=e[n];r[0]===o[0]&&r[1]===o[1]||t.push(o),r=o}return t}function _sortByX(e){return e.sort(function(e,t){return e[0]-t[0]||e[1]-t[1]})}function _sqLength(e,t){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function _cos(e,t,r){var n=[t[0]-e[0],t[1]-e[1]],o=[r[0]-e[0],r[1]-e[1]],u=_sqLength(e,t),i=_sqLength(e,r);return(n[0]*o[0]+n[1]*o[1])/Math.sqrt(u*i)}function _intersect(e,t){for(var r=0;r<t.length-1;r++){var n=[t[r],t[r+1]];if(!(e[0][0]===n[0][0]&&e[0][1]===n[0][1]||e[0][0]===n[1][0]&&e[0][1]===n[1][1])&&(0,_intersect2.default)(e,n))return!0}return!1}function _occupiedArea(e){for(var t=1/0,r=1/0,n=-1/0,o=-1/0,u=e.length-1;0<=u;u--)e[u][0]<t&&(t=e[u][0]),e[u][1]<r&&(r=e[u][1]),e[u][0]>n&&(n=e[u][0]),e[u][1]>o&&(o=e[u][1]);return[n-t,o-r]}function _bBoxAround(e){return[Math.min(e[0][0],e[1][0]),Math.min(e[0][1],e[1][1]),Math.max(e[0][0],e[1][0]),Math.max(e[0][1],e[1][1])]}function _midPoint(e,t,r){for(var n,o,u=null,i=MAX_CONCAVE_ANGLE_COS,_=MAX_CONCAVE_ANGLE_COS,a=0;a<t.length;a++)n=_cos(e[0],e[1],t[a]),o=_cos(e[1],e[0],t[a]),i<n&&_<o&&!_intersect([e[0],t[a]],r)&&!_intersect([e[1],t[a]],r)&&(i=n,_=o,u=t[a]);return u}function _concave(e,t,r,n,o){for(var u=!1,i=0;i<e.length-1;i++){var _=[e[i],e[i+1]],a=_[0][0]+","+_[0][1]+","+_[1][0]+","+_[1][1];if(!(_sqLength(_[0],_[1])<t||o.has(a))){for(var f=0,c=_bBoxAround(_),l=void 0,s=void 0,d=void 0;l=(c=n.extendBbox(c,f))[2]-c[0],s=c[3]-c[1],f++,null===(d=_midPoint(_,n.rangePoints(c),e))&&(r[0]>l||r[1]>s););l>=r[0]&&s>=r[1]&&o.add(a),null!==d&&(e.splice(i+1,0,d),n.removePoint(d),u=!0)}}return u?_concave(e,t,r,n,o):e}function hull(e,t,r){var n=t||20,o=_filterDuplicates(_sortByX(_format.default.toXy(e,r)));if(o.length<4)return o.concat([o[0]]);var u=_occupiedArea(o),i=[u[0]*MAX_SEARCH_BBOX_SIZE_PERCENT,u[1]*MAX_SEARCH_BBOX_SIZE_PERCENT],_=(0,_convex.default)(o),a=o.filter(function(e){return _.indexOf(e)<0}),f=Math.ceil(1/(o.length/(u[0]*u[1]))),c=_concave(_,Math.pow(n,2),i,(0,_grid.default)(a,f),new Set);return r?_format.default.fromXy(c,r):c}var MAX_CONCAVE_ANGLE_COS=Math.cos(90/(180/Math.PI)),MAX_SEARCH_BBOX_SIZE_PERCENT=.6,_default=hull;exports.default=_default;