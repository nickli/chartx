"use strict";!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./intersect","./grid","./format","./convex"],t);else if("undefined"!=typeof exports)t(exports,require("./intersect"),require("./grid"),require("./format"),require("./convex"));else{var r={};t(r,e.intersect,e.grid,e.format,e.convex),e.undefined=r}}(void 0,function(e,t,r,n,o){Object.defineProperty(e,"__esModule",{value:!0});var u=i(t),l=i(r),v=i(n),h=i(o);function i(e){return e&&e.__esModule?e:{default:e}}function g(e,t){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function d(e,t,r){var n=[t[0]-e[0],t[1]-e[1]],o=[r[0]-e[0],r[1]-e[1]],u=g(e,t),i=g(e,r);return(n[0]*o[0]+n[1]*o[1])/Math.sqrt(u*i)}function c(e,t){for(var r=0;r<t.length-1;r++){var n=[t[r],t[r+1]];if(!(e[0][0]===n[0][0]&&e[0][1]===n[0][1]||e[0][0]===n[1][0]&&e[0][1]===n[1][1])&&(0,u.default)(e,n))return!0}return!1}function p(e,t,r){for(var n,o,u=null,i=s,f=s,a=0;a<t.length;a++)n=d(e[0],e[1],t[a]),o=d(e[1],e[0],t[a]),i<n&&f<o&&!c([e[0],t[a]],r)&&!c([e[1],t[a]],r)&&(i=n,f=o,u=t[a]);return u}var s=Math.cos(90/(180/Math.PI));e.default=function(e,t,r){var n=t||20,o=function(e){for(var t=[e[0]],r=e[0],n=1;n<e.length;n++){var o=e[n];r[0]===o[0]&&r[1]===o[1]||t.push(o),r=o}return t}(function(e){return e.sort(function(e,t){return e[0]-t[0]||e[1]-t[1]})}(v.default.toXy(e,r)));if(o.length<4)return o.concat([o[0]]);var u=function(e){for(var t=1/0,r=1/0,n=-1/0,o=-1/0,u=e.length-1;0<=u;u--)e[u][0]<t&&(t=e[u][0]),e[u][1]<r&&(r=e[u][1]),e[u][0]>n&&(n=e[u][0]),e[u][1]>o&&(o=e[u][1]);return[n-t,o-r]}(o),i=[.6*u[0],.6*u[1]],f=(0,h.default)(o),a=o.filter(function(e){return f.indexOf(e)<0}),d=Math.ceil(1/(o.length/(u[0]*u[1]))),c=function e(t,r,n,o,u){for(var i,f=!1,a=0;a<t.length-1;a++){var d=[t[a],t[a+1]],c=d[0][0]+","+d[0][1]+","+d[1][0]+","+d[1][1];if(!(g(d[0],d[1])<r||u.has(c))){for(var l=0,v=(i=d,[Math.min(i[0][0],i[1][0]),Math.min(i[0][1],i[1][1]),Math.max(i[0][0],i[1][0]),Math.max(i[0][1],i[1][1])]),h=void 0,s=void 0,M=void 0;h=(v=o.extendBbox(v,l))[2]-v[0],s=v[3]-v[1],l++,null===(M=p(d,o.rangePoints(v),t))&&(n[0]>h||n[1]>s););h>=n[0]&&s>=n[1]&&u.add(c),null!==M&&(t.splice(a+1,0,M),o.removePoint(M),f=!0)}}return f?e(t,r,n,o,u):t}(f,Math.pow(n,2),i,(0,l.default)(a,d),new Set);return r?v.default.fromXy(c,r):c}});