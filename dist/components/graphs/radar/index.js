"use strict";!function(e,t){if("function"==typeof define&&define.amd)define(["exports","canvax","../index","mmvis"],t);else if("undefined"!=typeof exports)t(exports,require("canvax"),require("../index"),require("mmvis"));else{var n={};t(n,e.canvax,e.index,e.mmvis),e.undefined=n}}(void 0,function(e,t,n,c){Object.defineProperty(e,"__esModule",{value:!0});var i=l(t),o=l(n);function l(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=i.default.Shapes.Polygon,h=i.default.Shapes.Circle,y=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(v,o.default),s(v,null,[{key:"defaultProps",value:function(){return{field:{detail:"字段配置",default:null},line:{detail:"线配置",propertys:{enabled:{detail:"是否显示",default:!0},lineWidth:{detail:"线宽",default:2},strokeStyle:{detail:"线颜色",default:null}}},area:{detail:"面积区域配置",propertys:{enabled:{detail:"是否显示",default:!0},fillStyle:{detail:"面积背景色",default:null},fillAlpha:{detail:"面积透明度",default:.1}}},node:{detail:"线上面的单数据节点图形配置",propertys:{enabled:{detail:"是否显示",default:!0},strokeStyle:{detail:"边框色",default:"#ffffff"},radius:{detail:"半径",default:4},lineWidth:{detail:"边框大小",default:1}}}}}}]),s(v,[{key:"init",value:function(){}},{key:"draw",value:function(e){e=e||{},c._.extend(!0,this,e),this.data=this._trimGraphs(),this._widget(),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.fire("complete")}},{key:"_widget",value:function(){var u=this,s=this.app.getComponent({name:"coord"}),d=0;c._.each(this.data,function(e,t){var n={},i=[];c._.each(e,function(e,t){i.push([e.point.x,e.point.y])});var o=s.getFieldMapOf(t),l=u._getStyle(u.line.strokeStyle,d,o.color,o),a={pointList:i,cursor:"pointer"};u.line.enabled&&(a.lineWidth=u.line.lineWidth,a.strokeStyle=l),u.area.enabled&&(a.fillStyle=u._getStyle(u.area.fillStyle,d,o.color,o),a.fillAlpha=u._getStyle(u.area.fillAlpha,d,1,o));var r=new p({hoverClone:!1,context:a});if(n.area=r,u.sprite.addChild(r),r.__hoverFillAlpha=r.context.fillAlpha+.2,r.__fillAlpha=r.context.fillAlpha,r.on(c.event.types.get(),function(e){"mouseover"==e.type&&(this.context.fillAlpha=this.__hoverFillAlpha),"mouseout"==e.type&&(this.context.fillAlpha=this.__fillAlpha),u.app.fire(e.type,e)}),u.node.enabled){var f=[];c._.each(e,function(e,t){i.push([e.point.x,e.point.y]);var n=new h({context:{cursor:"pointer",x:e.point.x,y:e.point.y,r:u.node.radius,lineWidth:u.node.lineWidth,strokeStyle:u.node.strokeStyle,fillStyle:l}});u.sprite.addChild(n),n.iNode=t,n.nodeData=e,n._strokeStyle=l,n.on(c.event.types.get(),function(e){e.aAxisInd=this.iNode,e.eventInfo={trigger:u.node,nodes:[this.nodeData]},u.app.fire(e.type,e)}),f.push(n)}),n.nodes=f}u.groups[t]=n,d++})}},{key:"tipsPointerOf",value:function(e){var i=this;i.tipsPointerHideOf(e),e.eventInfo&&e.eventInfo.nodes&&c._.each(e.eventInfo.nodes,function(n){i.data[n.field]&&c._.each(i.data[n.field],function(e,t){n.iNode==t&&i.focusOf(e)})})}},{key:"tipsPointerHideOf",value:function(){var n=this;c._.each(n.data,function(e,t){c._.each(e,function(e){n.unfocusOf(e)})})}},{key:"focusOf",value:function(e){if(!e.focused){var t=this.groups[e.field].nodes[e.iNode];t.context.r+=1,t.context.fillStyle=this.node.strokeStyle,t.context.strokeStyle=t._strokeStyle,e.focused=!0}}},{key:"unfocusOf",value:function(e){if(e.focused){var t=this.groups[e.field].nodes[e.iNode];t.context.r-=1,t.context.fillStyle=t._strokeStyle,t.context.strokeStyle=this.node.strokeStyle,e.focused=!1}}},{key:"hide",value:function(e){var t=this.app.getComponent({name:"coord"});this.enabledField=t.filterEnabledFields(this.field);var n=this.groups[e];n&&(n.area.context.visible=!1,c._.each(n.nodes,function(e){e.context.visible=!1}))}},{key:"show",value:function(e){var t=this.app.getComponent({name:"coord"});this.enabledField=t.filterEnabledFields(this.field);var n=this.groups[e];n&&(n.area.context.visible=!0,c._.each(n.nodes,function(e){e.context.visible=!0}))}},{key:"_trimGraphs",value:function(){var f=this,u=this.app.getComponent({name:"coord"});this.enabledField=u.filterEnabledFields(this.field);var e={};return c._.each(this.enabledField,function(o){var l=f.dataFrame.getFieldData(o),a=u.getFieldMapOf(o),r=[];c._.each(u.aAxis.angleList,function(e,t){var n=Math.PI*e/180,i=u.getPointInRadianOfR(n,u.getROfNum(l[t]));r.push({type:"radar",field:o,iNode:t,rowData:f.dataFrame.getRowDataAt(t),focused:!1,value:l[t],point:i,color:a.color})}),e[o]=r}),e}},{key:"_getStyle",value:function(e,t,n,i){var o=n;return(c._.isString(e)||c._.isNumber(e))&&(o=e),c._.isArray(e)&&(o=e[t]),c._.isFunction(e)&&(o=e(t,i)),null==o&&(o=n),o}},{key:"getNodesAt",value:function(i){var o=this.data,l=[];return c._.each(this.enabledField,function(e,t){if(c._.isArray(e))c._.each(e,function(e,t){var n=o[e][i];n&&l.push(n)});else{var n=o[e][i];n&&l.push(n)}}),l}}]),v);function v(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),(n=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?f(e):t}(this,r(v).call(this,e,t))).type="radar",n.enabledField=null,n.groups={},c._.extend(!0,f(n),(0,c.getDefaultProps)(v.defaultProps()),e),n.init(),n}c.global.registerComponent(y,"graphs","radar"),e.default=y});