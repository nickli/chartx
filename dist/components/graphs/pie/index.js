"use strict";!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./pie","../index","mmvis"],t);else if("undefined"!=typeof exports)t(exports,require("./pie"),require("../index"),require("mmvis"));else{var n={};t(n,e.pie,e.index,e.mmvis),e.undefined=n}}(void 0,function(e,t,n,_){Object.defineProperty(e,"__esModule",{value:!0});var i=a(t);function a(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(h,a(n).default),d(h,null,[{key:"defaultProps",value:function(){return{field:{detail:"字段配置",default:null},groupField:{detail:"分组字段",default:null,documentation:"groupField主要是给legend用的， 所有在legend中需要显示的分组数据，都用groupField"},sort:{detail:"排序，默认不排序，可以配置为asc,desc",default:null},startAngle:{detail:"起始角度",default:-90},allAngle:{detail:"全部角度",default:360},node:{detail:"单个节点（扇形）配置",propertys:{radius:{detail:"半径",default:null,documentation:"每个扇形单元的半径，也可以配置一个字段，就成了丁格尔玫瑰图"},innerRadius:{detail:"内径",default:0},outRadius:{detail:"外径",default:null},minRadius:{detail:"最小的半径厚度",default:10,documentation:"outRadius - innerRadius ， 也就是radius的最小值"},moveDis:{detail:"hover偏移量",default:15,documentation:"要预留moveDis位置来hover sector 的时候外扩"},fillStyle:{detail:"单个图形背景色",default:null},focus:{detail:"图形的hover设置",propertys:{enabled:{detail:"是否开启",default:!0}}},select:{detail:"图形的选中效果",propertys:{enabled:{detail:"是否开启",default:!0},radius:{detail:"选中效果图形的半径厚度",default:5},alpha:{detail:"选中效果图形的透明度",default:.7}}}}},label:{detail:"label",propertys:{field:{detail:"获取label的字段",default:null},enabled:{detail:"是否开启",default:!1},format:{detail:"label的格式化函数，支持html",default:null}}}}}}]),d(h,[{key:"init",value:function(){this.data=this._dataHandle()}},{key:"_computerProps",value:function(){var e=this.width,t=this.height;if(!this.node.outRadius){var n=Math.min(e,t)/2;this.label.enabled&&(n-=this.node.moveDis),this.node.outRadius=parseInt(n)}null!==this.node.radius&&_._.isNumber(this.node.radius)&&(this.node.radius=Math.max(this.node.radius,this.node.minRadius),this.node.innerRadius=this.node.outRadius-this.node.radius),this.node.outRadius-this.node.innerRadius<this.node.minRadius&&(this.node.innerRadius=this.node.outRadius-this.node.minRadius),this.node.innerRadius<0&&(this.node.innerRadius=0)}},{key:"draw",value:function(e){e=e||{},_._.extend(!0,this,e),this._computerProps(),this._pie=new i.default(this,this._trimGraphs(this.data)),this._pie.draw(e);var t=this;this.animation&&!e.resize?this._pie.grow(function(){t.fire("complete")}):this.fire("complete"),this.sprite.addChild(this._pie.sprite)}},{key:"show",value:function(e){this._setEnabled(e,!0)}},{key:"hide",value:function(e){this._setEnabled(e,!1)}},{key:"_setEnabled",value:function(t,n){_._.each(this.data,function(e){if(e.label===t)return e.enabled=n,!1}),this._pie.resetData(this._trimGraphs(this.data))}},{key:"_dataHandle",value:function(){for(var n=this,e=[],t=n.dataFrame,i=0,a=t.length;i<a;i++){var l=t.getRowDataAt(i),r={type:"pie",rowData:l,focused:!1,focusEnabled:n.node.focus.enabled,selected:!1,selectEnabled:n.node.select.enabled,selectedR:n.node.select.radius,selectedAlpha:n.node.select.alpha,enabled:!0,fillStyle:null,color:null,value:l[n.field],label:l[n.groupField||n.label.field||n.field],labelText:null,iNode:i},o=n._getColor(n.node.fillStyle,r);r.fillStyle=r.color=o,e.push(r)}return e.length&&n.sort&&(e.sort(function(e,t){return"asc"==n.sort?e.value-t.value:t.value-e.value}),_._.each(e,function(e,t){e.iNode=t})),e}},{key:"_trimGraphs",value:function(e){var n=this,t=0;n.currentAngle=0+n.startAngle%360;var i=n.allAngle+n.startAngle%n.allAngle,a=0,l=0;if(e.length){for(var r=0;r<e.length;r++)if(e[r].enabled&&(t+=e[r].value,n.node.radius&&_._.isString(n.node.radius)&&n.node.radius in e[r].rowData)){var o=Number(e[r].rowData[n.node.radius]);a=Math.max(a,o),l=Math.min(l,o)}if(0<t)for(var u=0;u<e.length;u++){var s=e[u].value/t;e[u].enabled||(s=0);var d=+(100*s).toFixed(2),f=n.allAngle*s,c=n.currentAngle+f>i?i:n.currentAngle+f,h=Math.cos((n.currentAngle+f/2)/180*Math.PI),p=Math.sin((n.currentAngle+f/2)/180*Math.PI),v=n.currentAngle+f/2;h=h.toFixed(5),p=p.toFixed(5);var b=function(e){i<=e&&(e=i),e%=n.allAngle;var t=parseInt(e/90);if(0<=e)switch(t){case 0:return 1;case 1:return 2;case 2:return 3;case 3:case 4:return 4}else if(e<0)switch(t){case 0:return 4;case-1:return 3;case-2:return 2;case-3:case-4:return 1}}(v),y=n.node.outRadius;if(n.node.radius&&_._.isString(n.node.radius)&&n.node.radius in e[u].rowData){var g=Number(e[u].rowData[n.node.radius]);y=parseInt((n.node.outRadius-n.node.innerRadius)*((g-l)/(a-l))+n.node.innerRadius)}var m=n.node.moveDis;_._.extend(e[u],{outRadius:y,innerRadius:n.node.innerRadius,startAngle:n.currentAngle,endAngle:c,midAngle:v,moveDis:m,outOffsetx:.7*m*h,outOffsety:.7*m*p,centerx:y*h,centery:y*p,outx:(y+m)*h,outy:(y+m)*p,edgex:(y+m)*h,edgey:(y+m)*p,orginPercentage:s,percentage:d,quadrant:b,labelDirection:1==b||4==b?1:0,iNode:u}),e[u].labelText=n._getLabelText(e[u]),n.currentAngle+=f,n.currentAngle>i&&(n.currentAngle=i)}}return{list:e,total:t}}},{key:"_getColor",value:function(e,t){var n=t.iNode,i=e;return _._.isArray(e)&&(i=e[n]),_._.isFunction(e)&&(i=s.apply(this,[t])),i=i||this.app.getTheme(n)}},{key:"_getLabelText",value:function(e){var t;if(this.label.enabled)if(this.label.format)_._.isFunction(this.label.format)&&(t=this.label.format(e.label,e));else{var n=this.label.field||this.groupField;t=n?e.rowData[n]+"："+e.percentage+"%":e.percentage+"%"}return t}},{key:"getList",value:function(){return this.data}},{key:"getLegendData",value:function(){var t=[];return _._.each(this.data,function(e){t.push({name:e.label,color:e.fillStyle,enabled:e.enabled})}),t}},{key:"tipsPointerOf",value:function(){}},{key:"tipsPointerHideOf",value:function(){}},{key:"focusAt",value:function(e){var t=this._pie.data.list[e];this.node.focus.enabled&&this._pie.focusOf(t)}},{key:"unfocusAt",value:function(e){var t=this._pie.data.list[e];t.node.focus.enabled&&this._pie.unfocusOf(t)}},{key:"selectAt",value:function(e){var t=this._pie.data.list[e];this.node.select.enabled&&this._pie.selectOf(t)}},{key:"unselectAt",value:function(e){var t=this._pie.data.list[e];this.node.select.enabled&&this._pie.unselectOf(t)}}]),h);function h(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(n=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?o(e):t}(this,r(h).call(this,e,t))).type="pie",_._.extend(!0,o(n),(0,_.getDefaultProps)(h.defaultProps()),e),n.init(),n}_.global.registerComponent(c,"graphs","pie"),e.default=c});