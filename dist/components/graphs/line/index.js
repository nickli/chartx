"use strict";!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./group","../index","mmvis"],t);else if("undefined"!=typeof exports)t(exports,require("./group"),require("../index"),require("mmvis"));else{var i={};t(i,e.group,e.index,e.mmvis),e.undefined=i}}(void 0,function(e,t,i,p){Object.defineProperty(e,"__esModule",{value:!0});var h=n(t);function n(e){return e&&e.__esModule?e:{default:e}}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){return t&&u(e.prototype,t),i&&u(e,i),e}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(d,n(i).default),s(d,null,[{key:"defaultProps",value:function(){return{field:{detail:"字段配置，支持二维数组格式",default:null},yAxisAlign:{detail:"绘制在哪根y轴上面",default:"left"},_props:[h.default]}}}]),s(d,[{key:"init",value:function(){}},{key:"draw",value:function(e){return e=e||{},this.width=e.width,this.height=e.height,p._.extend(!0,this.origin,e.origin),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.data=this._trimGraphs(),this._setGroupsForYfield(this.data,null,e),this.animation&&!e.resize?this.grow():this.fire("complete"),this}},{key:"resetData",value:function(e,t){var i=this;e&&(i.dataFrame=e,i.data=i._trimGraphs()),p._.each(i.groups,function(e){e.resetData(i.data[e.field].data,t)})}},{key:"setEnabledField",value:function(){this.enabledField=this.app.getComponent({name:"coord"}).filterEnabledFields(this.field)}},{key:"_trimGraphs",value:function(){var f=this,l=this.app.getComponent({name:"coord"}),d={};return f.setEnabledField(),p._.each(p._.flatten(f.enabledField),function(e,t){var i=f.app.getComponent({name:"coord"}).getFieldMapOf(e),n=f.dataFrame.getFieldData(e);if(n){for(var r=[],o=0,a=n.length;o<a;o++){var u=l.getPoint({iNode:o,field:e,value:{y:n[o]}}),s={type:"line",iGroup:t,iNode:o,field:e,value:n[o],x:u.pos.x,y:u.pos.y,rowData:f.dataFrame.getRowDataAt(o),color:i.color};r.push(s)}d[e]={yAxis:i.yAxis,field:e,data:r}}}),d}},{key:"grow",value:function(i){var n=0,r=this.groups.length,o=this;return p._.each(this.groups,function(e,t){e._grow(function(){n++,i&&i(e),n==r&&o.fire("complete")})}),this}},{key:"show",value:function(e){var i=this;-1!=p._.indexOf(p._.flatten([i.field]),e)&&(this.data=this._trimGraphs(),this._setGroupsForYfield(this.data,e),p._.each(this.groups,function(e,t){e.resetData(i.data[e.field].data)}))}},{key:"hide",value:function(e){var i=this,t=i.getGroupIndex(e);!this.groups.length||t<0||(this.groups.splice(t,1)[0].destroy(),this.data=this._trimGraphs(),p._.each(this.groups,function(e,t){e.resetData(i.data[e.field].data)}))}},{key:"getGroupIndex",value:function(e){for(var t=-1,i=0,n=this.groups.length;i<n;i++)if(this.groups[i].field===e){t=i;break}return t}},{key:"getGroup",value:function(e){return this.groups[this.getGroupIndex(e)]}},{key:"_setGroupsForYfield",value:function(e,s,f){var l=this;f=f||{},s=s&&p._.flatten([s]);var d=p._.flatten([this.field]);p._.each(e,function(e,t){if(!s||-1!=p._.indexOf(s,t)){var i=l.app.getComponent({name:"coord"}).getFieldMapOf(t),n=p._.indexOf(d,t),r=new h.default(i,n,l._opt,l.ctx,l.height,l.width,l);r.draw({animation:l.animation&&!f.resize},e.data);for(var o=!1,a=0,u=l.groups.length;a<u;a++)if(n<l.groups[a].iGroup){l.groups.splice(a,0,r),o=!0,l.sprite.addChildAt(r.sprite,a);break}o||(l.groups.push(r),l.sprite.addChild(r.sprite))}})}},{key:"getNodesAt",value:function(i,n){var r=[];return p._.each(this.groups,function(e){var t=e.getNodeInfoAt(i,n);t&&r.push(t)}),r}},{key:"getNodesOfPos",value:function(i){var n=[];return p._.each(this.groups,function(e){var t=e.getNodeInfoOfX(i);t&&n.push(t)}),n}}]),d);function d(e,t){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(i=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?a(e):t}(this,o(d).call(this,e,t))).type="line",i.enabledField=null,i.groups=[],p._.extend(!0,a(i),(0,p.getDefaultProps)(d.defaultProps()),e),i.init(),i}p.global.registerComponent(l,"graphs","line"),e.default=l});