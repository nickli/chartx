"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_group=_interopRequireDefault(require("./group")),_index=_interopRequireDefault(require("../index")),_mmvis=require("mmvis"),LineGraphs=function(e){function r(e,t){var i;return(0,_classCallCheck2.default)(this,r),(i=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(r).call(this,e,t))).type="line",i.enabledField=null,i.groups=[],_mmvis._.extend(!0,(0,_assertThisInitialized2.default)(i),(0,_mmvis.getDefaultProps)(r.defaultProps()),e),i.init(),i}return(0,_inherits2.default)(r,e),(0,_createClass2.default)(r,null,[{key:"defaultProps",value:function(){return{field:{detail:"字段配置，支持二维数组格式",default:null},yAxisAlign:{detail:"绘制在哪根y轴上面",default:"left"},_props:[_group.default]}}}]),(0,_createClass2.default)(r,[{key:"init",value:function(){}},{key:"draw",value:function(e){return e=e||{},this.width=e.width,this.height=e.height,_mmvis._.extend(!0,this.origin,e.origin),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.data=this._trimGraphs(),this._setGroupsForYfield(this.data,null,e),this.animation&&!e.resize?this.grow():this.fire("complete"),this}},{key:"resetData",value:function(e,t){var i=this;e&&(i.dataFrame=e,i.data=i._trimGraphs()),_mmvis._.each(i.groups,function(e){e.resetData(i.data[e.field].data,t)})}},{key:"setEnabledField",value:function(){this.enabledField=this.app.getComponent({name:"coord"}).filterEnabledFields(this.field)}},{key:"_trimGraphs",value:function(){var l=this,d=this.app.getComponent({name:"coord"}),p={};return l.setEnabledField(),_mmvis._.each(_mmvis._.flatten(l.enabledField),function(e,t){var i=l.app.getComponent({name:"coord"}).getFieldMapOf(e),r=l.dataFrame.getFieldData(e);if(r){for(var a=[],s=0,n=r.length;s<n;s++){var u=d.getPoint({iNode:s,field:e,value:{y:r[s]}}),o={type:"line",iGroup:t,iNode:s,field:e,value:r[s],x:u.pos.x,y:u.pos.y,rowData:l.dataFrame.getRowDataAt(s),color:i.color};a.push(o)}p[e]={yAxis:i.yAxis,field:e,data:a}}}),p}},{key:"grow",value:function(i){var r=0,a=this.groups.length,s=this;return _mmvis._.each(this.groups,function(e,t){e._grow(function(){r++,i&&i(e),r==a&&s.fire("complete")})}),this}},{key:"show",value:function(e){var i=this;-1!=_mmvis._.indexOf(_mmvis._.flatten([i.field]),e)&&(this.data=this._trimGraphs(),this._setGroupsForYfield(this.data,e),_mmvis._.each(this.groups,function(e,t){e.resetData(i.data[e.field].data)}))}},{key:"hide",value:function(e){var i=this,t=i.getGroupIndex(e);!this.groups.length||t<0||(this.groups.splice(t,1)[0].destroy(),this.data=this._trimGraphs(),_mmvis._.each(this.groups,function(e,t){e.resetData(i.data[e.field].data)}))}},{key:"getGroupIndex",value:function(e){for(var t=-1,i=0,r=this.groups.length;i<r;i++)if(this.groups[i].field===e){t=i;break}return t}},{key:"getGroup",value:function(e){return this.groups[this.getGroupIndex(e)]}},{key:"_setGroupsForYfield",value:function(e,o,l){var d=this;l=l||{},o=o&&_mmvis._.flatten([o]);var p=_mmvis._.flatten([this.field]);_mmvis._.each(e,function(e,t){if(!o||-1!=_mmvis._.indexOf(o,t)){var i=d.app.getComponent({name:"coord"}).getFieldMapOf(t),r=_mmvis._.indexOf(p,t),a=new _group.default(i,r,d._opt,d.ctx,d.height,d.width,d);a.draw({animation:d.animation&&!l.resize},e.data);for(var s=!1,n=0,u=d.groups.length;n<u;n++)if(r<d.groups[n].iGroup){d.groups.splice(n,0,a),s=!0,d.sprite.addChildAt(a.sprite,n);break}s||(d.groups.push(a),d.sprite.addChild(a.sprite))}})}},{key:"getNodesAt",value:function(i,r){var a=[];return _mmvis._.each(this.groups,function(e){var t=e.getNodeInfoAt(i,r);t&&a.push(t)}),a}},{key:"getNodesOfPos",value:function(i){var r=[];return _mmvis._.each(this.groups,function(e){var t=e.getNodeInfoOfX(i);t&&r.push(t)}),r}}]),r}(_index.default);_mmvis.global.registerComponent(LineGraphs,"graphs","line");var _default=LineGraphs;exports.default=_default;