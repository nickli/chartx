"use strict";!function(e,n){if("function"==typeof define&&define.amd)define(["exports","mmvis"],n);else if("undefined"!=typeof exports)n(exports,require("mmvis"));else{var r={};n(r,e.mmvis),e.undefined=r}}(void 0,function(e,_){Object.defineProperty(e,"__esModule",{value:!0}),e.arrayToTreeJsonForRelation=e.jsonToArrayForRelation=e.checkDataIsJson=void 0;var v="children";function o(e,n,r){v=r;return!!_._.isArray(e)&&(_._.every(e,function(e){return _._.isObject(e)})&&_._.every(e,function(e){return!_._.isArray(e[n])}),_._.some(e,function(e){return v in e}))}e.checkDataIsJson=o,e.jsonToArrayForRelation=function(e,n,r){v=r;var a=[],c=new WeakMap,f=n.field||"__key__",u=n.node&&n.node.content&&n.node.content.field;if(!o(e,f,v))return console.error("该数据不能正确绘制，请提供数组对象形式的数据！"),a;var s=[],d=0,l=void 0;_._.each(e,function(e){s.push(e)});for(var i=function(){l[f]||(l[f]=d);var e=l[v];e&&(_._.each(e,function(e){c.set(e,{parentIndex:d,parentNode:l})}),s=s.concat(e.reverse()));var r={};_._.each(l,function(e,n){n!==v&&(r[n]=e)}),a.push(r);var n=c.get(l);if(n){var i=n.parentIndex,o=n.parentNode,t={};t.key=[i,d].join(","),u&&(t[u]=[o[u],l[u]].join("_")),a.push(t)}d++};l=s.pop();)i();return a},e.arrayToTreeJsonForRelation=function(e,r){var t={},a={};_._.each(e,function(e){var n=e[r.field];1==n.split(",").length?t[n]=e:a[n]=e});var n=[];return _._.each(t,function(e,r){var i=!0;_._.each(a,function(e,n){if(n.split(",")[1]==r)return i=!1}),i&&(n.push(e),e.__inRelation=!0)}),function n(e){_._.each(e,function(i,e){if(!i.__cycle){var o=i[r.field];_._.each(a,function(e,n){if(n.split(",")[0]==o){var r=t[n.split(",")[1]];r&&(i.children||(i.children=[]),i.children.push(r),r.__inRelation&&(r.__cycle=!0))}}),i.children&&i.children.length&&n(i.children)}})}(n),n}});