"use strict";!function(e,t){if("function"==typeof define&&define.amd)define(["exports","../component","canvax","mmvis"],t);else if("undefined"!=typeof exports)t(exports,require("../component"),require("canvax"),require("mmvis"));else{var n={};t(n,e.component,e.canvax,e.mmvis),e.undefined=n}}(void 0,function(e,t,n,r){Object.defineProperty(e,"__esModule",{value:!0});var l=o(t),i=o(n);function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function s(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=i.default.Shapes.Line,h=i.default.Shapes.Circle,x=i.default.Display.Text,y=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(_,l.default),s(_,null,[{key:"defaultProps",value:function(){return{xVal:{detail:"x的value值",default:null},x:{detail:"x的像素值",default:null},markTo:{detail:"标准哪个目标字段",documentation:"如果设置了这个字段，那么line的起点将是这个graphs上的node节点",default:null},line:{detail:"线的配置",propertys:{enabled:{detail:"是否开启",default:!0},lineWidth:{detail:"线宽",default:2},strokeStyle:{detail:"线的颜色",default:"#d5d5d5"},lineType:{detail:"线的样式，虚线(dashed)实线(solid)",default:"solid"},startY:{detail:"startY",default:0},endY:{detail:"startY",default:null}}},node:{detail:"数据图形节点",propertys:{enabled:{detail:"是否开启",default:!0},radius:{detail:"节点半径",default:5},fillStyle:{detail:"节点图形的背景色",default:"#ffffff"},strokeStyle:{detail:"节点图形的描边色，默认和line.strokeStyle保持一致",default:null},lineWidth:{detail:"节点图形边宽大小",default:2}}},label:{detail:"文本",propertys:{enabled:{detail:"是否开启",default:!1},fontColor:{detail:"文本字体颜色",default:null},fontSize:{detail:"文本字体大小",default:12},text:{detail:"文本内容",documentation:"可以是函数",default:null},format:{detail:"文本格式化函数",default:null}}}}}}]),s(_,[{key:"draw",value:function(e){e=e||{},this.width=e.width,this.height=e.height,this.origin=e.origin,this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this._widget()}},{key:"reset",value:function(e){e&&r._.extend(!0,this,e),this._widget()}},{key:"_widget",value:function(){var l,i=this,e=this.app.getComponent({name:"coord"})._xAxis;if(null!=this.xVal&&(l=e.getNodeInfoOfVal(this.xVal)),null!=this.x&&(l=e.getNodeInfoOfPos(this.x)),l){i.nodes=[],i.on("complete",function(){i._drawLine(l),i._drawNodes(l),i._drawLabels(l)});var o=0,a=this.app.getGraphs();r._.each(a,function(n){function e(){if(o++,!i.markTo||-1!=r._.flatten([n.field]).indexOf(i.markTo)){var e=n.getNodesOfPos(l.x);if(i.markTo){var t=r._.find(e,function(e){return e.field==i.markTo});t&&(i.nodes=[t])}else i.nodes=i.nodes.concat(e)}o==a.length&&i.fire("complete")}n.inited?e():n.on("complete",function(){e()})})}}},{key:"_drawLine",value:function(e){var t=this;if(t.line.enabled){var n=r._.extend(!0,{x:parseInt(e.x),start:{x:0,y:0},end:{x:0,y:-t.height},lineWidth:1,strokeStyle:"#cccccc"},this.line);if(null!=t.line.endY){var l=0;r._.isNumber(t.line.endY)&&(l=t.line.endY),"auto"==t.line.endY&&r._.each(t.nodes,function(e){l=Math.min(e.y)}),n.end.y=l}this._line?r._.extend(this._line.context,n):(this._line=new p({context:n}),this._lineSp.addChild(this._line),this._line.on(r.event.types.get(),function(e){e.eventInfo={xAxis:{},nodes:t.nodes},null!=t.xVal&&(e.eventInfo.xAxis.value=t.xVal,e.eventInfo.xAxis.text=t.xVal+"",e.eventInfo.title=t.xVal+""),t.app.fire(e.type,e)}))}}},{key:"_drawNodes",value:function(){var l=this;l.node.enabled&&(l._nodes.removeAllChildren(),r._.each(l.nodes,function(t){var e=r._.extend({x:t.x,y:t.y,cursor:"pointer",r:l.node.radius,lineWidth:l.node.lineWidth||t.lineWidth,strokeStyle:l.node.strokeStyle||t.color,fillStyle:l.node.fillStyle||t.fillStyle}),n=new h({context:e});n.nodeData=t,n.on(r.event.types.get(),function(e){e.eventInfo={xAxis:{},nodes:[t]},null!=l.xVal&&(e.eventInfo.xAxis.value=l.xVal,e.eventInfo.xAxis.text=l.xVal+"",e.eventInfo.title=l.xVal+""),l.app.fire(e.type,e)}),l._nodes.addChild(n)}))}},{key:"_drawLabels",value:function(){var i=this;i.node.enabled&&(i._labels.removeAllChildren(),r._.each(i.nodes,function(e){var t={x:e.x,y:e.y-i.node.radius-2,fillStyle:i.label.fontColor||e.color,fontSize:i.label.fontSize,textAlign:"center",textBaseline:"bottom"},n=i.label.text;if(r._.isFunction(n)&&(n=n.apply(i,[e])),n){var l=new x(n,{context:t});i._labels.addChild(l),l.localToGlobal().x+l.getTextWidth()/2>i.app.width&&(l.context.x=i.app.width-l.getTextWidth()/2-l.parent.localToGlobal().x)}}))}}]),_);function _(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_),(n=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?f(e):t}(this,d(_).call(this,e,t))).name="markcloumn",r._.extend(!0,f(n),(0,r.getDefaultProps)(_.defaultProps()),e),n.sprite=new i.default.Display.Sprite,n.app.graphsSprite.addChild(n.sprite),n._line=null,n._lineSp=new i.default.Display.Sprite,n.sprite.addChild(n._lineSp),n.nodes=[],n._nodes=new i.default.Display.Sprite,n.sprite.addChild(n._nodes),n._labels=new i.default.Display.Sprite,n.sprite.addChild(n._labels),n}r.global.registerComponent(y,"markcloumn"),e.default=y});