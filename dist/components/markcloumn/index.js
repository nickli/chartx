"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_component=_interopRequireDefault(require("../component")),_canvax=_interopRequireDefault(require("canvax")),_mmvis=require("mmvis"),Line=_canvax.default.Shapes.Line,Circle=_canvax.default.Shapes.Circle,Text=_canvax.default.Display.Text,markCloumn=function(e){function i(e,t){var l;return(0,_classCallCheck2.default)(this,i),(l=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(i).call(this,e,t))).name="markcloumn",_mmvis._.extend(!0,(0,_assertThisInitialized2.default)(l),(0,_mmvis.getDefaultProps)(i.defaultProps()),e),l.sprite=new _canvax.default.Display.Sprite,l.app.graphsSprite.addChild(l.sprite),l._line=null,l._lineSp=new _canvax.default.Display.Sprite,l.sprite.addChild(l._lineSp),l.nodes=[],l._nodes=new _canvax.default.Display.Sprite,l.sprite.addChild(l._nodes),l._labels=new _canvax.default.Display.Sprite,l.sprite.addChild(l._labels),l}return(0,_inherits2.default)(i,e),(0,_createClass2.default)(i,null,[{key:"defaultProps",value:function(){return{xVal:{detail:"x的value值",default:null},x:{detail:"x的像素值",default:null},markTo:{detail:"标准哪个目标字段",documentation:"如果设置了这个字段，那么line的起点将是这个graphs上的node节点",default:null},line:{detail:"线的配置",propertys:{enabled:{detail:"是否开启",default:!0},lineWidth:{detail:"线宽",default:2},strokeStyle:{detail:"线的颜色",default:"#d5d5d5"},lineType:{detail:"线的样式，虚线(dashed)实线(solid)",default:"solid"},startY:{detail:"startY",default:0},endY:{detail:"startY",default:null}}},node:{detail:"数据图形节点",propertys:{enabled:{detail:"是否开启",default:!0},radius:{detail:"节点半径",default:5},fillStyle:{detail:"节点图形的背景色",default:"#ffffff"},strokeStyle:{detail:"节点图形的描边色，默认和line.strokeStyle保持一致",default:null},lineWidth:{detail:"节点图形边宽大小",default:2}}},label:{detail:"文本",propertys:{enabled:{detail:"是否开启",default:!1},fontColor:{detail:"文本字体颜色",default:null},fontSize:{detail:"文本字体大小",default:12},text:{detail:"文本内容",documentation:"可以是函数",default:null},format:{detail:"文本格式化函数",default:null}}}}}}]),(0,_createClass2.default)(i,[{key:"draw",value:function(e){e=e||{},this.width=e.width,this.height=e.height,this.origin=e.origin,this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this._widget()}},{key:"reset",value:function(e){e&&_mmvis._.extend(!0,this,e),this._widget()}},{key:"_widget",value:function(){var i,n=this,e=this.app.getComponent({name:"coord"})._xAxis;if(null!=this.xVal&&(i=e.getNodeInfoOfVal(this.xVal)),null!=this.x&&(i=e.getNodeInfoOfPos(this.x)),i){n.nodes=[],n.on("complete",function(){n._drawLine(i),n._drawNodes(i),n._drawLabels(i)});var a=0,r=this.app.getGraphs();_mmvis._.each(r,function(l){function e(){if(a++,!n.markTo||-1!=_mmvis._.flatten([l.field]).indexOf(n.markTo)){var e=l.getNodesOfPos(i.x);if(n.markTo){var t=_mmvis._.find(e,function(e){return e.field==n.markTo});t&&(n.nodes=[t])}else n.nodes=n.nodes.concat(e)}a==r.length&&n.fire("complete")}l.inited?e():l.on("complete",function(){e()})})}}},{key:"_drawLine",value:function(e){var t=this;if(t.line.enabled){var l=_mmvis._.extend(!0,{x:parseInt(e.x),start:{x:0,y:0},end:{x:0,y:-t.height},lineWidth:1,strokeStyle:"#cccccc"},this.line);if(null!=t.line.endY){var i=0;_mmvis._.isNumber(t.line.endY)&&(i=t.line.endY),"auto"==t.line.endY&&_mmvis._.each(t.nodes,function(e){i=Math.min(e.y)}),l.end.y=i}this._line?_mmvis._.extend(this._line.context,l):(this._line=new Line({context:l}),this._lineSp.addChild(this._line),this._line.on(_mmvis.event.types.get(),function(e){e.eventInfo={xAxis:{},nodes:t.nodes},null!=t.xVal&&(e.eventInfo.xAxis.value=t.xVal,e.eventInfo.xAxis.text=t.xVal+"",e.eventInfo.title=t.xVal+""),t.app.fire(e.type,e)}))}}},{key:"_drawNodes",value:function(){var i=this;i.node.enabled&&(i._nodes.removeAllChildren(),_mmvis._.each(i.nodes,function(t){var e=_mmvis._.extend({x:t.x,y:t.y,cursor:"pointer",r:i.node.radius,lineWidth:i.node.lineWidth||t.lineWidth,strokeStyle:i.node.strokeStyle||t.color,fillStyle:i.node.fillStyle||t.fillStyle}),l=new Circle({context:e});l.nodeData=t,l.on(_mmvis.event.types.get(),function(e){e.eventInfo={xAxis:{},nodes:[t]},null!=i.xVal&&(e.eventInfo.xAxis.value=i.xVal,e.eventInfo.xAxis.text=i.xVal+"",e.eventInfo.title=i.xVal+""),i.app.fire(e.type,e)}),i._nodes.addChild(l)}))}},{key:"_drawLabels",value:function(){var n=this;n.node.enabled&&(n._labels.removeAllChildren(),_mmvis._.each(n.nodes,function(e){var t={x:e.x,y:e.y-n.node.radius-2,fillStyle:n.label.fontColor||e.color,fontSize:n.label.fontSize,textAlign:"center",textBaseline:"bottom"},l=n.label.text;if(_mmvis._.isFunction(l)&&(l=l.apply(n,[e])),l){var i=new Text(l,{context:t});n._labels.addChild(i),i.localToGlobal().x+i.getTextWidth()/2>n.app.width&&(i.context.x=n.app.width-i.getTextWidth()/2-i.parent.localToGlobal().x)}}))}}]),i}(_component.default);_mmvis.global.registerComponent(markCloumn,"markcloumn");var _default=markCloumn;exports.default=_default;