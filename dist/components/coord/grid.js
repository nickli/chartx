"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_canvax=_interopRequireDefault(require("canvax")),_mmvis=require("mmvis"),Line=_canvax.default.Shapes.Line,Rect=_canvax.default.Shapes.Rect,rectGrid=function(e){function l(e,i){var t;return(0,_classCallCheck2.default)(this,l),t=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(l).call(this,e,i)),_mmvis._.extend(!0,(0,_assertThisInitialized2.default)(t),(0,_mmvis.getDefaultProps)(l.defaultProps())),t.width=0,t.height=0,t._coord=i,t.pos={x:0,y:0},t.sprite=null,t.xAxisSp=null,t.yAxisSp=null,t.init(e),t}return(0,_inherits2.default)(l,e),(0,_createClass2.default)(l,null,[{key:"defaultProps",value:function(){return{enabled:{detail:"是否开启grid绘制",default:!0},line:{detail:"网格线条配置",propertys:{xDimension:{detail:"一维方向的网格线",propertys:{enabled:{detail:"是否开启",default:!0},data:[],lineType:{detail:"线的样式，虚线或者实现",default:"solid"},lineWidth:{detail:"线宽",default:1},strokeStyle:{detail:"线颜色",default:"#f0f0f0"}}},yDimension:{detail:"二维方向的网格线",propertys:{enabled:{detail:"是否开启",default:!1},data:[],lineType:{detail:"线的样式，虚线或者实现",default:"solid"},lineWidth:{detail:"线宽",default:1},strokeStyle:{detail:"线颜色",default:"#f0f0f0"}}}}},fill:{detail:"背景色配置",propertys:{xDimension:{detail:"以为方向的背景色块，x方向",propertys:{enabled:{detail:"是否开启",default:!1},splitVals:{detail:"从x轴上面用来分割区块的vals",default:null},fillStyle:{detail:"背景颜色",default:null},alpha:{detail:"背景透明度",default:null}}},yDimension:{detail:"以为方向的背景色块，y方向",propertys:{enabled:{detail:"是否开启",default:!1},splitVals:{detail:"从x轴上面用来分割区块的vals",default:null},fillStyle:{detail:"背景颜色",default:null},alpha:{detail:"背景透明度",default:null}}}}}}}}]),(0,_createClass2.default)(l,[{key:"init",value:function(e){_mmvis._.extend(!0,this,e),this.sprite=new _canvax.default.Display.Sprite}},{key:"setX",value:function(e){this.sprite.context.x=e}},{key:"setY",value:function(e){this.sprite.context.y=e}},{key:"draw",value:function(e){_mmvis._.extend(!0,this,e),this._widget(),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"clean",value:function(){this.sprite.removeAllChildren()}},{key:"reset",value:function(e){this.sprite.removeAllChildren(),this.draw(e)}},{key:"_widget",value:function(){var u=this;if(this.enabled){var o=u._coord._yAxis[0],p=u._coord._xAxis;this.fillSp=new _canvax.default.Display.Sprite,this.sprite.addChild(this.fillSp),_mmvis._.each([u.fill.xDimension,u.fill.yDimension],function(a,n){var e=n?o:p,i=[];if(a.enabled){a.splitVals?(i=[e.dataSection[0]].concat(_mmvis._.flatten([a.splitVals]))).push(e.dataSection.slice(-1)[0]):i=e.dataSection;var t=[];if(2<=i.length){for(var l=[],s=0,r=i.length;s<r;s++){var d=e.getPosOf({val:i[s]});if(l.length){if(1==l.length){if(d-l[0]<1)continue;l.push(d),t.push(l),l=[l[1]]}}else l.push(d)}_mmvis._.each(t,function(e,i){var t={fillStyle:u.getProp(a.fillStyle,i,"#000"),fillAlpha:u.getProp(a.alpha,i,i%2*.02)};n?(t.x=0,t.y=-e[0],t.width=u.width,t.height=-(e[1]-e[0])):(t.x=e[0],t.y=0,t.width=e[1]-e[0],t.height=-u.height);var l=new Rect({context:t});u.fillSp.addChild(l)})}}}),u.xAxisSp=new _canvax.default.Display.Sprite,u.sprite.addChild(u.xAxisSp),u.yAxisSp=new _canvax.default.Display.Sprite,u.sprite.addChild(u.yAxisSp);for(var e=0,i=(l=o.layoutData).length;e<i;e++){if((a=l[e]).visible){var t=new Line({id:"back_line_"+e,context:{y:a.y,lineType:u.getProp(u.line.xDimension.lineType,e,"solid"),lineWidth:u.getProp(u.line.xDimension.lineWidth,e,1),strokeStyle:u.getProp(u.line.xDimension.strokeStyle,e,"#f0f0f0"),visible:!0}});u.line.xDimension.enabled&&(u.xAxisSp.addChild(t),t.context.start.x=0,t.context.end.x=u.width)}}var l;for(e=0,i=(l=p.layoutData).length;e<i;e++){var a=l[e];t=new Line({context:{x:a.x,start:{x:0,y:0},end:{x:0,y:-u.height},lineType:u.getProp(u.line.yDimension.lineType,e,"solid"),lineWidth:u.getProp(u.line.yDimension.lineWidth,e,1),strokeStyle:u.getProp(u.line.yDimension.strokeStyle,e,"#f0f0f0"),visible:!0}});u.line.yDimension.enabled&&u.yAxisSp.addChild(t)}}}},{key:"getProp",value:function(e,i,t){var l=t;return null!=e&&null!=e&&((_mmvis._.isString(e)||_mmvis._.isNumber(e))&&(l=e),_mmvis._.isFunction(e)&&(l=e.apply(this,[i,t])),_mmvis._.isArray(e)&&(l=e[i])),l}}]),l}(_mmvis.event.Dispatcher);exports.default=rectGrid;