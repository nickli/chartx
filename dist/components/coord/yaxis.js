"use strict";!function(t,e){if("function"==typeof define&&define.amd)define(["exports","canvax","../../utils/tools","mmvis","./axis"],e);else if("undefined"!=typeof exports)e(exports,require("canvax"),require("../../utils/tools"),require("mmvis"),require("./axis"));else{var i={};e(i,t.canvax,t.tools,t.mmvis,t.axis),t.undefined=i}}(void 0,function(t,e,r,m,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var S=l(e),n=l(i);function l(t){return t&&t.__esModule?t:{default:t}}function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,i){return e&&h(t.prototype,e),i&&h(t,i),t}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var k=S.default.Shapes.Line,f=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(c,n.default),u(c,null,[{key:"defaultProps",value:function(){return{align:{detail:"左右轴设置",default:"left"},layoutType:{detail:"布局方式",default:"proportion"}}}}]),u(c,[{key:"init",value:function(t){this._setField(),this._initHandle(t),this.sprite=new S.default.Display.Sprite({id:"yAxisSprite_"+(new Date).getTime()}),this.rulesSprite=new S.default.Display.Sprite({id:"yRulesSprite_"+(new Date).getTime()}),this.sprite.addChild(this.rulesSprite)}},{key:"_initHandle",value:function(t){t&&(!t.isH||t.label&&void 0!==t.label.rotaion||(this.label.rotation=90),t.label&&t.label.textAlign||(this.label.textAlign="left"==this.align?"right":"left")),this.setDataSection(),this._getTitle(),this._setYaxisWidth()}},{key:"_setField",value:function(t){t&&(this.field=t),m._.isArray(this.field)||(this.field=[this.field])}},{key:"draw",value:function(t){m._.extend(!0,this,t||{}),this.height=parseInt(this.yMaxHeight-this._getYAxisDisLine()),this.setAxisLength(this.height),this.sprite.cleanAnimates(),this._trimYAxis(),this._widget(t),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"resetData",value:function(t){this._setField(t.field),this.resetDataOrg(t.org),this._initHandle(),this.draw()}},{key:"setX",value:function(t){this.sprite.context.x=t,this.pos.x=t}},{key:"setY",value:function(t){this.sprite.context.y=t,this.pos.y=t}},{key:"_getTitle",value:function(){if(this.title.text)if(this._title)this._title.resetText(this.title.text);else{var t=0;"left"==this.align?t=-90:(t=90,this.isH&&(t=270)),this._title=new S.default.Display.Text(this.title.text,{context:{fontSize:this.title.fontSize,textAlign:this.title.textAlign,textBaseline:this.title.textBaseline,fillStyle:this.title.fontColor,strokeStyle:this.title.strokeStyle,lineWidth:this.title.lineWidth,rotation:t}})}}},{key:"_setYaxisWidth",value:function(){}},{key:"_trimYAxis",value:function(){for(var t=[],e=0,i=this.dataSection.length;e<i;e++){var n={value:this.dataSection[e],y:-Math.abs(this.getPosOf({val:this.dataSection[e],ind:e})),visible:!0,text:""},l=n.value;m._.isFunction(this.label.format)&&(l=this.label.format.apply(this,[l,e])),null==l&&"proportion"==this.layoutType&&(l=(0,r.numAddSymbol)(n.value)),n.text=l,t.push(n)}for(var a=0,s=0,o=t.length;s<o;s++)0!=s&&(0==a?t[s].text==t[a].text?t[s].visible=!1:a=s:(t[s].text==t[a].text&&(t[a].visible=!1),a=s));this.layoutData=t,this.trimLayout&&this.trimLayout(t)}},{key:"_getYAxisDisLine",value:function(){var t=0;return t=0<(t=0+this.yMaxHeight%this.dataSection.length)?0:t}},{key:"resetWidth",value:function(t){this.width=t,"left"==this.align&&(this.rulesSprite.context.x=this.width)}},{key:"_widget",value:function(t){var e=this;if(t=t||{},e.enabled){for(var i=this.layoutData,n=0,l=e.maxW=0,a=i.length;l<a;l++){m._.isFunction(e.filter)&&e.filter({layoutData:i,index:l});var s=i[l];if(s.visible){var o=s.y,r=e.label.textAlign,h=o+(0==l?-3:0)+(l==i.length-1?3:0);90!=e.label.rotation&&-90!=e.label.rotation||(r="center",l==i.length-1&&(h=o-2,r="right"),0==l&&(h=o));var u=16;s.value==e.origin&&(u=0),s.value<e.origin&&(u=-16);var d,f,c=0;if(e.tickLine.enabled&&(d={x:c="left"==e.align?-e.tickLine.lineLength-e.tickLine.distance:e.tickLine.distance,y:o,end:{x:e.tickLine.lineLength,y:0},lineWidth:e.tickLine.lineWidth,strokeStyle:e._getStyle(e.tickLine.strokeStyle)}),e.label.enabled){var x="left"==e.align?c-e.label.distance:c+e.tickLine.lineLength+e.label.distance;this.isH&&(x+=4*("left"==e.align?-1:1)),f={x:x,y:h,fillStyle:e._getStyle(e.label.fontColor),fontSize:e.label.fontSize,rotation:-Math.abs(e.label.rotation),textAlign:r,textBaseline:"middle",lineHeight:e.label.lineHeight,globalAlpha:1}}var y=300;e.animation&&!t.resize||(y=0);var p=this.rulesSprite.getChildAt(n);p?(p._tickLine&&e.tickLine.enabled&&p._tickLine.animate(d,{duration:y,id:p._tickLine.id}),p._txt&&e.label.enabled&&(p._txt.animate(f,{duration:y,id:p._txt.id}),p._txt.resetText(s.text))):(p=new S.default.Display.Sprite({id:"_node"+n}),e.tickLine.enabled&&(p._tickLine=new k({id:"yAxis_tickline_"+n,context:d}),p.addChild(p._tickLine)),e.label.enabled&&(p._txt=new S.default.Display.Text(s.text,{id:"yAxis_txt_"+n,context:f}),p.addChild(p._txt),90==e.label.rotation||-90==e.label.rotation?e.maxW=Math.max(e.maxW,p._txt.getTextHeight()):e.maxW=Math.max(e.maxW,p._txt.getTextWidth()),e.animation&&!t.resize&&(p._txt.context.y=o+u,p._txt.context.globalAlpha=0,p._txt.animate({y:f.y,globalAlpha:1},{duration:300,id:p._txt.id}))),e.rulesSprite.addChild(p)),n++}}if(e.rulesSprite.children.length>=n){a=n;for(var _=e.rulesSprite.children.length;a<_;a++)e.rulesSprite.getChildAt(a).remove(),a--,_--}e.width||"width"in e._opt||(e.width=parseInt(e.maxW+e.label.distance),e.tickLine.enabled&&(e.width+=parseInt(e.tickLine.lineLength+e.tickLine.distance)),e._title&&(e.width+=e._title.getTextHeight()));var g=0;if("left"==e.align&&(e.rulesSprite.context.x=e.width,g=e.width),e.axisLine.enabled){var b={start:{x:g,y:0},end:{x:g,y:-e.height},lineWidth:e.axisLine.lineWidth,strokeStyle:e._getStyle(e.axisLine.strokeStyle)};if(this._axisLine)this._axisLine.animate(b);else{var v=new k({context:b});this.sprite.addChild(v),this._axisLine=v}}this._title&&(this._title.context.y=-this.height/2,this._title.context.x=this._title.getTextHeight()/2,"right"==this.align&&(this._title.context.x=this.width-this._title.getTextHeight()/2),this.sprite.addChild(this._title))}else e.width=0}},{key:"_getStyle",value:function(t){var e=t;return m._.isFunction(t)&&(e=t.call(this,this)),t||(e="#999"),e}}]),c);function c(t,e,i){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(n=function(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?o(t):e}(this,s(c).call(this,t,e.org))).type="yAxis",n._coord=i||{},n._title=null,n._axisLine=null,n.maxW=0,n.pos={x:0,y:0},n.yMaxHeight=0,n.layoutData=[],n.sprite=null,n.isH=!1,m._.extend(!0,o(n),(0,m.getDefaultProps)(c.defaultProps()),t),n.init(t),n}t.default=f});