"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_canvax=_interopRequireDefault(require("canvax")),_tools=require("../../utils/tools"),_mmvis=require("mmvis"),_axis=_interopRequireDefault(require("./axis")),Line=_canvax.default.Shapes.Line,yAxis=function(t){function a(t,e,i){var l;return(0,_classCallCheck2.default)(this,a),(l=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(a).call(this,t,e.org))).type="yAxis",l._coord=i||{},l._title=null,l._axisLine=null,l.maxW=0,l.pos={x:0,y:0},l.yMaxHeight=0,l.layoutData=[],l.sprite=null,l.isH=!1,_mmvis._.extend(!0,(0,_assertThisInitialized2.default)(l),(0,_mmvis.getDefaultProps)(a.defaultProps()),t),l.init(t),l}return(0,_inherits2.default)(a,t),(0,_createClass2.default)(a,null,[{key:"defaultProps",value:function(){return{align:{detail:"左右轴设置",default:"left"},layoutType:{detail:"布局方式",default:"proportion"}}}}]),(0,_createClass2.default)(a,[{key:"init",value:function(t){this._setField(),this._initHandle(t),this.sprite=new _canvax.default.Display.Sprite({id:"yAxisSprite_"+(new Date).getTime()}),this.rulesSprite=new _canvax.default.Display.Sprite({id:"yRulesSprite_"+(new Date).getTime()}),this.sprite.addChild(this.rulesSprite)}},{key:"_initHandle",value:function(t){t&&(!t.isH||t.label&&void 0!==t.label.rotaion||(this.label.rotation=90),t.label&&t.label.textAlign||(this.label.textAlign="left"==this.align?"right":"left")),this.setDataSection(),this._getTitle(),this._setYaxisWidth()}},{key:"_setField",value:function(t){t&&(this.field=t),_mmvis._.isArray(this.field)||(this.field=[this.field])}},{key:"draw",value:function(t){_mmvis._.extend(!0,this,t||{}),this.height=parseInt(this.yMaxHeight-this._getYAxisDisLine()),this.setAxisLength(this.height),this.sprite.cleanAnimates(),this._trimYAxis(),this._widget(t),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"resetData",value:function(t){this._setField(t.field),this.resetDataOrg(t.org),this._initHandle(),this.draw()}},{key:"setX",value:function(t){this.sprite.context.x=t,this.pos.x=t}},{key:"setY",value:function(t){this.sprite.context.y=t,this.pos.y=t}},{key:"_getTitle",value:function(){if(this.title.text)if(this._title)this._title.resetText(this.title.text);else{var t=0;"left"==this.align?t=-90:(t=90,this.isH&&(t=270)),this._title=new _canvax.default.Display.Text(this.title.text,{context:{fontSize:this.title.fontSize,textAlign:this.title.textAlign,textBaseline:this.title.textBaseline,fillStyle:this.title.fontColor,strokeStyle:this.title.strokeStyle,lineWidth:this.title.lineWidth,rotation:t}})}}},{key:"_setYaxisWidth",value:function(){}},{key:"_trimYAxis",value:function(){for(var t=this,e=[],i=0,l=this.dataSection.length;i<l;i++){var a={value:this.dataSection[i],y:-Math.abs(this.getPosOf({val:this.dataSection[i],ind:i})),visible:!0,text:""},s=a.value;_mmvis._.isFunction(t.label.format)&&(s=t.label.format.apply(this,[s,i])),null==s&&"proportion"==t.layoutType&&(s=(0,_tools.numAddSymbol)(a.value)),a.text=s,e.push(a)}for(var n=0,r=0,h=e.length;r<h;r++)0!=r&&(0==n?e[r].text==e[n].text?e[r].visible=!1:n=r:(e[r].text==e[n].text&&(e[n].visible=!1),n=r));this.layoutData=e,this.trimLayout&&this.trimLayout(e)}},{key:"_getYAxisDisLine",value:function(){var t=0;return t=0<(t=0+this.yMaxHeight%this.dataSection.length)?0:t}},{key:"resetWidth",value:function(t){var e=this;e.width=t,"left"==e.align&&(e.rulesSprite.context.x=e.width)}},{key:"_widget",value:function(t){var e=this;if(t=t||{},e.enabled){for(var i=this.layoutData,l=0,a=e.maxW=0,s=i.length;a<s;a++){_mmvis._.isFunction(e.filter)&&e.filter({layoutData:i,index:a});var n=i[a];if(n.visible){var r=n.y,h=e.label.textAlign,o=r+(0==a?-3:0)+(a==i.length-1?3:0);90!=e.label.rotation&&-90!=e.label.rotation||(h="center",a==i.length-1&&(o=r-2,h="right"),0==a&&(o=r));var u=16;n.value==e.origin&&(u=0),n.value<e.origin&&(u=-16);var d,x,_=0;if(e.tickLine.enabled&&(d={x:_="left"==e.align?-e.tickLine.lineLength-e.tickLine.distance:e.tickLine.distance,y:r,end:{x:e.tickLine.lineLength,y:0},lineWidth:e.tickLine.lineWidth,strokeStyle:e._getStyle(e.tickLine.strokeStyle)}),e.label.enabled){var c="left"==e.align?_-e.label.distance:_+e.tickLine.lineLength+e.label.distance;this.isH&&(c+=4*("left"==e.align?-1:1)),x={x:c,y:o,fillStyle:e._getStyle(e.label.fontColor),fontSize:e.label.fontSize,rotation:-Math.abs(e.label.rotation),textAlign:h,textBaseline:"middle",lineHeight:e.label.lineHeight,globalAlpha:1}}var f=300;e.animation&&!t.resize||(f=0);var p=this.rulesSprite.getChildAt(l);p?(p._tickLine&&e.tickLine.enabled&&p._tickLine.animate(d,{duration:f,id:p._tickLine.id}),p._txt&&e.label.enabled&&(p._txt.animate(x,{duration:f,id:p._txt.id}),p._txt.resetText(n.text))):(p=new _canvax.default.Display.Sprite({id:"_node"+l}),e.tickLine.enabled&&(p._tickLine=new Line({id:"yAxis_tickline_"+l,context:d}),p.addChild(p._tickLine)),e.label.enabled&&(p._txt=new _canvax.default.Display.Text(n.text,{id:"yAxis_txt_"+l,context:x}),p.addChild(p._txt),90==e.label.rotation||-90==e.label.rotation?e.maxW=Math.max(e.maxW,p._txt.getTextHeight()):e.maxW=Math.max(e.maxW,p._txt.getTextWidth()),e.animation&&!t.resize&&(p._txt.context.y=r+u,p._txt.context.globalAlpha=0,p._txt.animate({y:x.y,globalAlpha:1},{duration:300,id:p._txt.id}))),e.rulesSprite.addChild(p)),l++}}if(e.rulesSprite.children.length>=l){s=l;for(var g=e.rulesSprite.children.length;s<g;s++)e.rulesSprite.getChildAt(s).remove(),s--,g--}e.width||"width"in e._opt||(e.width=parseInt(e.maxW+e.label.distance),e.tickLine.enabled&&(e.width+=parseInt(e.tickLine.lineLength+e.tickLine.distance)),e._title&&(e.width+=e._title.getTextHeight()));var y=0;if("left"==e.align&&(e.rulesSprite.context.x=e.width,y=e.width),e.axisLine.enabled){var v={start:{x:y,y:0},end:{x:y,y:-e.height},lineWidth:e.axisLine.lineWidth,strokeStyle:e._getStyle(e.axisLine.strokeStyle)};if(this._axisLine)this._axisLine.animate(v);else{var b=new Line({context:v});this.sprite.addChild(b),this._axisLine=b}}this._title&&(this._title.context.y=-this.height/2,this._title.context.x=this._title.getTextHeight()/2,"right"==this.align&&(this._title.context.x=this.width-this._title.getTextHeight()/2),this.sprite.addChild(this._title))}else e.width=0}},{key:"_getStyle",value:function(t){var e=t;return _mmvis._.isFunction(t)&&(e=t.call(this,this)),t||(e="#999"),e}}]),a}(_axis.default);exports.default=yAxis;