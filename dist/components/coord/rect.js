"use strict";!function(i,t){if("function"==typeof define&&define.amd)define(["exports","./index","canvax","./xaxis","./yaxis","./grid","mmvis"],t);else if("undefined"!=typeof exports)t(exports,require("./index"),require("canvax"),require("./xaxis"),require("./yaxis"),require("./grid"),require("mmvis"));else{var e={};t(e,i.index,i.canvax,i.xaxis,i.yaxis,i.grid,i.mmvis),i.undefined=e}}(void 0,function(i,t,e,s,n,a,d){Object.defineProperty(i,"__esModule",{value:!0});var r=f(t),o=f(e),h=f(s),x=f(n),l=f(a);function f(i){return i&&i.__esModule?i:{default:i}}function u(i){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(i)}function y(i){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)})(i)}function _(i){if(void 0===i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function g(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function p(i,t,e){return t&&g(i.prototype,t),e&&g(i,e),i}function c(i,t){return(c=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i})(i,t)}var A=(function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&c(i,t)}(v,r.default),p(v,null,[{key:"defaultProps",value:function(){return{horizontal:{detail:"横向翻转坐标系",documentation:"横向翻转坐标系",insertText:"horizontal: ",default:!1,values:[!0,!1]},_props:{xAxis:h.default,yAxis:x.default,grid:l.default}}}}]),p(v,[{key:"setDefaultOpt",value:function(i,t){var e={field:this.dataFrame.fields[0],xAxis:{layoutType:"rule",posParseToInt:!1},grid:{}};if(d._.extend(!0,e,i),e.yAxis){var s=[];d._.each(d._.flatten([e.yAxis]),function(i){s.push(d._.clone(i))}),e.yAxis=s}else e.yAxis=[];for(var n=d._.flatten([t._opt.graphs]),a=0;a<n.length;a++){var r=n[a];if("bar"==r.type&&(e.xAxis.layoutType="peak"),r.field){var o="left";"right"==r.yAxisAlign&&(o="right");var h=null;(h=d._.find(e.yAxis,function(i,t){return i.align==o||!i.align&&t==("left"==o?0:1)}))?h.align||(h.align=o):(h={align:o,field:[]},e.yAxis.push(h)),h.field?d._.isArray(h.field)||(h.field=[h.field]):h.field=[],d._.isArray(r.field)?h.field=h.field.concat(r.field):h.field.push(r.field)}}var x=[],l=[];return d._.each(e.yAxis,function(i,t){i.align||(i.align=t?"right":"left"),"left"==i.align?x.push(i):l.push(i)}),e.yAxis=x.concat(l),e.horizontal&&(e.xAxis.isH=!0,d._.each(e.yAxis,function(i){i.isH=!0})),"enabled"in e&&(d._.extend(!0,e.xAxis,{enabled:e.enabled}),d._.each(e.yAxis,function(i){d._.extend(!0,i,{enabled:e.enabled})}),e.grid.enabled=e.enabled),"animation"in e&&(d._.extend(!0,e.xAxis,{animation:e.animation}),d._.each(e.yAxis,function(i){d._.extend(!0,i,{animation:e.animation})}),e.grid.animation=e.animation),e}},{key:"init",value:function(){this._initModules(),this.fieldsMap=this.setFieldsMap({type:"yAxis"})}},{key:"resetData",value:function(i){var e=this;this.dataFrame=i;var t=this.getAxisDataFrame(this.xAxis.field);this._xAxis.resetData(t),d._.each(this._yAxis,function(i){var t=e.getAxisDataFrame(i.field);i.resetData(t)}),this._resetXY_axisLine_pos(),this._yAxisLeft||this._yAxisRight,this._grid.reset({animation:!1})}},{key:"draw",value:function(i){i=i||{};var t=this.app.padding,e=i.height||this.app.height,s=i.width||this.app.width;if(this.horizontal){var n=s;s=e,e=n}var a=e-this._xAxis.height-t.bottom,r=0,o=0;this._yAxisLeft&&(this._yAxisLeft.draw({pos:{x:t.left,y:a},yMaxHeight:a-t.top,resize:i.resize}),r=this._yAxisLeft.width),this._yAxisRight&&(this._yAxisRight.draw({pos:{x:0,y:a},yMaxHeight:a-t.top,resize:i.resize}),o=this._yAxisRight.width),this._xAxis.draw({pos:{x:t.left+r,y:a},width:s-r-t.left-o-t.right,resize:i.resize}),this._yAxisRight&&this._yAxisRight.setX(r+t.left+this._xAxis.width),this._grid.draw({width:this._xAxis.width,height:this._yAxis[0].height,pos:{x:r+t.left,y:a},resize:i.resize}),this.width=this._xAxis.width,this.height=this._yAxis[0].height,this.origin.x=r+t.left,this.origin.y=a,this._initInduce(),this._resetXY_axisLine_pos(),this.horizontal&&this._horizontal({w:s,h:e})}},{key:"_resetXY_axisLine_pos",value:function(){var i,e=this;this._xAxis.enabled&&("center"==this._xAxis.axisLine.position&&(i=-this._yAxis[0].height/2),"center"==this._xAxis.axisLine.position&&(i=-this._yAxis[0].height/2),d._.isNumber(this._xAxis.axisLine.position)&&(i=-this._yAxis[0].getPosOfVal(this._xAxis.axisLine.position)),void 0!==i&&(this._xAxis._axisLine.context.y=i)),d._.each(this._yAxis,function(i){var t;i.enabled&&("center"==i.axisLine.position&&(t=e._xAxis.width/2),d._.isNumber(i.axisLine.position)&&(t=e._xAxis.getPosOfVal(i.axisLine.position)),void 0!==t&&(i._axisLine.context.x=t))})}},{key:"getSizeAndOrigin",value:function(){var i={width:this.width,height:this.height,origin:this.origin};if(this.horizontal){var t=this.app.padding,e=t.bottom,s=t.right;i={width:this._yAxis[0].height,height:this._xAxis.width,origin:{x:this._xAxis.height+e,y:this._yAxis[0].height+s}}}return i}},{key:"_initModules",value:function(){this._grid=new l.default(this.grid,this),this.sprite.addChild(this._grid.sprite);var i=this.getAxisDataFrame(this.xAxis.field);this._xAxis=new h.default(this.xAxis,i,this),this._axiss.push(this._xAxis),this.sprite.addChild(this._xAxis.sprite);var t,e,s,n,a=this.yAxis;d._.isArray(a)||(a=[a]),(t=d._.find(a,function(i){return"left"==i.align}))&&(s=this.getAxisDataFrame(t.field),this._yAxisLeft=new x.default(t,s,this),this._yAxisLeft.axis=t,this.sprite.addChild(this._yAxisLeft.sprite),this._yAxis.push(this._yAxisLeft),this._axiss.push(this._yAxisLeft)),(e=d._.find(a,function(i){return"right"==i.align}))&&(n=this.getAxisDataFrame(e.field),this._yAxisRight=new x.default(e,n,this),this._yAxisRight.axis=e,this.sprite.addChild(this._yAxisRight.sprite),this._yAxis.push(this._yAxisRight),this._axiss.push(this._yAxisRight))}},{key:"_horizontal",value:function(i){var e=i.h,s=i.w;d._.each([this.sprite.context],function(i){i.x+=(e-s)/2,i.y+=(s-e)/2;var t={x:s/2,y:e/2};i.rotation=90,i.rotateOrigin=t})}},{key:"changeFieldEnabled",value:function(i){this.setFieldEnabled(i);var t=this.getFieldMapOf(i),e=t.yAxis||t.rAxis,s=this.getEnabledFieldsOf(e);e.resetData(this.getAxisDataFrame(s)),this._resetXY_axisLine_pos(),this._grid.reset({animation:!1})}},{key:"_initInduce",value:function(){var t=this;t.induce=new o.default.Shapes.Rect({id:"induce",context:{x:t.origin.x,y:t.origin.y-t.height,width:t.width,height:t.height,fillStyle:"#000000",globalAlpha:0,cursor:"pointer"}}),t.sprite.getChildById("induce")||t.sprite.addChild(t.induce),t.induce.on(d.event.types.get(),function(i){t.fire(i.type,i),t.app.fire(i.type,i)})}},{key:"getTipsInfoHandler",value:function(i){var t=i.point.x;i.target!==this.induce&&(t=this.induce.globalToLocal(i.target.localToGlobal(i.point)).x);var e=this._xAxis.getNodeInfoOfX(t),s={xAxis:e,dimension_1:e,title:e.text,iNode:e.ind,nodes:[]};return i.eventInfo&&(d._.extend(!0,s,i.eventInfo),s.xAxis&&(i.eventInfo.xAxis=e)),s}},{key:"getPoint",value:function(i){var t={x:0,y:void 0},e={type:"yAxis",field:i.field},s=this.getAxis({type:"xAxis"}),n=this.getAxis(e),a=i.iNode||0,r=i.value;"x"in r||(r.x=d._.flatten(s.dataOrg)[a]),t.x=s.getPosOf({ind:a,val:r.x});var o=r.y;return isNaN(o)||null==o||""===o?t.y=void 0:t.y=-n.getPosOfVal(o),{pos:t,value:r}}},{key:"getAxisOriginPoint",value:function(i){var t=this.getAxis(i);return{pos:-t.originPos,value:t.origin}}},{key:"getOriginPos",value:function(i){var t={type:"yAxis",field:i.field},e=this.getAxis({type:"xAxis"}),s=this.getAxis(t);return{x:e.originPos,y:-s.originPos}}}]),v);function v(i,t){var e;return function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),e=function(i,t){return!t||"object"!==u(t)&&"function"!=typeof t?_(i):t}(this,y(v).call(this,i,t)),d._.extend(!0,_(e),(0,d.getDefaultProps)(v.defaultProps()),e.setDefaultOpt(i,t)),e.type="rect",e._xAxis=null,e._yAxis=[],e._yAxisLeft=null,e._yAxisRight=null,e._grid=null,e.init(i),e}d.global.registerComponent(A,"coord","rect"),i.default=A});