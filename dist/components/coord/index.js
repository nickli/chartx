"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_component=_interopRequireDefault(require("../component")),_canvax=_interopRequireDefault(require("canvax")),_mmvis=require("mmvis"),coordBase=function(e){function r(e,i){var t;return(0,_classCallCheck2.default)(this,r),t=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(r).call(this,e,i)),_mmvis._.extend(!0,(0,_assertThisInitialized2.default)(t),(0,_mmvis.getDefaultProps)(r.defaultProps())),t.name="coord",t._opt=e,t.app=i,t.dataFrame=t.app.dataFrame,t.sprite=new _canvax.default.Display.Sprite({name:"coord_"+e.type}),t.app.coordSprite.addChild(t.sprite),t.fieldsMap=null,t.induce=null,t._axiss=[],t}return(0,_inherits2.default)(r,e),(0,_createClass2.default)(r,null,[{key:"defaultProps",value:function(){return{type:{detail:"坐标系组件",documentation:"坐标系组件，可选值有'rect'（二维直角坐标系）,'polar'（二维极坐标系）,'box'（三维直角坐标系） ",insertText:"type: ",default:"",values:["rect","polar","box","polar3d"]},width:{detail:"坐标系width",default:0},height:{detail:"坐标系height",default:0},origin:{detail:"坐标系原点",propertys:{x:{detail:"原点x位置",default:0},y:{detail:"原点x位置",default:0}}}}}}]),(0,_createClass2.default)(r,[{key:"setFieldsMap",value:function(e){var n=this,l=0,s=e.type||"yAxis",i=[];return _mmvis._.each(this.getAxiss(e),function(e){e.field&&(i=i.concat(e.field))}),function e(i){_mmvis._.isString(i)&&(i=[i]);for(var t=_mmvis._.clone(i),r=0,a=i.length;r<a;r++)_mmvis._.isString(i[r])&&(t[r]={field:i[r],enabled:!0,color:n.app.getTheme(l),ind:l++},t[r][s]=n.getAxis({type:s,field:i[r]})),_mmvis._.isArray(i[r])&&(t[r]=e(i[r]));return t}(i)}},{key:"setFieldEnabled",value:function(r){!function t(e){_mmvis._.each(e,function(e,i){_mmvis._.isArray(e)?t(e):e.field&&e.field==r&&(e.enabled=!e.enabled)})}(this.fieldsMap)}},{key:"getFieldMapOf",value:function(r){var a=null;return function t(e){_mmvis._.each(e,function(e,i){if(_mmvis._.isArray(e))t(e);else if(e.field&&e.field==r)return a=e,!1})}(this.fieldsMap),a}},{key:"getEnabledFieldsOf",value:function(r){var a=[],n=r?r.type:"yAxis";return _mmvis._.each(this.fieldsMap,function(e,i){if(_mmvis._.isArray(e)){var t=[];_mmvis._.each(e,function(e,i){e[n]===r&&e.field&&e.enabled&&t.push(e.field)}),t.length&&a.push(t)}else e[n]===r&&e.field&&e.enabled&&a.push(e.field)}),a}},{key:"filterEnabledFields",value:function(e){var t=this,r=[];return _mmvis._.isArray(e)||(e=[e]),_mmvis._.each(e,function(e){if(_mmvis._.isArray(e)){var i=[];_mmvis._.each(e,function(e){t.getFieldMapOf(e).enabled&&i.push(e)}),i.length&&r.push(i)}else t.getFieldMapOf(e).enabled&&r.push(e)}),r}},{key:"getAxisDataFrame",value:function(e){return{field:e,org:this.dataFrame.getDataOrg(e,function(e){return null==e||""==e?e:isNaN(Number(e))?e:Number(e)})}}},{key:"hide",value:function(e){this.changeFieldEnabled(e)}},{key:"show",value:function(e){this.changeFieldEnabled(e)}},{key:"getSizeAndOrigin",value:function(){return{width:this.width,height:this.height,origin:this.origin}}},{key:"getPoint",value:function(){}},{key:"getAxisOriginPoint",value:function(){}},{key:"getOriginPos",value:function(){}},{key:"getAxis",value:function(e){return this.getAxiss(e)[0]}},{key:"getAxiss",value:function(l){var s=[],u=0;for(var e in l)u++;return _mmvis._.each(this._axiss,function(e){var i=0;for(var t in l)if("field"==t){var r=_mmvis._.flatten([e[t]]),a=_mmvis._.flatten([l[t]]),n=!0;_mmvis._.each(a,function(e){-1==_mmvis._.indexOf(r,e)&&(n=!1)}),n&&i++}else JSON.stringify(e[t])==JSON.stringify(l[t])&&i++;u==i&&s.push(e)}),s}}]),r}(_component.default);exports.default=coordBase;