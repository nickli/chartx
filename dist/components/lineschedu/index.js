"use strict";!function(t,e){if("function"==typeof define&&define.amd)define(["exports","../component","canvax","mmvis"],e);else if("undefined"!=typeof exports)e(exports,require("../component"),require("canvax"),require("mmvis"));else{var i={};e(i,t.component,t.canvax,t.mmvis),t.undefined=i}}(void 0,function(t,e,i,y){Object.defineProperty(t,"__esModule",{value:!0});var n=o(e),g=o(i);function o(t){return t&&t.__esModule?t:{default:t}}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(p,n.default),u(p,null,[{key:"defaultProps",value:function(){return{lineField:{detail:"对应的line字段",default:null},style:{detail:"默认色",default:"#3995ff"},fillStyle:{detail:"节点填充色",default:"#ffffff"},lineWidth:{detail:"线宽",default:2},radius:{detail:"圆点半径",default:6},timeFontSize:{detail:"时间文本大小",default:14},timeFontColor:{detail:"时间文本颜色",default:"#606060"},listFontSize:{detail:"列表信息文本大小",default:12}}}}]),u(p,[{key:"reset",value:function(t){y._.extend(!0,this,t),this.lineDatas=null,this.sprite.removeAllChildren(),this.draw()}},{key:"draw",value:function(){var t=this,e=this.app.getComponent({name:"coord"});this.pos={x:e.origin.x,y:e.origin.y},this.setPosition();var i=t.app.getComponent({name:"graphs",type:"line",field:t.lineField});t.lineDatas=i.data[t.lineField].data;var n=this.app.getComponent({name:"coord"}).getAxis({type:"xAxis"}).getIndexOfVal(this.time);if(-1!=n){var o=this.lineDatas[n];if(null!=o.y){var r=t._getNodeY(o,e),l=o.x,a=new g.default.Display.Sprite({context:{x:l-20}});this.sprite.addChild(a);var s=0,u=new g.default.Display.Text(t.time,{context:{fillStyle:this.timeFontColor||this.style,fontSize:this.timeFontSize}});a.addChild(u),s=u.getTextHeight();var d=u.getTextWidth(),f=new g.default.Display.Text(y._.flatten([t.list]).join("\n"),{context:{y:s,fillStyle:this.listFontColor||this.style,fontSize:this.listFontSize}});a.addChild(f),s+=f.getTextHeight(),(d=Math.max(d,f.getTextWidth()))+l-20>e.width+t.app.padding.right&&(a.context.x=e.width+t.app.padding.right,u.context.textAlign="right",f.context.textAlign="right");var p=0;"online"==t.status?(p=r-(this.radius+3)-s,Math.abs(p)>e.origin.y&&(p=-e.origin.y,r=-(e.origin.y-(this.radius+3)-s))):0<(p=r+(this.radius+3))+s&&(p=-s,r=-(this.radius+3)-s),a.context.y=p;var h=new g.default.Shapes.BrokenLine({context:{pointList:[[l,r],[l,o.y]],strokeStyle:t.style,lineWidth:t.lineWidth}});t.sprite.addChild(h);var c=new g.default.Shapes.Circle({context:{x:l,y:r,r:t.radius,fillStyle:t.fillStyle,strokeStyle:t.style,lineWidth:t.lineWidth}});t.sprite.addChild(c)}}}},{key:"_getNodeY",value:function(t,e){var i=this.app.height,n=(e.height,t.y);return"online"==this.status?n-=Math.min(50,.3*(i-Math.abs(n))):n+=Math.min(50,.3*Math.abs(n)),n}}]),p);function p(t,e){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p),(i=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?a(t):e}(this,l(p).call(this,t,e))).name="lineSchedu",y._.extend(!0,a(i),(0,y.getDefaultProps)(p.defaultProps()),t),i.lineDatas=null,i.sprite=new g.default.Display.Sprite,i.app.graphsSprite.addChild(i.sprite),i}y.global.registerComponent(f,"lineSchedu"),t.default=f});