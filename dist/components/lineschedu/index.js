"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_component=_interopRequireDefault(require("../component")),_canvax=_interopRequireDefault(require("canvax")),_mmvis=require("mmvis"),lineSchedu=function(e){function a(e,t){var i;return(0,_classCallCheck2.default)(this,a),(i=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(a).call(this,e,t))).name="lineSchedu",_mmvis._.extend(!0,(0,_assertThisInitialized2.default)(i),(0,_mmvis.getDefaultProps)(a.defaultProps()),e),i.lineDatas=null,i.sprite=new _canvax.default.Display.Sprite,i.app.graphsSprite.addChild(i.sprite),i}return(0,_inherits2.default)(a,e),(0,_createClass2.default)(a,null,[{key:"defaultProps",value:function(){return{lineField:{detail:"对应的line字段",default:null},style:{detail:"默认色",default:"#3995ff"},fillStyle:{detail:"节点填充色",default:"#ffffff"},lineWidth:{detail:"线宽",default:2},radius:{detail:"圆点半径",default:6},timeFontSize:{detail:"时间文本大小",default:14},timeFontColor:{detail:"时间文本颜色",default:"#606060"},listFontSize:{detail:"列表信息文本大小",default:12}}}}]),(0,_createClass2.default)(a,[{key:"reset",value:function(e){_mmvis._.extend(!0,this,e),this.lineDatas=null,this.sprite.removeAllChildren(),this.draw()}},{key:"draw",value:function(){var e=this,t=this.app.getComponent({name:"coord"});this.pos={x:t.origin.x,y:t.origin.y},this.setPosition();var i=e.app.getComponent({name:"graphs",type:"line",field:e.lineField});e.lineDatas=i.data[e.lineField].data;var a=this.app.getComponent({name:"coord"}).getAxis({type:"xAxis"}).getIndexOfVal(this.time);if(-1!=a){var l=this.lineDatas[a];if(null!=l.y){var r=e._getNodeY(l,t),n=l.x,s=new _canvax.default.Display.Sprite({context:{x:n-20}});this.sprite.addChild(s);var u=0,o=new _canvax.default.Display.Text(e.time,{context:{fillStyle:this.timeFontColor||this.style,fontSize:this.timeFontSize}});s.addChild(o);u=o.getTextHeight();var d=o.getTextWidth(),h=new _canvax.default.Display.Text(_mmvis._.flatten([e.list]).join("\n"),{context:{y:u,fillStyle:this.listFontColor||this.style,fontSize:this.listFontSize}});s.addChild(h),u+=h.getTextHeight(),(d=Math.max(d,h.getTextWidth()))+n-20>t.width+e.app.padding.right&&(s.context.x=t.width+e.app.padding.right,o.context.textAlign="right",h.context.textAlign="right");var p=0;"online"==e.status?(p=r-(this.radius+3)-u,Math.abs(p)>t.origin.y&&(p=-t.origin.y,r=-(t.origin.y-(this.radius+3)-u))):0<(p=r+(this.radius+3))+u&&(p=-u,r=-(this.radius+3)-u),s.context.y=p;var f=new _canvax.default.Shapes.BrokenLine({context:{pointList:[[n,r],[n,l.y]],strokeStyle:e.style,lineWidth:e.lineWidth}});e.sprite.addChild(f);var c=new _canvax.default.Shapes.Circle({context:{x:n,y:r,r:e.radius,fillStyle:e.fillStyle,strokeStyle:e.style,lineWidth:e.lineWidth}});e.sprite.addChild(c)}}}},{key:"_getNodeY",value:function(e,t){var i=this.app.height,a=(t.height,e.y);return"online"==this.status?a-=Math.min(50,.3*(i-Math.abs(a))):a+=Math.min(50,.3*Math.abs(a)),a}}]),a}(_component.default);_mmvis.global.registerComponent(lineSchedu,"lineSchedu");var _default=lineSchedu;exports.default=_default;