"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_component=_interopRequireDefault(require("../component")),_canvax=_interopRequireDefault(require("canvax")),_mmvis=require("mmvis"),_trigger=_interopRequireDefault(require("../trigger")),Circle=_canvax.default.Shapes.Circle,Legend=function(e){function a(e,t){var i;return(0,_classCallCheck2.default)(this,a),(i=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(a).call(this,e,t))).name="legend",_mmvis._.extend(!0,(0,_assertThisInitialized2.default)(i),(0,_mmvis.getDefaultProps)(a.defaultProps()),e),i.data=i._getLegendData(e),!e.direction&&e.position&&("left"==i.position||"right"==i.position?i.direction="v":i.direction="h"),i.sprite=new _canvax.default.Display.Sprite({id:"LegendSprite",context:{x:i.pos.x,y:i.pos.y}}),i.app.stage.addChild(i.sprite),i.widget(),i.layout(),i}return(0,_inherits2.default)(a,e),(0,_createClass2.default)(a,null,[{key:"defaultProps",value:function(){return{data:{detail:"图例数据",default:[],documentation:'                    数据结构为：{name: "uv", color: "#ff8533", field: "" ...}                    如果手动传入数据只需要前面这三个 enabled: true, ind: 0                    外部只需要传field和fillStyle就行了                    '},position:{detail:"图例位置",documentation:"图例所在的方向top,right,bottom,left",default:"top"},direction:{detail:"图例布局方向",default:"h",documentation:"横向 top,bottom --\x3e h left,right -- >v"},textAlign:{detail:"水平方向的对其，默认居左对其",default:"left",documentation:"可选left，center，right"},verticalAlign:{detail:"垂直方向的对其方式，默认居中（待实现）",default:"middle",documentation:"可选top，middle，bottom"},icon:{detail:"图标设置",propertys:{height:{detail:"高",default:26},width:{detail:"图标宽",default:"auto"},shapeType:{detail:"图标的图形类型，目前只实现了圆形",default:"circle"},radius:{detail:"图标（circle）半径",default:5},lineWidth:{detail:"图标描边宽度",default:1},fillStyle:{detail:"图标颜色，一般会从data里面取，这里是默认色",default:"#999"}}},label:{detail:"文本配置",propertys:{textAlign:{detail:"水平对齐方式",default:"left"},textBaseline:{detail:"文本基线对齐方式",default:"middle"},fontColor:{detail:"文本颜色",default:"#333333"},cursor:{detail:"鼠标样式",default:"pointer"},format:{detail:"文本格式化处理函数",default:null}}},activeEnabled:{detail:"是否启动图例的",default:!0},tipsEnabled:{detail:"是否开启图例的tips",default:!1}}}}]),(0,_createClass2.default)(a,[{key:"_getLegendData",value:function(e){var t=e.data;return t?_mmvis._.each(t,function(e,t){e.enabled=!0,e.ind=t}):t=this.app.getLegendData(),t||[]}},{key:"layout",value:function(){var e,t=this.app,i=this.width+this.margin.left+this.margin.right,a=this.height+this.margin.top+this.margin.bottom,n=t.padding.left,l=t.padding.top;return"right"==this.position&&(n=t.width-t.padding.right-i),"bottom"==this.position&&(l=t.height-t.padding.bottom-a/2),"left"==this.position||"right"==this.position?(t.padding[this.position]+=i,e=i,t.height-t.padding.top-t.padding.bottom):"top"!=this.position&&"bottom"!=this.position||(t.padding[this.position]+=a,e=t.width-t.padding.right-t.padding.left,a),"center"==this.textAlign&&(n+=e/2-this.width/2),"right"==this.textAlign&&(n+=e-this.width),this.pos={x:n,y:l},this.pos}},{key:"draw",value:function(){var e=this.app.getComponent({name:"coord"});e&&"rect"==e.type&&("left"!=this.textAlign||"top"!=this.position&&"bottom"!=this.position||(this.pos.x=e.getSizeAndOrigin().origin.x+this.icon.radius)),this.setPosition()}},{key:"widget",value:function(){var d=this,s=this.app.width-this.app.padding.left-this.app.padding.right,p=this.app.height-this.app.padding.top-this.app.padding.bottom,u=0,h=0,f=0,c=0,g=0,m=1,_=!1;_mmvis._.each(this.data,function(t,e){if(!_){var i=new Circle({id:"legend_field_icon_"+e,context:{x:0,y:d.icon.height/3,fillStyle:t.enabled?t.color||"#999":"#ccc",r:d.icon.radius,cursor:"pointer"}});i.on(_mmvis.event.types.get(),function(e){});var a=t.name;d.label.format&&(a=d.label.format(t.name,t));var n=new _canvax.default.Display.Text(a,{id:"legend_field_txt_"+e,context:{x:d.icon.radius+3,y:d.icon.height/3,textAlign:d.label.textAlign,textBaseline:d.label.textBaseline,fillStyle:d.label.fontColor,cursor:d.label.cursor}});n.on(_mmvis.event.types.get(),function(e){});var l=n.getTextWidth()+2*d.icon.radius+20;u=Math.max(u,l);var r={height:d.icon.height};if("v"==d.direction){if(g+d.icon.height>p){if(.3*s<c)return void(_=!0);c+=u,g=0}r.x=c,r.y=g,g+=d.icon.height,f=Math.max(f,g)}else{if(s<c+l){if(d.icon.height*(m+1)>.3*p)return void(_=!0);c=0,m++}r.x=c,r.y=d.icon.height*(m-1),c+=l,h=Math.max(h,c)}var o=new _canvax.default.Display.Sprite({id:"legend_field_"+e,context:r});o.addChild(i),o.addChild(n),o.context.width=l,d.sprite.addChild(o),o.on(_mmvis.event.types.get(),function(e){if("click"==e.type&&d.activeEnabled){if(1==_mmvis._.filter(d.data,function(e){return e.enabled}).length&&t.enabled)return;t.enabled=!t.enabled,i.context.fillStyle=t.enabled?t.color||"#999":"#ccc",t.enabled?d.app.show(t.name,new _trigger.default(this,t)):d.app.hide(t.name,new _trigger.default(this,t))}d.tipsEnabled&&("mouseover"!=e.type&&"mousemove"!=e.type||(e.eventInfo=d._getInfoHandler(e,t)),"mouseout"==e.type&&delete e.eventInfo,d.app.fire(e.type,e))})}}),"h"==this.direction?(d.width=d.sprite.context.width=h,d.height=d.sprite.context.height=d.icon.height*m):(d.width=d.sprite.context.width=c+u,d.height=d.sprite.context.height=f)}},{key:"_getInfoHandler",value:function(e,t){return{type:"legend",triggerType:"legend",trigger:this,tipsEnabled:this.tipsEnabled,nodes:[{name:t.name,fillStyle:t.color}]}}}]),a}(_component.default);_mmvis.global.registerComponent(Legend,"legend");var _default=Legend;exports.default=_default;