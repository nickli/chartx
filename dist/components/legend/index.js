"use strict";!function(t,e){if("function"==typeof define&&define.amd)define(["exports","../component","canvax","mmvis","../trigger"],e);else if("undefined"!=typeof exports)e(exports,require("../component"),require("canvax"),require("mmvis"),require("../trigger"));else{var i={};e(i,t.component,t.canvax,t.mmvis,t.trigger),t.undefined=i}}(void 0,function(t,e,i,b,n){Object.defineProperty(t,"__esModule",{value:!0});var o=a(e),v=a(i),x=a(n);function a(t){return t&&t.__esModule?t:{default:t}}function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,i){return e&&p(t.prototype,e),i&&p(t,i),t}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var w=v.default.Shapes.Circle,u=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(h,o.default),s(h,null,[{key:"defaultProps",value:function(){return{data:{detail:"图例数据",default:[],documentation:'                    数据结构为：{name: "uv", color: "#ff8533", field: "" ...}                    如果手动传入数据只需要前面这三个 enabled: true, ind: 0                    外部只需要传field和fillStyle就行了                    '},position:{detail:"图例位置",documentation:"图例所在的方向top,right,bottom,left",default:"top"},direction:{detail:"图例布局方向",default:"h",documentation:"横向 top,bottom --\x3e h left,right -- >v"},textAlign:{detail:"水平方向的对其，默认居左对其",default:"left",documentation:"可选left，center，right"},verticalAlign:{detail:"垂直方向的对其方式，默认居中（待实现）",default:"middle",documentation:"可选top，middle，bottom"},icon:{detail:"图标设置",propertys:{height:{detail:"高",default:26},width:{detail:"图标宽",default:"auto"},shapeType:{detail:"图标的图形类型，目前只实现了圆形",default:"circle"},radius:{detail:"图标（circle）半径",default:5},lineWidth:{detail:"图标描边宽度",default:1},fillStyle:{detail:"图标颜色，一般会从data里面取，这里是默认色",default:"#999"}}},label:{detail:"文本配置",propertys:{textAlign:{detail:"水平对齐方式",default:"left"},textBaseline:{detail:"文本基线对齐方式",default:"middle"},fontColor:{detail:"文本颜色",default:"#333333"},cursor:{detail:"鼠标样式",default:"pointer"},format:{detail:"文本格式化处理函数",default:null}}},activeEnabled:{detail:"是否启动图例的",default:!0},tipsEnabled:{detail:"是否开启图例的tips",default:!1}}}}]),s(h,[{key:"_getLegendData",value:function(t){var e=t.data;return e?b._.each(e,function(t,e){t.enabled=!0,t.ind=e}):e=this.app.getLegendData(),e||[]}},{key:"layout",value:function(){var t,e=this.app,i=this.width+this.margin.left+this.margin.right,n=this.height+this.margin.top+this.margin.bottom,o=e.padding.left,a=e.padding.top;return"right"==this.position&&(o=e.width-e.padding.right-i),"bottom"==this.position&&(a=e.height-e.padding.bottom-n/2),"left"==this.position||"right"==this.position?(e.padding[this.position]+=i,t=i,e.height,e.padding.top,e.padding.bottom):"top"!=this.position&&"bottom"!=this.position||(e.padding[this.position]+=n,t=e.width-e.padding.right-e.padding.left),"center"==this.textAlign&&(o+=t/2-this.width/2),"right"==this.textAlign&&(o+=t-this.width),this.pos={x:o,y:a},this.pos}},{key:"draw",value:function(){var t=this.app.getComponent({name:"coord"});t&&"rect"==t.type&&("left"!=this.textAlign||"top"!=this.position&&"bottom"!=this.position||(this.pos.x=t.getSizeAndOrigin().origin.x+this.icon.radius)),this.setPosition()}},{key:"widget",value:function(){var d=this,p=this.app.width-this.app.padding.left-this.app.padding.right,s=this.app.height-this.app.padding.top-this.app.padding.bottom,f=0,u=0,h=0,c=0,g=0,y=1,m=!1;b._.each(this.data,function(e,t){if(!m){var i=new w({id:"legend_field_icon_"+t,context:{x:0,y:d.icon.height/3,fillStyle:e.enabled?e.color||"#999":"#ccc",r:d.icon.radius,cursor:"pointer"}});i.on(b.event.types.get(),function(t){});var n=e.name;d.label.format&&(n=d.label.format(e.name,e));var o=new v.default.Display.Text(n,{id:"legend_field_txt_"+t,context:{x:d.icon.radius+3,y:d.icon.height/3,textAlign:d.label.textAlign,textBaseline:d.label.textBaseline,fillStyle:d.label.fontColor,cursor:d.label.cursor}});o.on(b.event.types.get(),function(t){});var a=o.getTextWidth()+2*d.icon.radius+20;f=Math.max(f,a);var l={height:d.icon.height};if("v"==d.direction){if(g+d.icon.height>s){if(.3*p<c)return void(m=!0);c+=f,g=0}l.x=c,l.y=g,g+=d.icon.height,h=Math.max(h,g)}else{if(p<c+a){if(d.icon.height*(y+1)>.3*s)return void(m=!0);c=0,y++}l.x=c,l.y=d.icon.height*(y-1),c+=a,u=Math.max(u,c)}var r=new v.default.Display.Sprite({id:"legend_field_"+t,context:l});r.addChild(i),r.addChild(o),r.context.width=a,d.sprite.addChild(r),r.on(b.event.types.get(),function(t){if("click"==t.type&&d.activeEnabled){if(1==b._.filter(d.data,function(t){return t.enabled}).length&&e.enabled)return;e.enabled=!e.enabled,i.context.fillStyle=e.enabled?e.color||"#999":"#ccc",e.enabled?d.app.show(e.name,new x.default(this,e)):d.app.hide(e.name,new x.default(this,e))}d.tipsEnabled&&("mouseover"!=t.type&&"mousemove"!=t.type||(t.eventInfo=d._getInfoHandler(t,e)),"mouseout"==t.type&&delete t.eventInfo,d.app.fire(t.type,t))})}}),"h"==this.direction?(d.width=d.sprite.context.width=u,d.height=d.sprite.context.height=d.icon.height*y):(d.width=d.sprite.context.width=c+f,d.height=d.sprite.context.height=h)}},{key:"_getInfoHandler",value:function(t,e){return{type:"legend",triggerType:"legend",trigger:this,tipsEnabled:this.tipsEnabled,nodes:[{name:e.name,fillStyle:e.color}]}}}]),h);function h(t,e){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(i=function(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?d(t):e}(this,r(h).call(this,t,e))).name="legend",b._.extend(!0,d(i),(0,b.getDefaultProps)(h.defaultProps()),t),i.data=i._getLegendData(t),!t.direction&&t.position&&("left"==i.position||"right"==i.position?i.direction="v":i.direction="h"),i.sprite=new v.default.Display.Sprite({id:"LegendSprite",context:{x:i.pos.x,y:i.pos.y}}),i.app.stage.addChild(i.sprite),i.widget(),i.layout(),i}b.global.registerComponent(u,"legend"),t.default=u});