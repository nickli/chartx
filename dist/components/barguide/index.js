"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_component=_interopRequireDefault(require("../component")),_canvax=_interopRequireDefault(require("canvax")),_mmvis=require("mmvis"),barGuide=function(e){function l(e,t){var a;return(0,_classCallCheck2.default)(this,l),(a=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(l).call(this,e,t))).name="barGuide",a.data=null,a.barDatas=null,a._yAxis=null,a.sprite=null,_mmvis._.extend(!0,(0,_assertThisInitialized2.default)(a),(0,_mmvis.getDefaultProps)(l.defaultProps()),e),a._yAxis=a.app.getComponent({name:"coord"})._yAxis["left"==a.yAxisAlign?0:1],a.sprite=new _canvax.default.Display.Sprite,a.app.graphsSprite.addChild(a.sprite),a}return(0,_inherits2.default)(l,e),(0,_createClass2.default)(l,null,[{key:"defaultProps",value:function(){return{field:{detail:"字段配置",default:null},barField:{detail:"这个guide对应的bar Graph 的field",default:null},yAxisAlign:{detail:"这个guide组件回到到哪个y轴",default:"left"},node:{detail:"单个节点配置",propertys:{shapeType:{detail:"节点绘制的图形类型",default:"circle"},lineWidth:{detail:"图表描边线宽",default:3},radius:{detail:"图形半径",default:6},fillStyle:{detail:"填充色",default:"#19dea1"},strokeStyle:{detail:"描边色",default:"#fff"}}},label:{detail:"文本配置",propertys:{fontSize:{detail:"字体大小",default:12},fontColor:{detail:"字体颜色",default:"#19dea1"},verticalAlign:{detail:"垂直对齐方式",default:"bottom"},textAlign:{detail:"水平对齐方式",default:"center"},strokeStyle:{detail:"文本描边颜色",default:"#fff"},lineWidth:{detail:"文本描边线宽",default:0},format:{detail:"文本格式处理函数",default:null}}}}}}]),(0,_createClass2.default)(l,[{key:"reset",value:function(e){_mmvis._.extend(!0,this,e),this.barDatas=null,this.data=null,this.sprite.removeAllChildren(),this.draw()}},{key:"draw",value:function(){var s=this,e=this.app.getComponent({name:"coord"});this.pos={x:e.origin.x,y:e.origin.y},this.setPosition(),_mmvis._.each(s.app.getComponents({name:"graphs"}),function(e){if("bar"==e.type&&e.data[s.barField])return s.barDatas=e.data[s.barField],!1}),this.data=_mmvis._.flatten(s.app.dataFrame.getDataOrg(s.field)),this.barDatas&&_mmvis._.each(this.data,function(e,t){var a=-s._yAxis.getPosOfVal(e),l=s.barDatas[t],i=new _canvax.default.Shapes.Circle({context:{x:l.x+l.width/2,y:a,r:s.node.radius,fillStyle:s.node.fillStyle,strokeStyle:s.node.strokeStyle,lineWidth:s.node.lineWidth}}),r=e;_mmvis._.isFunction(s.label.format)&&(r=s.label.format(e,l));var n=new _canvax.default.Display.Text(r,{context:{x:l.x+l.width/2,y:a-s.node.radius-1,fillStyle:s.label.fontColor,lineWidth:s.label.lineWidth,strokeStyle:s.label.strokeStyle,fontSize:s.label.fontSize,textAlign:s.label.textAlign,textBaseline:s.label.verticalAlign}});s.sprite.addChild(i),s.sprite.addChild(n)})}},{key:"_getProp",value:function(e,t,a){var l=e;return _mmvis._.isFunction(e)&&(l=e.apply(this,[t,a])),l}}]),l}(_component.default);_mmvis.global.registerComponent(barGuide,"barGuide");var _default=barGuide;exports.default=_default;