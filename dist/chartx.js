var Chartx=function(){"use strict";var t,e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t},r=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},o={},l={},u=Array.prototype,d=Object.prototype,c=Function.prototype,f=u.push,p=u.slice,g=u.concat,v=d.toString,y=d.hasOwnProperty,x=u.forEach,m=u.map,b=u.filter,k=u.every,w=u.some,S=u.indexOf,A=Array.isArray,C=Object.keys,P=(c.bind,Math.pow(2,53)-1),T=(t="length",function(e){return null==e?void 0:e[t]}),L=function(t){var e=T(t);return"number"==typeof e&&e>=0&&e<=P};o.values=function(t){for(var e=o.keys(t),i=e.length,n=new Array(i),a=0;a<i;a++)n[a]=t[e[a]];return n},o.keys=C||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)o.has(t,i)&&e.push(i);return e},o.has=function(t,e){return y.call(t,e)};var O=o.each=o.forEach=function(t,e,i){if(null!=t)if(x&&t.forEach===x)t.forEach(e,i);else if(t.length===+t.length){for(var n=0,a=t.length;n<a;n++)if(e.call(i,t[n],n,t)===l)return}else{var r=o.keys(t);for(n=0,a=r.length;n<a;n++)if(e.call(i,t[r[n]],r[n],t)===l)return}};o.compact=function(t){return o.filter(t,o.identity)},o.filter=o.select=function(t,e,i){var n=[];return null==t?n:b&&t.filter===b?t.filter(e,i):(O(t,function(t,a,r){e.call(i,t,a,r)&&n.push(t)}),n)},O(["Arguments","Function","String","Number","Date","RegExp"],function(t){o["is"+t]=function(e){return v.call(e)=="[object "+t+"]"}}),o.isArguments=function(t){return!(!t||!o.has(t,"callee"))},o.isFunction=function(t){return"function"==typeof t},o.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},o.isNaN=function(t){return o.isNumber(t)&&t!=+t},o.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==v.call(t)},o.isNull=function(t){return null===t},o.isEmpty=function(t){if(null==t)return!0;if(o.isArray(t)||o.isString(t))return 0===t.length;for(var e in t)if(o.has(t,e))return!1;return!0},o.isElement=function(t){return!(!t||1!==t.nodeType)},o.isArray=A||function(t){return"[object Array]"==v.call(t)},o.isObject=function(t){return t===Object(t)},o.identity=function(t){return t},o.indexOf=function(t,e,i){if(null==t)return-1;var n=0,a=t.length;if(i){if("number"!=typeof i)return t[n=o.sortedIndex(t,e)]===e?n:-1;n=i<0?Math.max(0,a+i):i}if(S&&t.indexOf===S)return t.indexOf(e,i);for(;n<a;n++)if(t[n]===e)return n;return-1},o.isWindow=function(t){return null!=t&&t==t.window};o.flatten=function(t,e){return function t(e,i,n){return i&&o.every(e,o.isArray)?g.apply(n,e):(O(e,function(e){o.isArray(e)||o.isArguments(e)?i?f.apply(n,e):t(e,i,n):n.push(e)}),n)}(t,e,[])},o.every=o.all=function(t,e,i){e||(e=o.identity);var n=!0;return null==t?n:k&&t.every===k?t.every(e,i):(O(t,function(t,a,r){if(!(n=n&&e.call(i,t,a,r)))return l}),!!n)},o.min=function(t,e,i){if(!e&&o.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&o.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return O(t,function(t,a,r){var s=e?e.call(i,t,a,r):t;s<n.computed&&(n={value:t,computed:s})}),n.value},o.max=function(t,e,i){if(!e&&o.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&o.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return O(t,function(t,a,r){var s=e?e.call(i,t,a,r):t;s>n.computed&&(n={value:t,computed:s})}),n.value},o.find=o.detect=function(t,e,i){var n;return D(t,function(t,a,r){if(e.call(i,t,a,r))return n=t,!0}),n};var D=o.some=o.any=function(t,e,i){e||(e=o.identity);var n=!1;return null==t?n:w&&t.some===w?t.some(e,i):(O(t,function(t,a,r){if(n||(n=e.call(i,t,a,r)))return l}),!!n)};function M(t){return parseFloat(t.toPrecision(14))}o.without=function(t){return o.difference(t,p.call(arguments,1))},o.difference=function(t){var e=g.apply(u,p.call(arguments,1));return o.filter(t,function(t){return!o.contains(e,t)})},o.uniq=o.unique=function(t,e,i,n){o.isFunction(e)&&(n=i,i=e,e=!1);var a=i?o.map(t,i,n):t,r=[],s=[];return O(a,function(i,n){(e?n&&s[s.length-1]===i:o.contains(s,i))||(s.push(i),r.push(t[n]))}),r},o.map=o.collect=function(t,e,i){var n=[];return null==t?n:m&&t.map===m?t.map(e,i):(O(t,function(t,a,r){n.push(e.call(i,t,a,r))}),n)},o.contains=o.include=function(t,e){return null!=t&&(S&&t.indexOf===S?-1!=t.indexOf(e):D(t,function(t){return t===e}))},o.pluck=function(t,e){return o.map(t,function(t){return t[e]})},o.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},o.shuffle=function(t){return o.sample(t,1/0)},o.sample=function(t,e,i){if(null==e||i)return L(t)||(t=o.values(t)),t[o.random(t.length-1)];var n=L(t)?o.clone(t):o.values(t),a=T(n);e=Math.max(Math.min(e,a),0);for(var r=a-1,s=0;s<e;s++){var l=o.random(s,r),h=n[s];n[s]=n[l],n[l]=h}return n.slice(0,e)},o.extend=function(){var t,i,n,a,r=arguments[0]||{},s=1,l=arguments.length,h=!1;for("boolean"==typeof r&&(h=r,r=arguments[1]||{},s=2),"object"===(void 0===r?"undefined":e(r))||o.isFunction(r)||(r={}),l===s&&(r=this,--s);s<l;s++)if(null!=(t=arguments[s]))for(i in t)n=r[i],r!==(a=t[i])&&(h&&a&&o.isObject(a)&&a.constructor===Object?r[i]=o.extend(h,n,a):r[i]=a);return r},o.clone=function(t){return o.isObject(t)?o.isArray(t)?t.slice():o.extend(!0,{},t):t},o.euclideanModulo=function(t,e){return(t%e+e)%e},o.DEG2RAD=Math.PI/180,o.RAD2DEG=180/Math.PI,o.degToRad=function(t){return t*o.DEG2RAD},o.radToDeg=function(t){return t*o.RAD2DEG};var I=function(t,e,i){return o.uniq(function(t,e,i){t=o.without(t,void 0,null,"");var n=i&&i.scale?parseFloat(i.scale):1,a=i&&i.isInt?1:0;isNaN(n)&&(n=1);var r=o.max(t),s=r;r*=n;var l=o.min(t);if(l==r)return r>0?[l=0,r]:r<0?[r,0]:[0,r=1];var h=r-l;if(h){var u=l;(l-=.05*h)<0&&u>=0&&(l=0),r+=.05*h}var d=.3*(r-l);d=function(t,e){var i,n=[1,2,5,10];i=t/e;for(var a=0;a<n.length&&(t=n[a],!(i<=(n[a]+(n[a+1]||n[a]))/2));a++);return t*=e}(d,Math.pow(10,Math.floor(Math.log(d)/Math.LN10))),a&&(d=Math.ceil(d));var c,f,p=M(Math.floor(l/d)*d),g=M(Math.ceil(r/d)*d),v=[];for(c=p;c<=g&&(v.push(c),(c=M(c+d))!==f);)f=c;return v.length>=3&&v[v.length-2]>=s&&v.pop(),v}(t,0,i))},R=function(){function t(e,n){i(this,t),this.layoutType=e.layoutType||"proportion",this._opt=o.clone(e),this.dataOrg=n||[],this.sectionHandler=null,this.dataSection=[],this.dataSectionLayout=[],this.axisLength=1,this._cellCount=null,this._cellLength=null,this.waterLine=null,this.dataSectionGroup=[],this.middleweight=null,this.symmetric=!1,this.origin=null,this.originPos=0,this._originTrans=0,this._min=null,this._max=null,this.sort=null,this.posParseToInt=!1}return n(t,[{key:"resetDataOrg",value:function(t){this.dataSection=[],this.dataSectionGroup=[],this.dataOrg=t,this._cellCount=null,this._cellLength=null}},{key:"setAxisLength",value:function(t){this.axisLength=t,this.calculateProps()}},{key:"calculateProps",value:function(){var t=this;"proportion"==this.layoutType&&(null==this._min&&(this._min=o.min(this.dataSection)),null==this._max&&(this._max=o.max(this.dataSection)),"origin"in this._opt||(this.origin=0,o.max(this.dataSection)<0&&(this.origin=o.max(this.dataSection)),o.min(this.dataSection)>0&&(this.origin=o.min(this.dataSection))),this._originTrans=this._getOriginTrans(this.origin),this.originPos=this.getPosOfVal(this.origin)),this.dataSectionLayout=[],o.each(this.dataSection,function(e,i){var n=i;"proportion"==t.layoutType&&(n=t.getIndexOfVal(e));var a=parseInt(t.getPosOf({ind:i,val:e}),10);t.dataSectionLayout.push({val:e,ind:n,pos:a})})}},{key:"getDataSection",value:function(){return this.dataSection}},{key:"setDataSection",value:function(t){if(o.isEmpty(t)&&o.isEmpty(this._opt.dataSection))if("proportion"==this.layoutType){var e=this._getDataSection();if("origin"in this._opt&&e.push(this._opt.origin),1==e.length&&e.push(2*e[0]),this.waterLine&&e.push(this.waterLine),this.symmetric){var i=o.min(e),n=o.max(e);Math.abs(i)>Math.abs(n)?e.push(Math.abs(i)):e.push(-Math.abs(n))}for(var a=0,r=e.length;a<r;a++)e[a]=Number(e[a]),isNaN(e[a])&&(e.splice(a,1),a--,r--);if(o.isFunction(this.sectionHandler)&&(this.dataSection=this.sectionHandler(e)),this.dataSection&&this.dataSection.length||(this.dataSection=I(e,3)),this.symmetric){i=o.min(this.dataSection),n=o.max(this.dataSection);Math.abs(i)>Math.abs(n)?this.dataSection.push(Math.abs(i)):this.dataSection.unshift(-Math.abs(n))}0==this.dataSection.length&&(this.dataSection=[0]),this.dataSectionGroup=[o.clone(this.dataSection)],this._middleweight(),this._sort()}else this.dataSection=o.flatten(this.dataOrg),this.dataSectionGroup=[this.dataSection];else this.dataSection=t||this._opt.dataSection,this.dataSectionGroup=[this.dataSection]}},{key:"_getDataSection",value:function(){var t=1;return o.each(this.dataOrg,function(e){t=Math.max(e.length,t)}),1==t?this._oneDimensional():t>1?this._twoDimensional():void 0}},{key:"_oneDimensional",value:function(){for(var t=o.flatten(this.dataOrg),e=0,i=t.length;e<i;e++)t[e]=t[e]||0;return t}},{key:"_twoDimensional",value:function(){var t,e=this.dataOrg,i=[];return o.each(e,function(e,n){if(e.length)if(o.isArray(e[0])){var a=[],r=e[0].length,s=e.length;for(n=0;n<r;n++){for(var l=0,h=0,u=0,d=0,c=0;c<s;c++){var f=e[c][n];(f||0===f)&&(void 0==t&&(t=f),t=Math.min(t,f),f>=0?(l+=f,h++):(u+=f,d++))}h&&a.push(l),d&&a.push(u)}i.push(a)}else i.push(e)}),i.push(t),o.flatten(i)}},{key:"setWaterLine",value:function(t){t<=this.waterLine||(this.waterLine=t,(t<o.min(this.dataSection)||t>o.max(this.dataSection))&&(this.setDataSection(),this.calculateProps()))}},{key:"_sort",value:function(){this.sort&&("desc"==this._getSortType()&&(this.dataSection.reverse(),o.each(this.dataSectionGroup,function(t,e){t.reverse()}),this.dataSectionGroup.reverse()))}},{key:"_getSortType",value:function(){var t;return o.isString(this.sort)&&(t=this.sort),t||(t="asc"),t}},{key:"_middleweight",value:function(){if(this.middleweight){o.isArray(this.middleweight)||(this.middleweight=[this.middleweight]);for(var t=o.min(this.dataSection),e=o.max(this.dataSection),i=[t],n=[],a=0,r=this.middleweight.length;a<r;a++){var s=t;a>0&&(s=this.middleweight[a-1]);var l=s+parseInt((this.middleweight[a]-s)/2);i.push(l),i.push(this.middleweight[a]),n.push([s,l,this.middleweight[a]])}var h=this.middleweight.slice(-1)[0];e>h&&(i.push(h+(e-h)/2),i.push(e),n.push([h,h+(e-h)/2,e])),this.dataSection=i,this.dataSectionGroup=n}}},{key:"_getOriginTrans",value:function(t){for(var e=0,i=this.dataSectionGroup.length,n=this.axisLength/i,a=0,r=i;a<r;a++){var s=this.dataSectionGroup[a];if("proportion"==this.layoutType){var l=o.min(s),h=o.max(s),u=Math.abs(h-l);if(t>=l&&t<=h){e=(t-l)/u*n+a*n;break}}}return"desc"==this.sort&&(e=-(n-e)),parseInt(e)}},{key:"_getLayoutDataOf",value:function(t){var e,i;return o.each(["val","ind","pos"],function(i){i in t&&(e=i)}),o.each(this.dataSectionLayout,function(n){n[e]===t[e]&&(i=n)}),i||{}}},{key:"getPosOfVal",value:function(t){return this.getPosOf({val:t})}},{key:"getPosOfInd",value:function(t){var e=this._getLayoutDataOf({ind:t}).pos;return void 0!=e?e:this.getPosOf({ind:t})}},{key:"getPosOf",value:function(t){var e,i=this._getCellCount();if("proportion"==this.layoutType)for(var n=this.dataSectionGroup.length,a=this.axisLength/n,r=0,s=n;r<s;r++){var l=this.dataSectionGroup[r],h=o.min(l),u=o.max(l),d="val"in t?t.val:this.getValOfInd(t.ind);if(d>=h&&d<=u){var c=this.origin;(c<h||c>u)&&(c=h);var f=Math.max(Math.abs(u-c),Math.abs(c-h));e=(d-c)/f*(f/Math.abs(u-h)*a)+r*a,isNaN(e)&&(e=parseInt(r*a));break}}else if(1==i)e=this.axisLength/2;else{var p="ind"in t?t.ind:this.getIndexOfVal(t.val);if(-1!=p&&("rule"==this.layoutType&&(e=p/(i-1)*this.axisLength),"peak"==this.layoutType)){var g=this.getCellLength();e=g*(p+1)-g/2}}return!e&&(e=0),e=Number(e.toFixed(1))+this._originTrans,Math.abs(e)}},{key:"getValOfPos",value:function(t){var e=this._getLayoutDataOf({pos:t}).val;return void 0!=e?e:this._getValOfInd(this.getIndexOfPos(t))}},{key:"getValOfInd",value:function(t){var e=this._getLayoutDataOf({ind:t}).val;return void 0!=e?e:this._getValOfInd(t)}},{key:"_getValOfInd",value:function(t,e){var i,n=this,a=o.flatten(this.dataOrg);if("proportion"==this.layoutType){var r=this.axisLength/this.dataSectionGroup.length;o.each(this.dataSectionGroup,function(e,a){if(parseInt(t/r)==a||a==n.dataSectionGroup.length-1){var s=o.min(e),l=o.max(e);return i=s+(l-s)/r*(t-r*a),!1}})}else i=a[t];return i}},{key:"getIndexOfPos",value:function(t){var e=this._getLayoutDataOf({pos:t}).ind;if(void 0!=e)return e;var i=0,n=this.getCellLengthOfPos(t),a=this._getCellCount();return"proportion"==this.layoutType?t:("peak"==this.layoutType&&(i=parseInt(t/n))==a&&(i=a-1),"rule"==this.layoutType&&(i=parseInt((t+n/2)/n),1==a&&(i=0)),i)}},{key:"getIndexOfVal",value:function(t){var e=-1;if("proportion"==this.layoutType){var i=this._getLayoutDataOf({val:t}).ind;if(void 0!=i)return i;e=this.getPosOfVal(t)}else o.each(this.dataOrg,function(i){o.each(i,function(i){var n=o.indexOf(i,t);-1!=n&&(e=n)})});return e}},{key:"getCellLength",value:function(){if(null!==this._cellLength)return this._cellLength;var t=this.axisLength,e=t,i=this._getCellCount();return i&&("proportion"==this.layoutType?e=1:(e=t/i,"rule"==this.layoutType&&(e=1==i?t/2:t/(i-1)),this.posParseToInt&&(e=parseInt(e)))),this._cellLength=e,e}},{key:"getCellLengthOfPos",value:function(t){return this.getCellLength()}},{key:"getCellLengthOfInd",value:function(t){return this.getCellLength()}},{key:"_getCellCount",value:function(){if(null!==this._cellCount)return this._cellCount;var t=0;return"proportion"==this.layoutType?t=this.axisLength:this.dataOrg.length&&this.dataOrg[0].length&&this.dataOrg[0][0].length&&(t=this.dataOrg[0][0].length),this._cellCount=t,t}}]),t}();function F(t,e){var i={length:0,org:[],data:[],getRowDataAt:f,getRowDataOf:function(t){!t&&(t={});var e=[],n=0;for(var a in t)n++;if(n)for(var r=i.range.start;r<i.range.end;r++){var s=0;o.each(i.data,function(e){e.field in t&&e.data[r]==t[e.field]&&s++}),s==n&&e.push(f(r))}return e},getFieldData:function(t){var e;return o.each(i.data,function(i){i.field==t&&(e=i)}),e?e.data.slice(i.range.start,i.range.end+1):[]},getDataOrg:function t(e,n,a,s){s||(s=0);var l=a||r;if(!l)return;n||(n=function(t){return t});function h(t){for(var e=0,i=t.length;e<i;e++)t[e]=n(t[e]);return t}o.isArray(e)||(e=[e]);var u=[];for(var d=0,c=e.length;d<c;d++)if(o.isArray(e[d]))u.push(t(e[d],n,a,s+1));else{var f=u;s||(f=[]);for(var p=0,g=l.length;p<g;p++)if(e[d]==l[p].field){f.push(h(l[p].data.slice(i.range.start,i.range.end+1)));break}s||u.push(f)}return u},fields:[],range:{start:0,end:0}};if(!(t=JSON.parse(JSON.stringify(t)))||0==t.length)return i;if(t.length>0&&!o.isArray(t[0])&&(t=function(t){if(void 0!==t&&null!==t||(t=[]),t.length>0&&!o.isArray(t[0])){for(var e=[],i=[],n=0,a=0,r=t.length;a<r;a++){var s=t[a];if(0==a){for(var l in s)i.push(l);e.push(i),n=i.length}for(var h=[],u=0;u<n;u++)h.push(s[i[u]]);e.push(h)}return e}return t}(t)),i.length=t.length-1,i.range.end=i.length-1,e&&e.dataZoom&&e.dataZoom.range&&o.extend(i.range,e.dataZoom.range),t.length&&t[0].length&&!~t[0].indexOf("__index__"))for(var n=0,a=t.length;n<a;n++)n?t[n].push(n-1):t[0].push("__index__");i.org=t,i.fields=t[0]?t[0]:[];for(var r=[],s=0,l=i.fields.length;s<l;s++){var h={};h.field=i.fields[s],h.index=s,h.data=[],r.push(h)}i.data=r;for(s=1,l=t.length;s<l;s++)for(var u=0,d=t[s].length;u<d;u++){var c=t[s][u];isNaN(c)||""===c||null===c||(c=Number(c)),r[u].data.push(c)}function f(t){for(var e={},n=i.data,a=0;a<n.length;a++)e[n[a].field]=n[a].data[i.range.start+t];return e}return i}var E=window.devicePixelRatio||1,W=function(t,e){if(document[t]){return function e(i,n,a){if(i.length)for(var r=0;r<i.length;r++)e(i[r],n,a);else i[t](n,a,!1)}}return function t(i,n,a){if(i.length)for(var r=0;r<i.length;r++)t(i[r],n,a);else i[e]("on"+n,function(){return a.call(i,window.event)})}},N={query:function(t){return o.isString(t)?document.getElementById(t):1==t.nodeType?t:t.length?t[0]:null},offset:function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,n=i.body,a=i.documentElement,r=a.clientTop||n.clientTop||0,s=a.clientLeft||n.clientLeft||0,o=1;if(n.getBoundingClientRect){var l=n.getBoundingClientRect();o=(l.right-l.left)/n.clientWidth}return o>1&&(r=0,s=0),{top:e.top/o+(window.pageYOffset||a&&a.scrollTop/o||n.scrollTop/o)-r,left:e.left/o+(window.pageXOffset||a&&a.scrollLeft/o||n.scrollLeft/o)-s}},addEvent:W("addEventListener","attachEvent"),removeEvent:W("removeEventListener","detachEvent"),pageX:function(t){return t.pageX?t.pageX:t.clientX?t.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft):null},pageY:function(t){return t.pageY?t.pageY:t.clientY?t.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop):null},createCanvas:function(t,e,i){var n=document.createElement("canvas");return n.style.position="absolute",n.style.width=t+"px",n.style.height=e+"px",n.style.left=0,n.style.top=0,n.setAttribute("width",t*E),n.setAttribute("height",e*E),n.setAttribute("id",i),n},createView:function(t,e,i){var n=document.createElement("div");n.className="canvax-view",n.style.cssText+="position:relative;width:100%;height:100%;";var a=document.createElement("div");a.style.cssText+="position:absolute;width:"+t+"px;height:"+e+"px;";var r=document.createElement("div");return r.style.cssText+="position:absolute;width:"+t+"px;height:"+e+"px;",n.appendChild(a),n.appendChild(r),{view:n,stageView:a,domView:r}}},z={colors:["#ff8533","#73ace6","#82d982","#e673ac","#cd6bed","#8282d9","#c0e650","#e6ac73","#6bcded","#73e6ac","#ed6bcd","#9966cc"],set:function(t){return this.colors=t,this.colors},get:function(){return this.colors}},G={create:function(t,e,i){var n=null,a=this,r=function(t){return JSON.parse(JSON.stringify(t))}(e),s=function(t){return o.clone(t)}(i),l=function(){a.instances[n.id]=null,delete a.instances[n.id]},h=N.query(t).getAttribute("chart_id");if(void 0!=h){var u=a.instances[h];u&&(u.destroy(),u.off&&u.off("destroy",l)),delete a.instances[h]}var d=2;(function(t){return t.coord&&t.coord.type&&["box","polar3d"].indexOf(t.coord.type)>-1})(i)&&(d=3);var c=a.getComponentModules(d),f=a.getComponentModule("chart",d);return(n=new f(t,r,s,c))&&(n.draw(),a.instances[n.id]=n,n.on("destroy",l)),n},setGlobalTheme:function(t){z.set(t)},getGlobalTheme:function(){return z.get()},instances:{},getChart:function(t){return this.instances[t]},resize:function(){for(var t in this.instances)this.instances[t].resize()},getOptions:function(t,e){if(!this.options[t])return e||{};var i,n="[[JSON_FUN_PREFIX_",a="_JSON_FUN_SUFFIX]]",r=(i=decodeURIComponent(this.options[t]||{}),JSON.parse(i,function(t,e){return"string"==typeof e&&e.indexOf(a)>0&&0==e.indexOf(n)?new Function("return "+e.replace(n,"").replace(a,""))():e})||{});return e&&(r=o.extend(!0,r,e)),r},components:{c_2d:{},c_3d:{}},getComponentModules:function(t){var e=this.components.c_2d;return 3==t&&(e=this.components.c_3d),e.modules||(e.modules={}),e.get||(e.get=function(t,i){i||(i="empty");var n=e.modules[t];if(n&&n[i])return n[i]}),e},registerComponent:function(t,e){var i=2,n="empty";if(3==arguments.length){var a=arguments[2];o.isNumber(a)&&3==a&&(i=3),o.isString(a)&&(n=a)}4==arguments.length&&(n=arguments[2],3==arguments[3]&&(i=3));var r=this.getComponentModules(i).modules,s=r[e];return s||(s=r[e]={}),s[n]||(s[n]=t),r},getComponentModule:function(t){var e=2,i="empty";if(2==arguments.length){var n=arguments[1];o.isNumber(n)&&3==n&&(e=3),o.isString(n)&&(i=n)}3==arguments.length&&(i=arguments[1],3==arguments[2]&&(e=3));var a=this.getComponentModules(e).modules[t];return a?a[i]:void 0}},B=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;var j=Math.cos,H=Math.sin,V=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];i(this,t),this._opt=o.clone(e),this.dataFrame=n,this.axisLength=1,this.dataOrg=[],this.startAngle=this._opt.startAngle,this.allAngles=Math.min(360,this._opt.allAngles),this.sort=this._opt.sort,this.layoutData=[],this.maxRadius=0,this.minRadius=0}n(t,[{key:"calculateProps",value:function(){var t=this,e=0,i=0,n=0,a=this._opt,r=void 0,s=void 0,l=void 0,h=void 0,u=void 0,d=void 0,c=a.node.outRadius,f=a.node.innerRadius,p=a.node.moveDis;this.layoutData.forEach(function(i,n){i.enabled&&(e+=isNaN(+i.value)?0:+i.value,i.radiusField&&(t.maxRadius=Math.max(i.radiusValue,e),t.minRadius=Math.min(i.radiusValue,e)))}),this.axisLength=e,e>0&&(n=o.euclideanModulo(this.startAngle,360),this.layoutData.forEach(function(g,v){i=g.value/e,g.enabled||(i=0),r=t.allAngles*i,s=n+r,u=n+.5*r,l=j(o.degToRad(u)),h=H(o.degToRad(u)),l=l.toFixed(5),h=h.toFixed(5),d=t.getAuadrant(u),g.radiusField&&(c=parseInt((a.node.outRadius-a.node.innerRadius)*((g.radiusValue-t.minRadius)/(t.maxRadius-t.minRadius))+a.node.innerRadius)),o.extend(g,{outRadius:c,innerRadius:f,startAngle:n,endAngle:s,midAngle:u,moveDis:p,outOffsetx:.7*p*l,outOffsety:.7*p*h,centerx:c*l,centery:c*h,outx:(c+p)*l,outy:(c+p)*h,edgex:(c+p)*l,edgey:(c+p)*h,orginPercentage:i,percentage:(100*i).toFixed(2),quadrant:d,isRightSide:1==d||4==d?1:0,cosV:l,sinV:h}),n+=r}))}},{key:"resetData",value:function(t){this.dataFrame=t||[],this.axisLength=1,this.dataOrg=[],this.startAngle=this._opt.startAngle||-90,this.allAngles=this._opt.allAngles||360,this.layoutData=[]}},{key:"setOption",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this._opt,t),this.startAngle=this._opt.startAngle,this.allAngles=Math.min(360,this._opt.allAngles),this.sort=this._opt.sort}},{key:"setDataFrame",value:function(t){var e=this,i=[],n=this._opt,a=n.field,r=n.groupField||n.label.field||n.field,s=n.node.radius;t=t||this.dataFrame,this.dataFrame=t,this.dataOrg=[];for(var l=0,h=t.length;l<h;l++){var u=t.getRowDataAt(l),d={rowData:u,enabled:!0,value:u[a],label:u[r],iNode:l};this.dataOrg.push(u[a]),this._isFiled(s,d)&&(d.radiusField=s,d.radiusValue=u[s]),i.push(d)}return this.sort&&(this.dataOrg=[],i.sort(function(t,i){return"asc"==e.sort?t.value-i.value:i.value-t.value}),o.each(i,function(t,i){t.iNode=i,e.dataOrg.push(t)})),this.layoutData=i,i}},{key:"getLayoutData",value:function(){return this.layoutData||[]}},{key:"_isFiled",value:function(t,e){return t&&o.isString(t)&&t in e.rowData}},{key:"getAuadrant",value:function(t){t=o.euclideanModulo(t,360);var e=0;switch(parseInt(t/90)){case 0:e=1;break;case 1:e=2;break;case 2:e=3;break;case 3:case 4:e=4}return e}},{key:"_getLayoutDataOf",value:function(t){var e,i=[{val:"value"},{ind:"iNode"}][Object.keys(t)[0]];return o.each(this.layoutData,function(n){n[i]===t[i]&&(e=n)}),e||{}}},{key:"getRadiansAtR",value:function(){}},{key:"getPointsOfR",value:function(e,i){var n=[];return o.each(i,function(i){var a=Math.PI*i/180,r=t.getPointInRadianOfR(a,e);n.push(r)}),n}}],[{key:"filterPointsInRect",value:function(e,i,n,a){for(var r=0,s=e.length;r<s;r++)t.checkPointInRect(e[r],i,n,a)||(e.splice(r,1),r--,s--);return e}},{key:"checkPointInRect",value:function(t,e,i,n){var a=t.x+e.x,r=t.y+e.y;return!(a<0||a>i||r<0||r>n)}},{key:"checkArcInRect",value:function(e,i,n,a,r){var s=e[0],o=e[1],l=o.radian-s.radian;o.radian<s.radian&&(l=2*Math.PI+o.radian-s.radian);var h=(s.radian+l/2)%(2*Math.PI);return t.checkPointInRect(t.getPointInRadianOfR(h,i),n,a,r)}},{key:"getRadianInPoint",value:function(t){var e=2*Math.PI;return(Math.atan2(t.y,t.x)+e)%e}},{key:"getPointInRadianOfR",value:function(t,e){var i=Math.PI,n=Math.cos(t)*e;t!=i/2&&t!=3*i/2||(n=0);var a=Math.sin(t)*e;return t%i==0&&(a=0),{x:n,y:a}}},{key:"getROfNum",value:function(t,e,i,n){var a=o.max(e);return parseInt(Math.max(i,n)/2)*((t-0)/(a-0))}}])}(),function(t){var e="CanvaxEvent";o.isString(t)&&(e=t),o.isObject(t)&&t.type&&(e=t.type),this.target=null,this.currentTarget=null,this.type=e,this.point=null,this._stopPropagation=!1});V.prototype={stopPropagation:function(){this._stopPropagation=!0}};var Y="mousedown mouseup mouseover mousemove mouseout click dblclick",$={_types:Y.split(/,| /),register:function(t){t&&(o.isString(t)&&(t=t.split(/,| /)),this._types=Y.split(/,| /).concat(t))},get:function(){return this._types}},q=function(){this._eventMap={}};q.prototype={_setEventEnable:function(){var t=!1;for(var e in this._eventMap)o.indexOf($.get(),e)>-1&&(t=!0);this._eventEnabled=t},_addEventListener:function(t,e){if("function"!=typeof e)return!1;var i=!0,n=this,a=t;return o.isString(t)&&(a=t.split(/,| /)),o.each(a,function(t){var a=n._eventMap[t];return a?-1==o.indexOf(a,e)?(a.push(e),n._setEventEnable(),!0):void(i=!1):((a=n._eventMap[t]=[]).push(e),n._setEventEnable(),!0)}),i},_removeEventListener:function(t,e){if(1==arguments.length)return this.removeEventListenerByType(t);var i=this._eventMap[t];if(!i)return!1;for(var n=0;n<i.length;n++){if(i[n]===e)return i.splice(n,1),0==i.length&&(delete this._eventMap[t],this._setEventEnable()),!0}return!1},_removeEventListenerByType:function(t){return!this._eventMap[t]&&(delete this._eventMap[t],this._setEventEnable(),!0)},_removeAllEventListeners:function(){this._eventMap={},this._eventEnabled=!1},_dispatchEvent:function(t){var e=this._eventMap[t.type];if(e){t.target||(t.target=this),e=e.slice();for(var i=0;i<e.length;i++){var n=e[i];"function"==typeof n&&n.call(this,t)}}return t._stopPropagation||this.parent&&(t.currentTarget=this.parent,this.parent._dispatchEvent(t)),!0},_hasEventListener:function(t){var e=this._eventMap[t];return null!=e&&e.length>0}};var X=function(t){function e(){return i(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return r(e,q),n(e,[{key:"on",value:function(t,e){return this._addEventListener(t,e),this}},{key:"addEventListener",value:function(t,e){return this._addEventListener(t,e),this}},{key:"un",value:function(t,e){return this._removeEventListener(t,e),this}},{key:"removeEventListener",value:function(t,e){return this._removeEventListener(t,e),this}},{key:"removeEventListenerByType",value:function(t){return this._removeEventListenerByType(t),this}},{key:"removeAllEventListeners",value:function(){return this._removeAllEventListeners(),this}},{key:"fire",value:function(t,e){var i=new V(t);if(e)for(var n in e)"type"!=n&&(i[n]=e[n]),i.currentTarget=this;var a=this;return o.each(t.split(" "),function(t){i.currentTarget=a,a.dispatchEvent(i)}),this}},{key:"dispatchEvent",value:function(t){if(this.children&&t.point){var e=this.getObjectsUnderPoint(t.point,1)[0];e&&e.dispatchEvent(t)}else{if(!this.context||"mouseover"!=t.type){if(this._dispatchEvent(t),this.context&&"mouseout"==t.type&&this._hoverClass&&this.hoverClone){a=this.getStage().parent;this._hoverClass=!1,a._bufferStage.removeChildById(this.id),this._globalAlpha&&(this.context.globalAlpha=this._globalAlpha,delete this._globalAlpha)}return this}var i=this._heartBeatNum,n=this.context.$model.globalAlpha;if(this._dispatchEvent(t),i!=this._heartBeatNum&&(this._hoverClass=!0,this.hoverClone)){var a=this.getStage().parent,r=this.clone(!0);r._transform=this.getConcatenatedMatrix(),a._bufferStage.addChildAt(r,0),this._globalAlpha=n,this.context.globalAlpha=0}}}},{key:"hasEvent",value:function(t){return this._hasEventListener(t)}},{key:"hasEventListener",value:function(t){return this._hasEventListener(t)}},{key:"hover",value:function(t,e){return this.on("mouseover",t),this.on("mouseout",e),this}},{key:"once",value:function(t,e){var i=this;return this.on(t,function n(){e.apply(i,arguments),this.un(t,n)}),this}}]),e}(),U=(document.compareDocumentPosition,{}),Z={},Q=Array.prototype,J=Object.prototype,K=Function.prototype,tt=Q.push,et=Q.slice,it=Q.concat,nt=J.toString,at=J.hasOwnProperty,rt=Q.forEach,st=Q.map,ot=Q.filter,lt=Q.every,ht=Q.some,ut=Q.indexOf,dt=Array.isArray,ct=Object.keys,ft=(K.bind,Math.pow(2,53)-1),pt=function(t){return function(e){return null==e?void 0:e[t]}}("length"),gt=function(t){var e=pt(t);return"number"==typeof e&&e>=0&&e<=ft};U.values=function(t){for(var e=U.keys(t),i=e.length,n=new Array(i),a=0;a<i;a++)n[a]=t[e[a]];return n},U.keys=ct||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)U.has(t,i)&&e.push(i);return e},U.has=function(t,e){return at.call(t,e)};var vt=U.each=U.forEach=function(t,e,i){if(null!=t)if(rt&&t.forEach===rt)t.forEach(e,i);else if(t.length===+t.length){for(var n=0,a=t.length;n<a;n++)if(e.call(i,t[n],n,t)===Z)return}else{var r=U.keys(t);for(n=0,a=r.length;n<a;n++)if(e.call(i,t[r[n]],r[n],t)===Z)return}};U.compact=function(t){return U.filter(t,U.identity)},U.filter=U.select=function(t,e,i){var n=[];return null==t?n:ot&&t.filter===ot?t.filter(e,i):(vt(t,function(t,a,r){e.call(i,t,a,r)&&n.push(t)}),n)},vt(["Arguments","Function","String","Number","Date","RegExp"],function(t){U["is"+t]=function(e){return nt.call(e)=="[object "+t+"]"}}),U.isArguments=function(t){return!(!t||!U.has(t,"callee"))},U.isFunction=function(t){return"function"==typeof t},U.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},U.isNaN=function(t){return U.isNumber(t)&&t!=+t},U.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==nt.call(t)},U.isNull=function(t){return null===t},U.isEmpty=function(t){if(null==t)return!0;if(U.isArray(t)||U.isString(t))return 0===t.length;for(var e in t)if(U.has(t,e))return!1;return!0},U.isElement=function(t){return!(!t||1!==t.nodeType)},U.isArray=dt||function(t){return"[object Array]"==nt.call(t)},U.isObject=function(t){return t===Object(t)},U.identity=function(t){return t},U.indexOf=function(t,e,i){if(null==t)return-1;var n=0,a=t.length;if(i){if("number"!=typeof i)return t[n=U.sortedIndex(t,e)]===e?n:-1;n=i<0?Math.max(0,a+i):i}if(ut&&t.indexOf===ut)return t.indexOf(e,i);for(;n<a;n++)if(t[n]===e)return n;return-1},U.isWindow=function(t){return null!=t&&t==t.window};U.flatten=function(t,e){return function t(e,i,n){return i&&U.every(e,U.isArray)?it.apply(n,e):(vt(e,function(e){U.isArray(e)||U.isArguments(e)?i?tt.apply(n,e):t(e,i,n):n.push(e)}),n)}(t,e,[])},U.every=U.all=function(t,e,i){e||(e=U.identity);var n=!0;return null==t?n:lt&&t.every===lt?t.every(e,i):(vt(t,function(t,a,r){if(!(n=n&&e.call(i,t,a,r)))return Z}),!!n)},U.min=function(t,e,i){if(!e&&U.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&U.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return vt(t,function(t,a,r){var s=e?e.call(i,t,a,r):t;s<n.computed&&(n={value:t,computed:s})}),n.value},U.max=function(t,e,i){if(!e&&U.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&U.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return vt(t,function(t,a,r){var s=e?e.call(i,t,a,r):t;s>n.computed&&(n={value:t,computed:s})}),n.value},U.find=U.detect=function(t,e,i){var n;return yt(t,function(t,a,r){if(e.call(i,t,a,r))return n=t,!0}),n};var yt=U.some=U.any=function(t,e,i){e||(e=U.identity);var n=!1;return null==t?n:ht&&t.some===ht?t.some(e,i):(vt(t,function(t,a,r){if(n||(n=e.call(i,t,a,r)))return Z}),!!n)};function xt(t){return parseFloat(t.toPrecision(14))}U.without=function(t){return U.difference(t,et.call(arguments,1))},U.difference=function(t){var e=it.apply(Q,et.call(arguments,1));return U.filter(t,function(t){return!U.contains(e,t)})},U.uniq=U.unique=function(t,e,i,n){U.isFunction(e)&&(n=i,i=e,e=!1);var a=i?U.map(t,i,n):t,r=[],s=[];return vt(a,function(i,n){(e?n&&s[s.length-1]===i:U.contains(s,i))||(s.push(i),r.push(t[n]))}),r},U.map=U.collect=function(t,e,i){var n=[];return null==t?n:st&&t.map===st?t.map(e,i):(vt(t,function(t,a,r){n.push(e.call(i,t,a,r))}),n)},U.contains=U.include=function(t,e){return null!=t&&(ut&&t.indexOf===ut?-1!=t.indexOf(e):yt(t,function(t){return t===e}))},U.pluck=function(t,e){return U.map(t,function(t){return t[e]})},U.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},U.shuffle=function(t){return U.sample(t,1/0)},U.sample=function(t,e,i){if(null==e||i)return gt(t)||(t=U.values(t)),t[U.random(t.length-1)];var n=gt(t)?U.clone(t):U.values(t),a=pt(n);e=Math.max(Math.min(e,a),0);for(var r=a-1,s=0;s<e;s++){var o=U.random(s,r),l=n[s];n[s]=n[o],n[o]=l}return n.slice(0,e)},U.extend=function(){var t,i,n,a,r=arguments[0]||{},s=1,o=arguments.length,l=!1;for("boolean"==typeof r&&(l=r,r=arguments[1]||{},s=2),"object"===(void 0===r?"undefined":e(r))||U.isFunction(r)||(r={}),o===s&&(r=this,--s);s<o;s++)if(null!=(t=arguments[s]))for(i in t)n=r[i],r!==(a=t[i])&&(l&&a&&U.isObject(a)&&a.constructor===Object?r[i]=U.extend(l,n,a):r[i]=a);return r},U.clone=function(t){return U.isObject(t)?U.isArray(t)?t.slice():U.extend(!0,{},t):t},U.euclideanModulo=function(t,e){return(t%e+e)%e},U.DEG2RAD=Math.PI/180,U.RAD2DEG=180/Math.PI,U.degToRad=function(t){return t*U.DEG2RAD},U.radToDeg=function(t){return t*U.RAD2DEG};var _t=function(t,e,i){return U.uniq(function(t,e,i){t=U.without(t,void 0,null,"");var n=i&&i.scale?parseFloat(i.scale):1,a=i&&i.isInt?1:0;isNaN(n)&&(n=1);var r=U.max(t),s=r;r*=n;var o=U.min(t);if(o==r)return r>0?[o=0,r]:r<0?[r,0]:[0,r=1];var l=r-o;if(l){var h=o;(o-=.05*l)<0&&h>=0&&(o=0),r+=.05*l}var u=.3*(r-o);u=function(t,e){var i,n=[1,2,5,10];i=t/e;for(var a=0;a<n.length&&(t=n[a],!(i<=(n[a]+(n[a+1]||n[a]))/2));a++);return t*=e}(u,Math.pow(10,Math.floor(Math.log(u)/Math.LN10))),a&&(u=Math.ceil(u));var d,c,f=xt(Math.floor(o/u)*u),p=xt(Math.ceil(r/u)*u),g=[];for(d=f;d<=p&&(g.push(d),(d=xt(d+u))!==c);)c=d;return g.length>=3&&g[g.length-2]>=s&&g.pop(),g}(t,0,i))},mt=(function(){function t(e,n){i(this,t),this.layoutType=e.layoutType||"proportion",this._opt=U.clone(e),this.dataOrg=n||[],this.dataSection=[],this.dataSectionLayout=[],this.axisLength=1,this._cellCount=null,this._cellLength=null,this.waterLine=null,this.dataSectionGroup=[],this.middleweight=null,this.symmetric=!1,this.origin=null,this.originPos=0,this._originTrans=0,this._min=null,this._max=null,this.sort=null,this.posParseToInt=!1}n(t,[{key:"resetDataOrg",value:function(t){this.dataSection=[],this.dataSectionGroup=[],this.dataOrg=t,this._cellCount=null,this._cellLength=null}},{key:"setAxisLength",value:function(t){this.axisLength=t,this.calculateProps()}},{key:"calculateProps",value:function(){var t=this;"proportion"==this.layoutType&&(null==this._min&&(this._min=U.min(this.dataSection)),null==this._max&&(this._max=U.max(this.dataSection)),"origin"in this._opt||(this.origin=0,U.max(this.dataSection)<0&&(this.origin=U.max(this.dataSection)),U.min(this.dataSection)>0&&(this.origin=U.min(this.dataSection))),this._originTrans=this._getOriginTrans(this.origin),this.originPos=this.getPosOfVal(this.origin)),this.dataSectionLayout=[],U.each(this.dataSection,function(e,i){var n=i;"proportion"==t.layoutType&&(n=t.getIndexOfVal(e));var a=parseInt(t.getPosOf({ind:i,val:e}),10);t.dataSectionLayout.push({val:e,ind:n,pos:a})})}},{key:"getDataSection",value:function(){return this.dataSection}},{key:"setDataSection",value:function(t){if(U.isEmpty(t)&&U.isEmpty(this._opt.dataSection))if("proportion"==this.layoutType){var e=this._getDataSection();if("origin"in this._opt&&e.push(this._opt.origin),1==e.length&&e.push(2*e[0]),this.waterLine&&e.push(this.waterLine),this.symmetric){var i=U.min(e),n=U.max(e);Math.abs(i)>Math.abs(n)?e.push(Math.abs(i)):e.push(-Math.abs(n))}for(var a=0,r=e.length;a<r;a++)e[a]=Number(e[a]),isNaN(e[a])&&(e.splice(a,1),a--,r--);if(this.dataSection=_t(e,3),this.symmetric){i=U.min(this.dataSection),n=U.max(this.dataSection);Math.abs(i)>Math.abs(n)?this.dataSection.push(Math.abs(i)):this.dataSection.unshift(-Math.abs(n))}0==this.dataSection.length&&(this.dataSection=[0]),this.dataSectionGroup=[U.clone(this.dataSection)],this._middleweight(),this._sort()}else this.dataSection=U.flatten(this.dataOrg),this.dataSectionGroup=[this.dataSection];else this.dataSection=t||this._opt.dataSection,this.dataSectionGroup=[this.dataSection]}},{key:"_getDataSection",value:function(){var t=1;return U.each(this.dataOrg,function(e){t=Math.max(e.length,t)}),1==t?this._oneDimensional():t>1?this._twoDimensional():void 0}},{key:"_oneDimensional",value:function(){for(var t=U.flatten(this.dataOrg),e=0,i=t.length;e<i;e++)t[e]=t[e]||0;return t}},{key:"_twoDimensional",value:function(){var t,e=this.dataOrg,i=[];return U.each(e,function(e,n){if(e.length)if(U.isArray(e[0])){var a=[],r=e[0].length,s=e.length;for(n=0;n<r;n++){for(var o=0,l=0,h=0,u=0,d=0;d<s;d++){var c=e[d][n];(c||0===c)&&(void 0==t&&(t=c),t=Math.min(t,c),c>=0?(o+=c,l++):(h+=c,u++))}l&&a.push(o),u&&a.push(h)}i.push(a)}else i.push(e)}),i.push(t),U.flatten(i)}},{key:"setWaterLine",value:function(t){t<=this.waterLine||(this.waterLine=t,(t<U.min(this.dataSection)||t>U.max(this.dataSection))&&(this.setDataSection(),this.calculateProps()))}},{key:"_sort",value:function(){this.sort&&("desc"==this._getSortType()&&(this.dataSection.reverse(),U.each(this.dataSectionGroup,function(t,e){t.reverse()}),this.dataSectionGroup.reverse()))}},{key:"_getSortType",value:function(){var t;return U.isString(this.sort)&&(t=this.sort),t||(t="asc"),t}},{key:"_middleweight",value:function(){if(this.middleweight){U.isArray(this.middleweight)||(this.middleweight=[this.middleweight]);for(var t=U.min(this.dataSection),e=U.max(this.dataSection),i=[t],n=[],a=0,r=this.middleweight.length;a<r;a++){var s=t;a>0&&(s=this.middleweight[a-1]);var o=s+parseInt((this.middleweight[a]-s)/2);i.push(o),i.push(this.middleweight[a]),n.push([s,o,this.middleweight[a]])}var l=this.middleweight.slice(-1)[0];e>l&&(i.push(l+(e-l)/2),i.push(e),n.push([l,l+(e-l)/2,e])),this.dataSection=i,this.dataSectionGroup=n}}},{key:"_getOriginTrans",value:function(t){for(var e=0,i=this.dataSectionGroup.length,n=this.axisLength/i,a=0,r=i;a<r;a++){var s=this.dataSectionGroup[a];if("proportion"==this.layoutType){var o=U.min(s),l=U.max(s),h=Math.abs(l-o);if(t>=o&&t<=l){e=(t-o)/h*n+a*n;break}}}return"desc"==this.sort&&(e=-(n-e)),parseInt(e)}},{key:"_getLayoutDataOf",value:function(t){var e,i;return U.each(["val","ind","pos"],function(i){i in t&&(e=i)}),U.each(this.dataSectionLayout,function(n){n[e]===t[e]&&(i=n)}),i||{}}},{key:"getPosOfVal",value:function(t){return this.getPosOf({val:t})}},{key:"getPosOfInd",value:function(t){var e=this._getLayoutDataOf({ind:t}).pos;return void 0!=e?e:this.getPosOf({ind:t})}},{key:"getPosOf",value:function(t){var e,i=this._getCellCount();if("proportion"==this.layoutType)for(var n=this.dataSectionGroup.length,a=this.axisLength/n,r=0,s=n;r<s;r++){var o=this.dataSectionGroup[r],l=U.min(o),h=U.max(o),u="val"in t?t.val:this.getValOfInd(t.ind);if(u>=l&&u<=h){var d=this.origin;(d<l||d>h)&&(d=l);var c=Math.max(Math.abs(h-d),Math.abs(d-l));e=(u-d)/c*(c/Math.abs(h-l)*a)+r*a,isNaN(e)&&(e=parseInt(r*a));break}}else if(1==i)e=this.axisLength/2;else{var f="ind"in t?t.ind:this.getIndexOfVal(t.val);if(-1!=f&&("rule"==this.layoutType&&(e=f/(i-1)*this.axisLength),"peak"==this.layoutType)){var p=this.getCellLength();e=p*(f+1)-p/2}}return!e&&(e=0),e=Number(e.toFixed(1))+this._originTrans,Math.abs(e)}},{key:"getValOfPos",value:function(t){var e=this._getLayoutDataOf({pos:t}).val;return void 0!=e?e:this._getValOfInd(this.getIndexOfPos(t))}},{key:"getValOfInd",value:function(t){var e=this._getLayoutDataOf({ind:t}).val;return void 0!=e?e:this._getValOfInd(t)}},{key:"_getValOfInd",value:function(t,e){var i,n=this,a=U.flatten(this.dataOrg);if("proportion"==this.layoutType){var r=this.axisLength/this.dataSectionGroup.length;U.each(this.dataSectionGroup,function(e,a){if(parseInt(t/r)==a||a==n.dataSectionGroup.length-1){var s=U.min(e),o=U.max(e);return i=s+(o-s)/r*(t-r*a),!1}})}else i=a[t];return i}},{key:"getIndexOfPos",value:function(t){var e=this._getLayoutDataOf({pos:t}).ind;if(void 0!=e)return e;var i=0,n=this.getCellLengthOfPos(t),a=this._getCellCount();return"proportion"==this.layoutType?t:("peak"==this.layoutType&&(i=parseInt(t/n))==a&&(i=a-1),"rule"==this.layoutType&&(i=parseInt((t+n/2)/n),1==a&&(i=0)),i)}},{key:"getIndexOfVal",value:function(t){var e=-1;if("proportion"==this.layoutType){var i=this._getLayoutDataOf({val:t}).ind;if(void 0!=i)return i;e=this.getPosOfVal(t)}else U.each(this.dataOrg,function(i){U.each(i,function(i){var n=U.indexOf(i,t);-1!=n&&(e=n)})});return e}},{key:"getCellLength",value:function(){if(null!==this._cellLength)return this._cellLength;var t=this.axisLength,e=t,i=this._getCellCount();return i&&("proportion"==this.layoutType?e=1:(e=t/i,"rule"==this.layoutType&&(e=1==i?t/2:t/(i-1)),this.posParseToInt&&(e=parseInt(e)))),this._cellLength=e,e}},{key:"getCellLengthOfPos",value:function(t){return this.getCellLength()}},{key:"getCellLengthOfInd",value:function(t){return this.getCellLength()}},{key:"_getCellCount",value:function(){if(null!==this._cellCount)return this._cellCount;var t=0;return"proportion"==this.layoutType?t=this.axisLength:this.dataOrg.length&&this.dataOrg[0].length&&this.dataOrg[0][0].length&&(t=this.dataOrg[0][0].length),this._cellCount=t,t}}])}(),window.devicePixelRatio||1),bt=function(t,e){if(document[t]){return function e(i,n,a){if(i.length)for(var r=0;r<i.length;r++)e(i[r],n,a);else i[t](n,a,!1)}}return function t(i,n,a){if(i.length)for(var r=0;r<i.length;r++)t(i[r],n,a);else i[e]("on"+n,function(){return a.call(i,window.event)})}},kt={query:function(t){return U.isString(t)?document.getElementById(t):1==t.nodeType?t:t.length?t[0]:null},offset:function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,n=i.body,a=i.documentElement,r=a.clientTop||n.clientTop||0,s=a.clientLeft||n.clientLeft||0,o=1;if(n.getBoundingClientRect){var l=n.getBoundingClientRect();o=(l.right-l.left)/n.clientWidth}return o>1&&(r=0,s=0),{top:e.top/o+(window.pageYOffset||a&&a.scrollTop/o||n.scrollTop/o)-r,left:e.left/o+(window.pageXOffset||a&&a.scrollLeft/o||n.scrollLeft/o)-s}},addEvent:bt("addEventListener","attachEvent"),removeEvent:bt("removeEventListener","detachEvent"),pageX:function(t){return t.pageX?t.pageX:t.clientX?t.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft):null},pageY:function(t){return t.pageY?t.pageY:t.clientY?t.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop):null},createCanvas:function(t,e,i){var n=document.createElement("canvas");return n.style.position="absolute",n.style.width=t+"px",n.style.height=e+"px",n.style.left=0,n.style.top=0,n.setAttribute("width",t*mt),n.setAttribute("height",e*mt),n.setAttribute("id",i),n},createView:function(t,e,i){var n=document.createElement("div");n.className="canvax-view",n.style.cssText+="position:relative;width:100%;height:100%;";var a=document.createElement("div");a.style.cssText+="position:absolute;width:"+t+"px;height:"+e+"px;";var r=document.createElement("div");return r.style.cssText+="position:absolute;width:"+t+"px;height:"+e+"px;",n.appendChild(a),n.appendChild(r),{view:n,stageView:a,domView:r}}},wt=Math.cos,St=Math.sin,At=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];i(this,t),this._opt=U.clone(e),this.dataFrame=n,this.axisLength=1,this.dataOrg=[],this.startAngle=this._opt.startAngle,this.allAngles=Math.min(360,this._opt.allAngles),this.sort=this._opt.sort,this.layoutData=[],this.maxRadius=0,this.minRadius=0}n(t,[{key:"calculateProps",value:function(){var t=this,e=0,i=0,n=0,a=this._opt,r=void 0,s=void 0,o=void 0,l=void 0,h=void 0,u=void 0,d=a.node.outRadius,c=a.node.innerRadius,f=a.node.moveDis;this.layoutData.forEach(function(i,n){i.enabled&&(e+=isNaN(+i.value)?0:+i.value,i.radiusField&&(t.maxRadius=Math.max(i.radiusValue,e),t.minRadius=Math.min(i.radiusValue,e)))}),this.axisLength=e,e>0&&(n=U.euclideanModulo(this.startAngle,360),this.layoutData.forEach(function(p,g){i=p.value/e,p.enabled||(i=0),r=t.allAngles*i,s=n+r,h=n+.5*r,o=wt(U.degToRad(h)),l=St(U.degToRad(h)),o=o.toFixed(5),l=l.toFixed(5),u=t.getAuadrant(h),p.radiusField&&(d=parseInt((a.node.outRadius-a.node.innerRadius)*((p.radiusValue-t.minRadius)/(t.maxRadius-t.minRadius))+a.node.innerRadius)),U.extend(p,{outRadius:d,innerRadius:c,startAngle:n,endAngle:s,midAngle:h,moveDis:f,outOffsetx:.7*f*o,outOffsety:.7*f*l,centerx:d*o,centery:d*l,outx:(d+f)*o,outy:(d+f)*l,edgex:(d+f)*o,edgey:(d+f)*l,orginPercentage:i,percentage:(100*i).toFixed(2),quadrant:u,isRightSide:1==u||4==u?1:0,cosV:o,sinV:l}),n+=r}))}},{key:"resetData",value:function(t){this.dataFrame=t||[],this.axisLength=1,this.dataOrg=[],this.startAngle=this._opt.startAngle||-90,this.allAngles=this._opt.allAngles||360,this.layoutData=[]}},{key:"setOption",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this._opt,t),this.startAngle=this._opt.startAngle,this.allAngles=Math.min(360,this._opt.allAngles),this.sort=this._opt.sort}},{key:"setDataFrame",value:function(t){var e=this,i=[],n=this._opt,a=n.field,r=n.groupField||n.label.field||n.field,s=n.node.radius;t=t||this.dataFrame,this.dataFrame=t,this.dataOrg=[];for(var o=0,l=t.length;o<l;o++){var h=t.getRowDataAt(o),u={rowData:h,enabled:!0,value:h[a],label:h[r],iNode:o};this.dataOrg.push(h[a]),this._isFiled(s,u)&&(u.radiusField=s,u.radiusValue=h[s]),i.push(u)}return this.sort&&(this.dataOrg=[],i.sort(function(t,i){return"asc"==e.sort?t.value-i.value:i.value-t.value}),U.each(i,function(t,i){t.iNode=i,e.dataOrg.push(t)})),this.layoutData=i,i}},{key:"getLayoutData",value:function(){return this.layoutData||[]}},{key:"_isFiled",value:function(t,e){return t&&U.isString(t)&&t in e.rowData}},{key:"getAuadrant",value:function(t){t=U.euclideanModulo(t,360);var e=0;switch(parseInt(t/90)){case 0:e=1;break;case 1:e=2;break;case 2:e=3;break;case 3:case 4:e=4}return e}},{key:"_getLayoutDataOf",value:function(t){var e,i=[{val:"value"},{ind:"iNode"}][Object.keys(t)[0]];return U.each(this.layoutData,function(n){n[i]===t[i]&&(e=n)}),e||{}}},{key:"getRadiansAtR",value:function(){}},{key:"getPointsOfR",value:function(e,i){var n=[];return U.each(i,function(i){var a=Math.PI*i/180,r=t.getPointInRadianOfR(a,e);n.push(r)}),n}}],[{key:"filterPointsInRect",value:function(e,i,n,a){for(var r=0,s=e.length;r<s;r++)t.checkPointInRect(e[r],i,n,a)||(e.splice(r,1),r--,s--);return e}},{key:"checkPointInRect",value:function(t,e,i,n){var a=t.x+e.x,r=t.y+e.y;return!(a<0||a>i||r<0||r>n)}},{key:"checkArcInRect",value:function(e,i,n,a,r){var s=e[0],o=e[1],l=o.radian-s.radian;o.radian<s.radian&&(l=2*Math.PI+o.radian-s.radian);var h=(s.radian+l/2)%(2*Math.PI);return t.checkPointInRect(t.getPointInRadianOfR(h,i),n,a,r)}},{key:"getRadianInPoint",value:function(t){var e=2*Math.PI;return(Math.atan2(t.y,t.x)+e)%e}},{key:"getPointInRadianOfR",value:function(t,e){var i=Math.PI,n=Math.cos(t)*e;t!=i/2&&t!=3*i/2||(n=0);var a=Math.sin(t)*e;return t%i==0&&(a=0),{x:n,y:a}}},{key:"getROfNum",value:function(t,e,i,n){var a=U.max(e);return parseInt(Math.max(i,n)/2)*((t-0)/(a-0))}}])}(),function(t){var e="CanvaxEvent";U.isString(t)&&(e=t),U.isObject(t)&&t.type&&(e=t.type),this.target=null,this.currentTarget=null,this.type=e,this.point=null,this._stopPropagation=!1});At.prototype={stopPropagation:function(){this._stopPropagation=!0}};var Ct="mousedown mouseup mouseover mousemove mouseout click dblclick",Pt={_types:Ct.split(/,| /),register:function(t){t&&(U.isString(t)&&(t=t.split(/,| /)),this._types=Ct.split(/,| /).concat(t))},get:function(){return this._types}},Tt=function(){this._eventMap={}};Tt.prototype={_setEventEnable:function(){var t=!1;for(var e in this._eventMap)U.indexOf(Pt.get(),e)>-1&&(t=!0);this._eventEnabled=t},_addEventListener:function(t,e){if("function"!=typeof e)return!1;var i=!0,n=this,a=t;return U.isString(t)&&(a=t.split(/,| /)),U.each(a,function(t){var a=n._eventMap[t];return a?-1==U.indexOf(a,e)?(a.push(e),n._setEventEnable(),!0):void(i=!1):((a=n._eventMap[t]=[]).push(e),n._setEventEnable(),!0)}),i},_removeEventListener:function(t,e){if(1==arguments.length)return this.removeEventListenerByType(t);var i=this._eventMap[t];if(!i)return!1;for(var n=0;n<i.length;n++){if(i[n]===e)return i.splice(n,1),0==i.length&&(delete this._eventMap[t],this._setEventEnable()),!0}return!1},_removeEventListenerByType:function(t){return!this._eventMap[t]&&(delete this._eventMap[t],this._setEventEnable(),!0)},_removeAllEventListeners:function(){this._eventMap={},this._eventEnabled=!1},_dispatchEvent:function(t){var e=this._eventMap[t.type];if(e){t.target||(t.target=this),e=e.slice();for(var i=0;i<e.length;i++){var n=e[i];"function"==typeof n&&n.call(this,t)}}return t._stopPropagation||this.parent&&(t.currentTarget=this.parent,this.parent._dispatchEvent(t)),!0},_hasEventListener:function(t){var e=this._eventMap[t];return null!=e&&e.length>0}};var Lt=function(t){function e(){return i(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return r(e,Tt),n(e,[{key:"on",value:function(t,e){return this._addEventListener(t,e),this}},{key:"addEventListener",value:function(t,e){return this._addEventListener(t,e),this}},{key:"un",value:function(t,e){return this._removeEventListener(t,e),this}},{key:"removeEventListener",value:function(t,e){return this._removeEventListener(t,e),this}},{key:"removeEventListenerByType",value:function(t){return this._removeEventListenerByType(t),this}},{key:"removeAllEventListeners",value:function(){return this._removeAllEventListeners(),this}},{key:"fire",value:function(t,e){var i=new At(t);if(e)for(var n in e)"type"!=n&&(i[n]=e[n]),i.currentTarget=this;var a=this;return U.each(t.split(" "),function(t){i.currentTarget=a,a.dispatchEvent(i)}),this}},{key:"dispatchEvent",value:function(t){if(this.children&&t.point){var e=this.getObjectsUnderPoint(t.point,1)[0];e&&e.dispatchEvent(t)}else{if(!this.context||"mouseover"!=t.type){if(this._dispatchEvent(t),this.context&&"mouseout"==t.type&&this._hoverClass&&this.hoverClone){a=this.getStage().parent;this._hoverClass=!1,a._bufferStage.removeChildById(this.id),this._globalAlpha&&(this.context.globalAlpha=this._globalAlpha,delete this._globalAlpha)}return this}var i=this._heartBeatNum,n=this.context.$model.globalAlpha;if(this._dispatchEvent(t),i!=this._heartBeatNum&&(this._hoverClass=!0,this.hoverClone)){var a=this.getStage().parent,r=this.clone(!0);r._transform=this.getConcatenatedMatrix(),a._bufferStage.addChildAt(r,0),this._globalAlpha=n,this.context.globalAlpha=0}}}},{key:"hasEvent",value:function(t){return this._hasEventListener(t)}},{key:"hasEventListener",value:function(t){return this._hasEventListener(t)}},{key:"hover",value:function(t,e){return this.on("mouseover",t),this.on("mouseout",e),this}},{key:"once",value:function(t,e){var i=this;return this.on(t,function n(){e.apply(i,arguments),this.un(t,n)}),this}}]),e}(),Ot=["pan","panstart","panmove","panend","pancancel","panleft","panright","panup","pandown","press","pressup","swipe","swipeleft","swiperight","swipeup","swipedown","tap"],Dt=function(t,e){this.canvax=t,this.curPoints=[{x:0,y:0}],this.curPointsTarget=[],this._touching=!1,this._draging=!1,this._cursor="default",this.target=this.canvax.view,this.drag={start:"panstart",move:"panmove",end:"panend"},U.extend(!0,this,e)},Mt=document.compareDocumentPosition?function(t,e){return!!e&&!!(16&t.compareDocumentPosition(e))}:function(t,e){return!!e&&(e!=e&&(!t.contains||t.contains(e)))};Dt.prototype={init:function(){var t=this;void 0==t.target.nodeType&&Pt.register(Ot),U.each(Pt.get(),function(e){1==t.target.nodeType?kt.addEvent(t.target,e,function(e){t.__mouseHandler(e)}):t.target.on(e,function(e){t.__libHandler(e)})})},__mouseHandler:function(t){var e=this,i=e.canvax;i.updateViewOffset(),e.curPoints=[{x:kt.pageX(t)-i.viewOffset.left,y:kt.pageY(t)-i.viewOffset.top}];var n=e.curPoints[0],a=e.curPointsTarget[0];if("mousedown"==t.type){if(!a){var r=i.getObjectsUnderPoint(n,1)[0];r&&(e.curPointsTarget=[r])}(a=e.curPointsTarget[0])&&a.dragEnabled&&(e._touching=!0)}if(("mouseup"==t.type||"mouseout"==t.type&&!Mt(i.view,t.toElement||t.relatedTarget))&&(1==e._draging&&(e._dragEnd(t,a,0),a.fire("dragend")),e._draging=!1,e._touching=!1),"mouseout"==t.type)Mt(i.view,t.toElement||t.relatedTarget)||e.__getcurPointsTarget(t,n,!0);else if("mousemove"==t.type)if(e._touching&&"mousemove"==t.type&&a){if(e._draging)e._dragIngHander(t,a,0);else a.fire("dragstart"),a._globalAlpha||(a._globalAlpha=a.context.$model.globalAlpha),a.context.globalAlpha=0,e._clone2hoverStage(a,0).context.globalAlpha=a._globalAlpha;e._draging=!0}else e.__getcurPointsTarget(t,n);else{var s=a;s||(s=i),e.__dispatchEventInChilds(t,[s]),e._cursorHander(s)}i.preventDefault&&(t&&t.preventDefault?t.preventDefault():window.event.returnValue=!1)},__getcurPointsTarget:function(t,e,i){var n=this,a=n.canvax,r=n.curPointsTarget[0];if(r&&!r.context&&(r=null),"mousemove"==(t=new At(t)).type&&r&&r._hoverClass&&r.hoverClone&&r.pointChkPriority&&r.getChildInPoint(e))return t.target=t.currentTarget=r,t.point=r.globalToLocal(e),void r.dispatchEvent(t);var s=i?null:a.getObjectsUnderPoint(e,1)[0];(r&&r!=s||"mouseout"==t.type)&&r&&r.context&&(n.curPointsTarget[0]=null,t.type="mouseout",t.toTarget=s,t.target=t.currentTarget=r,t.point=r.globalToLocal(e),r.dispatchEvent(t)),s&&r!=s&&(n.curPointsTarget[0]=s,t.type="mouseover",t.fromTarget=r,t.target=t.currentTarget=s,t.point=s.globalToLocal(e),s.dispatchEvent(t)),"mousemove"==t.type&&s&&(t.target=t.currentTarget=r,t.point=r.globalToLocal(e),r.dispatchEvent(t)),n._cursorHander(s,r)},_cursorHander:function(t,e){t||e||this._setCursor("default"),t&&e!=t&&t.context&&this._setCursor(t.context.$model.cursor)},_setCursor:function(t){this._cursor!=t&&(this.canvax.view.style.cursor=t,this._cursor=t)},__libHandler:function(t){var e=this,i=e.canvax;i.updateViewOffset(),e.curPoints=e.__getCanvaxPointInTouchs(t),e._draging||(e.curPointsTarget=e.__getChildInTouchs(e.curPoints)),e.curPointsTarget.length>0?(t.type==e.drag.start&&U.each(e.curPointsTarget,function(t,i){if(t&&t.dragEnabled)return e._draging=!0,t._globalAlpha||(t._globalAlpha=t.context.$model.globalAlpha),e._clone2hoverStage(t,i),t.context.globalAlpha=0,t.fire("dragstart"),!1}),t.type==e.drag.move&&e._draging&&U.each(e.curPointsTarget,function(i,n){i&&i.dragEnabled&&e._dragIngHander(t,i,n)}),t.type==e.drag.end&&e._draging&&(U.each(e.curPointsTarget,function(i,n){i&&i.dragEnabled&&(e._dragEnd(t,i,0),i.fire("dragend"))}),e._draging=!1),e.__dispatchEventInChilds(t,e.curPointsTarget)):e.__dispatchEventInChilds(t,[i])},__getCanvaxPointInTouchs:function(t){var e=this.canvax,i=[];return U.each(t.point,function(t){i.push({x:kt.pageX(t)-e.viewOffset.left,y:kt.pageY(t)-e.viewOffset.top})}),i},__getChildInTouchs:function(t){var e=this.canvax,i=[];return U.each(t,function(t){i.push(e.getObjectsUnderPoint(t,1)[0])}),i},__dispatchEventInChilds:function(t,e){if(!(e||"length"in e))return!1;var i=this,n=!1;return U.each(e,function(e,a){if(e){n=!0;var r=new At(t);r.target=r.currentTarget=e||this,r.stagePoint=i.curPoints[a],r.point=r.target.globalToLocal(r.stagePoint),e.dispatchEvent(r)}}),n},_clone2hoverStage:function(t,e){var i=this.canvax,n=i._bufferStage.getChildById(t.id);return n||((n=t.clone(!0))._transform=t.getConcatenatedMatrix(),i._bufferStage.addChildAt(n,0)),n.context.globalAlpha=t._globalAlpha,t._dragPoint=t.globalToLocal(this.curPoints[e]),n},_dragIngHander:function(t,e,i){var n=this.canvax,a=e.globalToLocal(this.curPoints[i]);e._noHeart=!0;var r=e.moveing;e.moveing=!0,e.context.x+=a.x-e._dragPoint.x,e.context.y+=a.y-e._dragPoint.y,e.fire("draging"),e.moveing=r,e._noHeart=!1;var s=n._bufferStage.getChildById(e.id);s._transform=e.getConcatenatedMatrix(),s.worldTransform=null,s.heartBeat()},_dragEnd:function(t,e,i){var n=this.canvax._bufferStage.getChildById(e.id);n&&n.destroy(),e.context.globalAlpha=e._globalAlpha}};var It={mainFrameRate:60,now:0,_pixelCtx:null,__emptyFunc:function(){},_devicePixelRatio:window.devicePixelRatio||1,_UID:0,getUID:function(){return this._UID++},createId:function(t){var e=t.charCodeAt(t.length-1);return e>=48&&e<=57&&(t+="_"),t+It.getUID()},canvasSupport:function(){return!!document.createElement("canvas").getContext},initElement:function(t){return window.FlashCanvas&&FlashCanvas.initElement&&FlashCanvas.initElement(t),t},getCssOrderArr:function(t){var e,i,n,a;return"number"==typeof t?e=i=n=a=t:t instanceof Array?1===t.length?e=i=n=a=t[0]:2===t.length?(e=n=t[0],i=a=t[1]):3===t.length?(e=t[0],i=a=t[1],n=t[2]):(e=t[0],i=t[1],n=t[2],a=t[3]):e=i=n=a=0,[e,i,n,a]},isWebGLSupported:function(){var t={stencil:!0};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);return!(!i||!i.getContextAttributes().stencil)}catch(t){return!1}},checkOpt:function(t){return t?t.context||(t.context={}):t={context:{}},t}};It._pixelCtx=It.initElement(kt.createCanvas(1,1,"_pixelCanvas")).getContext("2d");var Rt=function(t,e,i,n,a,r){this.a=void 0!=t?t:1,this.b=void 0!=e?e:0,this.c=void 0!=i?i:0,this.d=void 0!=n?n:1,this.tx=void 0!=a?a:0,this.ty=void 0!=r?r:0,this.array=null};Rt.prototype={concat:function(t){var e=this.a,i=this.c,n=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=n*t.a+this.ty*t.c+t.tx,this.ty=n*t.b+this.ty*t.d+t.ty,this},concatTransform:function(t,e,i,n,a){var r=1,s=0;if(a%360){var o=a*Math.PI/180;r=Math.cos(o),s=Math.sin(o)}return this.concat(new Rt(r*i,s*i,-s*n,r*n,t,e)),this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,a=this.c,r=this.tx;if(t>0)this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=a*e-this.d*i,this.d=a*i+this.d*e,this.tx=r*e-this.ty*i,this.ty=r*i+this.ty*e;else{var s=Math.sin(Math.abs(t)),o=Math.cos(Math.abs(t));this.a=n*o+this.b*s,this.b=-n*s+this.b*o,this.c=a*o+this.d*s,this.d=-a*s+o*this.d,this.tx=o*r+s*this.ty,this.ty=o*this.ty-s*r}return this},scale:function(t,e){return this.a*=t,this.d*=e,this.tx*=t,this.ty*=e,this},translate:function(t,e){return this.tx+=t,this.ty+=e,this},identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},invert:function(){var t=this.a,e=this.b,i=this.c,n=this.d,a=this.tx,r=t*n-e*i;return this.a=n/r,this.b=-e/r,this.c=-i/r,this.d=t/r,this.tx=(i*this.ty-n*a)/r,this.ty=-(t*this.ty-e*a)/r,this},clone:function(){return new Rt(this.a,this.b,this.c,this.d,this.tx,this.ty)},toArray:function(t,e){if(0==arguments.length)return[this.a,this.b,this.c,this.d,this.tx,this.ty];this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},mulVector:function(t){var e=this.a,i=this.c,n=this.tx,a=this.b,r=this.d,s=this.ty,o=[0,0];return o[0]=t[0]*e+t[1]*i+n,o[1]=t[0]*a+t[1]*r+s,o}};var Ft=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(i(this,t),1==arguments.length&&"object"==e(arguments[0])){var r=arguments[0];if("x"in r&&"y"in r)this.x=1*r.x,this.y=1*r.y;else{var s=0;for(var o in r){if(0!=s){this.y=1*r[o];break}this.x=1*r[o],s++}}}else this.x=1*n,this.y=1*a}return n(t,[{key:"toArray",value:function(){return[this.x,this.y]}}]),t}();"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;for(var Et,Wt=(function(t,e){var i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},remove:function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},update:function(t,e){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(t=void 0!==t?t:a.now();i.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++)!1===this._tweens[i[n]].update(t)&&(this._tweens[i[n]]._isPlaying=!1,e||delete this._tweens[i[n]]);i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var n,a=new i;a.Group=i,a._nextId=0,a.nextId=function(){return a._nextId++},"undefined"==typeof window&&"undefined"!=typeof process?a.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?a.now=window.performance.now.bind(window.performance):void 0!==Date.now?a.now=Date.now:a.now=function(){return(new Date).getTime()},a.Tween=function(t,e){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=a.Easing.Linear.None,this._interpolationFunction=a.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=e||a,this._id=a.nextId()},a.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(t,e){return this._valuesEnd=t,void 0!==e&&(this._duration=e),this},start:function(t){for(var e in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==t?"string"==typeof t?a.now()+parseFloat(t):t:a.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}void 0!==this._object[e]&&(this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array==!1&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop()},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function(t){return this._yoyo=t,this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var e,i,n;if(t<this._startTime)return!0;for(e in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(i=(t-this._startTime)/this._duration)>1?1:i,n=this._easingFunction(i),this._valuesEnd)if(void 0!==this._valuesStart[e]){var a=this._valuesStart[e]||0,r=this._valuesEnd[e];r instanceof Array?this._object[e]=this._interpolationFunction(r,n):("string"==typeof r&&(r="+"===r.charAt(0)||"-"===r.charAt(0)?a+parseFloat(r):parseFloat(r)),"number"==typeof r&&(this._object[e]=a+(r-a)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===i){if(this._repeat>0){for(e in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo){var s=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=s}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,l=this._chainedTweens.length;o<l;o++)this._chainedTweens[o].start(this._startTime+this._duration);return!1}return!0}},a.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-a.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*a.Easing.Bounce.In(2*t):.5*a.Easing.Bounce.Out(2*t-1)+.5}}},a.Interpolation={Linear:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n),s=a.Interpolation.Utils.Linear;return e<0?s(t[0],t[1],n):e>1?s(t[i],t[i-1],i-n):s(t[r],t[r+1>i?i:r+1],n-r)},Bezier:function(t,e){for(var i=0,n=t.length-1,r=Math.pow,s=a.Interpolation.Utils.Bernstein,o=0;o<=n;o++)i+=r(1-e,n-o)*r(e,o)*t[o]*s(n,o);return i},CatmullRom:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n),s=a.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(r=Math.floor(n=i*(1+e))),s(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],n-r)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(s(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):s(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],n-r)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=a.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:(n=[1],function(t){var e=1;if(n[t])return n[t];for(var i=t;i>1;i--)e*=i;return n[t]=e,e}),CatmullRom:function(t,e,i,n,a){var r=.5*(i-t),s=.5*(n-e),o=a*a;return(2*e-2*i+r+s)*(a*o)+(-3*e+3*i-2*r-s)*o+r*a+e}}},t.exports=a}(Et={exports:{}},Et.exports),Et.exports),Nt=0,zt=["ms","moz","webkit","o"],Gt=0;Gt<zt.length&&!window.requestAnimationFrame;++Gt)window.requestAnimationFrame=window[zt[Gt]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[zt[Gt]+"CancelAnimationFrame"]||window[zt[Gt]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var i=(new Date).getTime(),n=Math.max(0,16-(i-Nt)),a=window.setTimeout(function(){t(i+n)},n);return Nt=i+n,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});var Bt=[],jt=null;function Ht(t){if(t)return Bt.push(t),jt||(jt=requestAnimationFrame(function(){Wt.update();var t=Bt;for(Bt=[],jt=null;t.length>0;)t.shift().task()})),jt}function Vt(t){for(var e=!1,i=0,n=Bt.length;i<n;i++)Bt[i].id===t.id&&(e=!0,Bt.splice(i,1),i--,n--);return 0==Bt.length&&(cancelAnimationFrame(jt),jt=null),e}var Yt={registFrame:Ht,destroyFrame:Vt,registTween:function(t){var e=U.extend({from:null,to:null,duration:500,onStart:function(){},onUpdate:function(){},onComplete:function(){},onStop:function(){},repeat:0,delay:0,easing:"Linear.None",desc:""},t),i={},n="tween_"+It.getUID();e.id&&(n=n+"_"+e.id),e.from&&e.to&&((i=new Wt.Tween(e.from).to(e.to,e.duration).onStart(function(){e.onStart(e.from)}).onUpdate(function(){e.onUpdate(e.from)}).onComplete(function(){Vt({id:n}),i._isCompleteed=!0,e.onComplete(e.from)}).onStop(function(){Vt({id:n}),i._isStoped=!0,e.onStop(e.from)}).repeat(e.repeat).delay(e.delay).easing(Wt.Easing[e.easing.split(".")[0]][e.easing.split(".")[1]])).id=n,i.start(),function t(){i._isCompleteed||i._isStoped?i=null:Ht({id:n,task:t,desc:e.desc,tween:i})}());return i},destroyTween:function(t,e){t.stop()},Tween:Wt,taskList:Bt};var $t=Object.defineProperty;try{$t({},"_",{value:"x"});var qt=Object.defineProperties}catch(t){"__defineGetter__"in Object&&($t=function(t,e,i){return"value"in i&&(t[e]=i.value),"get"in i&&t.__defineGetter__(e,i.get),"set"in i&&t.__defineSetter__(e,i.set),t},qt=function(t,e){for(var i in e)e.hasOwnProperty(i)&&$t(t,i,e[i]);return t})}Math.PI,Math.PI,Math.PI;var Xt={UNKNOWN:0,WEBGL:1,CANVAS:2},Ut={POLY:0,RECT:1,CIRC:2,ELIP:3},Zt=["x","y","scaleX","scaleY","rotation","scaleOrigin","rotateOrigin"],Qt=["lineWidth","lineAlpha","strokeStyle","fillStyle","fillAlpha","globalAlpha"],Jt=function(t,e,i,n){var a=t[0],r=t[1],s=t[2],o=t[3],l=Math.max(n,3),h=0,u=a;return!(i>r+l&&i>o+l||i<r-l&&i<o-l||e>a+l&&e>s+l||e<a-l&&e<s-l)&&(a===s?Math.abs(e-a)<=l/2:((h=(r-o)/(a-s))*e-i+(u=(a*o-s*r)/(a-s)))*(h*e-i+u)/(h*h+1)<=l/2*l/2)};function Kt(t,e,i,n){for(var a=t.shape.points,r=t.lineWidth,s=!1,o=0;o<a.length&&!(s=Jt(a.slice(o,o+4),e,i,r));++o)o+=1;return s}var te={RESOLUTION:window.devicePixelRatio||1,TARGET_FPMS:.06,MIPMAP_TEXTURES:!0,FILTER_RESOLUTION:1,SPRITE_BATCH_SIZE:4096,RETINA_PREFIX:/@(.+)x/,RENDER_OPTIONS:{view:null,antialias:!0,forceFXAA:!1,autoResize:!1,transparent:!0,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1},TRANSFORM_MODE:0,GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:0,SCALE_MODE:0,PRECISION:"mediump"},ee=function(t){function a(t){i(this,a);var e=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));e._transform=null,e.worldTransform=null,e._transformChange=!1,e._heartBeatNum=0,e.stage=null,e.parent=null,e.xyToInt=!("xyToInt"in t)||t.xyToInt,e.moveing=!1,e.clip=null,e.context=e._createContext(t),e.type=t.type||"DisplayObject",e.id=t.id||It.createId(e.type),e._trackList=[],e.init.apply(e,arguments),e._updateTransform(),e._tweens=[];var n=e;return e.on("destory",function(){n.cleanAnimates()}),e}return r(a,Lt),n(a,[{key:"init",value:function(){}},{key:"clipTo",value:function(t){this.clip=t,t.isClip=!0}},{key:"_createContext",value:function(t){var i=this,n=t.context||{},a={width:n.width||0,height:n.height||0,x:n.x||0,y:n.y||0,scaleX:n.scaleX||1,scaleY:n.scaleY||1,scaleOrigin:n.scaleOrigin||{x:0,y:0},rotation:n.rotation||0,rotateOrigin:n.rotateOrigin||{x:0,y:0},visible:n.visible||!0,globalAlpha:n.globalAlpha||1};return U.extend(!0,a,t.context),i._notWatch=!1,i._noHeart=!1,a.$watch=function(t,e,n){var a=i;a.context&&("globalGalpha"==t&&(a._globalAlphaChange=!0),U.indexOf(Zt,t)>-1&&(a._updateTransform(),a._transformChange=!0),a._notWatch||(a.$watch&&(a._notWatch=!0,a.$watch(t,e,n),a._notWatch=!1),a._noHeart||a.heartBeat({convertType:"context",shape:a,name:t,value:e,preValue:n})))},function t(i){var n=!0,a={},r={},s=["$watch","$model"],o={},l=s;function h(i,h){-1===U.indexOf(s,i)&&(o[i]=h);var u=void 0===h?"undefined":e(h);if(!(U.indexOf(l,i)>-1))if("function"===u)l.push(i);else{var d=function(r){var s,l=o[i],h=l;if(!arguments.length)return!l||"object"!==u||l instanceof Array||l.$model||l.addColorStop||((l=t(l)).$watch=a.$watch,o[i]=l),l;var d=void 0===r?"undefined":e(r);n||l!==r&&(!r||"object"!==d||r instanceof Array||r.addColorStop?l=r:s=(l=r.$model?r:t(r)).$model,o[i]=s||l,u!=d&&(u=d),a.$watch&&a.$watch.call(a,i,l,h))};r[i]={set:d,get:d,enumerable:!0}}}for(var u in i)h(u,i[u]);return a=qt(a,r,l),U.forEach(l,function(t){i[t]&&("function"==typeof i[t]?a[t]=function(){i[t].apply(this,arguments)}:a[t]=i[t])}),a.$model=o,a.hasOwnProperty=function(t){return t in a.$model},n=!1,a}(a)}},{key:"track",value:function(t){-1==U.indexOf(this._trackList,t)&&this._trackList.push(t)}},{key:"untrack",value:function(t){var e=U.indexOf(this._trackList,t);e>-1&&this._trackList.splice(e,1)}},{key:"clone",value:function(t){var e,i={id:this.id,context:U.clone(this.context.$model),isClone:!0};return(e="text"==this.type?new this.constructor(this.text,i):new this.constructor(i)).id=i.id,this.children&&(e.children=this.children),this.graphics&&(e.graphics=this.graphics.clone()),t||(e.id=It.createId(e.type)),e}},{key:"heartBeat",value:function(t){var e=this.getStage();e&&(this._heartBeatNum++,e.heartBeat&&e.heartBeat(t))}},{key:"getCurrentWidth",value:function(){return Math.abs(this.context.$model.width*this.context.$model.scaleX)}},{key:"getCurrentHeight",value:function(){return Math.abs(this.context.$model.height*this.context.$model.scaleY)}},{key:"getStage",value:function(){if(this.stage)return this.stage;var t=this;if("stage"!=t.type){for(;t.parent&&"stage"!=(t=t.parent).type;);if("stage"!==t.type)return!1}return this.stage=t,t}},{key:"localToGlobal",value:function(t,e){!t&&(t=new Ft(0,0));var i=this.getConcatenatedMatrix(e);if(null==i)return Ft(0,0);var n=new Rt(1,0,0,1,t.x,t.y);return n.concat(i),new Ft(n.tx,n.ty)}},{key:"globalToLocal",value:function(t,e){if(!t&&(t=new Ft(0,0)),"stage"==this.type)return t;var i=this.getConcatenatedMatrix(e);if(null==i)return new Ft(0,0);i.invert();var n=new Rt(1,0,0,1,t.x,t.y);return n.concat(i),new Ft(n.tx,n.ty)}},{key:"localToTarget",value:function(t,e){var i=localToGlobal(t);return e.globalToLocal(i)}},{key:"getConcatenatedMatrix",value:function(t){for(var e=new Rt,i=this;null!=i;i=i.parent)if(e.concat(i._transform),!i.parent||t&&i.parent&&i.parent==t||i.parent&&"stage"==i.parent.type)return e;return e}},{key:"setEventEnable",value:function(t){return!!U.isBoolean(t)&&(this._eventEnabled=t,!0)}},{key:"getIndex",value:function(){if(this.parent)return U.indexOf(this.parent.children,this)}},{key:"toBack",value:function(t){if(this.parent){var e=this.getIndex(),i=0;if(U.isNumber(t)){if(0==t)return;i=e-t}var n=this.parent.children.splice(e,1)[0];i<0&&(i=0),this.parent.addChildAt(n,i)}}},{key:"toFront",value:function(t){if(this.parent){var e=this.getIndex(),i=this.parent.children.length,n=i;if(U.isNumber(t)){if(0==t)return;n=e+t+1}var a=this.parent.children.splice(e,1)[0];n>i&&(n=i),this.parent.addChildAt(a,n-1)}}},{key:"_updateTransform",value:function(){var t=new Rt;t.identity();var e=this.context;1===e.scaleX&&1===e.scaleY||(((i=new Ft(e.scaleOrigin)).x||i.y)&&t.translate(-i.x,-i.y),t.scale(e.scaleX,e.scaleY),(i.x||i.y)&&t.translate(i.x,i.y));var i,n=e.rotation;n&&(((i=new Ft(e.rotateOrigin)).x||i.y)&&t.translate(-i.x,-i.y),t.rotate(n%360*Math.PI/180),(i.x||i.y)&&t.translate(i.x,i.y));if(this.xyToInt&&!this.moveing){var a=parseInt(e.x),r=parseInt(e.y);parseInt(e.lineWidth,10)%2==1&&e.strokeStyle&&(a+=.5,r+=.5)}else a=e.x,r=e.y;return 0==a&&0==r||t.translate(a,r),this._transform=t,t}},{key:"setWorldTransform",value:function(){var t=new Rt;return t.concat(this._transform),this.parent&&t.concat(this.parent.worldTransform),this.worldTransform=t,this.worldTransform}},{key:"getChildInPoint",value:function(t){var e=!1,i=t.x,n=t.y;if(this.worldTransform){var a=this.worldTransform.clone().invert(),r=[i*te.RESOLUTION,n*te.RESOLUTION];i=(r=a.mulVector(r))[0],n=r[1]}if(this.graphics&&(e=this.containsPoint({x:i,y:n})),"text"==this.type){var s=this.getRect();return!(!s.width||!s.height)&&(e=i>=s.x&&i<=s.x+s.width&&(s.height>=0&&n>=s.y&&n<=s.y+s.height||s.height<0&&n<=s.y&&n>=s.y+s.height))}return e}},{key:"containsPoint",value:function(t){for(var e=!1,i=0;i<this.graphics.graphicsData.length;++i){var n=this.graphics.graphicsData[i];if(n.shape){if(n.hasFill()&&n.shape.contains(t.x,t.y)&&(e=!0))break;if(n.hasLine()&&n.shape.points&&(e=Kt(n,t.x,t.y)))break}}return e}},{key:"animate",value:function(t,e,i){if(i||(i=this.context),i){var n=t,a=null;for(var r in n)U.isObject(n[r])?this.animate(n[r],U.extend({},e),i[r]):isNaN(n[r])&&""!==n[r]&&null!==n[r]?(i[r]=n[r],delete n[r]):(a||(a={}),a[r]=i[r]);if(a){!e&&(e={}),e.from=a,e.to=n;var s,o=this,l=function(){};e.onUpdate&&(l=e.onUpdate),e.onUpdate=function(t){if(!i&&s)return Yt.destroyTween(s),void(s=null);for(var e in t)i[e]=t[e];l.apply(o,[t])};var h=function(){};return e.onComplete&&(h=e.onComplete),e.onComplete=function(t){h.apply(o,arguments),o._removeTween(s)},e.onStop=function(){o._removeTween(s)},e.desc="tweenType:DisplayObject.animate__id:"+this.id+"__objectType:"+this.type,s=Yt.registTween(e),this._tweens.push(s),s}}}},{key:"_removeTween",value:function(t){for(var e=0;e<this._tweens.length;e++)if(t==this._tweens[e]){this._tweens.splice(e,1);break}}},{key:"removeAnimate",value:function(t){t.stop(),this._removeTween(t)}},{key:"cleanAnimates",value:function(){this._cleanAnimates()}},{key:"_cleanAnimates",value:function(){for(;this._tweens.length;)this._tweens.shift().stop()}},{key:"remove",value:function(){this.parent&&(this.parent.removeChild(this),this.parent=null)}},{key:"destroy",value:function(){this._destroy()}},{key:"_destroy",value:function(){this.remove(),this.fire("destroy"),this.context=null,delete this.context}}]),a}(),ie=function(t){function e(t){i(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.children=[],n.mouseChildren=[],n._eventEnabled=!0,n}return r(e,ee),n(e,[{key:"addChild",value:function(t,e){if(t)return-1!=this.getChildIndex(t)?(t.parent=this,t):(t.parent&&t.parent.removeChild(t),void 0===e&&(e=this.children.length),this.children.splice(e,0,t),t.parent=this,this.heartBeat&&this.heartBeat({convertType:"children",target:t,src:this}),this._afterAddChild&&this._afterAddChild(t),t)}},{key:"addChildAt",value:function(t,e){return this.addChild(t,e)}},{key:"removeChild",value:function(t){return this.removeChildAt(U.indexOf(this.children,t))}},{key:"removeChildAt",value:function(t){if(t<0||t>this.children.length-1)return!1;var e=this.children[t];return null!=e&&(e.parent=null),this.children.splice(t,1),this.heartBeat&&this.heartBeat({convertType:"children",target:e,src:this}),this._afterDelChild&&this._afterDelChild(e,t),e}},{key:"removeChildById",value:function(t){for(var e=0,i=this.children.length;e<i;e++)if(this.children[e].id==t)return this.removeChildAt(e);return!1}},{key:"removeAllChildren",value:function(){for(;this.children.length>0;)this.removeChildAt(0)}},{key:"destroy",value:function(){for(var t=0,e=this.children.length;t<e;t++)this.getChildAt(t).destroy(),t--,e--;this._destroy()}},{key:"cleanAnimates",value:function(){for(var t=0,e=this.children.length;t<e;t++)this.getChildAt(t).cleanAnimates();this._cleanAnimates()}},{key:"getChildById",value:function(t,e){if(e)return null;for(var i=0,n=this.children.length;i<n;i++)if(this.children[i].id==t)return this.children[i];return null}},{key:"getChildAt",value:function(t){return t<0||t>this.children.length-1?null:this.children[t]}},{key:"getChildIndex",value:function(t){return U.indexOf(this.children,t)}},{key:"setChildIndex",value:function(t,e){if(t.parent==this){var i=U.indexOf(this.children,t);e!=i&&(this.children.splice(i,1),this.children.splice(e,0,t))}}},{key:"getNumChildren",value:function(){return this.children.length}},{key:"getObjectsUnderPoint",value:function(t,i){for(var n=[],a=this.children.length-1;a>=0;a--){var r=this.children[a];if(null!=r&&(r._eventEnabled||r.dragEnabled)&&r.context.$model.visible)if(r instanceof e){if(r.mouseChildren&&r.getNumChildren()>0){var s=r.getObjectsUnderPoint(t);s.length>0&&(n=n.concat(s))}}else if(r.getChildInPoint(t)&&(n.push(r),void 0!=i&&!isNaN(i)&&n.length==i))return n}return n}}]),e}(),ne=function(t){function e(t){i(this,e),t.type="stage";var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.canvas=null,n.ctx=null,n.stageRending=!1,n._isReady=!1,n}return r(e,ie),n(e,[{key:"initStage",value:function(t,e,i){this.canvas=t;var n=this.context;n.width=e,n.height=i,n.scaleX=It._devicePixelRatio,n.scaleY=It._devicePixelRatio,this._isReady=!0}},{key:"heartBeat",value:function(t){this._isReady&&(t||(t={}),t.stage=this,this.parent&&this.parent.heartBeat(t))}}]),e}(),ae=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xt.UNKNOWN,n=arguments[1],a=arguments[2];if(i(this,t),this.type=e,this.app=n,a)for(var r in te.RENDER_OPTIONS)void 0===a[r]&&(a[r]=te.RENDER_OPTIONS[r]);else a=te.RENDER_OPTIONS;this.options=a,this.requestAid=null,this._heartBeat=!1,this._preRenderTime=0}return n(t,[{key:"startEnter",value:function(){var t=this;t.requestAid||(t.requestAid=Yt.registFrame({id:"enterFrame",task:function(){t.enterFrame.apply(t)}}))}},{key:"enterFrame",value:function(){this.requestAid=null,It.now=(new Date).getTime(),this._heartBeat&&(this.app.children.length&&this.render(this.app),this._heartBeat=!1,this._preRenderTime=(new Date).getTime())}},{key:"_convertCanvax",value:function(t){U.each(this.app.children,function(e){e.context[t.name]=t.value})}},{key:"heartBeat",value:function(t){var e=this;if(t){if("context"==t.convertType){var i=t.stage,n=t.shape;t.name,t.value,t.preValue;if("canvax"==n.type)e._convertCanvax(t);else if(e.app.convertStages[i.id]||(e.app.convertStages[i.id]={stage:i,convertShapes:{}}),n){if(e.app.convertStages[i.id].convertShapes[n.id])return;e.app.convertStages[i.id].convertShapes[n.id]={shape:n,convertType:t.convertType}}}if("children"==t.convertType){var a=t.target;((i=t.src.getStage())||"stage"==a.type)&&(i=i||a,e.app.convertStages[i.id]||(e.app.convertStages[i.id]={stage:i,convertShapes:{}}))}if(!t.convertType){i=t.stage;e.app.convertStages[i.id]||(e.app.convertStages[i.id]={stage:i,convertShapes:{}})}}else U.each(e.app.children,function(t,i){e.app.convertStages[t.id]={stage:t,convertShapes:{}}});e._heartBeat?e._heartBeat=!0:(e._heartBeat=!0,e.startEnter())}}]),t}(),re=function(){function t(e){i(this,t),this.renderer=e}return n(t,[{key:"render",value:function(t,e,i,n){this.renderer;for(var a=t.graphics.graphicsData,r=e.ctx,s=0;s<a.length;s++){var o=a[s],l=o.shape,h=o.fillStyle,u=o.strokeStyle,d=o.hasFill()&&o.fillAlpha&&!n,c=o.hasLine()&&o.lineAlpha&&!n;if(r.lineWidth=o.lineWidth,o.type===Ut.POLY)r.beginPath(),this.renderPolygon(l.points,l.closed,r,n),d&&(r.globalAlpha=o.fillAlpha*i,r.fillStyle=h,r.fill()),c&&(r.globalAlpha=o.lineAlpha*i,r.strokeStyle=u,r.stroke());else if(o.type===Ut.RECT)n&&r.rect(l.x,l.y,l.width,l.height),d&&(r.globalAlpha=o.fillAlpha*i,r.fillStyle=h,r.fillRect(l.x,l.y,l.width,l.height)),c&&(r.globalAlpha=o.lineAlpha*i,r.strokeStyle=u,r.strokeRect(l.x,l.y,l.width,l.height));else if(o.type===Ut.CIRC)r.beginPath(),r.arc(l.x,l.y,l.radius,0,2*Math.PI),r.closePath(),d&&(r.globalAlpha=o.fillAlpha*i,r.fillStyle=h,r.fill()),c&&(r.globalAlpha=o.lineAlpha*i,r.strokeStyle=u,r.stroke());else if(o.type===Ut.ELIP){var f=2*l.width,p=2*l.height,g=l.x-f/2,v=l.y-p/2;r.beginPath();var y=f/2*.5522848,x=p/2*.5522848,_=g+f,m=v+p,b=g+f/2,k=v+p/2;r.moveTo(g,k),r.bezierCurveTo(g,k-x,b-y,v,b,v),r.bezierCurveTo(b+y,v,_,k-x,_,k),r.bezierCurveTo(_,k+x,b+y,m,b,m),r.bezierCurveTo(b-y,m,g,k+x,g,k),r.closePath(),d&&(r.globalAlpha=o.fillAlpha*i,r.fillStyle=h,r.fill()),c&&(r.globalAlpha=o.lineAlpha*i,r.strokeStyle=u,r.stroke())}}}},{key:"renderPolygon",value:function(t,e,i,n){i.moveTo(t[0],t[1]);for(var a=1;a<t.length/2;++a)i.lineTo(t[2*a],t[2*a+1]);(e||n)&&i.closePath()}}]),t}(),se=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Xt.CANVAS,t,n));return a.CGR=new re(a),a}return r(e,ae),n(e,[{key:"render",value:function(t){var e=this;e.app=t,U.each(U.values(t.convertStages),function(t){e.renderStage(t.stage)}),t.convertStages={}}},{key:"renderStage",value:function(t){t.ctx||(t.ctx=t.canvas.getContext("2d")),t.stageRending=!0,t.setWorldTransform(),this._clear(t),this._render(t,t,t.context.globalAlpha),t.stageRending=!1}},{key:"_render",value:function(t,e,i){var n=t.ctx;if(n){var a=e.context.$model;if((!e.worldTransform||e._transformChange||e.parent&&e.parent._transformChange)&&(e.setWorldTransform(),e._transformChange=!0),i*=a.globalAlpha,a.visible&&!e.isClip){n.setTransform.apply(n,e.worldTransform.toArray());var r=!1;if(e.clip&&e.clip.graphics){var s=e.clip;n.save(),r=!0,(!s.worldTransform||s._transformChange||s.parent._transformChange)&&(s.setWorldTransform(),s._transformChange=!0),n.setTransform.apply(n,s.worldTransform.toArray()),s.graphics.graphicsData.length||s._draw(s.graphics),this.CGR.render(s,t,i,r),s._transformChange=!1,n.clip()}if(e.graphics&&(e.graphics.graphicsData.length||e._draw(e.graphics),i&&this.CGR.render(e,t,i)),"text"==e.type&&e.render(n,i),e.children)for(var o=0,l=e.children.length;o<l;o++)this._render(t,e.children[o],i);e._transformChange=!1,r&&n.restore()}}}},{key:"_clear",value:function(t){var e=t.ctx;e.setTransform.apply(e,t.worldTransform.toArray()),e.clearRect(0,0,this.app.width,this.app.height)}}]),e}();var oe=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e),t.type="canvax";var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));a._cid=(new Date).getTime()+"_"+Math.floor(100*Math.random()),a.el=kt.query(t.el),a.width=parseInt("width"in t||a.el.offsetWidth,10),a.height=parseInt("height"in t||a.el.offsetHeight,10);var r=kt.createView(a.width,a.height,a._cid);return a.view=r.view,a.stageView=r.stageView,a.domView=r.domView,a.el.innerHTML="",a.el.appendChild(a.view),a.viewOffset=kt.offset(a.view),a.lastGetRO=0,a.webGL=t.webGL,a.renderer=function(t,e){return new se(t,e)}(a,n),a.event=null,a.preventDefault=!0,!1===t.preventDefault&&(a.preventDefault=!1),a.convertStages={},a.context.$model.width=a.width,a.context.$model.height=a.height,a._bufferStage=null,a._creatHoverStage(),a.worldTransform=(new Rt).identity(),a}return r(e,ie),n(e,[{key:"registEvent",value:function(t){return this.event=new Dt(this,t),this.event.init(),this.event}},{key:"destroy",value:function(){for(var t=0,e=this.children.length;t<e;t++){var i=this.children[t];i.destroy(),i.canvas=null,i.ctx=null,i=null,t--,e--}this.view.removeChild(this.stageView),this.view.removeChild(this.domView),this.el.removeChild(this.view),this.el.innerHTML="",this.event=null,this._bufferStage=null}},{key:"resize",value:function(t){this.width=parseInt(t&&"width"in t||this.el.offsetWidth,10),this.height=parseInt(t&&"height"in t||this.el.offsetHeight,10),this.viewOffset=kt.offset(this.view),this.context.$model.width=this.width,this.context.$model.height=this.height;var e=this;U.each(this.children,function(t,i){var n;t.context.$model.width=e.width,t.context.$model.height=e.height,(n=t.canvas).style.width=e.width+"px",n.style.height=e.height+"px",n.setAttribute("width",e.width*It._devicePixelRatio),n.setAttribute("height",e.height*It._devicePixelRatio)}),this.stageView.style.width=this.width+"px",this.stageView.style.height=this.height+"px",this.domView.style.width=this.width+"px",this.domView.style.height=this.height+"px",this.heartBeat()}},{key:"getHoverStage",value:function(){return this._bufferStage}},{key:"_creatHoverStage",value:function(){this._bufferStage=new ne({id:"activCanvas"+(new Date).getTime(),context:{width:this.context.$model.width,height:this.context.$model.height}}),this._bufferStage._eventEnabled=!1,this.addChild(this._bufferStage)}},{key:"updateViewOffset",value:function(){var t=(new Date).getTime();t-this.lastGetRO>1e3&&(this.viewOffset=kt.offset(this.view),this.lastGetRO=t)}},{key:"_afterAddChild",value:function(t,e){var i;i=t.canvas?t.canvas:kt.createCanvas(this.context.$model.width,this.context.$model.height,t.id),1==this.children.length?this.stageView.appendChild(i):this.children.length>1&&(void 0===e?this.stageView.insertBefore(i,this._bufferStage.canvas):e>=this.children.length-1?this.stageView.appendChild(i):this.stageView.insertBefore(i,this.children[e].canvas)),It.initElement(i),t.initStage(i,this.context.$model.width,this.context.$model.height)}},{key:"_afterDelChild",value:function(t){this.stageView.removeChild(t.canvas)}},{key:"heartBeat",value:function(t){this.children.length>0&&this.renderer.heartBeat(t)}},{key:"toDataURL",value:function(){var t=kt.createCanvas(this.width,this.height,"curr_base64_canvas"),e=t.getContext("2d");return U.each(this.children,function(t){e.drawImage(t.canvas,0,0)}),t.toDataURL()}}]),e}(),le=function(t){function e(t){return i(this,e),(t=It.checkOpt(t)).type="sprite",s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return r(e,ie),e}(),he=function(){function t(e,n,a,r,s,o){i(this,t),this.lineWidth=e,this.strokeStyle=n,this.lineAlpha=a,this.fillStyle=r,this.fillAlpha=s,this.shape=o,this.type=o.type,this.holes=[],this.fill=!0,this.line=!0}return n(t,[{key:"clone",value:function(){var e=new t(this.lineWidth,this.strokeStyle,this.lineAlpha,this.fillStyle,this.fillAlpha,this.shape);return e.fill=this.fill,e.line=this.line,e}},{key:"addHole",value:function(t){this.holes.push(t)}},{key:"synsStyle",value:function(t){this.line&&(this.lineWidth=t.lineWidth,this.strokeStyle=t.strokeStyle,this.lineAlpha=t.lineAlpha),this.fill&&(this.fillStyle=t.fillStyle,this.fillAlpha=t.fillAlpha)}},{key:"hasFill",value:function(){return this.fillStyle&&this.fill&&void 0!==this.shape.closed&&this.shape.closed}},{key:"hasLine",value:function(){return this.strokeStyle&&this.lineWidth&&this.line}},{key:"destroy",value:function(){this.shape=null,this.holes=null}}]),t}(),ue={},de={},ce=Array.prototype.join;function fe(t,e,i,n,a,r,s){var o=ce.call(arguments);if(ue[o])return ue[o];var l=Math.PI,h=s*l/180,u=Math.sin(h),d=Math.cos(h),c=0,f=0,p=-d*t*.5-u*e*.5,g=-d*e*.5+u*t*.5,v=(i=Math.abs(i))*i,y=(n=Math.abs(n))*n,x=g*g,_=p*p,m=v*y-v*x-y*_,b=0;if(m<0){var k=Math.sqrt(1-m/(v*y));i*=k,n*=k}else b=(a===r?-1:1)*Math.sqrt(m/(v*x+y*_));var w=b*i*g/n,S=-b*n*p/i,A=d*w-u*S+.5*t,C=u*w+d*S+.5*e,P=ge(1,0,(p-w)/i,(g-S)/n),T=ge((p-w)/i,(g-S)/n,(-p-w)/i,(-g-S)/n);0===r&&T>0?T-=2*l:1===r&&T<0&&(T+=2*l);for(var L=Math.ceil(Math.abs(T/l*2)),O=[],D=T/L,M=8/3*Math.sin(D/4)*Math.sin(D/4)/Math.sin(D/2),I=P+D,R=0;R<L;R++)O[R]=pe(P,I,d,u,i,n,A,C,M,c,f),c=O[R][4],f=O[R][5],P=I,I+=D;return ue[o]=O,O}function pe(t,e,i,n,a,r,s,o,l,h,u){var d=ce.call(arguments);if(de[d])return de[d];var c=Math.cos(t),f=Math.sin(t),p=Math.cos(e),g=Math.sin(e),v=i*a*p-n*r*g+s,y=n*a*p+i*r*g+o,x=h+l*(-i*a*f-n*r*c),_=u+l*(-n*a*f+i*r*c),m=v+l*(i*a*g+n*r*p),b=y+l*(n*a*g-i*r*p);return de[d]=[x,_,m,b,v,y],de[d]}function ge(t,e,i,n){var a=Math.atan2(e,t),r=Math.atan2(n,i);return r>=a?r-a:2*Math.PI-(a-r)}var ve=function(t,e,i,n){for(var a=n[0],r=n[1],s=n[2],o=n[3],l=n[4],h=[[],[],[],[]],u=fe(n[5]-e,n[6]-i,a,r,o,l,s),d=0,c=u.length;d<c;d++)h[d][0]=u[d][0]+e,h[d][1]=u[d][1]+i,h[d][2]=u[d][2]+e,h[d][3]=u[d][3]+i,h[d][4]=u[d][4]+e,h[d][5]=u[d][5]+i,t.bezierCurveTo.apply(t,h[d])},ye=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;i(this,t),this.x=e,this.y=n,this.width=a,this.height=r,this.type=Ut.RECT,this.closed=!0}return n(t,[{key:"clone",value:function(){return new t(this.x,this.y,this.width,this.height)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}},{key:"contains",value:function(t,e){return!(this.height*e<0||this.width*t<0)&&(t>=this.x&&t<=this.x+this.width&&(this.height>=0&&e>=this.y&&e<=this.y+this.height||this.height<0&&e<=this.y&&e>=this.y+this.height))}}]),t}(),xe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,t),this.x=e,this.y=n,this.radius=a,this.type=Ut.CIRC,this.closed=!0}return n(t,[{key:"clone",value:function(){return new t(this.x,this.y,this.radius)}},{key:"contains",value:function(t,e){if(this.radius<=0)return!1;var i=this.radius*this.radius,n=this.x-t,a=this.y-e;return(n*=n)+(a*=a)<=i}},{key:"getBounds",value:function(){return new ye(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}]),t}(),_e=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;i(this,t),this.x=e,this.y=n,this.width=a,this.height=r,this.type=Ut.ELIP,this.closed=!0}return n(t,[{key:"clone",value:function(){return new t(this.x,this.y,this.width,this.height)}},{key:"contains",value:function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,n=(e-this.y)/this.height;return(i*=i)+(n*=n)<=1}},{key:"getBounds",value:function(){return new ye(this.x-this.width,this.y-this.height,this.width,this.height)}}]),t}(),me=function(){function t(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];i(this,t);var r=n[0];if(Array.isArray(r)&&(n=r),r&&"x"in r&&"y"in r){for(var s=[],o=0,l=n.length;o<l;o++)s.push(n[o].x,n[o].y);n=s}this.closed=!0,this.points=n,this.type=Ut.POLY}return n(t,[{key:"clone",value:function(){return new t(this.points.slice())}},{key:"close",value:function(){var t=this.points;t[0]===t[t.length-2]&&t[1]===t[t.length-1]||t.push(t[0],t[1]),this.closed=!0}},{key:"contains",value:function(t,e){return this._isInsidePolygon_WindingNumber(t,e)}},{key:"_isInsidePolygon_WindingNumber",value:function(t,e){for(var i,n=this.points,a=0,r=n[1]>e,s=3;s<n.length;s+=2)if((i=r)!=(r=n[s]>e)){var o=(i?1:0)-(r?1:0);o*((n[s-3]-t)*(n[s-0]-e)-(n[s-2]-e)*(n[s-1]-t))>0&&(a+=o)}return a}}]),t}();var be=function(){function t(e){i(this,t),this.lineWidth=1,this.strokeStyle=null,this.lineAlpha=1,this.fillStyle=null,this.fillAlpha=1,this.graphicsData=[],this.currentPath=null,this.dirty=0,this.clearDirty=0,this._webGL={},this.worldAlpha=1,this.tint=16777215,this.Bound={x:0,y:0,width:0,height:0}}return n(t,[{key:"setStyle",value:function(t){var e=t.$model;this.lineWidth=e.lineWidth,this.strokeStyle=e.strokeStyle,this.lineAlpha=e.lineAlpha*e.globalAlpha,this.fillStyle=e.fillStyle,this.fillAlpha=e.fillAlpha*e.globalAlpha;var i=this;this.graphicsData.length&&U.each(this.graphicsData,function(t,e){t.synsStyle(i)})}},{key:"clone",value:function(){var e=new t;e.dirty=0;for(var i=0;i<this.graphicsData.length;++i)e.graphicsData.push(this.graphicsData[i].clone());return e.currentPath=e.graphicsData[e.graphicsData.length-1],e}},{key:"moveTo",value:function(t,e){var i=new me([t,e]);return i.closed=!1,this.drawShape(i),this}},{key:"lineTo",value:function(t,e){return this.currentPath?(this.currentPath.shape.points.push(t,e),this.dirty++):this.moveTo(0,0),this}},{key:"quadraticCurveTo",value:function(t,e,i,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var a=this.currentPath.shape.points,r=0,s=0;0===a.length&&this.moveTo(0,0);for(var o=a[a.length-2],l=a[a.length-1],h=1;h<=20;++h){var u=h/20;r=o+(t-o)*u,s=l+(e-l)*u,a.push(r+(t+(i-t)*u-r)*u,s+(e+(n-e)*u-s)*u)}return this.dirty++,this}},{key:"bezierCurveTo",value:function(t,e,i,n,a,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var s=this.currentPath.shape.points,o=s[s.length-2],l=s[s.length-1];return s.length-=2,function(t,e,i,n,a,r,s,o){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],h=0,u=0,d=0,c=0,f=0;l.push(t,e);for(var p=1,g=0;p<=20;++p)d=(u=(h=1-(g=p/20))*h)*h,f=(c=g*g)*g,l.push(d*t+3*u*g*i+3*h*c*a+f*s,d*e+3*u*g*n+3*h*c*r+f*o)}(o,l,t,e,i,n,a,r,s),this.dirty++,this}},{key:"arcTo",value:function(t,e,i,n,a){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var r=this.currentPath.shape.points,s=r[r.length-2],o=r[r.length-1]-e,l=s-t,h=n-e,u=i-t,d=Math.abs(o*u-l*h);if(d<1e-8||0===a)r[r.length-2]===t&&r[r.length-1]===e||r.push(t,e);else{var c=o*o+l*l,f=h*h+u*u,p=o*h+l*u,g=a*Math.sqrt(c)/d,v=a*Math.sqrt(f)/d,y=g*p/c,x=v*p/f,_=g*u+v*l,m=g*h+v*o,b=l*(v+y),k=o*(v+y),w=u*(g+x),S=h*(g+x),A=Math.atan2(k-m,b-_),C=Math.atan2(S-m,w-_);this.arc(_+t,m+e,a,A,C,l*h>u*o)}return this.dirty++,this}},{key:"arc",value:function(t,e,i,n,a){var r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(n===a)return this;!r&&a<=n?a+=2*Math.PI:r&&n<=a&&(n+=2*Math.PI);var s=a-n,o=48*Math.ceil(Math.abs(s)/(2*Math.PI));if(0===s)return this;var l=t+Math.cos(n)*i,h=e+Math.sin(n)*i,u=this.currentPath?this.currentPath.shape.points:null;u?u[u.length-2]===l&&u[u.length-1]===h||u.push(l,h):(this.moveTo(l,h),u=this.currentPath.shape.points);for(var d=s/(2*o),c=2*d,f=Math.cos(d),p=Math.sin(d),g=o-1,v=g%1/g,y=0;y<=g;++y){var x=d+n+c*(y+v*y),_=Math.cos(x),m=-Math.sin(x);u.push((f*_+p*m)*i+t,(f*-m+p*_)*i+e)}return this.dirty++,this}},{key:"drawRect",value:function(t,e,i,n){return this.drawShape(new ye(t,e,i,n)),this}},{key:"drawCircle",value:function(t,e,i){return this.drawShape(new xe(t,e,i)),this}},{key:"drawEllipse",value:function(t,e,i,n){return this.drawShape(new _e(t,e,i,n)),this}},{key:"drawPolygon",value:function(t){var e=t,i=!0;if(e instanceof me&&(i=e.closed,e=e.points),!Array.isArray(e)){e=new Array(arguments.length);for(var n=0;n<e.length;++n)e[n]=arguments[n]}var a=new me(e);return a.closed=i,this.drawShape(a),this}},{key:"clear",value:function(){return this.graphicsData.length>0&&(this.dirty++,this.clearDirty++,this.graphicsData.length=0),this.currentPath=null,this}},{key:"drawShape",value:function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.beginPath();var e=new he(this.lineWidth,this.strokeStyle,this.lineAlpha,this.fillStyle,this.fillAlpha,t);return this.graphicsData.push(e),e.type===Ut.POLY&&(e.shape.closed=e.shape.closed,this.currentPath=e),this.dirty++,e}},{key:"beginPath",value:function(){this.currentPath=null}},{key:"closePath",value:function(){var t=this.currentPath;return t&&t.shape&&t.shape.close(),this}},{key:"updateLocalBounds",value:function(){var t=1/0,e=-1/0,i=1/0,n=-1/0;if(this.graphicsData.length)for(var a=0,r=0,s=0,o=0,l=0,h=0;h<this.graphicsData.length;h++){var u=this.graphicsData[h],d=u.type,c=u.lineWidth;if(a=u.shape,d===Ut.RECT||d===Ut.RREC)r=a.x-c/2,s=a.y-c/2,o=a.width+c,l=a.height+c,t=r<t?r:t,e=r+o>e?r+o:e,i=s<i?s:i,n=s+l>n?s+l:n;else if(d===Ut.CIRC)r=a.x,s=a.y,o=a.radius+c/2,l=a.radius+c/2,t=r-o<t?r-o:t,e=r+o>e?r+o:e,i=s-l<i?s-l:i,n=s+l>n?s+l:n;else if(d===Ut.ELIP)r=a.x,s=a.y,o=a.width+c/2,l=a.height+c/2,t=r-o<t?r-o:t,e=r+o>e?r+o:e,i=s-l<i?s-l:i,n=s+l>n?s+l:n;else for(var f=a.points,p=0,g=0,v=0,y=0,x=0,_=0,m=0,b=0,k=0;k+2<f.length;k+=2)r=f[k],s=f[k+1],p=f[k+2],g=f[k+3],v=Math.abs(p-r),y=Math.abs(g-s),l=c,(o=Math.sqrt(v*v+y*y))<1e-9||(_=(l/o*v+y)/2,b=(g+s)/2,t=(m=(p+r)/2)-(x=(l/o*y+v)/2)<t?m-x:t,e=m+x>e?m+x:e,i=b-_<i?b-_:i,n=b+_>n?b+_:n)}else t=0,e=0,i=0,n=0;return this.Bound={x:t,y:i,width:e-t,height:n-i},this}},{key:"getBound",value:function(){return this.updateLocalBounds().Bound}},{key:"destroy",value:function(t){for(var e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();for(var i in this._webGL)for(var n=0;n<this._webGL[i].data.length;++n)this._webGL[i].data[n].destroy();this.graphicsData=null,this.currentPath=null,this._webGL=null}}]),t}(),ke=function(t){function e(t){i(this,e);var n={cursor:(t=It.checkOpt(t)).context.cursor||"default",fillAlpha:t.context.fillAlpha||1,fillStyle:t.context.fillStyle||null,lineCap:t.context.lineCap||"round",lineJoin:t.context.lineJoin||"round",miterLimit:t.context.miterLimit||null,lineAlpha:t.context.lineAlpha||1,strokeStyle:t.context.strokeStyle||null,lineType:t.context.lineType||"solid",lineWidth:t.context.lineWidth||null},a=U.extend(!0,n,t.context);t.context=a,void 0===t.id&&void 0!==t.type&&(t.id=It.createId(t.type));var r=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r._hoverClass=!1,r.hoverClone=!0,r.pointChkPriority=!0,r._eventEnabled=!1,r.dragEnabled=t.dragEnabled||!1,r._dragDuplicate=null,r.type=r.type||"shape",r.initCompProperty(t),r.isClone?r.graphics=null:(r.graphics=new be,r._draw(r.graphics)),r}return r(e,ee),n(e,[{key:"_draw",value:function(t){0==t.graphicsData.length&&(t.setStyle(this.context),this.draw(t))}},{key:"draw",value:function(){}},{key:"clearGraphicsData",value:function(){this.graphics.clear()}},{key:"$watch",value:function(t,e,i){U.indexOf(Qt,t)>-1&&this.graphics.setStyle(this.context),this.watch(t,e,i)}},{key:"initCompProperty",value:function(t){for(var e in t)"id"!=e&&"context"!=e&&(this[e]=t[e])}},{key:"getBound",value:function(){return this.graphics.updateLocalBounds().Bound}},{key:"dashedLineTo",value:function(t,e,i,n,a,r){r=void 0===r?3:r,r=Math.max(r,this.context.$model.lineWidth);for(var s=n-e,o=a-i,l=Math.floor(Math.sqrt(s*s+o*o)/r),h=0;h<l;++h){var u=parseInt(e+s/l*h),d=parseInt(i+o/l*h);t[h%2==0?"moveTo":"lineTo"](u,d),h==l-1&&h%2==0&&t.lineTo(n,a)}}}]),e}(),we=function(t){function e(t,n){i(this,e),n.type="text",null!==t&&void 0!==t||(t=""),n.context=U.extend({font:"",fontSize:13,fontWeight:"normal",fontFamily:"微软雅黑,sans-serif",textBaseline:"top",textAlign:"left",textDecoration:null,fillStyle:"blank",strokeStyle:null,lineWidth:0,lineHeight:1.2,backgroundColor:null,textBackgroundColor:null},n.context);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return a._reNewline=/\r?\n/,a.fontProperts=["fontStyle","fontVariant","fontWeight","fontSize","fontFamily"],a.context.font=a._getFontDeclaration(),a.text=t.toString(),a.context.width=a.getTextWidth(),a.context.height=a.getTextHeight(),a}return r(e,ee),n(e,[{key:"$watch",value:function(t,e,i){U.indexOf(this.fontProperts,t)>=0&&(this.context[t]=e,this.context.font=this._getFontDeclaration(),this.context.width=this.getTextWidth(),this.context.height=this.getTextHeight())}},{key:"_setContextStyle",value:function(t,e,i){for(var n in e)"textBaseline"!=n&&n in t&&(e[n]||U.isNumber(e[n]))&&("globalAlpha"==n?t.globalAlpha=i:t[n]=e[n])}},{key:"render",value:function(t,e){this._renderText(t,this._getTextLines(),e)}},{key:"resetText",value:function(t){this.text=t.toString(),this.heartBeat()}},{key:"getTextWidth",value:function(){var t=0;return It._pixelCtx&&(It._pixelCtx.save(),It._pixelCtx.font=this.context.$model.font,t=this._getTextWidth(It._pixelCtx,this._getTextLines()),It._pixelCtx.restore()),t}},{key:"getTextHeight",value:function(){return this._getTextHeight(It._pixelCtx,this._getTextLines())}},{key:"_getTextLines",value:function(){return this.text.split(this._reNewline)}},{key:"_renderText",value:function(t,e,i){t&&(t.save(),this._setContextStyle(t,this.context.$model,i),this._renderTextStroke(t,e),this._renderTextFill(t,e),t.restore())}},{key:"_getFontDeclaration",value:function(){var t=this,e=[];return U.each(this.fontProperts,function(i){var n=t.context[i];"fontSize"==i&&(n=parseFloat(n)+"px"),n&&e.push(n)}),e.join(" ")}},{key:"_renderTextFill",value:function(t,e){if(this.context.$model.fillStyle){this._boundaries=[];for(var i=0,n=0,a=e.length;n<a;n++){i+=this._getHeightOfLine(t,n,e),this._renderTextLine("fillText",t,e[n],0,this._getTopOffset()+i,n)}}}},{key:"_renderTextStroke",value:function(t,e){if(t&&this.context.$model.strokeStyle&&this.context.$model.lineWidth){var i=0;t.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),supportsLineDash&&t.setLineDash(this.strokeDashArray)),t.beginPath();for(var n=0,a=e.length;n<a;n++){i+=this._getHeightOfLine(t,n,e),this._renderTextLine("strokeText",t,e[n],0,this._getTopOffset()+i,n)}t.closePath(),t.restore()}}},{key:"_renderTextLine",value:function(t,e,i,n,a,r){if(a-=this._getHeightOfLine()/4,"justify"===this.context.$model.textAlign){var s=e.measureText(i).width,o=this.context.$model.width;if(o>s)for(var l=i.split(/\s+/),h=(o-e.measureText(i.replace(/\s+/g,"")).width)/(l.length-1),u=0,d=0,c=l.length;d<c;d++)this._renderChars(t,e,l[d],n+u,a,r),u+=e.measureText(l[d]).width+h;else this._renderChars(t,e,i,n,a,r)}else this._renderChars(t,e,i,n,a,r)}},{key:"_renderChars",value:function(t,e,i,n,a){e[t](i,0,a)}},{key:"_getHeightOfLine",value:function(){return this.context.$model.fontSize*this.context.$model.lineHeight}},{key:"_getTextWidth",value:function(t,e){for(var i=t.measureText(e[0]||"|").width,n=1,a=e.length;n<a;n++){var r=t.measureText(e[n]).width;r>i&&(i=r)}return i}},{key:"_getTextHeight",value:function(t,e){return this.context.$model.fontSize*e.length*this.context.$model.lineHeight}},{key:"_getTopOffset",value:function(){var t=0;switch(this.context.$model.textBaseline){case"top":t=0;break;case"middle":t=-this.context.$model.height/2;break;case"bottom":t=-this.context.$model.height}return t}},{key:"getRect",value:function(){var t=this.context,e=0,i=0;return"center"==t.textAlign&&(e=-t.width/2),"right"==t.textAlign&&(e=-t.width),"middle"==t.textBaseline&&(i=-t.height/2),"bottom"==t.textBaseline&&(i=-t.height),{x:e,y:i,width:t.width,height:t.height}}}]),e}();function Se(t,e){var i=0,n=0;if(1==arguments.length&&U.isObject(t)){var a=arguments[0];U.isArray(a)?(i=a[0],n=a[1]):a.hasOwnProperty("x")&&a.hasOwnProperty("y")&&(i=a.x,n=a.y)}this._axes=[i,n]}function Ae(t,e,i,n,a,r,s){var o=.25*(i-t),l=.25*(n-e);return(2*(e-i)+o+l)*s+(-3*(e-i)-2*o-l)*r+o*a+e}Se.prototype={distance:function(t){var e=this._axes[0]-t._axes[0],i=this._axes[1]-t._axes[1];return Math.sqrt(e*e+i*i)}};var Ce={sin:{},cos:{}},Pe=Math.PI/180;function Te(t,e){var i={points:t};U.isFunction(e)&&(i.smoothFilter=e);var n=function(t){var e=t.points,i=t.isLoop,n=t.smoothFilter,a=e.length;if(1==a)return e;for(var r=[],s=0,o=new Se(e[0]),l=null,h=1;h<a;h++)l=new Se(e[h]),s+=o.distance(l),o=l;o=null,l=null;var u=s/6;for(u=u<a?a:u,h=0;h<u;h++){var d,c,f,p=h/(u-1)*(i?a:a-1),g=Math.floor(p),v=p-g,y=e[g%a];i?(d=e[(g-1+a)%a],c=e[(g+1)%a],f=e[(g+2)%a]):(d=e[0===g?g:g-1],c=e[g>a-2?a-1:g+1],f=e[g>a-3?a-1:g+2]);var x=v*v,_=v*x,m=[Ae(d[0],y[0],c[0],f[0],v,x,_),Ae(d[1],y[1],c[1],f[1],v,x,_)];U.isFunction(n)&&n(m),r.push(m)}return r}(i);return t&&t.length>0&&n.push(t[t.length-1]),n}function Le(t){return!t||U.isArray(t)&&t.length>=2&&(!U.isNumber(t[0])||!U.isNumber(t[1]))||"x"in t&&!U.isNumber(t.x)||"y"in t&&!U.isNumber(t.y)}var Oe={PI:Math.PI,sin:function(t,e){return t=(e?t*Pe:t).toFixed(4),void 0===Ce.sin[t]&&(Ce.sin[t]=Math.sin(t)),Ce.sin[t]},cos:function(t,e){return t=(e?t*Pe:t).toFixed(4),void 0===Ce.cos[t]&&(Ce.cos[t]=Math.cos(t)),Ce.cos[t]},degreeToRadian:function(t){return t*Pe},radianToDegree:function(t){return t/Pe},degreeTo360:function(t){var e=(360+t%360)%360;return 0==e&&0!==t&&(e=360),e},getIsgonPointList:function(t,e){for(var i=[],n=2*Math.PI/t,a=-Math.PI/2,r=0,s=t;r<s;r++)i.push([e*Math.cos(a),e*Math.sin(a)]),a+=n;return i},getSmoothPointList:function(t,e){var i=[],n=t.length,a=[];return U.each(t,function(t,r){Le(t)?(a.length&&(i=i.concat(Te(a,e)),a=[]),i.push(t)):a.push(t),r==n-1&&a.length&&(i=i.concat(Te(a,e)),a=[])}),i},isNotValibPoint:Le,isValibPoint:function(t){return!Le(t)}},De=function(t){function e(t){i(this,e),t=It.checkOpt(t);var n=U.extend({lineType:null,smooth:!1,pointList:[],smoothFilter:It.__emptyFunc},t.context);!t.isClone&&n.smooth&&(n.pointList=Oe.getSmoothPointList(n.pointList,n.smoothFilter)),t.context=n,t.type="brokenline";var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return a._pointList=n.pointList,a}return r(e,ke),n(e,[{key:"watch",value:function(t,e,i){"pointList"!=t&&"smooth"!=t&&"lineType"!=t||("pointList"==t&&this.context.smooth&&(this.context.pointList=Oe.getSmoothPointList(e,this.context.smoothFilter),this._pointList=e),"smooth"==t&&(this.context.pointList=e?Oe.getSmoothPointList(this._pointList,this.context.smoothFilter):this._pointList),this.graphics.clear())}},{key:"draw",value:function(t){for(var e=this.context,i=e.pointList,n=!1,a=0,r=i.length;a<r;a++){var s=i[a],o=i[a+1];if(Oe.isValibPoint(s)){if(e.lineType&&"solid"!=e.lineType){if("dashed"==e.lineType||"dotted"==e.lineType)if(e.smooth){if(n){t.lineTo(s[0],s[1]),n=!1,a++;continue}t.moveTo(s[0],s[1])}else Oe.isValibPoint(o)&&this.dashedLineTo(t,s[0],s[1],o[0],o[1],5)}else n?t.lineTo(s[0],s[1]):t.moveTo(s[0],s[1]);n=!0}else n=!1}return this}}]),e}(),Me=function(t){function e(t){return i(this,e),t=U.extend(!0,{type:"circle",xyToInt:!1,context:{r:0}},It.checkOpt(t)),s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return r(e,ke),n(e,[{key:"watch",value:function(t,e,i){"r"==t&&this.graphics.clear()}},{key:"draw",value:function(t){var e=this.context.$model.r;e<0&&(e=0),t.drawCircle(0,0,e)}}]),e}(),Ie=function(t){function e(t){i(this,e);var n=U.extend({pointList:[],path:""},t.context);return t.context=n,t.__parsePathData=null,t.type="path",s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return r(e,ke),n(e,[{key:"watch",value:function(t,e,i){"path"==t&&this.graphics.clear()}},{key:"_parsePathData",value:function(t){if(this.__parsePathData)return this.__parsePathData;if(!t)return[];this.__parsePathData=[];var e=U.compact(t.replace(/[Mm]/g,"\\r$&").split("\\r")),i=this;return U.each(e,function(t){i.__parsePathData.push(i._parseChildPathData(t))}),this.__parsePathData}},{key:"_parseChildPathData",value:function(t){var e,i=t,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];for(i=(i=(i=(i=i.replace(/  /g," ")).replace(/ /g,",")).replace(/(\d)-/g,"$1,-")).replace(/,,/g,","),e=0;e<n.length;e++)i=i.replace(new RegExp(n[e],"g"),"|"+n[e]);var a=i.split("|"),r=[],s=0,o=0;for(e=1;e<a.length;e++){var l=a[e],h=l.charAt(0),u=(l=(l=l.slice(1)).replace(new RegExp("e,-","g"),"e-")).split(",");u.length>0&&""===u[0]&&u.shift();for(var d=0;d<u.length;d++)u[d]=parseFloat(u[d]);for(;u.length>0&&!isNaN(u[0]);){var c,f,p,g=null,v=[],y=s,x=o;switch(h){case"l":s+=u.shift(),o+=u.shift(),g="L",v.push(s,o);break;case"L":s=u.shift(),o=u.shift(),v.push(s,o);break;case"m":s+=u.shift(),o+=u.shift(),g="M",v.push(s,o),h="l";break;case"M":s=u.shift(),o=u.shift(),g="M",v.push(s,o),h="L";break;case"h":s+=u.shift(),g="L",v.push(s,o);break;case"H":s=u.shift(),g="L",v.push(s,o);break;case"v":o+=u.shift(),g="L",v.push(s,o);break;case"V":o=u.shift(),g="L",v.push(s,o);break;case"C":v.push(u.shift(),u.shift(),u.shift(),u.shift()),s=u.shift(),o=u.shift(),v.push(s,o);break;case"c":v.push(s+u.shift(),o+u.shift(),s+u.shift(),o+u.shift()),s+=u.shift(),o+=u.shift(),g="C",v.push(s,o);break;case"S":c=s,f=o,"C"===(p=r[r.length-1]).command&&(c=s+(s-p.points[2]),f=o+(o-p.points[3])),v.push(c,f,u.shift(),u.shift()),s=u.shift(),o=u.shift(),g="C",v.push(s,o);break;case"s":c=s,f=o,"C"===(p=r[r.length-1]).command&&(c=s+(s-p.points[2]),f=o+(o-p.points[3])),v.push(c,f,s+u.shift(),o+u.shift()),s+=u.shift(),o+=u.shift(),g="C",v.push(s,o);break;case"Q":v.push(u.shift(),u.shift()),s=u.shift(),o=u.shift(),v.push(s,o);break;case"q":v.push(s+u.shift(),o+u.shift()),s+=u.shift(),o+=u.shift(),g="Q",v.push(s,o);break;case"T":c=s,f=o,"Q"===(p=r[r.length-1]).command&&(c=s+(s-p.points[0]),f=o+(o-p.points[1])),s=u.shift(),o=u.shift(),g="Q",v.push(c,f,s,o);break;case"t":c=s,f=o,"Q"===(p=r[r.length-1]).command&&(c=s+(s-p.points[0]),f=o+(o-p.points[1])),s+=u.shift(),o+=u.shift(),g="Q",v.push(c,f,s,o);break;case"A":y=s,x=o,g="A",v=[u.shift(),u.shift(),u.shift(),u.shift(),u.shift(),s=u.shift(),o=u.shift(),y,x];break;case"a":y=s,x=o,g="A",v=[u.shift(),u.shift(),u.shift(),u.shift(),u.shift(),s+=u.shift(),o+=u.shift(),y,x]}r.push({command:g||h,points:v})}"z"!==h&&"Z"!==h||r.push({command:"z",points:[]})}return r}},{key:"draw",value:function(t){this.__parsePathData=null,this.context.$model.pointList=[];for(var e=this._parsePathData(this.context.$model.path),i=0,n=e.length;i<n;i++)for(var a=0,r=e[i].length;a<r;a++){var s=e[i][a].command,o=e[i][a].points;switch(s){case"L":t.lineTo(o[0],o[1]);break;case"M":t.moveTo(o[0],o[1]);break;case"C":t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":t.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":ve(t,o[7],o[8],o);break;case"z":t.closePath()}}return this}}]),e}(),Re=function(t){function e(t){var n;i(this,e),t=U.extend({type:"droplet",context:{hr:0,vr:0}},It.checkOpt(t));n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.context.$model.path=n.createPath(),n}return r(e,Ie),n(e,[{key:"watch",value:function(t,e,i){"hr"!=t&&"vr"!=t||(this.context.$model.path=this.createPath())}},{key:"createPath",value:function(){var t=this.context.$model,e="M 0 "+t.hr+" C "+t.hr+" "+t.hr+" "+3*t.hr/2+" "+-t.hr/3+" 0 "+-t.vr;return e+=" C "+3*-t.hr/2+" "+-t.hr/3+" "+-t.hr+" "+t.hr+" 0 "+t.hr+"z"}}]),e}(),Fe=function(t){function e(t){return i(this,e),t=U.extend({type:"ellipse",context:{hr:0,vr:0}},It.checkOpt(t)),s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return r(e,ke),n(e,[{key:"watch",value:function(t,e,i){"hr"!=t&&"vr"!=t||this.graphics.clear()}},{key:"draw",value:function(t){t.drawEllipse(0,0,2*this.context.$model.hr,2*this.context.$model.vr)}}]),e}(),Ee=function(t){function e(t){i(this,e);var n=U.extend({lineType:null,smooth:!1,pointList:[],smoothFilter:It.__emptyFunc},t.context);if(!t.isClone){n.pointList[0];var a=n.pointList.slice(-1)[0];n.smooth&&(n.pointList.unshift(a),n.pointList=Oe.getSmoothPointList(n.pointList))}return t.context=n,t.type="polygon",s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return r(e,ke),n(e,[{key:"watch",value:function(t,e,i){"pointList"!=t&&"smooth"!=t&&"lineType"!=t||this.graphics.clear()}},{key:"draw",value:function(t){var e=this.context,i=e.pointList;if(!(i.length<2)){t.moveTo(i[0][0],i[0][1]);for(var n=1,a=i.length;n<a;n++)t.lineTo(i[n][0],i[n][1]);if(t.closePath(),"dashed"==e.lineType||"dotted"==e.lineType)if(t.currentPath.line=!1,e.smooth)for(var r=0,s=i.length;r<s&&r!=s-1;r++)t.moveTo(i[r][0],i[r][1]),t.lineTo(i[r+1][0],i[r+1][1]),r+=1;else{t.moveTo(i[0][0],i[0][1]);for(n=1,a=i.length;n<a;n++){var o=i[n-1][0],l=i[n][0],h=i[n-1][1],u=i[n][1];this.dashedLineTo(t,o,h,l,u,5)}}t.closePath()}}}]),e}(),We=function(t){function e(t){i(this,e);var n=U.extend({pointList:[],r:0,n:0},t.context);return n.pointList=Oe.getIsgonPointList(n.n,n.r),t.context=n,t.type="isogon",s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return r(e,Ee),n(e,[{key:"watch",value:function(t,e,i){"r"!=t&&"n"!=t||(this.context.$model.pointList=Oe.getIsgonPointList(this.context.$model.n,this.context.$model.r)),"pointList"!=t&&"smooth"!=t&&"lineType"!=t||this.graphics.clear()}}]),e}(),Ne=function(t){function e(t){i(this,e);var n=U.extend({lineType:null,start:{x:0,y:0},end:{x:0,y:0},dashLength:3},t.context);return t.context=n,t.type="line",s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return r(e,ke),n(e,[{key:"watch",value:function(t,e,i){"x"!=t&&"y"!=t||this.graphics.clear()}},{key:"draw",value:function(t){var e=this.context.$model;return e.lineType&&"solid"!=e.lineType?"dashed"!=e.lineType&&"dotted"!=e.lineType||this.dashedLineTo(t,e.start.x,e.start.y,e.end.x,e.end.y,e.dashLength):(t.moveTo(e.start.x,e.start.y),t.lineTo(e.end.x,e.end.y)),this}}]),e}(),ze=function(t){function e(t){i(this,e);var n=U.extend({width:0,height:0,radius:[]},t.context);return t.context=n,t.type="rect",s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return r(e,ke),n(e,[{key:"watch",value:function(t,e,i){"width"!=t&&"height"!=t&&"radius"!=t||this.graphics.clear()}},{key:"_buildRadiusPath",value:function(t){var e=this.context.$model,i=e.width,n=e.height,a=It.getCssOrderArr(e.radius),r=t,s=1;n>=0&&(s=-1),r.moveTo(parseInt(0+a[0]),parseInt(n)),r.lineTo(parseInt(0+i-a[1]),parseInt(n)),0!==a[1]&&r.quadraticCurveTo(0+i,n,parseInt(0+i),parseInt(n+a[1]*s)),r.lineTo(parseInt(0+i),parseInt(0-a[2]*s)),0!==a[2]&&r.quadraticCurveTo(0+i,0,parseInt(0+i-a[2]),parseInt(0)),r.lineTo(parseInt(0+a[3]),parseInt(0)),0!==a[3]&&r.quadraticCurveTo(0,0,parseInt(0),parseInt(0-a[3]*s)),r.lineTo(parseInt(0),parseInt(0+n+a[0]*s)),0!==a[0]&&r.quadraticCurveTo(0,0+n,parseInt(0+a[0]),parseInt(0+n))}},{key:"draw",value:function(t){var e=this.context.$model;e.radius.length?this._buildRadiusPath(t):t.drawRect(0,0,e.width,e.height),t.closePath()}}]),e}(),Ge=function(t){function e(t){i(this,e);var n=U.extend({pointList:[],r0:0,r:0,startAngle:0,endAngle:0,clockwise:!1},t.context);return t.context=n,t.regAngle=[],t.isRing=!1,t.type="sector",s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return r(e,ke),n(e,[{key:"watch",value:function(t,e,i){"r0"!=t&&"r"!=t&&"startAngle"!=t&&"endAngle"!=t&&"clockwise"!=t||(this.isRing=!1,this.graphics.clear())}},{key:"draw",value:function(t){var e=this.context.$model,i=void 0===e.r0?0:e.r0,n=e.r,a=Oe.degreeTo360(e.startAngle),r=Oe.degreeTo360(e.endAngle);e.startAngle!=e.endAngle&&Math.abs(e.startAngle-e.endAngle)%360==0&&(this.isRing=!0,a=0,r=360),a=Oe.degreeToRadian(a),r=Oe.degreeToRadian(r);var s=t;this.isRing?0==e.r0?s.drawCircle(0,0,e.r):(e.fillStyle&&e.fillAlpha&&(s.beginPath(),s.arc(0,0,n,a,r,e.clockwise),0==e.r0?s.lineTo(0,0):s.arc(0,0,i,r,a,!e.clockwise),s.closePath(),s.currentPath.lineWidth=0,s.currentPath.strokeStyle=null,s.currentPath.lineAlpha=0,s.currentPath.line=!1),e.lineWidth&&e.strokeStyle&&e.lineAlpha&&(s.beginPath(),s.arc(0,0,n,a,r,e.clockwise),s.closePath(),s.currentPath.fillStyle=null,s.currentPath.fill=!1,s.beginPath(),s.arc(0,0,i,r,a,!e.clockwise),s.closePath(),s.currentPath.fillStyle=null,s.currentPath.fill=!1)):(s.beginPath(),s.arc(0,0,n,a,r,e.clockwise),0==e.r0?s.lineTo(0,0):s.arc(0,0,i,r,a,!e.clockwise),s.closePath())}}]),e}(),Be={App:oe};Be.Display={DisplayObject:ee,DisplayObjectContainer:ie,Stage:ne,Sprite:le,Shape:ke,Point:Ft,Text:we},Be.Shapes={BrokenLine:De,Circle:Me,Droplet:Re,Ellipse:Fe,Isogon:We,Line:Ne,Path:Ie,Polygon:Ee,Rect:ze,Sector:Ge},Be.AnimationFrame=Yt,Be.utils=It;G.Canvax=Be;var je=function(t){function e(t,n,a,r){i(this,e);var o=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.componentModules=r,o._node=t,o._data=n,o._opt=a,o.dataFrame=o.initData(n,a),o.el=N.query(t),o.width=parseInt(o.el.offsetWidth),o.height=parseInt(o.el.offsetHeight),o.padding=null,o.canvax=new Be.App({el:o.el,webGL:!1}),o.canvax.registEvent(),o.id="chartx_"+o.canvax.id,o.el.setAttribute("chart_id",o.id),o.el.setAttribute("chartx_version","2.0"),o.stage=new Be.Display.Stage({id:"main-chart-stage"}),o.canvax.addChild(o.stage),o.setCoord_Graphs_Sp(),o.__highModules=["theme","coord","graphs"],o.components=[],o.inited=!1,o.init(),o}return r(e,X),n(e,[{key:"init",value:function(){var t=this,e=this._opt;for(var i in this.padding=this._getPadding(),o.each(this.__highModules,function(i){if(e[i]){var n=o.flatten([e[i]]);o.each(n,function(e){if(("coord"!=i||e.type)&&("graphs"!=i||e.field||e.keyField)){var n=t.componentModules.get(i,e.type);if(n){var a=new n(e,t);t.components.push(a)}}})}}),this._opt)if(-1==o.indexOf(this.__highModules,i)){var n=this._opt[i];o.isArray(n)||(n=[n]),o.each(n,function(e){var n=t.componentModules.get(i,e.type);if(n){var a=new n(e,t);t.components.push(a)}})}}},{key:"draw",value:function(t){var e=this;!t&&(t={});var i=this.getComponent({name:"coord"});i&&i.horizontal&&this._drawBeginHorizontal();var n=this.width-this.padding.left-this.padding.right,a=this.height-this.padding.top-this.padding.bottom,r={x:this.padding.left,y:this.padding.top};if(i&&(i.draw(t),n=i.width,a=i.height,r=i.origin),0!=this.dataFrame.length){var s=this.getComponents({name:"graphs"}),l=s.length,h=0;t=o.extend(t,{width:n,height:a,origin:r}),o.each(s,function(i){i.on("complete",function(t){++h==l&&e.fire("complete"),i.inited=!0}),i.draw(t)});for(var u=0,d=this.components.length;u<d;u++){var c=this.components[u];-1==o.indexOf(this.__highModules,c.name)&&c.draw()}this._bindEvent(),i&&i.horizontal&&this._drawEndHorizontal()}else e.fire("complete")}},{key:"_drawBeginHorizontal",value:function(){var t=this.padding,e=t.top;t.top=t.right,t.right=t.bottom,t.bottom=t.left,t.left=e}},{key:"_drawEndHorizontal",value:function(){var t=this.graphsSprite.context;t.x+=(this.width-this.height)/2,t.y+=(this.height-this.width)/2,t.rotation=90,t.rotateOrigin={x:this.height/2,y:this.width/2},this._horizontalGraphsText()}},{key:"_horizontalGraphsText",value:function(){o.each(this.getComponents({name:"graphs"}),function(t){!function t(e){if(e.children&&o.each(e.children,function(e){t(e)}),"text"==e.type&&!e.__horizontal){var i=e.context;i.width,i.height,i.rotation=i.rotation-90,e.__horizontal=!0}}(t.sprite)})}},{key:"_getPadding",value:function(){var t=20;this._opt.coord&&"padding"in this._opt.coord&&(o.isObject(this._opt.coord.padding)||(t=this._opt.coord.padding));var e={top:t,right:t,bottom:t,left:t};return this._opt.coord&&"padding"in this._opt.coord&&o.isObject(this._opt.coord.padding)&&(e=o.extend(e,this._opt.coord.padding)),e}},{key:"getTheme",value:function(t){var e=G.getGlobalTheme(),i=this.getComponent({name:"theme"});return i&&(e=i.get()),void 0!=t?e[t%e.length]||"#ccc":e}},{key:"setCoord_Graphs_Sp",value:function(){this.coordSprite=new Be.Display.Sprite({id:"coordSprite"}),this.stage.addChild(this.coordSprite),this.graphsSprite=new Be.Display.Sprite({id:"graphsSprite"}),this.stage.addChild(this.graphsSprite)}},{key:"destroy",value:function(){this.clean(),this.el&&(this.el.removeAttribute("chart_id"),this.el.removeAttribute("chartx_version"),this.canvax.destroy(),this.el=null),this._destroy&&this._destroy(),this.fire("destroy")}},{key:"clean",value:function(){for(var t=0,e=this.canvax.children.length;t<e;t++)for(var i=this.canvax.getChildAt(t),n=0,a=i.children.length;n<a;n++)i.getChildAt(n).destroy(),n--,a--;this.setCoord_Graphs_Sp(),this.components=[],this.canvax.domView.innerHTML=""}},{key:"resize",value:function(){var t=parseInt(this.el.offsetWidth),e=parseInt(this.el.offsetHeight);t==this.width&&e==this.height||(this.width=t,this.height=e,this.canvax.resize(),this.inited=!1,this.clean(),this.init(),this.draw({resize:!0}),this.inited=!0)}},{key:"reset",value:function(t,e){!t&&(t={}),o.extend(!0,this._opt,t),e&&(this._data=e),this.dataFrame=this.initData(this._data,t),this.clean(),this.init(),this.draw()}},{key:"resetData",value:function(t,e){var i=this,n=this.dataFrame.length;if(t&&(this._data=t,this.dataFrame=this.initData(this._data)),!n)return this.clean(),this.init(),void this.draw(this._opt);var a=this.getComponent({name:"coord"});a&&a.resetData(this.dataFrame,e),o.each(this.getComponents({name:"graphs"}),function(t){t.resetData(i.dataFrame,e)}),this.componentsReset(e),a&&a.horizontal&&this._horizontalGraphsText(),this.fire("resetData")}},{key:"initData",value:function(){return F.apply(this,arguments)}},{key:"componentsReset",value:function(t){var e=this;o.each(this.components,function(i,n){-1==o.indexOf(e.__highModules,i.name)&&(t&&t.comp&&t.comp.__cid==i.__cid||i.reset&&i.reset(e[i.type]||{},e.dataFrame))})}},{key:"getComponentById",value:function(t){var e;return o.each(this.components,function(i){if(i.id&&i.id==t)return e=i,!1}),e}},{key:"getComponent",value:function(t){return this.getComponents(t)[0]}},{key:"getComponents",value:function(t,e){var i=[],n=0;for(var a in t)n++;return n?(e||(e=this.components),o.each(e,function(e){var a=0;for(var r in t)JSON.stringify(e[r])==JSON.stringify(t[r])&&a++;n==a&&i.push(e)}),i):i}},{key:"getGraph",value:function(t){return this.getGraphs(t)[0]}},{key:"getGraphs",value:function(t){return this.getComponents(t,this.getComponents({name:"graphs"}))}},{key:"getGraphById",value:function(t){var e;return o.each(this.getComponents({name:"graphs"}),function(i){if(i.id==t)return e=i,!1}),e}},{key:"getCoord",value:function(t){return this.getComponent(o.extend(!0,{name:"coord"},t))}},{key:"getLegendData",value:function(){var t=this,e=[];if(o.each(this.getComponents({name:"graphs"}),function(t){o.each(t.getLegendData(),function(t){if(!o.find(e,function(e){return e.name==t.name})){var i=o.extend(!0,{},t);i.color=t.fillStyle||t.color||t.style,e.push(i)}})}),e.length)return e;var i=t.getComponent({name:"coord"});return o.each(o.flatten(i.fieldsMap),function(i,n){var a=!1;o.each(t._opt.graphs,function(t){if(o.indexOf(o.flatten([t.field]),i.field)>-1)return a=!0,!1}),a&&e.push({enabled:i.enabled,name:i.field,field:i.field,ind:i.ind,color:i.color,yAxis:i.yAxis})}),e}},{key:"show",value:function(t,e){var i=this.getComponent({name:"coord"});i&&i.show(t,e),o.each(this.getComponents({name:"graphs"}),function(i){i.show(t,e)}),this.componentsReset(e)}},{key:"hide",value:function(t,e){var i=this.getComponent({name:"coord"});i&&i.hide(t,e),o.each(this.getComponents({name:"graphs"}),function(i){i.hide(t,e)}),this.componentsReset(e)}},{key:"_bindEvent",value:function(){var t=this;this.on("panstart mouseover",function(e){var i=t.getComponent({name:"tips"});i&&(t._setTipsInfo.apply(t,[e]),i.show(e),t._tipsPointerAtAllGraphs(e))}),this.on("panmove mousemove",function(e){var i=t.getComponent({name:"tips"});i&&(t._setTipsInfo.apply(t,[e]),i.move(e),t._tipsPointerAtAllGraphs(e))}),this.on("panend mouseout",function(e){var i=t.getComponent({name:"tips"}),n=t.getComponent({name:"coord"});!i||e.toTarget&&n&&n.induce&&n.induce.containsPoint(n.induce.globalToLocal(e.target.localToGlobal(e.point)))||(i.hide(e),t._tipsPointerHideAtAllGraphs(e))}),this.on("tap",function(e){var i=t.getComponent({name:"tips"});i&&(i.hide(e),t._setTipsInfo.apply(t,[e]),i.show(e),t._tipsPointerAtAllGraphs(e))})}},{key:"_setTipsInfo",value:function(t){t.eventInfo||(t.eventInfo={});var e=this.getComponent({name:"coord"});if(e&&(t.eventInfo=e.getTipsInfoHandler(t)),!t.eventInfo.nodes||!t.eventInfo.nodes.length){var i=[],n=t.eventInfo.iNode;o.each(this.getComponents({name:"graphs"}),function(t){i=i.concat(t.getNodesAt(n))}),t.eventInfo.nodes=i}}},{key:"_tipsPointerAtAllGraphs",value:function(t){o.each(this.getComponents({name:"graphs"}),function(e){e.tipsPointerOf(t)})}},{key:"_tipsPointerHideAtAllGraphs",value:function(t){o.each(this.getComponents({name:"graphs"}),function(e){e.tipsPointerHideOf(t)})}}]),e}(),He=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="component",a.type=null,a.enabled=!1,a._opt=t,a.app=n,a.width=0,a.height=0,a.pos={x:0,y:0},a.margin={top:0,right:0,bottom:0,left:0},a.__cid=Be.utils.createId("comp_"),a}return r(e,X),n(e,[{key:"init",value:function(t,e){}},{key:"draw",value:function(){}},{key:"destroy",value:function(){}},{key:"reset",value:function(){}},{key:"setPosition",value:function(t){!t&&(t=this.pos),t.x&&(this.sprite.context.x=t.x),t.y&&(this.sprite.context.y=t.y)}},{key:"layout",value:function(){}}]),e}(),Ve=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="coord",a._opt=t,a.app=n,a.dataFrame=a.app.dataFrame,a.width=0,a.height=0,a.origin={x:0,y:0},a.sprite=new Be.Display.Sprite({name:"coord_"+t.type}),a.app.coordSprite.addChild(a.sprite),a.fieldsMap=null,a.induce=null,a._axiss=[],a}return r(e,He),n(e,[{key:"setFieldsMap",value:function(t){var e=this,i=0,n=t.type||"yAxis",a=[];return o.each(this.getAxiss(t),function(t){t.field&&(a=a.concat(t.field))}),function t(a){o.isString(a)&&(a=[a]);for(var r=o.clone(a),s=0,l=a.length;s<l;s++)o.isString(a[s])&&(r[s]={field:a[s],enabled:!0,color:e.app.getTheme(i),ind:i++},r[s][n]=e.getAxis({type:n,field:a[s]})),o.isArray(a[s])&&(r[s]=t(a[s]));return r}(a)}},{key:"setFieldEnabled",value:function(t){!function e(i){o.each(i,function(i,n){o.isArray(i)?e(i):i.field&&i.field==t&&(i.enabled=!i.enabled)})}(this.fieldsMap)}},{key:"getFieldMapOf",value:function(t){var e=null;return function i(n){o.each(n,function(n,a){if(o.isArray(n))i(n);else if(n.field&&n.field==t)return e=n,!1})}(this.fieldsMap),e}},{key:"getEnabledFieldsOf",value:function(t){var e=[],i=t?t.type:"yAxis";return o.each(this.fieldsMap,function(n,a){if(o.isArray(n)){var r=[];o.each(n,function(e,n){e[i]===t&&e.field&&e.enabled&&r.push(e.field)}),r.length&&e.push(r)}else n[i]===t&&n.field&&n.enabled&&e.push(n.field)}),e}},{key:"filterEnabledFields",value:function(t){var e=this,i=[];return o.isArray(t)||(t=[t]),o.each(t,function(t){if(o.isArray(t)){var n=[];o.each(t,function(t){e.getFieldMapOf(t).enabled&&n.push(t)}),n.length&&i.push(n)}else e.getFieldMapOf(t).enabled&&i.push(t)}),i}},{key:"getAxisDataFrame",value:function(t){return{field:t,org:this.dataFrame.getDataOrg(t,function(t){return void 0===t||null===t||""==t?t:isNaN(Number(t))?t:Number(t)})}}},{key:"hide",value:function(t){this.changeFieldEnabled(t)}},{key:"show",value:function(t){this.changeFieldEnabled(t)}},{key:"getSizeAndOrigin",value:function(){return{width:this.width,height:this.height,origin:this.origin}}},{key:"getPoint",value:function(t){}},{key:"getAxisOriginPoint",value:function(t){}},{key:"getOriginPos",value:function(t){}},{key:"getAxis",value:function(t){return this.getAxiss(t)[0]}},{key:"getAxiss",value:function(t){var e=[],i=0;for(var n in t)i++;return o.each(this._axiss,function(n){var a=0;for(var r in t)if("field"==r){var s=o.flatten([n[r]]),l=o.flatten([t[r]]),h=!0;o.each(l,function(t){-1==o.indexOf(s,t)&&(h=!1)}),h&&a++}else JSON.stringify(n[r])==JSON.stringify(t[r])&&a++;i==a&&e.push(n)}),e}}]),e}();function Ye(t,e){var i=Number(t),n=e||",";if(!i)return String(t);if(i>=1e3){var a=parseInt(i/1e3);return String(t.toString().replace(a,a+n))}return String(t)}var $e=Be.Shapes.Line,qe=function(t){function e(t,n,a){i(this,e);var r=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n.org));return r.type="xAxis",r._opt=t,r._coord=a||{},r.width=0,r.height=0,r.title={text:"",shapeType:"text",fontColor:"#999",fontSize:12,offset:2,textAlign:"center",textBaseline:"middle",strokeStyle:null,lineHeight:0},r._title=null,r.enabled=!0,r.tickLine={enabled:1,lineWidth:1,lineLength:4,offset:2,strokeStyle:"#cccccc"},r.axisLine={position:"default",enabled:1,lineWidth:1,strokeStyle:"#cccccc"},r.label={enabled:1,fontColor:"#999",fontSize:12,rotation:0,format:null,offset:2,textAlign:"center",lineHeight:1,evade:!0},!t.isH||t.label&&void 0!==t.label.rotaion||(r.label.rotation=90),r.pos={x:0,y:0},r._formatTextSection=[],r._textElements=[],r.layoutData=[],r.sprite=null,r.filter=null,r.isH=!1,r.animation=!0,r.layoutType="rule",r.trimLayout=null,r.init(t,n),r._txts=[],r._axisLine=null,r}return r(e,R),n(e,[{key:"init",value:function(t,e){o.extend(!0,this,t),this._initHandle(),this.sprite=new Be.Display.Sprite({id:"xAxisSprite_"+(new Date).getTime()}),this.rulesSprite=new Be.Display.Sprite({id:"xRulesSprite_"+(new Date).getTime()}),this.sprite.addChild(this.rulesSprite)}},{key:"_initHandle",value:function(){var t=this;this.field=o.flatten([this.field])[0],this.setDataSection(),t._formatTextSection=[],t._textElements=[],o.each(t.dataSection,function(e,i){t._formatTextSection[i]=t._getFormatText(e,i);var n=new Be.Display.Text(t._formatTextSection[i],{context:{fontSize:t.label.fontSize}});t._textElements[i]=n}),0!=this.label.rotation&&(this.label.textAlign="right"),this._getTitle(),this._setXAxisHeight()}},{key:"draw",value:function(t){t&&o.extend(!0,this,t),this.setAxisLength(this.width),this._trimXAxis(),this._widget(t),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"resetData",value:function(t){this.field=t.field,this.resetDataOrg(t.org),this._initHandle(t),this.draw()}},{key:"setX",value:function(t){this.sprite.context.x=t,this.pos.x=t}},{key:"setY",value:function(t){this.sprite.context.y=t,this.pos.y=t}},{key:"_getTitle",value:function(){this.title.text&&(this._title?this._title.resetText(this.title.text):this._title=new Be.Display.Text(this.title.text,{context:{fontSize:this.title.fontSize,textAlign:this.title.textAlign,textBaseline:this.title.textBaseline,fillStyle:this.title.fontColor,strokeStyle:this.title.strokeStyle,lineWidth:this.title.lineWidth,rotation:this.isH?-180:0}}))}},{key:"_setXAxisHeight",value:function(){var t=this;if(t.enabled){var e=0;this.label.enabled&&o.each(t.dataSection,function(i,n){var a=t._textElements[n],r=a.getTextWidth(),s=a.getTextHeight();if(t.label.rotation)if(90==t.label.rotation)s=r;else{var o=Math.sin(Math.abs(t.label.rotation)*Math.PI/180);Math.cos(Math.abs(t.label.rotation)*Math.PI/180);s=parseInt(o*r)}e=Math.max(e,s)}),this.height=e+this.tickLine.lineLength+this.tickLine.offset+this.label.offset,this._title&&(this.height+=this._title.getTextHeight())}else t.height=0}},{key:"getNodeInfoOfX",value:function(t){var e=this.getIndexOfPos(t),i=this.getValOfInd(e),n=this.getPosOf({ind:e,val:i});return{ind:e,value:i,text:this._getFormatText(i,e),x:n,field:this.field}}},{key:"_trimXAxis",value:function(){for(var t=[],e=this.dataSection,i=0,n=e.length;i<n;i++){var a=this._formatTextSection[i],r=this._textElements[i],s={ind:i,value:e[i],text:a,x:this.getPosOf({val:e[i],ind:i}),textWidth:r.getTextWidth(),field:this.field,visible:null};t.push(s)}return this.layoutData=t,this._trimLayoutData(),t}},{key:"_getFormatText",value:function(t){var e=t;return o.isFunction(this.label.format)&&(e=this.label.format.apply(this,arguments)),o.isNumber(e)&&"proportion"==this.layoutType&&(e=Ye(e)),e}},{key:"_widget",value:function(t){if(this.enabled){!t&&(t={});var e=this,i=this.layoutData;this._title&&(this._title.context.y=this.height-this._title.getTextHeight()/2,this._title.context.x=this.width/2,this.sprite.addChild(this._title));for(var n=Math.min(1e3/i.length,25),a=0,r=0,s=i.length;r<s;r++){var l="xNode"+r,h=this.rulesSprite.getChildById(l);h||(h=new Be.Display.Sprite({id:l}),this.rulesSprite.addChild(h));var u=i[r],d=u.x,c=this.tickLine.lineLength+this.tickLine.offset+this.label.offset;if(this.label.enabled&&i[r].visible){var f={x:u._text_x||u.x,y:c+20,fillStyle:this.label.fontColor,fontSize:this.label.fontSize,rotation:-Math.abs(this.label.rotation),textAlign:this.label.textAlign,lineHeight:this.label.lineHeight,textBaseline:this.label.rotation?"middle":"top",globalAlpha:0};this.label.rotation&&90!=this.label.rotation&&(f.x+=5,f.y+=3),a<e._txts.length?(h._txt=e._txts[a],h._txt.resetText(u.text+""),this.animation?h._txt.animate({x:f.x},{duration:300}):h._txt.context.x=f.x):(h._txt=new Be.Display.Text(u.text,{id:"xAxis_txt_"+r,context:f}),h.addChild(h._txt),e._txts.push(h._txt),this.animation&&!t.resize?h._txt.animate({globalAlpha:1,y:h._txt.context.y-20},{duration:500,easing:"Back.Out",delay:r*n,id:h._txt.id}):(h._txt.context.y=h._txt.context.y-20,h._txt.context.globalAlpha=1)),a++}if(this.tickLine.enabled)if(i[r].visible){var p={x:d,y:this.tickLine.offset,end:{x:0,y:this.tickLine.lineLength},lineWidth:this.tickLine.lineWidth,strokeStyle:this.tickLine.strokeStyle};h._line?this.animation?h._line.animate({x:p.x},{duration:300}):h._line.context.x=p.x:(h._line=new $e({context:p}),h.addChild(h._line))}else h._line&&(h._line.destroy(),h._line=null);o.isFunction(this.filter)&&this.filter({layoutData:i,index:r,txt:h._txt,line:h._line||null})}if(e._txts.length>a)for(var g=a;g<e._txts.length;g++)e._txts.splice(g--,1)[0].destroy();if(this.rulesSprite.children.length>i.length){s=i.length;for(var v=this.rulesSprite.children.length;s<v;s++)this.rulesSprite.getChildAt(s).remove(),s--,v--}if(this.axisLine.enabled){var y=new $e({context:{start:{x:0,y:0},end:{x:this.width,y:0},lineWidth:this.axisLine.lineWidth,strokeStyle:this.axisLine.strokeStyle}});this.sprite.addChild(y),this._axisLine=y}}}},{key:"_trimLayoutData",value:function(){var t=this.layoutData.length;this.enabled&&t&&("proportion"==this.layoutType&&this._checkOver(),"peak"==this.layoutType&&this._checkOver(),"rule"==this.layoutType&&this._checkOver())}},{key:"_getRootPR",value:function(){var t=0;return this._coord.app&&(t=this._coord.app.padding.right),t}},{key:"_checkOver",value:function(){var t=this,e=t.layoutData;if(t.trimLayout)t.trimLayout(e);else if(this.label.evade){var i=e.length,n=t.label.textAlign;!function a(r){var s=e[r];if(void 0!==s){s.visible=!0;for(var o=r;o<i-1;o++){var l=e[o+1],h=l.textWidth,u=s.textWidth;t.label.rotation&&(h=Math.min(h,22),u=Math.min(u,22));var d=l.x,c=s.x+u;if("center"==n&&(d=l.x-h/2,c=s.x+u/2),"right"==n&&(d=l.x-h,c=s.x),o==i-2&&("center"==n&&l.x+h/2>t.width&&(d=t.width-h,l._text_x=t.width-h/2),"left"==n&&l.x+h>t.width&&(d=t.width-h,l._text_x=t.width-h)),!(d-c<-2)){a(o+1);break}if(o==i-2)return l.visible=!0,void(s.visible=!1);l.visible=!1}}}(0)}else o.each(e,function(t){t.visible=!0})}}]),e}(),Xe=Be.Shapes.Line,Ue=function(t){function e(t,n,a){i(this,e);var r=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n.org));return r.type="yAxis",r._opt=t,r.width=null,r.yMaxHeight=0,r.height=0,r.maxW=0,r.field=[],r.title={text:"",shapeType:"text",fontColor:"#999",fontSize:12,offset:2,textAlign:"center",textBaseline:"middle",strokeStyle:null,lineHeight:0},r._title=null,r.enabled=!0,r.tickLine={enabled:1,lineWidth:1,lineLength:4,strokeStyle:"#cccccc",distance:2},r.axisLine={position:"default",enabled:1,lineWidth:1,strokeStyle:"#cccccc"},r.label={enabled:1,fontColor:"#999",fontSize:12,format:null,rotation:0,distance:3,textAlign:null,lineHeight:1},!t.isH||t.label&&void 0!==t.label.rotaion||(r.label.rotation=90),r.pos={x:0,y:0},r.align="left",r.layoutData=[],r.sprite=null,r.filter=null,r.isH=!1,r.animation=!0,r.layoutType="proportion",r._axisLine=null,r.init(t,n),r}return r(e,R),n(e,[{key:"init",value:function(t,e){o.extend(!0,this,t),this._initHandle(),this.sprite=new Be.Display.Sprite({id:"yAxisSprite_"+(new Date).getTime()}),this.rulesSprite=new Be.Display.Sprite({id:"yRulesSprite_"+(new Date).getTime()}),this.sprite.addChild(this.rulesSprite)}},{key:"_initHandle",value:function(){o.isArray(this.field)||(this.field=[this.field]),this.setDataSection(),this._getTitle(),this._setYaxisWidth()}},{key:"draw",value:function(t){o.extend(!0,this,t||{}),this.height=parseInt(this.yMaxHeight-this._getYAxisDisLine()),this.setAxisLength(this.height),this.sprite.cleanAnimates(),this._trimYAxis(),this._widget(t),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"resetData",value:function(t){this.field=t.field,this.resetDataOrg(t.org),this._initHandle(),this.draw()}},{key:"setX",value:function(t){this.sprite.context.x=t,this.pos.x=t}},{key:"setY",value:function(t){this.sprite.context.y=t,this.pos.y=t}},{key:"_getTitle",value:function(){if(this.title.text)if(this._title)this._title.resetText(this.title.text);else{var t=0;"left"==this.align?t=-90:(t=90,this.isH&&(t=270)),this._title=new Be.Display.Text(this.title.text,{context:{fontSize:this.title.fontSize,textAlign:this.title.textAlign,textBaseline:this.title.textBaseline,fillStyle:this.title.fontColor,strokeStyle:this.title.strokeStyle,lineWidth:this.title.lineWidth,rotation:t}})}}},{key:"_setYaxisWidth",value:function(){}},{key:"_trimYAxis",value:function(){for(var t=[],e=0,i=this.dataSection.length;e<i;e++){var n={value:this.dataSection[e],y:-Math.abs(this.getPosOf({val:this.dataSection[e],ind:e})),visible:!0,text:""},a=n.value;o.isFunction(this.label.format)&&(a=this.label.format.apply(this,[a,e])),void 0!==a&&null!==a||"proportion"!=this.layoutType||(a=Ye(n.value)),n.text=a,t.push(n)}for(var r=0,s=0,l=t.length;s<l;s++)0!=s&&(0==r?t[s].text==t[r].text?t[s].visible=!1:r=s:(t[s].text==t[r].text&&(t[r].visible=!1),r=s));this.layoutData=t}},{key:"_getYAxisDisLine",value:function(){var t=0;return t=(t=0+this.yMaxHeight%this.dataSection.length)>0?0:t}},{key:"resetWidth",value:function(t){this.width=t,"left"==this.align&&(this.rulesSprite.context.x=this.width)}},{key:"_widget",value:function(t){var e=this;if(!t&&(t={}),e.enabled){var i=this.layoutData;e.maxW=0;for(var n=0,a=i.length;n<a;n++){var r=i[n];if(r.visible){var s=r.y,l=(r.value,e.label.textAlign||("left"==e.align?"right":"left")),h=s+(0==n?-3:0)+(n==i.length-1?3:0);90!=e.label.rotation&&-90!=e.label.rotation||(l="center",n==i.length-1&&(h=s-2,l="right"),0==n&&(h=s));var u=this.rulesSprite.getChildAt(n);if(u)u._txt&&this.label.enabled&&(e.animation&&!t.resize?u._txt.animate({y:h,globalAlpha:1},{duration:500,delay:80*n,id:u._txt.id}):u._txt.context.y=h,u._txt.resetText(r.text)),u._tickLine&&this.tickLine.enabled&&(e.animation&&!t.resize?u._tickLine.animate({y:s},{duration:500,delay:80*n,id:u._tickLine.id}):u._tickLine.context.y=s);else{u=new Be.Display.Sprite({id:"yNode"+n});var d=20;r.value==e.origin&&(d=0),r.value<e.origin&&(d=-20);var c=0;if(e.tickLine.enabled){c="left"==e.align?-e.tickLine.lineLength-e.tickLine.distance:e.tickLine.distance;var f=new Xe({context:{x:c,y:s,end:{x:e.tickLine.lineLength,y:0},lineWidth:e.tickLine.lineWidth,strokeStyle:e._getStyle(e.tickLine.strokeStyle)}});u.addChild(f),u._tickLine=f}if(e.label.enabled){var p="left"==e.align?c-e.label.distance:c+e.tickLine.lineLength+e.label.distance;this.isH&&(p+=4*("left"==e.align?-1:1));var g=new Be.Display.Text(r.text,{id:"yAxis_txt_"+e.align+"_"+n,context:{x:p,y:h+d,fillStyle:e._getStyle(e.label.fontColor),fontSize:e.label.fontSize,rotation:-Math.abs(e.label.rotation),textAlign:l,textBaseline:"middle",lineHeight:e.label.lineHeight,globalAlpha:0}});u.addChild(g),u._txt=g,90==e.label.rotation||-90==e.label.rotation?e.maxW=Math.max(e.maxW,g.getTextHeight()):e.maxW=Math.max(e.maxW,g.getTextWidth()),o.isFunction(e.filter)&&e.filter({layoutData:e.layoutData,index:n,txt:g,line:f}),e.rulesSprite.addChild(u),e.animation&&!t.resize?g.animate({globalAlpha:1,y:g.context.y-d},{duration:500,easing:"Back.Out",delay:80*(n+1),id:g.id}):(g.context.y=g.context.y-d,g.context.globalAlpha=1)}}}}if(e.rulesSprite.children.length>i.length){a=i.length;for(var v=e.rulesSprite.children.length;a<v;a++)e.rulesSprite.getChildAt(a).remove(),a--,v--}null===e.width&&(e.width=parseInt(e.maxW+e.label.distance),e.tickLine.enabled&&(e.width+=parseInt(e.tickLine.lineLength+e.tickLine.distance)),e._title&&(e.width+=e._title.getTextHeight()));var y=0;if("left"==e.align&&(e.rulesSprite.context.x=e.width,y=e.width),e.axisLine.enabled){var x=new Xe({context:{start:{x:y,y:0},end:{x:y,y:-e.height},lineWidth:e.axisLine.lineWidth,strokeStyle:e._getStyle(e.axisLine.strokeStyle)}});this.sprite.addChild(x),this._axisLine=x}this._title&&(this._title.context.y=-this.height/2,this._title.context.x=this._title.getTextHeight()/2,"right"==this.align&&(this._title.context.x=this.width-this._title.getTextHeight()/2),this.sprite.addChild(this._title))}else e.width=0}},{key:"_getStyle",value:function(t){var e=t;return o.isFunction(t)&&(e=t.call(this,this)),t||(e="#999"),e}}]),e}(),Ze=Be.Shapes.Line,Qe=Be.Shapes.Rect,Je=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.width=0,a.height=0,a.app=n,a.pos={x:0,y:0},a.enabled=1,a.xDirection={shapeType:"line",enabled:1,data:[],lineType:"solid",lineWidth:1,strokeStyle:"#f0f0f0",filter:null},a.yDirection={shapeType:"line",enabled:0,data:[],lineType:"solid",lineWidth:1,strokeStyle:"#f0f0f0",filter:null},a.fill={enabled:!0,fillStyle:null,alpha:null},a.sprite=null,a.xAxisSp=null,a.yAxisSp=null,a.init(t),a}return r(e,X),n(e,[{key:"init",value:function(t){o.extend(!0,this,t),this.sprite=new Be.Display.Sprite}},{key:"setX",value:function(t){this.sprite.context.x=t}},{key:"setY",value:function(t){this.sprite.context.y=t}},{key:"draw",value:function(t){o.extend(!0,this,t),this._widget(),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"clean",value:function(){this.sprite.removeAllChildren()}},{key:"reset",value:function(t){this.sprite.removeAllChildren(),this.draw(t)}},{key:"_widget",value:function(){if(this.enabled){var t=this.app._yAxis[0];if(this.fill.enabled&&this.app&&t&&t.dataSectionGroup&&t.dataSectionGroup.length>1){this.yGroupSp=new Be.Display.Sprite,this.sprite.addChild(this.yGroupSp);for(var e=0,i=t.dataSectionGroup.length;e<i;e++){var n=t.height/i,a=new Qe({context:{x:0,y:-n*e,width:this.width,height:-n,fillStyle:this.fill.fillStyle||"#000",fillAlpha:this.fill.alpha||e%2*.025}});this.yGroupSp.addChild(a)}}this.xAxisSp=new Be.Display.Sprite,this.sprite.addChild(this.xAxisSp),this.yAxisSp=new Be.Display.Sprite,this.sprite.addChild(this.yAxisSp);for(var r=0,s=(u=this.xDirection.data).length;r<s;r++){var l=u[r],h=new Ze({id:"back_line_"+r,context:{y:l.y,lineType:this.xDirection.lineType,lineWidth:this.xDirection.lineWidth,strokeStyle:this.xDirection.strokeStyle}});this.xDirection.enabled&&(o.isFunction(this.xDirection.filter)&&this.xDirection.filter.apply(h,[{layoutData:this.yDirection.data,index:r,line:h},this]),this.xAxisSp.addChild(h),h.context.start.x=0,h.context.end.x=this.width)}var u;for(r=0,s=(u=this.yDirection.data).length;r<s;r++){l=u[r],h=new Ze({context:{x:l.x,start:{x:0,y:0},end:{x:0,y:-this.height},lineType:this.yDirection.lineType,lineWidth:this.yDirection.lineWidth,strokeStyle:this.yDirection.strokeStyle,visible:!!l.x}});this.yDirection.enabled&&(o.isFunction(this.yDirection.filter)&&this.yDirection.filter.apply(h,[{layoutData:this.xDirection.data,index:r,line:h},this]),this.yAxisSp.addChild(h))}}}}]),e}(),Ke=Be.Shapes.Rect,ti=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="rect",a._xAxis=null,a._yAxis=[],a._yAxisLeft=null,a._yAxisRight=null,a._grid=null,a.horizontal=!1,a.xAxis={field:a.dataFrame.fields[0]},a.yAxis=[{field:a.dataFrame.fields.slice(1)}],a.grid={},o.extend(!0,a,a.setDefaultOpt(t,n)),t.horizontal&&(a.xAxis.isH=!0,o.each(a.yAxis,function(t){t.isH=!0})),"enabled"in t&&(o.extend(!0,a.xAxis,{enabled:t.enabled}),o.each(a.yAxis,function(e){o.extend(!0,e,{enabled:t.enabled})}),a.grid.enabled=t.enabled),a.init(t),a}return r(e,Ve),n(e,[{key:"setDefaultOpt",value:function(t,e){var i={xAxis:{layoutType:"rule",posParseToInt:!1}};if(o.extend(!0,i,t),i.yAxis){var n=[];o.each(o.flatten([i.yAxis]),function(t){n.push(o.clone(t))}),i.yAxis=n}else i.yAxis=[];for(var a=o.flatten([e._opt.graphs]),r=0;r<a.length;r++){var s=a[r];if("bar"==s.type&&(i.xAxis.layoutType="peak"),s.field){var l="left";"right"==s.yAxisAlign&&(l="right");var h=null;(h=o.find(i.yAxis,function(t,e){return t.align==l||!t.align&&e==("left"==l?0:1)}))?h.align||(h.align=l):(h={align:l,field:[]},i.yAxis.push(h)),h.field?o.isArray(h.field)||(h.field=[h.field]):h.field=[],o.isArray(s.field)?h.field=h.field.concat(s.field):h.field.push(s.field)}}var u=[],d=[];return o.each(i.yAxis,function(t,e){t.align||(t.align=e?"right":"left"),"left"==t.align?u.push(t):d.push(t)}),i.yAxis=u.concat(d),i}},{key:"init",value:function(t){this._initModules(),this.fieldsMap=this.setFieldsMap({type:"yAxis"})}},{key:"resetData",value:function(t,e){var i=this;this.dataFrame=t;var n=this.getAxisDataFrame(this.xAxis.field);this._xAxis.resetData(n),o.each(this._yAxis,function(t){var e=i.getAxisDataFrame(t.field);t.resetData(e)}),this._resetXY_axisLine_pos();var a=this._yAxisLeft||this._yAxisRight;this._grid.reset({animation:!1,xDirection:{data:a.layoutData}})}},{key:"draw",value:function(t){!t&&(t={});var e=this.app.padding,i=t.height||this.app.height,n=t.width||this.app.width;if(this.horizontal){var a=n;n=i,i=a}var r=i-this._xAxis.height-e.bottom,s=0,o=0;this._yAxisLeft&&(this._yAxisLeft.draw({pos:{x:e.left,y:r},yMaxHeight:r-e.top,resize:t.resize}),s=this._yAxisLeft.width),this._yAxisRight&&(this._yAxisRight.draw({pos:{x:0,y:r},yMaxHeight:r-e.top,resize:t.resize}),o=this._yAxisRight.width),this._xAxis.draw({pos:{x:e.left+s,y:r},width:n-s-e.left-o-e.right,resize:t.resize}),this._yAxisRight&&this._yAxisRight.setX(s+e.left+this._xAxis.width),this._grid.draw({width:this._xAxis.width,height:this._yAxis[0].height,xDirection:{data:this._yAxis[0].layoutData},yDirection:{data:this._xAxis.layoutData},pos:{x:s+e.left,y:r},resize:t.resize}),this.width=this._xAxis.width,this.height=this._yAxis[0].height,this.origin.x=s+e.left,this.origin.y=r,this._initInduce(),this._resetXY_axisLine_pos(),this.horizontal&&this._horizontal({w:n,h:i})}},{key:"_resetXY_axisLine_pos",value:function(){var t,e=this;"center"==this._xAxis.axisLine.position&&(t=-this._yAxis[0].height/2),"center"==this._xAxis.axisLine.position&&(t=-this._yAxis[0].height/2),o.isNumber(this._xAxis.axisLine.position)&&(t=-this._yAxis[0].getPosOfVal(this._xAxis.axisLine.position)),void 0!==t&&(this._xAxis._axisLine.context.y=t),o.each(this._yAxis,function(t){var i;"center"==t.axisLine.position&&(i=e._xAxis.width/2),o.isNumber(t.axisLine.position)&&(i=e._xAxis.getPosOfVal(t.axisLine.position)),void 0!==i&&(t._axisLine.context.x=i)})}},{key:"getSizeAndOrigin",value:function(){var t={width:this.width,height:this.height,origin:this.origin};if(this.horizontal){var e=this.app.padding,i=e.bottom,n=e.right;t={width:this._yAxis[0].height,height:this._xAxis.width,origin:{x:this._xAxis.height+i,y:this._yAxis[0].height+n}}}return t}},{key:"_initModules",value:function(){this._grid=new Je(this.grid,this),this.sprite.addChild(this._grid.sprite);var t=this.getAxisDataFrame(this.xAxis.field);this._xAxis=new qe(this.xAxis,t,this),this._axiss.push(this._xAxis),this.sprite.addChild(this._xAxis.sprite);var e,i,n,a,r=this.yAxis;o.isArray(r)||(r=[r]),(e=o.find(r,function(t){return"left"==t.align}))&&(n=this.getAxisDataFrame(e.field),this._yAxisLeft=new Ue(e,n),this._yAxisLeft.axis=e,this.sprite.addChild(this._yAxisLeft.sprite),this._yAxis.push(this._yAxisLeft),this._axiss.push(this._yAxisLeft)),(i=o.find(r,function(t){return"right"==t.align}))&&(a=this.getAxisDataFrame(i.field),this._yAxisRight=new Ue(i,a),this._yAxisRight.axis=i,this.sprite.addChild(this._yAxisRight.sprite),this._yAxis.push(this._yAxisRight),this._axiss.push(this._yAxisRight))}},{key:"_horizontal",value:function(t){var e=t.h,i=t.w;o.each([this.sprite.context],function(t){t.x+=(e-i)/2,t.y+=(i-e)/2;var n={x:i/2,y:e/2};t.rotation=90,t.rotateOrigin=n})}},{key:"changeFieldEnabled",value:function(t){this.setFieldEnabled(t);var e=this.getFieldMapOf(t),i=e.yAxis||e.rAxis,n=this.getEnabledFieldsOf(i);i.resetData(this.getAxisDataFrame(n)),this._resetXY_axisLine_pos(),this._grid.reset({animation:!1,xDirection:{data:this._yAxisLeft?this._yAxisLeft.layoutData:this._yAxisRight.layoutData}})}},{key:"_initInduce",value:function(){var t=this;t.induce=new Ke({id:"induce",context:{x:t.origin.x,y:t.origin.y-t.height,width:t.width,height:t.height,fillStyle:"#000000",globalAlpha:0,cursor:"pointer"}}),t.sprite.getChildById("induce")||t.sprite.addChild(t.induce),t.induce.on("panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){t.fire(e.type,e),t.app.fire(e.type,e)})}},{key:"getTipsInfoHandler",value:function(t){var e=t.point.x;t.target!==this.induce&&(e=this.induce.globalToLocal(t.target.localToGlobal(t.point)).x);var i=this._xAxis.getNodeInfoOfX(e),n={xAxis:i,title:i.text,iNode:i.ind,nodes:[]};return t.eventInfo&&(n=o.extend(n,t.eventInfo)).xAxis&&(t.eventInfo.xAxis=i),n}},{key:"getPoint",value:function(t){var e={x:0,y:void 0},i={type:"yAxis",field:t.field},n=this.getAxis({type:"xAxis"}),a=this.getAxis(i),r=t.iNode||0,s=t.value;"x"in s||(s.x=o.flatten(n.dataOrg)[r]),e.x=n.getPosOf({ind:r,val:s.x});var l=s.y;return isNaN(l)||null===l||void 0===l||""===l?e.y=void 0:e.y=-a.getPosOfVal(l),{pos:e,value:s}}},{key:"getAxisOriginPoint",value:function(t){var e=this.getAxis(t);return{pos:-e.originPos,value:e.origin}}},{key:"getOriginPos",value:function(t){var e={type:"yAxis",field:t.field},i=this.getAxis({type:"xAxis"}),n=this.getAxis(e);return{x:i.originPos,y:-n.originPos}}}]),e}(),ei=Be.Shapes.Line,ii=Be.Shapes.Circle,ni=Be.Shapes.Polygon,ai=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.width=0,a.height=0,a.app=n,a.pos={x:0,y:0},a.enabled=!1,a.ring={shapeType:"poly",lineType:"sold",lineWidth:1,strokeStyle:"#e5e5e5",fillStyle:null,fillAlpha:.5},a.ray={enabled:!0,lineWidth:1,strokeStyle:"#e5e5e5"},a.dataSection=[],a.sprite=null,a.animation=!0,a.induce=null,a.init(t),a}return r(e,X),n(e,[{key:"init",value:function(t){o.extend(!0,this,t),this.sprite=new Be.Display.Sprite}},{key:"setX",value:function(t){this.sprite.context.x=t}},{key:"setY",value:function(t){this.sprite.context.y=t}},{key:"draw",value:function(t){o.extend(!0,this,t),this._widget(),this.setX(this.pos.x),this.setY(this.pos.y)}},{key:"clean",value:function(){this.sprite.removeAllChildren()}},{key:"reset",value:function(t){}},{key:"_widget",value:function(){var t=this;o.each(this.dataSection,function(e,i){if(e){var n,a=t.app.getROfNum(e),r=t.app.getPointsOfR(a),s={lineWidth:t.ring.lineWidth,strokeStyle:t._getStyle(t.ring.strokeStyle,i-1),fillStyle:t._getStyle(t.ring.fillStyle,i-1),fillAlpha:t.ring.fillAlpha},l=ii;"circle"==t.ring.shapeType?(s.r=a,n=new l({context:s})):(s.pointList=[],o.each(r,function(t,e){e<r.length&&s.pointList.push([t.x,t.y])}),n=new(l=ni)({context:s})),t.sprite.addChildAt(n,0),i==t.dataSection.length-1&&(s.fillAlpha=0,s.fillStyle="#ffffff",t.induce=new l({context:s}),t.sprite.addChild(t.induce)),o.each(r,function(e){var i=new ei({context:{end:e,lineWidth:t.ring.lineWidth,strokeStyle:t.ring.strokeStyle}});t.sprite.addChild(i)})}})}},{key:"_getStyle",value:function(t,e){return o.isArray(t)?t[e%t.length]:t}}]),e}(),ri=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="polar",a.allAngle=360,a.aAxis={field:null,layoutType:"proportion",data:[],angleList:[],beginAngle:-90,layoutData:[],enabled:t.aAxis&&t.aAxis.field,label:{enabled:!0,format:function(t){return t},fontColor:"#666"}},a.rAxis={field:[],dataSection:null,enabled:!1},a.grid={enabled:!1},a.maxR=null,a.squareRange=!0,o.extend(!0,a,a.setDefaultOpt(t,n)),a.aAxis.field||(a.grid.enabled=!1),a.init(t),a}return r(e,Ve),n(e,[{key:"setDefaultOpt",value:function(t,e){var i={rAxis:{field:[]}};o.extend(!0,i,t),o.isArray(i.rAxis.field)||(i.rAxis.field=[i.rAxis.field]);var n=o.flatten([e._opt.graphs]),a=[];return o.each(n,function(t){if(t.field){var e=t.field;o.isArray(e)||(e=[e]),a=a.concat(e)}}),i.rAxis.field=i.rAxis.field.concat(a),i}},{key:"init",value:function(t){this._initModules(),this.fieldsMap=this.setFieldsMap({type:"rAxis"})}},{key:"_initModules",value:function(){this.grid.enabled&&(this._grid=new ai(this.grid,this),this.sprite.addChild(this._grid.sprite)),this.aAxis.enabled&&this.grid.enabled&&(this._aAxisScaleSp=new Be.Display.Sprite({id:"aAxisScaleSp"}),this.sprite.addChild(this._aAxisScaleSp)),this._axiss.push({type:"rAxis",field:this.rAxis.field})}},{key:"draw",value:function(t){!t&&(t={}),this._computeAttr(),this.rAxis.dataSection=this._getRDataSection(),this.aAxis.data=this.app.dataFrame.getFieldData(this.aAxis.field),this._setAAxisAngleList(),this.grid.enabled&&(this._grid.draw({pos:this.origin,width:this.width,height:this.height,dataSection:this.rAxis.dataSection},this),this.aAxis.enabled&&this._drawAAxis(),this._initInduce())}},{key:"resetData",value:function(t,e){}},{key:"changeFieldEnabled",value:function(t){this.setFieldEnabled(t),this.rAxis.dataSection=this._getRDataSection(),this.aAxis.data=this.app.dataFrame.getFieldData(this.aAxis.field),this.grid.enabled&&this._grid.reset({dataSection:this.rAxis.dataSection},this)}},{key:"_getRDataSection",value:function(){var t=this;if(this._opt.rAxis&&this._opt.rAxis.dataSection)return this._opt.rAxis.dataSection;var e=[];return o.each(o.flatten([t.rAxis.field]),function(i){e=e.concat(t.app.dataFrame.getFieldData(i))}),I(e,3)}},{key:"_computeAttr",value:function(){var t=this.app.padding,e=this.app.width,i=this.app.height;if("width"in this._opt||(this.width=e-t.left-t.right),"height"in this._opt||(this.height=i-t.top-t.bottom),this.aAxis.enabled&&(this.width-=40,this.height-=40),this.squareRange){var n=Math.min(this.width,this.height);this.width=this.height=n}"origin"in this._opt||(this.origin={x:t.left+(e-t.left-t.right)/2,y:t.top+(i-t.top-t.bottom)/2});var a,r=this.origin;if(r.x!=this.width/2||r.y!=this.height/2){var s=[r.x,this.width-r.x,r.y,this.height-r.y];a=o.max(s)}else a=Math.max(this.width/2,this.height/2);null!=this.maxR&&this.maxR<=a||(this.maxR=a)}},{key:"getRadiansAtR",value:function(t,e,i){var n=this;void 0==e&&(e=this.width),void 0==i&&(i=this.height);var a=[];if(t>this.maxR)return[];var r,s,l=this.app.padding,h={x:this.origin.x-l.left-(this.width-e)/2,y:this.origin.y-l.top-(this.height-i)/2},u=h.y;u<t&&(r=Math.sqrt(Math.pow(t,2)-Math.pow(u,2)),a=a.concat(this._filterPointsInRect([{x:-r,y:-u},{x:r,y:-u}],h,e,i)));var d=e-h.x;d<t&&(s=Math.sqrt(Math.pow(t,2)-Math.pow(d,2)),a=a.concat(this._filterPointsInRect([{x:d,y:-s},{x:d,y:s}],h,e,i)));var c=i-h.y;c<t&&(r=Math.sqrt(Math.pow(t,2)-Math.pow(c,2)),a=a.concat(this._filterPointsInRect([{x:r,y:c},{x:-r,y:c}],h,e,i)));var f=h.x;f<t&&(s=Math.sqrt(Math.pow(t,2)-Math.pow(f,2)),a=a.concat(this._filterPointsInRect([{x:-f,y:s},{x:-f,y:-s}],h,e,i)));var p=[];0==a.length?p.push([{point:{x:t,y:0},radian:0},{point:{x:t,y:0},radian:2*Math.PI}]):o.each(a,function(t,e){var i=e==a.length-1?0:e+1,r=a.slice(i,i+1)[0];p.push([{point:t,radian:n.getRadianInPoint(t)},{point:r,radian:n.getRadianInPoint(r)}])});for(var g=0,v=p.length;g<v;g++)this._checkArcInRect(p[g],t,h,e,i)||(p.splice(g,1),g--,v--);return p}},{key:"_filterPointsInRect",value:function(t,e,i,n){for(var a=0,r=t.length;a<r;a++)this._checkPointInRect(t[a],e,i,n)||(t.splice(a,1),a--,r--);return t}},{key:"_checkPointInRect",value:function(t,e,i,n){var a=t.x+e.x,r=t.y+e.y;return!(a<0||a>i||r<0||r>n)}},{key:"_checkArcInRect",value:function(t,e,i,n,a){var r=t[0],s=t[1],o=s.radian-r.radian;s.radian<r.radian&&(o=2*Math.PI+s.radian-r.radian);var l=(r.radian+o/2)%(2*Math.PI);return this._checkPointInRect(this.getPointInRadianOfR(l,e),i,n,a)}},{key:"getRadianInPoint",value:function(t){var e=2*Math.PI;return(Math.atan2(t.y,t.x)+e)%e}},{key:"getPointInRadianOfR",value:function(t,e){var i=Math.PI,n=Math.cos(t)*e;t!=i/2&&t!=3*i/2||(n=0);var a=Math.sin(t)*e;return t%i==0&&(a=0),{x:n,y:a}}},{key:"getROfNum",value:function(t){var e=o.max(this.rAxis.dataSection);return parseInt(Math.max(this.width,this.height)/2)*((t-0)/(e-0))}},{key:"getPointsOfR",value:function(t){var e=this,i=[];return o.each(e.aAxis.angleList,function(n){var a=Math.PI*n/180,r=e.getPointInRadianOfR(a,t);i.push(r)}),i}},{key:"_setAAxisAngleList",value:function(){var t=this;t.aAxis.angleList=[];var e=this.aAxis.data;if("proportion"==this.aAxis.layoutType){e=[];for(var i=0,n=this.aAxis.data.length;i<n;i++)e.push(i)}var a=this.allAngle,r=o.max(e);"proportion"==this.aAxis.layoutType&&r++,o.each(e,function(e){var i=(a*((e-0)/(r-0))+t.aAxis.beginAngle+a)%a;t.aAxis.angleList.push(i)})}},{key:"_drawAAxis",value:function(){var t=this,e=t.getROfNum(o.max(this.rAxis.dataSection)),i=t.getPointsOfR(e+3);t._aAxisScaleSp.context.x=this.origin.x,t._aAxisScaleSp.context.y=this.origin.y,o.each(this.aAxis.data,function(e,n){if(t.aAxis.label.enabled){var a=i[n],r={x:a.x,y:a.y,fillStyle:t.aAxis.label.fontColor},s=t.aAxis.label.format(e);o.extend(r,t._getTextAlignForPoint(Math.atan2(a.y,a.x))),t._aAxisScaleSp.addChild(new Be.Display.Text(s,{context:r})),t.aAxis.layoutData.push(s)}})}},{key:"_getTextAlignForPoint",value:function(t){var e="center",i="bottom";return t>-Math.PI/2&&t<0&&(e="left",i="bottom"),0==t&&(e="left",i="middle"),t>0&&t<Math.PI/2&&(e="left",i="top"),t==Math.PI/2&&(e="center",i="top"),t>Math.PI/2&&t<Math.PI&&(e="right",i="top"),t!=Math.PI&&t!=-Math.PI||(e="right",i="middle"),t>-Math.PI&&t<-Math.PI/2&&(e="right",i="bottom"),{textAlign:e,textBaseline:i}}},{key:"getAxisNodeOf",value:function(t){var e=this.getAAxisIndOf(t);if(void 0!==e)return{ind:e,value:this.aAxis.data[e],text:this.aAxis.layoutData[e],angle:this.aAxis.angleList[e]}}},{key:"getAAxisIndOf",value:function(t){var e=this;if(void 0!==t.aAxisInd)return t.aAxisInd;if(e.aAxis.angleList.length){var i=t.point,n=(180*e.getRadianInPoint(i)/Math.PI-e.aAxis.beginAngle)%e.allAngle,a=(Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),0),r=e.aAxis.angleList.length;return o.each(e.aAxis.angleList,function(t,i){t=(t-e.aAxis.beginAngle)%e.allAngle;var s=i+1,o=(e.aAxis.angleList[s]-e.aAxis.beginAngle)%e.allAngle;if(i==r-1&&(s=0,o=e.allAngle),n>=t&&n<=o)return a=n-t<o-n?i:s,!1}),a}}},{key:"_initInduce",value:function(){var t=this;t.induce=this._grid.induce,t.induce&&t.induce.on("panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){t.fire(e.type,e),t.app.fire(e.type,e)})}},{key:"getTipsInfoHandler",value:function(t){var e=this.getAxisNodeOf(t),i={nodes:[]};return e&&(i.aAxis=e,i.title=e.text,i.iNode=e.ind),t.eventInfo&&(i=o.extend(i,t.eventInfo)),i}},{key:"getPoint",value:function(t){}},{key:"getSizeAndOrigin",value:function(){}}]),e}(),si=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="graphs",a._opt=t||{},a.app=n,a.ctx=n.stage.canvas.getContext("2d"),a.dataFrame=n.dataFrame,a.data=null,a.width=0,a.height=0,a.origin={x:0,y:0},a.animation=!0,a.inited=!1,a.sprite=new Be.Display.Sprite({name:"graphs_"+t.type}),a.app.graphsSprite.addChild(a.sprite),a}return r(e,He),n(e,[{key:"tipsPointerOf",value:function(t){}},{key:"tipsPointerHideOf",value:function(t){}},{key:"focusAt",value:function(t,e){}},{key:"unfocusAt",value:function(t,e){}},{key:"selectAt",value:function(t,e){}},{key:"unselectAt",value:function(t,e){}},{key:"getSelectedList",value:function(){return[]}},{key:"getSelectedRowList",value:function(){return[]}},{key:"hide",value:function(t){}},{key:"show",value:function(t){}},{key:"getLegendData",value:function(){}},{key:"triggerEvent",value:function(t,e){var i=t["on"+e.type];if(i&&o.isFunction(i))if(e.eventInfo&&e.eventInfo.nodes&&e.eventInfo.nodes.length)1==e.eventInfo.nodes.length?i.apply(this,[e,e.eventInfo.nodes[0]]):i.apply(this,[e,e.eventInfo.nodes]);else{var n=[];o.each(arguments,function(t,e){e&&n.push(t)}),i.apply(this,n)}}}]),e}(),oi=Be.AnimationFrame,li=(Be.Shapes.BrokenLine,Be.Shapes.Rect),hi=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="bar",a.field=null,a.enabledField=null,a.yAxisAlign="left",a.absolute=!1,a.proportion=!1,a.node={shapeType:"rect",width:0,_width:0,maxWidth:50,minWidth:1,minHeight:0,radius:3,fillStyle:null,fillAlpha:.95,_count:0,xDis:null,filter:null},a.label={enabled:!1,animation:!0,fontColor:null,fontSize:12,format:null,lineWidth:0,strokeStyle:null,rotation:0,align:"center",verticalAlign:"bottom",position:"top",offsetX:0,offsetY:0},a.select={enabled:!1,alpha:.2,fillStyle:null,_fillStyle:"#092848",triggerEventType:"click",width:1,inds:[]},a._barsLen=0,a.txtsSp=null,o.extend(!0,a,t),a.init(),a}return r(e,si),n(e,[{key:"init",value:function(){this.barsSp=new Be.Display.Sprite({id:"barsSp"}),this.txtsSp=new Be.Display.Sprite({id:"txtsSp",context:{}})}},{key:"getNodesAt",value:function(t){var e=this.data,i=[];return o.each(this.enabledField,function(n,a){if(o.isArray(n))o.each(n,function(n,a){var r=e[n]?e[n][t]:null;r&&i.push(r)});else{var r=e[n]?e[n][t]:null;r&&i.push(r)}}),i}},{key:"_getTargetField",value:function(t,e,i,n){if(o.isString(n))return n;if(o.isArray(n)){var a=n[t];if(o.isString(a))return a;if(o.isArray(a))return a[e]}}},{key:"_getColor",value:function(t,e,i){e.value;var n,a=e.field,r=this.app.getComponent({name:"coord"}).getFieldMapOf(a);if(o.isString(t)&&(n=t),o.isArray(t)&&(n=o.flatten(t)[o.indexOf(i,a)]),o.isFunction(t)&&(n=t.apply(this,[e])),t&&t.lineargradient){var s=this.ctx.createLinearGradient(e.x,e.fromY+e.rectHeight,e.x,e.fromY);o.each(t.lineargradient,function(t,e){s.addColorStop(t.position,t.color)}),n=s}return void 0!==n&&null!==n||(n=r.color),n}},{key:"_getBarWidth",value:function(t,e){return this.node.width?o.isFunction(this.node.width)?this.node._width=this.node.width(t):this.node._width=this.node.width:(this.node._width=e-Math.max(1,.2*e),1==this.node._width&&t>3&&(this.node._width=t-2)),this.node._width<1&&(this.node._width=1),this.node._width=parseInt(this.node._width),this.node._width>this.node.maxWidth&&(this.node._width=this.node.maxWidth),this.node._width}},{key:"show",value:function(t){this.draw()}},{key:"hide",value:function(t){o.each(this.barsSp.children,function(e,i){var n=e.getChildById("bar_"+i+"_"+t);n&&n.destroy()}),o.each(this.txtsSp.children,function(e,i){var n=e.getChildById("text_"+i+"_"+t);n&&n.destroy()}),this.draw()}},{key:"resetData",value:function(t,e){this.dataFrame=t,this.draw()}},{key:"clean",value:function(){this.data={},this.barsSp.removeAllChildren(),this.label.enabled&&this.txtsSp.removeAllChildren()}},{key:"draw",value:function(t){!t&&(t={}),o.extend(!0,this,t);var e=this,i=e.animation&&!t.resize;if(this.data=this._trimGraphs(),0==this.enabledField.length||0==this._dataLen)return e._preDataLen=0,void this.clean();var n=e._preDataLen,a=this.enabledField.length,r=0;e.node._count=0;var s=o.flatten([this.field]);o.each(this.enabledField,function(t,l){var h=(t=o.flatten([t])).length;if(0!=h){r=e.width/e._dataLen,e._barsLen=e._dataLen*a;for(var u=0;u<e._dataLen;u++){var d=null;if(0==l){var c;u<=n-1?d=e.barsSp.getChildById("barGroup_"+u):(d=new Be.Display.Sprite({id:"barGroup_"+u}),e.barsSp.addChild(d),d.iNode=u);var f=r*e.select.width;e.select.width>1&&(f=e.select.width),u<=n-1?((c=d.getChildById("group_region_"+u)).context.width=f,c.context.x=r*u+(r-f)/2):(c=new li({id:"group_region_"+u,pointChkPriority:!1,hoverClone:!1,xyToInt:!1,context:{x:r*u+(r-f)/2,y:-e.height,width:f,height:e.height,fillStyle:e._getGroupRegionStyle(u),globalAlpha:o.indexOf(e.select.inds,e.dataFrame.range.start+u)>-1?e.select.alpha:0}}),d.addChild(c),c.iNode=u,c.on($.get(),function(t){if(t.eventInfo={iNode:this.iNode},e.app.fire(t.type,t),e.select.enabled&&t.type==e.select.triggerEventType){var i=e.dataFrame.range.start+this.iNode;o.indexOf(e.select.inds,i)>-1?e.unselectAt(i):e.selectAt(i)}e.triggerEvent(e,t)}))}else d=e.barsSp.getChildById("barGroup_"+u);var p=null;0==l?u<=n-1?p=e.txtsSp.getChildById("txtGroup_"+u):(p=new Be.Display.Sprite({id:"txtGroup_"+u}),e.txtsSp.addChild(p),p.iGroup=l):p=e.txtsSp.getChildById("txtGroup_"+u);for(var g=0;g<h;g++){e.node._count++;var v=e.data[t[g]][u];v.iGroup=l,v.iNode=u,v.iLay=g;var y=v.y-v.fromY;isNaN(y)?y=0:Math.abs(y)<e.node.minHeight&&(y=e.node.minHeight),v.rectHeight=y;var x=e._getColor(e.node.fillStyle,v,s);if(v.color=x,x instanceof CanvasGradient&&e.node.fillStyle.lineargradient){var _=e.node.fillStyle.lineargradient[parseInt(e.node.fillStyle.lineargradient.length/2)];_&&(v.color=_.color)}var m={x:Math.round(v.x),y:v.fromY,width:e.node._width,height:y,fillStyle:x,fillAlpha:e.node.fillAlpha,scaleY:-1};v.width=m.width;var b={x:m.x,y:v.yOriginPoint.pos,width:m.width,height:m.height,fillStyle:m.fillStyle,fillAlpha:e.node.fillAlpha,scaleY:0};if(e.node.radius&&v.isLeaf&&!e.proportion){var k=Math.min(e.node._width/2,Math.abs(y));k=Math.min(k,e.node.radius),b.radius=[k,k,0,0]}i||(delete b.scaleY,b.y=m.y);var w=null,S="bar_"+u+"_"+v.field;if(u<=n-1&&(w=d.getChildById(S)),w?w.context.fillStyle=x:((w=new li({id:S,context:b})).field=v.field,d.addChild(w)),w.finalPos=m,w.iGroup=l,w.iNode=u,w.iLay=g,w.nodeData=v,v.nodeElement=w,e.node.filter&&e.node.filter.apply(w,[v,e]),e.label.enabled){var A=v.value;if(o.isFunction(e.label.format)){var C=e.label.format(A,v);void 0===C&&null===C||(A=C)}if(void 0===A||null===A||""===A)continue;o.isNumber(A)&&(A=Ye(A));var P={fillStyle:e.label.fontColor||m.fillStyle,fontSize:e.label.fontSize,lineWidth:e.label.lineWidth,strokeStyle:e.label.strokeStyle||m.fillStyle,textBaseline:e.label.verticalAlign,rotation:e.label.rotation},T=e._getTextPos(m,v);P.x=T.x,P.y=T.y,P.textAlign=e._getTextAlign(m,v);var L=null,O="text_"+u+"_"+v.field;u<=n-1&&(L=p.getChildById(O)),L?(L.resetText(A),L.context.x=P.x,L.context.y=P.y):((L=new Be.Display.Text(A,{id:O,context:P})).field=v.field,p.addChild(L))}}}}}),this.sprite.addChild(this.barsSp),this.label.enabled&&this.sprite.addChild(this.txtsSp),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.grow(function(){e.fire("complete")},{delay:0,duration:300,animate:i}),e._preDataLen=e._dataLen}},{key:"setEnabledField",value:function(){this.enabledField=this.app.getComponent({name:"coord"}).filterEnabledFields(this.field)}},{key:"_getGroupRegionStyle",value:function(t){var e=this,i=e.select.fillStyle;return o.isArray(e.select.fillStyle)&&(i=e.select.fillStyle[h]),o.isFunction(e.select.fillStyle)&&(i=e.select.fillStyle.apply(this,[{iNode:t,rowData:e.dataFrame.getRowDataAt(t)}])),void 0===i||null===i?e.select._fillStyle:i}},{key:"_trimGraphs",value:function(){var t=this,e=this.app.getComponent({name:"coord"});this.setEnabledField(),this.data={};var i=[],n=0,a=0,r=!1;this.absolute?(i=[this],n=this.enabledField.length):o.each(this.app.getComponents({name:"graphs"}),function(e){e.absolute||"bar"!=e.type||(e===t&&(r=!0),r?e.setEnabledField():a+=e.enabledField.length,n+=e.enabledField.length,i.push(e))});var s=e.getAxis({type:"xAxis"}).getCellLength(),l=s/(n+1),h=this._getBarWidth(s,l),u=l-h;null!=this.node.xDis&&(u=this.node.xDis);var d=(s-h*n-u*(n-1))/2;a&&(d+=(u+h)*a);var c=this.dataFrame.getDataOrg(this.enabledField);return o.each(c,function(i,n){var a=[];o.each(i,function(r,l){a[l]=[],t._dataLen=r.length,o.each(r,function(r,c){var f=r;t.proportion&&(f=0,o.each(i,function(t,e){f+=t[c]}));var p=t._getTargetField(n,l,c,t.enabledField),g=e.getPoint({iNode:c,field:p,value:{y:r}}),v=g.pos.x,y=v-s/2+d+(h+u)*n,x=0;x=t.proportion?-r/f*e.height:g.pos.y;var _=e.getAxisOriginPoint({field:p});var m=function t(e,i,n,a,r){var s=e[i-1];if(!s)return _.pos;var o=s[n].y,l=s[n].value,h=_.value;return a>=h?l>=h?(s[n].isLeaf=!1,o):t(e,i-1,n,a,r):l<h?(s[n].isLeaf=!1,o):t(e,i-1,n,a,r)}(a,l,c,r,x);x+=m-_.pos;var b={type:"bar",value:r,vInd:l,vCount:f,field:p,fromX:y,fromY:m,x:y,y:x,width:h,yOriginPoint:_,isLeaf:!0,xAxis:e.getAxis({type:"xAxis"}).getNodeInfoOfX(v),iNode:c,rowData:t.dataFrame.getRowDataAt(c),color:null};t.data[b.field]||(t.data[b.field]=a[l]),a[l].push(b)})})}),t.data}},{key:"_getTextAlign",value:function(t,e){var i=this.label.align;return e.value<e.yOriginPoint.value&&("left"==i?i="right":"right"==i&&(i="left")),i}},{key:"_getTextPos",value:function(t,e){var i={x:0,y:0},n=t.x,a=t.y,r=!0;switch(t.y>e.y&&(r=!1),this.label.position){case"top":n=t.x+t.width/2,a=t.y+t.height,r&&(a+=16);break;case"topRight":n=t.x+t.width,a=t.y+t.height,r&&(a+=16);break;case"right":n=t.x+t.width,a=t.y+t.height/2;break;case"rightBottom":n=t.x+t.width,a=t.y;break;case"bottom":n=t.x+t.width/2,a=t.y;break;case"bottomLeft":n=t.x,a=t.y;break;case"left":n=t.x,a=t.y+t.height/2;break;case"leftTop":n=t.x,a=t.y+t.height,r&&(a+=16);break;case"center":n=t.x+t.width/2,a=t.y+t.height/2}n-=this.label.offsetX;var s=1;return e.value<e.yOriginPoint.value&&(s=-1),a-=s*this.label.offsetY,i.x=n,i.y=a,i}},{key:"grow",value:function(t,e){var i=this;if(i._preDataLen>i._dataLen)for(var n=i._dataLen,a=i._preDataLen;n<a;n++)i.barsSp.getChildAt(n).destroy(),i.label.enabled&&i.txtsSp.getChildAt(n).destroy(),n--,a--;if(e.animate){var r=o.extend({delay:Math.min(1e3/this._barsLen,80),easing:"Linear.None",duration:500},e),s=0;o.each(i.enabledField,function(e,n){var a=(e=o.flatten([e])).length;if(0!=a)for(var l=0;l<i._dataLen;l++)for(var h=0;h<a;h++){var u=i.data[e[h]][l],d=i.barsSp.getChildById("barGroup_"+l).getChildById("bar_"+l+"_"+u.field);0==r.duration?(d.context.scaleY=1,d.context.y=1*d.finalPos.y,d.context.x=d.finalPos.x,d.context.width=d.finalPos.width,d.context.height=d.finalPos.height):(d._tweenObj&&oi.destroyTween(d._tweenObj),d._tweenObj=d.animate({scaleY:1,y:1*d.finalPos.y,x:d.finalPos.x,width:d.finalPos.width,height:d.finalPos.height},{duration:r.duration,easing:r.easing,delay:l*r.delay,onUpdate:function(t){},onComplete:function(e){e.width<3&&this.context&&(this.context.radius=0),++s===i.node._count&&t&&t(i)},id:d.id}))}})}else t&&t(i)}},{key:"selectAt",value:function(t){if(!(o.indexOf(this.select.inds,t)>-1)){this.select.inds.push(t);var e=t-this.dataFrame.range.start,i=this.barsSp.getChildById("barGroup_"+e);if(i){var n=i.getChildById("group_region_"+e);n&&(n.context.globalAlpha=this.select.alpha)}}}},{key:"unselectAt",value:function(t){if(-1!=o.indexOf(this.select.inds,t)){var e=o.indexOf(this.select.inds,t);this.select.inds.splice(e,1);var i=t-this.dataFrame.range.start,n=this.barsSp.getChildById("barGroup_"+i);if(n){var a=n.getChildById("group_region_"+i);a&&(a.context.globalAlpha=0)}}}},{key:"getSelectedRowList",value:function(){var t=[],e=this;return o.each(e.select.inds,function(i){var n=i-e.dataFrame.range.start;t.push(e.dataFrame.getRowDataAt(n))}),t}}]),e}(),ui=Be.AnimationFrame,di=Be.Shapes.BrokenLine,ci=(Be.Shapes.Rect,Be.Shapes.Circle),fi=Be.Shapes.Path,pi=function(t){function e(t,n,a,r,l,h){i(this,e);var u=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return u._opt=a,u.fieldMap=t,u.field=null,u.iGroup=n,u._yAxis=t.yAxis,u.ctx=r,u.w=h,u.h=l,u.y=0,u.line={enabled:1,shapeType:"brokenLine",strokeStyle:t.color,lineWidth:2,lineType:"solid",smooth:!0},u.node={enabled:1,shapeType:"circle",corner:!1,radius:3,fillStyle:"#ffffff",strokeStyle:null,lineWidth:2},u.label={enabled:0,fontColor:null,strokeStyle:null,fontSize:12,format:null},u.area={shapeType:"path",enabled:1,fillStyle:null,alpha:.2},u.data=[],u.sprite=null,u._pointList=[],u._currPointList=[],u._bline=null,o.extend(!0,u,a),u.field=t.field,u.init(a),u}return r(e,X),n(e,[{key:"init",value:function(t){this.sprite=new Be.Display.Sprite;var e=this;this.sprite.on("destroy",function(){e._growTween&&ui.destroyTween(e._growTween)})}},{key:"draw",value:function(t,e){o.extend(!0,this,t),this.data=e,this._widget(t)}},{key:"destroy",value:function(){var t=this;t.sprite.animate({globalAlpha:0},{duration:300,onComplete:function(){t.sprite.remove()}})}},{key:"_getColor",value:function(t,e){var i=this._getProp(t,e);return void 0!==i&&null!==i||(i=this._getLineStrokeStyle())&&o.isString(i)||(i=this.fieldMap.color),i}},{key:"_getProp",value:function(t,e){if(o.isArray(t))return t[this.iGroup];if(o.isFunction(t)){var i=[];return void 0!=e&&i.push(this.getNodeInfoAt(e)),t.apply(this,i)}return t}},{key:"getNodeInfoAt",value:function(t){return this.data[t]}},{key:"resetData",value:function(t,e){var i=this;t&&(this.data=t),i._pointList=this._getPointList(this.data);var n={left:0,right:i._pointList.length-i._currPointList.length};e&&o.extend(n,e.params),n.left&&(n.left>0&&(this._currPointList=this._pointList.slice(0,n.left).concat(this._currPointList)),n.left<0&&this._currPointList.splice(0,Math.abs(n.left))),n.right&&(n.right>0&&(this._currPointList=this._currPointList.concat(this._pointList.slice(-n.right))),n.right<0&&this._currPointList.splice(this._currPointList.length-Math.abs(n.right))),i._createNodes(),i._createTexts(),i._grow()}},{key:"_grow",value:function(t,e){var i=this;function n(t){i._bline.context.pointList=o.clone(t),i._bline.context.strokeStyle=i._getLineStrokeStyle(t),i._area.context.path=i._fillLine(i._bline),i._area.context.fillStyle=i._getFillStyle();var e=0;o.each(t,function(t,n){if(o.isNumber(t[1])){if(i._circles){var a=i._circles.getChildAt(e);a&&(a.context.x=t[0],a.context.y=t[1])}if(i._labels){var r=i._labels.getChildAt(e);r&&(r.context.x=t[0],r.context.y=t[1]-3,i._checkTextPos(r,n))}e++}})}i.data.length?this._growTween=ui.registTween({from:i._getPointPosStr(i._currPointList),to:i._getPointPosStr(i._pointList),desc:i.field,onUpdate:function(t){for(var e in t){var a=parseInt(e.split("_")[2]),r=parseInt(e.split("_")[1]);i._currPointList[a]&&(i._currPointList[a][r]=t[e])}n(i._currPointList)},onComplete:function(){i._growTween=null,n(i._pointList),t&&t(i)}}):t&&t(i)}},{key:"_getPointPosStr",value:function(t){var e={};return o.each(t,function(t,i){t&&(e["p_1_"+i]=t[1],e["p_0_"+i]=t[0])}),e}},{key:"_getPointList",value:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var a=t[i];e.push([a.x,a.y])}return e}},{key:"_widget",value:function(t){var e=this;if(!t&&(t={}),e._pointList=this._getPointList(e.data),0!=e._pointList.length){var i=[];if(t.animation)for(var n=this._getFirstNode(),a=n?n.y:void 0,r=0,s=e.data.length;r<s;r++){var l=e.data[r];i.push([l.x,o.isNumber(l.y)?a:l.y])}else i=e._pointList;e._currPointList=i;var h=new di({context:{pointList:i,lineWidth:e.line.lineWidth,y:e.y,strokeStyle:e._getLineStrokeStyle(i),smooth:e.line.smooth,lineType:e._getProp(e.line.lineType),smoothFilter:function(t){t[1]>0?t[1]=0:Math.abs(t[1])>e.h&&(t[1]=-e.h)},lineCap:"round"}});this.line.enabled||(h.context.visible=!1),e.sprite.addChild(h),e._bline=h;var u=new fi({context:{path:e._fillLine(h),fillStyle:e._getFillStyle(),globalAlpha:o.isArray(e.area.alpha)?1:e.area.alpha}});this.area.enabled||(u.context.visible=!1),e.sprite.addChild(u),e._area=u,e._createNodes(),e._createTexts()}}},{key:"_getFirstNode",value:function(){for(var t=null,e=0,i=this.data.length;e<i;e++){var n=this.data[e];if(o.isNumber(n.y)&&(null!==t&&"right"!=this._yAxis.align||(t=n),"right"!==this._yAxis.align&&null!==t))break}return t}},{key:"_getFillStyle",value:function(){var t=this,e=null,i=t._getProp(t.area.fillStyle)||t._getLineStrokeStyle(null,"fillStyle");if(o.isArray(t.area.alpha)&&!(i instanceof CanvasGradient)){t.area.alpha.length=2,void 0==t.area.alpha[0]&&(t.area.alpha[0]=0),void 0==t.area.alpha[1]&&(t.area.alpha[1]=0);var n=o.min(t._bline.context.pointList,function(t){return t[1]});if(void 0===n[0]||void 0===n[1])return null;e=t.ctx.createLinearGradient(n[0],n[1],n[0],0);var a=function(t){var e=t.toLowerCase();if(e&&B.test(e)){if(4===e.length){for(var i="#",n=1;n<4;n+=1)i+=e.slice(n,n+1).concat(e.slice(n,n+1));e=i}var a=[];for(n=1;n<7;n+=2)a.push(parseInt("0x"+e.slice(n,n+2)));return"RGB("+a.join(",")+")"}return e}(i),r=a.replace(")",", "+t._getProp(t.area.alpha[0])+")").replace("RGB","RGBA");e.addColorStop(0,r);var s=a.replace(")",", "+t.area.alpha[1]+")").replace("RGB","RGBA");e.addColorStop(1,s),i=e}return i}},{key:"_getLineStrokeStyle",value:function(t,e){var i;if(!this._opt.line||!this._opt.line.strokeStyle)return this.line.strokeStyle;if(this._opt.line.strokeStyle.lineargradient){!t&&(t=this._bline.context.pointList);var n=o.min(t,function(t){return t[1]}),a=o.max(t,function(t){return t[1]});return"fillStyle"==e&&(a=[0,0]),void 0===n[0]||void 0===n[1]||void 0===a[1]?null:(i=this.ctx.createLinearGradient(n[0],n[1],n[0],a[1]),o.each(this._opt.line.strokeStyle.lineargradient,function(t,e){i.addColorStop(t.position,t.color)}),i)}return i=this._getColor(this._opt.line.strokeStyle)}},{key:"_createNodes",value:function(){var t=this,e=t._currPointList;if((t.node.enabled||1==e.length)&&t.line.lineWidth){this._circles||(this._circles=new Be.Display.Sprite({}),this.sprite.addChild(this._circles));for(var i=0,n=0,a=e.length;n<a;n++){var r=t._currPointList[n];if(r&&o.isNumber(r[1])){var s={x:r[0],y:r[1],r:t._getProp(t.node.radius,n),lineWidth:t._getProp(t.node.lineWidth,n)||2,strokeStyle:t._getColor(t.node.strokeStyle,n),fillStyle:t.node.fillStyle},l=t._circles.children[i];if(l?o.extend(l.context,s):(l=new ci({context:s}),t._circles.addChild(l)),t.node.corner){var h=t._pointList[n][1],u=t._pointList[n-1],d=t._pointList[n+1];u&&d&&h==u[1]&&h==d[1]&&(l.context.visible=!1)}i++}}if(t._circles.children.length>i)for(var c=i,f=t._circles.children.length;c<f;c++)t._circles.children[c].destroy(),c--,f--}}},{key:"_createTexts",value:function(){var t=this,e=t._currPointList;if(t.label.enabled){this._labels||(this._labels=new Be.Display.Sprite({}),this.sprite.addChild(this._labels));for(var i=0,n=0,a=e.length;n<a;n++){var r=e[n];if(r&&o.isNumber(r[1])){var s={x:r[0],y:r[1]-3,fontSize:this.label.fontSize,textAlign:"center",textBaseline:"bottom",fillStyle:t._getColor(t.label.fontColor,n),lineWidth:1,strokeStyle:"#ffffff"},l=t.data[n].value;if(o.isFunction(t.label.format)&&(l=t.label.format(l,t.data[n])||l),void 0!=l&&null!=l){var h=this._labels.children[i];h?(h.resetText(l),o.extend(h.context,s)):(h=new Be.Display.Text(l,{context:s}),t._labels.addChild(h),t._checkTextPos(h,n)),i++}}}if(t._labels.children.length>i)for(var u=i,d=t._labels.children.length;u<d;u++)t._labels.children[u].destroy(),u--,d--}}},{key:"_checkTextPos",value:function(t,e){var i=this._currPointList,n=i[e-1],a=i[e+1];n&&a&&n[1]<t.context.y&&a[1]<t.context.y&&(t.context.y+=7,t.context.textBaseline="top")}},{key:"_fillLine",value:function(t){var e=o.clone(t.context.pointList),i="",n=-this._yAxis.originPos,a=null;function r(){a.push([a[a.length-1][0],n],[a[0][0],n],[a[0][0],a[0][1]]),i+=function(t){var e="",i={x:0,y:0};o.isArray(t[0])?(i.x=t[0][0],i.y=t[0][1],e="M"+t[0][0]+" "+t[0][1]):(i=t[0],e="M"+t[0].x+" "+t[0].y);for(var n=1,a=t.length;n<a;n++){var r=0,s=0,l=t[n];o.isArray(l)?(r=l[0],s=l[1]):(r=l.x,s=l.y),r==i.x&&s==i.y?e+=" z":e+=" L"+r+" "+s}return e}(a),a=null}return o.each(e,function(t,i){o.isNumber(t[1])?(null===a&&(a=[]),a.push(t)):a&&a.length&&r(),i==e.length-1&&o.isNumber(t[1])&&r()}),i}}]),e}(),gi=(Be.Shapes.Rect,function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="line",a.yAxisAlign="left",a.field=null,a.enabledField=null,a.groups=[],o.extend(!0,a,t),a.init(a._opt),a}return r(e,si),n(e,[{key:"init",value:function(t){t.yAxisAlign&&(this.yAxisAlign=t.yAxisAlign)}},{key:"draw",value:function(t){return!t&&(t={}),this.width=t.width,this.height=t.height,o.extend(!0,this.origin,t.origin),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.data=this._trimGraphs(),this._setGroupsForYfield(this.data,null,t),this.animation&&!t.resize?this.grow():this.fire("complete"),this}},{key:"resetData",value:function(t,e){var i=this;t&&(i.dataFrame=t,i.data=i._trimGraphs()),o.each(i.groups,function(t){t.resetData(i.data[t.field].data,e)})}},{key:"setEnabledField",value:function(){this.enabledField=this.app.getComponent({name:"coord"}).filterEnabledFields(this.field)}},{key:"_trimGraphs",value:function(){var t=this,e=this.app.getComponent({name:"coord"}),i={};return t.setEnabledField(),o.each(o.flatten(t.enabledField),function(n,a){var r=t.app.getComponent({name:"coord"}).getFieldMapOf(n),s=t.dataFrame.getFieldData(n);if(s){for(var o=[],l=0,h=s.length;l<h;l++){var u=e.getPoint({iNode:l,field:n,value:{y:s[l]}}),d={type:"line",iGroup:a,iNode:l,field:n,value:s[l],x:u.pos.x,y:u.pos.y,rowData:t.dataFrame.getRowDataAt(l),color:r.color};o.push(d)}i[n]={yAxis:r.yAxis,field:n,data:o}}}),i}},{key:"grow",value:function(t){var e=0,i=this.groups.length,n=this;return o.each(this.groups,function(a,r){a._grow(function(){e++,t&&t(a),e==i&&n.fire("complete")})}),this}},{key:"show",value:function(t){var e=this;-1!=o.indexOf(o.flatten([e.field]),t)&&(this.data=this._trimGraphs(),this._setGroupsForYfield(this.data,t),o.each(this.groups,function(t,i){t.resetData(e.data[t.field].data)}))}},{key:"hide",value:function(t){var e=this,i=e.getGroupIndex(t);!this.groups.length||i<0||(this.groups.splice(i,1)[0].destroy(),this.data=this._trimGraphs(),o.each(this.groups,function(t,i){t.resetData(e.data[t.field].data)}))}},{key:"getGroupIndex",value:function(t){for(var e=-1,i=0,n=this.groups.length;i<n;i++)if(this.groups[i].field===t){e=i;break}return e}},{key:"getGroup",value:function(t){return this.groups[this.getGroupIndex(t)]}},{key:"_setGroupsForYfield",value:function(t,e,i){var n=this;!i&&(i={}),e&&(e=o.flatten([e]));var a=o.flatten([this.field]);o.each(t,function(t,r){if(!e||-1!=o.indexOf(e,r)){var s=n.app.getComponent({name:"coord"}).getFieldMapOf(r),l=o.indexOf(a,r),h=new pi(s,l,n._opt,n.ctx,n.height,n.width);h.draw({animation:n.animation&&!i.resize},t.data);for(var u=!1,d=0,c=n.groups.length;d<c;d++)if(l<n.groups[d].iGroup){n.groups.splice(d,0,h),u=!0,n.sprite.addChildAt(h.sprite,d);break}u||(n.groups.push(h),n.sprite.addChild(h.sprite))}})}},{key:"getNodesAt",value:function(t){var e=[];return o.each(this.groups,function(i){var n=i.getNodeInfoAt(t);n&&e.push(n)}),e}}]),e}()),vi=Be.Shapes.Circle,yi=Be.Shapes.Rect,xi=Be.Shapes.Line,_i=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="scat",a.field=null,a.groupField=null,a.node={shapeType:"circle",maxRadius:25,minRadius:5,radius:null,normalR:15,fillStyle:null,fillAlpha:.8,strokeStyle:null,lineWidth:0,lineAlpha:0,focus:{enabled:!0,lineWidth:6,lineAlpha:.2,fillAlpha:.8},select:{enabled:!0,lineWidth:8,lineAlpha:.4,fillAlpha:1}},a.line={enabled:!1,lineWidth:1,strokeStyle:"#ccc",lineType:"dashed"},a.label={enabled:!0,field:null,format:function(t,e){return t},fontSize:13,fontColor:"#888",strokeStyle:"#ffffff",lineWidth:0,align:"center",verticalAlign:"middle",position:"center",offsetX:0,offsetY:0},a.aniOrigin="default",o.extend(!0,a,t),a._rData=null,a._rMaxValue=null,a._rMinValue=null,a.init(),a}return r(e,si),n(e,[{key:"init",value:function(){this._shapesp=new Be.Display.Sprite({id:"shapesp"}),this._textsp=new Be.Display.Sprite({id:"textsp"}),this._linesp=new Be.Display.Sprite({id:"textsp"}),this.sprite.addChild(this._linesp),this.sprite.addChild(this._shapesp),this.sprite.addChild(this._textsp)}},{key:"draw",value:function(t){!t&&(t={}),o.extend(!0,this,t),this.data=this._trimGraphs(),this._widget(),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y;var e=this;return!this.animation||t.resize||e.inited?this.fire("complete"):this.grow(function(){e.fire("complete")}),this}},{key:"resetData",value:function(t,e){this.dataFrame=t,this.data=this._trimGraphs(),this._widget()}},{key:"getNodesAt",value:function(){return[]}},{key:"_trimGraphs",value:function(){var t=[],e=this.app.getComponent({name:"coord"}),i=this.dataFrame.length;this._rData=null,this._rMaxValue=null,this._rMinValue=null;for(var n=0;n<i;n++){var a=this.dataFrame.getRowDataAt(n),r=e.getFieldMapOf(this.field),s=e.getPoint({iNode:n,field:this.field,value:{y:a[this.field]}}),o={rowData:a,x:s.pos.x,y:s.pos.y,value:s.value,field:this.field,fieldColor:r.color,iNode:n,focused:!1,selected:!1,radius:null,fillStyle:null,color:null,strokeStyle:null,lineWidth:0,shapeType:null,label:null,nodeElement:null};this._setR(o),this._setFillStyle(o),this._setStrokeStyle(o),this._setLineWidth(o),this._setNodeType(o),this._setText(o),t.push(o)}return t}},{key:"_setR",value:function(t){var e=this.node.normalR,i=t.rowData;if(null!=this.node.radius){if(o.isString(this.node.radius)&&i[this.node.radius]){this._rData||this._rMaxValue||this._rMinValue||(this._rData=this.dataFrame.getFieldData(this.node.radius),this._rMaxValue=o.max(this._rData),this._rMinValue=o.min(this._rData));var n=i[this.node.radius];e=this._rMaxValue==this._rMinValue?this.node.minRadius+(this.node.maxRadius-this.node.minRadius)/2:this.node.minRadius+(n-this._rMinValue)/(this._rMaxValue-this._rMinValue)*(this.node.maxRadius-this.node.minRadius)}o.isFunction(this.node.radius)&&(e=this.node.radius(i)),isNaN(parseInt(this.node.radius))||(e=parseInt(this.node.radius))}return t.radius=e,this}},{key:"_setText",value:function(t){null!=this.label.field&&o.isString(this.label.field)&&t.rowData[this.label.field]&&(t.label=this.label.format(t.rowData[this.label.field],t))}},{key:"_setFillStyle",value:function(t){return t.color=t.fillStyle=this._getStyle(this.node.fillStyle,t),this}},{key:"_setStrokeStyle",value:function(t){return t.strokeStyle=this._getStyle(this.node.strokeStyle||this.node.fillStyle,t),this}},{key:"_getStyle",value:function(t,e){var i=t;return o.isArray(t)&&(i=t[e.iGroup]),o.isFunction(t)&&(i=t(e)),i||(i=e.fieldColor),i}},{key:"_setLineWidth",value:function(t){return t.lineWidth=this.node.lineWidth,this}},{key:"_setNodeType",value:function(t){var e=this.node.shapeType;return o.isArray(e)&&(e=e[t.iGroup]),o.isFunction(e)&&(e=e(t)),e||(e="circle"),t.shapeType=e,this}},{key:"_widget",value:function(){var t=this;if(t._shapesp.children.length>t.data.length)for(var e=t.data.length;e<t._shapesp.children.length;e++)t._shapesp.getChildAt(e--).destroy();if(t._textsp.children.length>t.data.length)for(e=t.data.length;e<t._textsp.children.length;e++)t._textsp.getChildAt(e--).destroy();if(t._linesp.children.length>t.data.length)for(e=t.data.length;e<t._linesp.children.length;e++)t._linesp.getChildAt(e--).destroy();o.each(t.data,function(e,i){var n=t._getNodeContext(e),a="circle"==e.shapeType?vi:yi,r=t._shapesp.getChildAt(i);if(r?r.animate(n):(r=new a({id:"shape_"+i,hoverClone:!1,context:n}),t._shapesp.addChild(r),r.on($.get(),function(e){e.eventInfo={title:null,nodes:[this.nodeData]},this.nodeData.label&&(e.eventInfo.title=this.nodeData.label),t.app.fire(e.type,e),t.triggerEvent(t.node,e)})),r.nodeData=e,r.iNode=i,e.nodeElement=r,t.node.focus.enabled&&r.hover(function(e){t.focusAt(this.nodeData.iNode)},function(e){!this.nodeData.selected&&t.unfocusAt(this.nodeData.iNode)}),t.line.enabled){var s=t._linesp.getChildAt(i),l={start:{x:n.x,y:n.y+n.r},end:{x:n.x,y:0},lineWidth:t.line.lineWidth,strokeStyle:t.line.strokeStyle,lineType:t.line.lineType};s?s.animate(l):(s=new xi({context:l}),t._linesp.addChild(s)),r._line=s}if(e.label&&t.label.enabled){var h=t._textsp.getChildAt(i),u={};h?(h.resetText(e.label),u=t._getTextContext(h,n),h.animate(u)):(h=new Be.Display.Text(e.label,{id:"scat_text_"+i,context:{}}),u=t._getTextContext(h,n),o.extend(h.context,u),t._textsp.addChild(h)),r.labelElement=h,h.nodeElement=r}})}},{key:"_getTextPosition",value:function(t,e){var i=0,n=0;switch(this.label.position){case"center":i=e.x,n=e.y;break;case"top":i=e.x,n=e.y-e.r;break;case"right":i=e.x+e.r,n=e.y;break;case"bottom":i=e.x,n=e.y+e.r;break;case"left":i=e.x-e.r,n=e.y;break;case"auto":i=e.x,n=e.y,t.getTextWidth()>2*e.r&&(n=e.y+e.r+.5*t.getTextHeight())}return{x:i+this.label.offsetX,y:n+this.label.offsetY}}},{key:"_getTextContext",value:function(t,e){var i=this._getTextPosition(t,e),n=this.label.fontSize;t.getTextWidth()>2*e.r&&(n-=2);var a={x:i.x,y:i.y,fillStyle:this.label.fontColor||e.fillStyle,fontSize:n,strokeStyle:this.label.strokeStyle||e.fillStyle,lineWidth:this.label.lineWidth,textAlign:this.label.align,textBaseline:this.label.verticalAlign};return this.animation&&!this.inited&&this._setCtxAniOrigin(a),a}},{key:"_setCtxAniOrigin",value:function(t){if("default"==this.aniOrigin&&(t.y=0),"origin"==this.aniOrigin){var e=this.app.getComponent({name:"coord"}).getOriginPos({field:this.field});t.x=e.x,t.y=e.y}"center"==this.aniOrigin&&(t.x=this.width/2,t.y=-this.height/2)}},{key:"_getNodeContext",value:function(t){if("circle"==t.shapeType)return this._getCircleContext(t)}},{key:"_getCircleContext",value:function(t){var e={x:t.x,y:t.y,r:t.radius,fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,lineWidth:t.lineWidth,fillAlpha:this.node.fillAlpha,cursor:"pointer"};return this.animation&&!this.inited&&(this._setCtxAniOrigin(e),e.r=1),e}},{key:"grow",value:function(t){var e=0,i=this.data.length-1,n=this;o.each(this.data,function(a){a.nodeElement.animate({x:a.x,y:a.y,r:a.radius},{onUpdate:function(t){if(this.labelElement&&this.labelElement.context){var e=n._getTextPosition(this.labelElement,t);this.labelElement.context.x=e.x,this.labelElement.context.y=e.y}this._line&&this._line.context&&(this._line.context.start.y=t.y+t.r)},delay:Math.round(300*Math.random()),onComplete:function(){(e+=1)==i&&t&&t()}})})}},{key:"focusAt",value:function(t){var e=this.data[t];if(this.node.focus.enabled&&!e.focused){var i=e.nodeElement.context;i.lineWidth=this.node.focus.lineWidth,i.lineAlpha=this.node.focus.lineAlpha,i.fillAlpha=this.node.focus.fillAlpha,e.focused=!0}}},{key:"unfocusAt",value:function(t){var e=this.data[t];if(this.node.focus.enabled&&e.focused){var i=e.nodeElement.context;i.lineWidth=this.node.lineWidth,i.lineAlpha=this.node.lineAlpha,i.fillAlpha=this.node.fillAlpha,e.focused=!1}}},{key:"selectAt",value:function(t){var e=this.data[t];if(this.node.select.enabled&&!e.selected){var i=e.nodeElement.context;i.lineWidth=this.node.select.lineWidth,i.lineAlpha=this.node.select.lineAlpha,i.fillAlpha=this.node.select.fillAlpha,e.selected=!0}}},{key:"unselectAt",value:function(t){var e=this.data[t];if(this.node.select.enabled&&e.selected){var i=e.nodeElement.context;e.focused?(i.lineWidth=this.node.focus.lineWidth,i.lineAlpha=this.node.focus.lineAlpha,i.fillAlpha=this.node.focus.fillAlpha):(i.lineWidth=this.node.lineWidth,i.lineAlpha=this.node.lineAlpha,i.fillAlpha=this.node.fillAlpha),e.selected=!1}}}]),e}(),mi=Be.Shapes.Sector,bi=Be.Shapes.Path,ki=(Be.Shapes.Rect,Be.AnimationFrame),wi=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.width=0,a.height=0,a.origin={x:0,y:0},a._graphs=t,a.domContainer=t.app.canvax.domView,a.data=n,a.sprite=null,a.textSp=null,a.sectorsSp=null,a.selectedSp=null,a.init(),a.sectors=[],a.textMaxCount=15,a.textList=[],a.completed=!1,a}return r(e,X),n(e,[{key:"init",value:function(){this.sprite=new Be.Display.Sprite,this.sectorsSp=new Be.Display.Sprite,this.sprite.addChild(this.sectorsSp),this.selectedSp=new Be.Display.Sprite,this.sprite.addChild(this.selectedSp),this._graphs.label.enabled&&(this.textSp=new Be.Display.Sprite)}},{key:"draw",value:function(t){o.extend(!0,this,t),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this._widget()}},{key:"resetData",value:function(t){var e=this;this.data=t,e.destroyLabel();for(var i=0,n=0;n<e.sectors.length;n++){var a=e.sectors[n],r=this.data.list[n];a.animate({r:r.outRadius,startAngle:r.startAngle,endAngle:r.endAngle},{duration:280,onComplete:function(){++i==e.sectors.length&&e._graphs.label.enabled&&e._startWidgetLabel()}})}}},{key:"_widget",value:function(){var t=this,e=t.data.list,i=t.data.total;if(e.length>0&&i>0){t.textSp&&t.sprite.addChild(t.textSp);for(var n=0;n<e.length;n++){var a=e[n],r=new mi({hoverClone:!1,xyToInt:!1,context:{x:a.focused?a.outOffsetx:0,y:a.focused?a.outOffsety:0,r0:a.innerRadius,r:a.outRadius,startAngle:a.startAngle,endAngle:a.endAngle,fillStyle:a.fillStyle,cursor:"pointer"},id:"sector"+n});r.nodeData=a,a.focusEnabled&&r.hover(function(e){t.focusOf(this.nodeData)},function(e){!this.nodeData.selected&&t.unfocusOf(this.nodeData)}),r.on($.get(),function(e){e.eventInfo={nodes:[this.nodeData]},t._graphs.app.fire(e.type,e),t._graphs.triggerEvent(t._graphs.node,e)}),t.sectorsSp.addChildAt(r,0),t.sectors.push(r)}t._graphs.label.enabled&&t._startWidgetLabel()}}},{key:"focusOf",value:function(t,e){if(!t.focused){this.sectors[t.iNode].animate({x:t.outOffsetx,y:t.outOffsety},{duration:100,onComplete:function(){e&&e()}}),t.focused=!0}}},{key:"unfocusOf",value:function(t,e){if(t.focused){this.sectors[t.iNode].animate({x:0,y:0},{duration:100,onComplete:function(){e&&e()}}),t.focused=!1}}},{key:"selectOf",value:function(t,e){var i=this;if(this.sectors.length&&t.selectEnabled){var n=this.sectors[t.iNode];t.selected||(t.focused?this.addCheckedSec(n):(t._focusTigger="select",this.focusOf(t,function(){i.addCheckedSec(n)})),t.selected=!0)}}},{key:"unselectOf",value:function(t,e){var i=this.sectors[t.iNode];if(t.selected&&t.selectEnabled){var n=this;n.cancelCheckedSec(i,function(){"select"==t._focusTigger&&n.unfocusOf(t)}),t.selected=!1}}},{key:"addCheckedSec",value:function(t,e){var i=t.context,n=t.nodeData;if(i){var a=new mi({xyToInt:!1,context:{x:i.x,y:i.y,r0:i.r-1,r:i.r+n.selectedR,startAngle:i.startAngle,endAngle:i.startAngle,fillStyle:i.fillStyle,globalAlpha:n.selectedAlpha},id:"selected_"+t.id});t._selectedSec=a,this.selectedSp.addChild(a),this.completed?a.animate({endAngle:i.endAngle},{duration:this._getAngleTime(i),onComplete:function(){e&&e()}}):a.context.endAngle=i.endAngle}}},{key:"cancelCheckedSec",value:function(t,e){var i=t._selectedSec;i.animate({startAngle:i.context.endAngle-.5},{duration:this._getAngleTime(t.context),onComplete:function(){delete t._selectedSec,i.destroy(),e&&e()}})}},{key:"_getAngleTime",value:function(t){return Math.abs(t.startAngle-t.endAngle)/360*500}},{key:"grow",value:function(t){var e=this;o.each(e.sectors,function(t,i){t.context&&(t.context.r0=0,t.context.r=0,t.context.startAngle=e._graphs.startAngle,t.context.endAngle=e._graphs.startAngle)}),e._hideGrowLabel(),ki.registTween({from:{process:0},to:{process:1},duration:500,onUpdate:function(t){for(var i=0;i<e.sectors.length;i++){var n=e.sectors[i],a=n.nodeData,r=n.context,s=a.startAngle,o=a.endAngle,l=a.outRadius,h=a.innerRadius;if(r){if(r.r=l*t.process,r.r0=h*t.process,0==i)r.startAngle=s,r.endAngle=s+(o-s)*t.process;else{var u=function(t){var i=t-1,n=e.sectors[i].context;return 0==i?n?n.endAngle:0:n?n.endAngle:arguments.callee(i)}(i);r.startAngle=u,r.endAngle=r.startAngle+(o-s)*t.process}n._selectedSec&&(n._selectedSec.context.r0=r.r-1,n._selectedSec.context.r=r.r+a.selectedR,n._selectedSec.context.startAngle=r.startAngle,n._selectedSec.context.endAngle=r.endAngle)}}},onComplete:function(){e._showGrowLabel(),e.completed=!0,t&&t()}})}},{key:"_widgetLabel",value:function(t,e,i,n,a,r){var s,o,l,h,u,d,c,f,p,g,v,y,x=this,_=0,m=x.data.list,b=2==t||3==t,k=3==t||4==t,w=b?i:n;e.length>0&&e.sort(function(t,e){return k?m[t].edgey-m[e].edgey:m[e].edgey-m[t].edgey});for(var S=0;S<e.length;S++){s=e[S];var A=m[s],C=A.outRadius+A.moveDis;if(!(!A.enabled||A.y<w||_>=x.textMaxCount)){_++,l=A.edgey,h=Math.abs(A.edgex),u=l-o,0!=S&&(Math.abs(u)<15||k&&u<0||!k&&u>0)&&(l=k?o+15:o-15,C-Math.abs(l)>0&&(h=Math.sqrt(Math.pow(C,2)-Math.pow(l,2))),(b&&-h>A.edgex||!b&&h<A.edgex)&&(h=Math.abs(A.edgex))),a&&(g=b?r.left:r.right,v=e.length-S,y=k?g-15*v:g+15*v,(k&&l>y||!k&&l<y)&&(l=y)),o=l,a||(b?r.left=o:r.right=o);var P=b?-h-5:h+5,T=P+x.origin.x,L=l+x.origin.y;if(T>x._graphs.app.width||L<0||L>x._graphs.app.height)return;var O="M"+A.centerx+","+A.centery;O+="Q"+A.outx+","+A.outy+","+P+","+l;var D=new bi({context:{lineType:"solid",path:O,lineWidth:1,strokeStyle:A.fillStyle}}),M=A.labelText,I=document.createElement("div");switch(I.style.cssText=" ;position:absolute;left:-1000px;top:-1000px;color:"+A.fillStyle,I.innerHTML=M,x.domContainer.appendChild(I),d=I.offsetWidth,c=I.offsetHeight,f=b?-h:h,p=l,t){case 1:f+=5,p-=c/2;break;case 2:case 3:f-=d+5,p-=c/2;break;case 4:f+=5,p-=c/2}I.style.left=f+x.origin.x+"px",I.style.top=p+x.origin.y+"px",x.textSp.addChild(D),x.textList.push({width:d,height:c,x:f+x.origin.x,y:p+x.origin.y,data:A,textTxt:M,textEle:I})}}}},{key:"_startWidgetLabel",value:function(){for(var t,e,i=this,n=i.data.list,a=0,r=0,s=[],o=[{indexs:[],count:0},{indexs:[],count:0},{indexs:[],count:0},{indexs:[],count:0}],l={right:{startQuadrant:4,endQuadrant:1,clockwise:!0,indexs:[]},left:{startQuadrant:3,endQuadrant:2,clockwise:!1,indexs:[]}},h=0;h<n.length;h++){var u=n[h].quadrant;o[u-1].indexs.push(h),o[u-1].count++}o[0].count>1&&o[0].indexs.reverse(),o[2].count>1&&o[2].indexs.reverse(),o[0].count>o[3].count&&(l.right.startQuadrant=1,l.right.endQuadrant=4,l.right.clockwise=!1),o[1].count>o[2].count&&(l.left.startQuadrant=2,l.left.endQuadrant=3,l.left.clockwise=!0),l.right.indexs=o[l.right.startQuadrant-1].indexs.concat(o[l.right.endQuadrant-1].indexs),l.left.indexs=o[l.left.startQuadrant-1].indexs.concat(o[l.left.endQuadrant-1].indexs),l.right.indexs.length>i.textMaxCount&&((e=l.right.indexs.slice(0)).sort(function(t,e){return n[e].y-n[t].y}),t=e.slice(i.textMaxCount),n[t[0]].percentage,a=n[t[0]].y),l.left.indexs.length>i.textMaxCount&&((e=l.left.indexs.slice(0)).sort(function(t,e){return n[e].y-n[t].y}),t=e.slice(i.textMaxCount),n[t[0]].percentage,r=n[t[0]].y),s.push(l.right.startQuadrant),s.push(l.right.endQuadrant),s.push(l.left.startQuadrant),s.push(l.left.endQuadrant);var d={};for(h=0;h<s.length;h++){var c=1==h||3==h;i._widgetLabel(s[h],o[s[h]-1].indexs,r,a,c,d)}}},{key:"destroyLabel",value:function(){var t=this;this.textSp&&this.textSp.removeAllChildren(),o.each(this.textList,function(e){t.domContainer.removeChild(e.textEle)}),this.textList=[]}},{key:"_showGrowLabel",value:function(){this.textSp&&this.textSp.context&&(this.textSp.context.globalAlpha=1,o.each(this.textList,function(t){t.textEle.style.visibility="visible"}))}},{key:"_hideGrowLabel",value:function(){this.textSp&&this.textSp.context&&(this.textSp.context.globalAlpha=0,o.each(this.textList,function(t){t.textEle.style.visibility="hidden"}))}}]),e}(),Si=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="pie",a.field=null,a.sort=null,a.groupField=null,a.node={shapeType:"sector",radius:null,innerRadius:0,outRadius:null,minRadius:10,moveDis:15,fillStyle:null,focus:{enabled:!0},select:{enabled:!1,radius:5,alpha:.7}},a.label={field:null,enabled:!1,format:null},a.startAngle=-90,a.allAngles=360,a.init(t),a}return r(e,si),n(e,[{key:"init",value:function(t){o.extend(!0,this,t),this.data=this._dataHandle()}},{key:"_computerProps",value:function(){var t=this.width,e=this.height;if(!this.node.outRadius){var i=Math.min(t,e)/2;this.label.enabled&&(i-=this.node.moveDis),this.node.outRadius=parseInt(i)}null!==this.node.radius&&o.isNumber(this.node.radius)&&(this.node.radius=Math.max(this.node.radius,this.node.minRadius),this.node.innerRadius=this.node.outRadius-this.node.radius),this.node.outRadius-this.node.innerRadius<this.node.minRadius&&(this.node.innerRadius=this.node.outRadius-this.node.minRadius),this.node.innerRadius<0&&(this.node.innerRadius=0)}},{key:"draw",value:function(t){!t&&(t={}),o.extend(!0,this,t),this._computerProps(),this._pie=new wi(this,this._trimGraphs(this.data)),this._pie.draw(t);var e=this;this.animation&&!t.resize?this._pie.grow(function(){e.fire("complete")}):this.fire("complete"),this.sprite.addChild(this._pie.sprite)}},{key:"show",value:function(t){this._setEnabled(t,!0)}},{key:"hide",value:function(t){this._setEnabled(t,!1)}},{key:"_setEnabled",value:function(t,e){o.each(this.data,function(i){if(i.label===t)return i.enabled=e,!1}),this._pie.resetData(this._trimGraphs(this.data))}},{key:"_dataHandle",value:function(){for(var t=this,e=[],i=t.dataFrame,n=0,a=i.length;n<a;n++){var r=i.getRowDataAt(n),s=t.app.getTheme(n),l={rowData:r,focused:!1,focusEnabled:t.node.focus.enabled,selected:!1,selectEnabled:t.node.select.enabled,selectedR:t.node.select.radius,selectedAlpha:t.node.select.alpha,enabled:!0,fillStyle:s,color:s,value:r[t.field],label:r[t.groupField||t.label.field||t.field],labelText:null,iNode:n};if(o.isFunction(this.node.fillStyle)){var h=this.node.fontColor(l);h||(l.fillStyle=l.color=h)}e.push(l)}return e.length&&t.sort&&(e.sort(function(e,i){return"asc"==t.sort?e.value-i.value:i.value-e.value}),o.each(e,function(t,e){t.iNode=e})),e}},{key:"_trimGraphs",value:function(t){var e=this,i=0;e.currentAngle=0+e.startAngle%360;var n=e.allAngles+e.startAngle%e.allAngles,a=0,r=0;if(t.length){for(var s=0;s<t.length;s++)if(t[s].enabled&&(i+=t[s].value,e.node.radius&&o.isString(e.node.radius)&&e.node.radius in t[s].rowData)){var l=Number(t[s].rowData[e.node.radius]);a=Math.max(a,l),r=Math.min(r,l)}if(i>0)for(var h=0;h<t.length;h++){var u=t[h].value/i;t[h].enabled||(u=0);var d=+(100*u).toFixed(2),c=e.allAngles*u,f=e.currentAngle+c>n?n:e.currentAngle+c,p=Math.cos((e.currentAngle+c/2)/180*Math.PI),g=Math.sin((e.currentAngle+c/2)/180*Math.PI),v=e.currentAngle+c/2;p=p.toFixed(5),g=g.toFixed(5);var y=function(t){t>=n&&(t=n),t%=e.allAngles;var i=parseInt(t/90);if(t>=0)switch(i){case 0:return 1;case 1:return 2;case 2:return 3;case 3:case 4:return 4}else if(t<0)switch(i){case 0:return 4;case-1:return 3;case-2:return 2;case-3:case-4:return 1}}(v),x=e.node.outRadius;if(e.node.radius&&o.isString(e.node.radius)&&e.node.radius in t[h].rowData){var _=Number(t[h].rowData[e.node.radius]);x=parseInt((e.node.outRadius-e.node.innerRadius)*((_-r)/(a-r))+e.node.innerRadius)}var m=e.node.moveDis;o.extend(t[h],{outRadius:x,innerRadius:e.node.innerRadius,startAngle:e.currentAngle,endAngle:f,midAngle:v,moveDis:m,outOffsetx:.7*m*p,outOffsety:.7*m*g,centerx:x*p,centery:x*g,outx:(x+m)*p,outy:(x+m)*g,edgex:(x+m)*p,edgey:(x+m)*g,orginPercentage:u,percentage:d,quadrant:y,labelDirection:1==y||4==y?1:0,iNode:h}),t[h].labelText=e._getLabelText(t[h]),e.currentAngle+=c,e.currentAngle>n&&(e.currentAngle=n)}}return{list:t,total:i}}},{key:"_getLabelText",value:function(t){var e;if(this.label.enabled)if(this.label.format)o.isFunction(this.label.format)&&(e=this.label.format(t.label,t));else{var i=this.label.field||this.groupField;e=i?t.rowData[i]+"："+t.percentage+"%":t.percentage+"%"}return e}},{key:"getList",value:function(){return this.data}},{key:"getLegendData",value:function(){var t=[];return o.each(this.data,function(e){t.push({name:e.label,color:e.fillStyle,enabled:e.enabled})}),t}},{key:"tipsPointerOf",value:function(t){}},{key:"tipsPointerHideOf",value:function(t){}},{key:"focusAt",value:function(t){var e=this._pie.data.list[t];this.node.focus.enabled&&this._pie.focusOf(e)}},{key:"unfocusAt",value:function(t){var e=this._pie.data.list[t];e.node.focus.enabled&&this._pie.unfocusOf(e)}},{key:"selectAt",value:function(t){var e=this._pie.data.list[t];this.node.select.enabled&&this._pie.selectOf(e)}},{key:"unselectAt",value:function(t){var e=this._pie.data.list[t];this.node.select.enabled&&this._pie.unselectOf(e)}}]),e}(),Ai=Be.Shapes.Polygon,Ci=Be.Shapes.Circle,Pi=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="radar",a.field=null,a.enabledField=null,a.line={shapeType:"brokenLine",enabled:!0,lineWidth:2,strokeStyle:null},a.area={shapeType:"path",enabled:!0,fillStyle:null,fillAlpha:.1},a.node={enabled:!0,shapeType:"circle",radius:4,strokeStyle:"#ffffff",lineWidth:1},a.groups={},o.extend(!0,a,t),a.init(),a}return r(e,si),n(e,[{key:"init",value:function(){}},{key:"draw",value:function(t){!t&&(t={}),o.extend(!0,this,t),this.data=this._trimGraphs(),this._widget(),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.fire("complete")}},{key:"_widget",value:function(){var t=this,e=this.app.getComponent({name:"coord"}),i=0;o.each(this.data,function(n,a){var r={},s=[];o.each(n,function(t,e){s.push([t.point.x,t.point.y])});var l=e.getFieldMapOf(a),h=t._getStyle(t.line.strokeStyle,i,l.color,l),u={pointList:s,cursor:"pointer"};t.line.enabled&&(u.lineWidth=t.line.lineWidth,u.strokeStyle=h),t.area.enabled&&(u.fillStyle=t._getStyle(t.area.fillStyle,i,l.color,l),u.fillAlpha=t._getStyle(t.area.fillAlpha,i,1,l));var d=new Ai({hoverClone:!1,context:u});if(r.area=d,t.sprite.addChild(d),d.on($.get(),function(e){"mouseover"==e.type&&(this.context.fillAlpha+=.2),"mouseout"==e.type&&(this.context.fillAlpha-=.2),t.fire(e.type,e),t.app.fire(e.type,e)}),t.node.enabled){var c=[];o.each(n,function(e,i){s.push([e.point.x,e.point.y]);var n=new Ci({context:{cursor:"pointer",x:e.point.x,y:e.point.y,r:t.node.radius,lineWidth:t.node.lineWidth,strokeStyle:t.node.strokeStyle,fillStyle:h}});t.sprite.addChild(n),n.iNode=i,n.nodeData=e,n._strokeStyle=h,n.on("panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){t.fire(e.type,e),e.aAxisInd=this.iNode,e.eventInfo={nodes:[this.nodeData]},t.app.fire(e.type,e)}),c.push(n)}),r.nodes=c}t.groups[a]=r,i++})}},{key:"tipsPointerOf",value:function(t){var e=this;e.tipsPointerHideOf(t),t.eventInfo&&t.eventInfo.nodes&&o.each(t.eventInfo.nodes,function(t){e.data[t.field]&&o.each(e.data[t.field],function(i,n){t.iNode==n&&e.focusOf(i)})})}},{key:"tipsPointerHideOf",value:function(t){var e=this;o.each(e.data,function(t,i){o.each(t,function(t){e.unfocusOf(t)})})}},{key:"focusOf",value:function(t){if(!t.focused){var e=this.groups[t.field].nodes[t.iNode];e.context.r+=1,e.context.fillStyle=this.node.strokeStyle,e.context.strokeStyle=e._strokeStyle,t.focused=!0}}},{key:"unfocusOf",value:function(t){if(t.focused){var e=this.groups[t.field].nodes[t.iNode];e.context.r-=1,e.context.fillStyle=e._strokeStyle,e.context.strokeStyle=this.node.strokeStyle,t.focused=!1}}},{key:"hide",value:function(t){var e=this.app.getComponent({name:"coord"});this.enabledField=e.filterEnabledFields(this.field);var i=this.groups[t];i&&(i.area.context.visible=!1,o.each(i.nodes,function(t){t.context.visible=!1}))}},{key:"show",value:function(t){var e=this.app.getComponent({name:"coord"});this.enabledField=e.filterEnabledFields(this.field);var i=this.groups[t];i&&(i.area.context.visible=!0,o.each(i.nodes,function(t){t.context.visible=!0}))}},{key:"_trimGraphs",value:function(){var t=this,e=this.app.getComponent({name:"coord"});this.enabledField=e.filterEnabledFields(this.field);var i={};return o.each(this.enabledField,function(n){var a=t.dataFrame.getFieldData(n),r=e.getFieldMapOf(n),s=[];o.each(e.aAxis.angleList,function(i,o){var l=Math.PI*i/180,h=e.getPointInRadianOfR(l,e.getROfNum(a[o]));s.push({field:n,iNode:o,rowData:t.dataFrame.getRowDataAt(o),focused:!1,value:a[o],point:h,color:r.color})}),i[n]=s}),i}},{key:"_getStyle",value:function(t,e,i,n){var a=i;return(o.isString(t)||o.isNumber(t))&&(a=t),o.isArray(t)&&(a=t[e]),o.isFunction(t)&&(a=t(e,n)),void 0!==a&&null!==a||(a=i),a}},{key:"getNodesAt",value:function(t){var e=this.data,i=[];return o.each(this.enabledField,function(n,a){if(o.isArray(n))o.each(n,function(n,a){var r=e[n][t];r&&i.push(r)});else{var r=e[n][t];r&&i.push(r)}}),i}}]),e}(),Ti={value:function(){}};function Li(){for(var t,e=0,i=arguments.length,n={};e<i;++e){if(!(t=arguments[e]+"")||t in n)throw new Error("illegal type: "+t);n[t]=[]}return new Oi(n)}function Oi(t){this._=t}function Di(t,e){for(var i,n=0,a=t.length;n<a;++n)if((i=t[n]).name===e)return i.value}function Mi(t,e,i){for(var n=0,a=t.length;n<a;++n)if(t[n].name===e){t[n]=Ti,t=t.slice(0,n).concat(t.slice(n+1));break}return null!=i&&t.push({name:e,value:i}),t}Oi.prototype=Li.prototype={constructor:Oi,on:function(t,e){var i,n,a=this._,r=(n=a,(t+"").trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),s=-1,o=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)a[i]=Mi(a[i],t.name,e);else if(null==e)for(i in a)a[i]=Mi(a[i],t.name,null);return this}for(;++s<o;)if((i=(t=r[s]).type)&&(i=Di(a[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new Oi(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,n,a=new Array(i),r=0;r<i;++r)a[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=0,i=(n=this._[t]).length;r<i;++r)n[r].value.apply(e,a)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],a=0,r=n.length;a<r;++a)n[a].value.apply(e,i)}};var Ii=Math.PI/180,Ri=64,Fi=2048,Ei=function(){var t=[256,256],e=Wi,i=Ni,n=Gi,a=zi,r=zi,s=Bi,o=ji,l=$i,h=[],u=1/0,d=Li("word","end"),c=null,f=Math.random,p={},g=qi;function v(e,i,n){t[0],t[1];for(var a,r,s,o,h,u=i.x,d=i.y,c=Math.sqrt(t[0]*t[0]+t[1]*t[1]),p=l(t),g=f()<.5?1:-1,v=-g;(a=p(v+=g))&&(r=~~a[0],s=~~a[1],!(Math.min(Math.abs(r),Math.abs(s))>=c));)if(i.x=u+r,i.y=d+s,!(i.x+i.x0<0||i.y+i.y0<0||i.x+i.x1>t[0]||i.y+i.y1>t[1]||n&&Vi(i,e,t[0])||n&&(h=n,!((o=i).x+o.x1>h[0].x&&o.x+o.x0<h[1].x&&o.y+o.y1>h[0].y&&o.y+o.y0<h[1].y)))){for(var y,x=i.sprite,_=i.width>>5,m=t[0]>>5,b=i.x-(_<<4),k=127&b,w=32-k,S=i.y1-i.y0,A=(i.y+i.y0)*m+(b>>5),C=0;C<S;C++){y=0;for(var P=0;P<=_;P++)e[A+P]|=y<<w|(P<_?(y=x[C*_+P])>>>k:0);A+=m}return delete i.sprite,!0}return!1}return p.canvas=function(t){return arguments.length?(g=Xi(t),p):g},p.start=function(){var l=function(t){t.width=t.height=1;var e=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2);t.width=(Ri<<5)/e,t.height=Fi/e;var i=t.getContext("2d");return i.fillStyle=i.strokeStyle="red",i.textAlign="center",{context:i,ratio:e}}(g()),y=function(t){var e=[],i=-1;for(;++i<t;)e[i]=0;return e}((t[0]>>5)*t[1]),x=null,_=h.length,m=-1,b=[],k=h.map(function(t,l){return t.text=e.call(this,t,l),t.font=i.call(this,t,l),t.style=a.call(this,t,l),t.weight=r.call(this,t,l),t.rotate=s.call(this,t,l),t.size=~~n.call(this,t,l),t.padding=o.call(this,t,l),t}).sort(function(t,e){return e.size-t.size});return c&&clearInterval(c),c=setInterval(w,0),w(),p;function w(){for(var e=Date.now();Date.now()-e<u&&++m<_&&c;){var i=k[m];i.x=t[0]*(f()+.5)>>1,i.y=t[1]*(f()+.5)>>1,Hi(l,i,k,m),i.hasText&&v(y,i,x)&&(b.push(i),d.call("word",p,i),x?Yi(x,i):x=[{x:i.x+i.x0,y:i.y+i.y0},{x:i.x+i.x1,y:i.y+i.y1}],i.x-=t[0]>>1,i.y-=t[1]>>1)}m>=_&&(p.stop(),d.call("end",p,b,x))}},p.stop=function(){return c&&(clearInterval(c),c=null),p},p.timeInterval=function(t){return arguments.length?(u=null==t?1/0:t,p):u},p.words=function(t){return arguments.length?(h=t,p):h},p.size=function(e){return arguments.length?(t=[+e[0],+e[1]],p):t},p.font=function(t){return arguments.length?(i=Xi(t),p):i},p.fontStyle=function(t){return arguments.length?(a=Xi(t),p):a},p.fontWeight=function(t){return arguments.length?(r=Xi(t),p):r},p.rotate=function(t){return arguments.length?(s=Xi(t),p):s},p.text=function(t){return arguments.length?(e=Xi(t),p):e},p.spiral=function(t){return arguments.length?(l=Ui[t]||t,p):l},p.fontSize=function(t){return arguments.length?(n=Xi(t),p):n},p.padding=function(t){return arguments.length?(o=Xi(t),p):o},p.random=function(t){return arguments.length?(f=t,p):f},p.on=function(){var t=d.on.apply(d,arguments);return t===d?p:t},p};function Wi(t){return t.text}function Ni(){return"serif"}function zi(){return"normal"}function Gi(t){return Math.sqrt(t.value)}function Bi(){return 30*(~~(6*Math.random())-3)}function ji(){return 1}function Hi(t,e,i,n){if(!e.sprite){var a=t.context,r=t.ratio;a.clearRect(0,0,(Ri<<5)/r,Fi/r);var s=0,o=0,l=0,h=i.length;for(--n;++n<h;){e=i[n],a.save(),a.font=e.style+" "+e.weight+" "+~~((e.size+1)/r)+"px "+e.font;var u=a.measureText(e.text+"m").width*r,d=e.size<<1;if(e.rotate){var c=Math.sin(e.rotate*Ii),f=Math.cos(e.rotate*Ii),p=u*f,g=u*c,v=d*f,y=d*c;u=Math.max(Math.abs(p+y),Math.abs(p-y))+31>>5<<5,d=~~Math.max(Math.abs(g+v),Math.abs(g-v))}else u=u+31>>5<<5;if(d>l&&(l=d),s+u>=Ri<<5&&(s=0,o+=l,l=0),o+d>=Fi)break;a.translate((s+(u>>1))/r,(o+(d>>1))/r),e.rotate&&a.rotate(e.rotate*Ii),a.fillText(e.text,0,0),e.padding&&(a.lineWidth=2*e.padding,a.strokeText(e.text,0,0)),a.restore(),e.width=u,e.height=d,e.xoff=s,e.yoff=o,e.x1=u>>1,e.y1=d>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,s+=u}for(var x=a.getImageData(0,0,(Ri<<5)/r,Fi/r).data,_=[];--n>=0;)if((e=i[n]).hasText){for(var m=(u=e.width)>>5,b=(d=e.y1-e.y0,0);b<d*m;b++)_[b]=0;if(null==(s=e.xoff))return;o=e.yoff;for(var k=0,w=-1,S=0;S<d;S++){for(b=0;b<u;b++){var A=m*S+(b>>5),C=x[(o+S)*(Ri<<5)+(s+b)<<2]?1<<31-b%32:0;_[A]|=C,k|=C}k?w=S:(e.y0++,d--,S--,o++)}e.y1=e.y0+w,e.sprite=_.slice(0,(e.y1-e.y0)*m)}}}function Vi(t,e,i){i>>=5;for(var n,a=t.sprite,r=t.width>>5,s=t.x-(r<<4),o=127&s,l=32-o,h=t.y1-t.y0,u=(t.y+t.y0)*i+(s>>5),d=0;d<h;d++){n=0;for(var c=0;c<=r;c++)if((n<<l|(c<r?(n=a[d*r+c])>>>o:0))&e[u+c])return!0;u+=i}return!1}function Yi(t,e){var i=t[0],n=t[1];e.x+e.x0<i.x&&(i.x=e.x+e.x0),e.y+e.y0<i.y&&(i.y=e.y+e.y0),e.x+e.x1>n.x&&(n.x=e.x+e.x1),e.y+e.y1>n.y&&(n.y=e.y+e.y1)}function $i(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function qi(){return document.createElement("canvas")}function Xi(t){return"function"==typeof t?t:function(){return t}}var Ui={archimedean:$i,rectangular:function(t){var e=4*t[0]/t[1],i=0,n=0;return function(t){var a=t<0?-1:1;switch(Math.sqrt(1+4*a*t)-a&3){case 0:i+=e;break;case 1:n+=4;break;case 2:i-=e;break;default:n-=4}return[i,n]}}},Zi=Be.Display.Text,Qi=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));a.type="cloud",a.field=null;var r=a;return a.node={fontFamily:"Impact",fontColor:function(t){return r.app.getTheme(t.iNode)},fontSize:function(){return this.minFontSize+Math.random()*this.maxFontSize},maxFontSize:30,_maxFontSizeVal:0,minFontSize:16,_minFontSizeVal:null,fontWeight:"normal",format:function(t,e){return t},padding:10,rotation:function(){return 30*(~~(6*Math.random())-3)},strokeStyle:null,focus:{enabled:!0},select:{enabled:!0,lineWidth:2,strokeStyle:"#666"}},o.extend(!0,a,t),a.init(),a}return r(e,si),n(e,[{key:"init",value:function(){}},{key:"draw",value:function(t){!t&&(t={}),o.extend(!0,this,t),this._drawGraphs(),this.sprite.context.x=this.width/2,this.sprite.context.y=this.height/2,this.fire("complete")}},{key:"getDaraFrameIndOfVal",value:function(t){var e=this,i=this.dataFrame,n=o.find(i.data,function(t){return t.field==e.field});return o.indexOf(n.data,t)}},{key:"_getFontSize",value:function(t,e){var i=this.node.minFontSize;if(o.isFunction(this.node.fontSize)&&(i=this.node.fontSize(t)),o.isString(this.node.fontSize)&&this.node.fontSize in t){e=Number(t[this.node.fontSize]);isNaN(e)||(i=this.node.minFontSize+(this.node.maxFontSize-this.node.minFontSize)/(this.node._maxFontSizeVal-this.node._minFontSizeVal)*(e-this.node._minFontSizeVal))}return o.isNumber(this.node.fontSize)&&(i=this.node.fontSize),i}},{key:"_getRotate",value:function(t,e){var i=this.node.rotation;return o.isFunction(this.node.rotation)&&(i=this.node.rotation(t,e)||0),i}},{key:"_getFontColor",value:function(t){var e;return o.isString(this.node.fontColor)&&(e=this.node.fontColor),o.isFunction(this.node.fontColor)&&(e=this.node.fontColor(t)),void 0!==e&&null!==e||(e="#ccc"),e}},{key:"_drawGraphs",value:function(){var t=this;o.isString(this.node.fontSize)&&o.each(t.dataFrame.getFieldData(this.node.fontSize),function(e){t.node._maxFontSizeVal=Math.max(t.node._maxFontSizeVal,e),t.node._minFontSizeVal=Math.min(t.node._minFontSizeVal,e)}),Ei().size([t.width,t.height]).words(t.dataFrame.getFieldData(t.field).map(function(e,i){var n=t.app.dataFrame.getRowDataAt(t.getDaraFrameIndOfVal(e)),a={rowData:n,field:t.field,value:e,text:null,size:t._getFontSize(n,e),iNode:i,color:null};return a.fontColor=t._getFontColor(a),a.text=t.node.format(e,a)||e,a})).padding(t.node.padding).rotate(function(e,i){return t._getRotate(e,i)}).font(t.node.fontFamily).fontSize(function(t){return t.size}).on("end",function(e,i){t.data=e,t.sprite.removeAllChildren(),o.each(e,function(i,n){i.iNode=n,i.dataLen=e.length,i.focused=!1,i.selected=!1;var a=new Zi(i.text,{context:{x:i.x,y:i.y,fontSize:i.size,fontFamily:i.font,rotation:i.rotate,textBaseline:"middle",textAlign:"center",cursor:"pointer",fontWeight:t.node.fontWeight,fillStyle:i.fontColor}});t.sprite.addChild(a),t.node.focus.enabled&&a.hover(function(e){t.focusAt(this.nodeData.iNode)},function(e){!this.nodeData.selected&&t.unfocusAt(this.nodeData.iNode)}),a.nodeData=i,i._node=a,a.on($.get(),function(e){e.eventInfo={title:null,nodes:[this.nodeData]},this.nodeData.text&&(e.eventInfo.title=this.nodeData.text),t.app.fire(e.type,e),t.triggerEvent(t.node,e)})})}).start()}},{key:"focusAt",value:function(t){var e=this.data[t];this.node.focus.enabled&&!e.focused&&(e._node.context.fontSize+=3,e.focused=!0)}},{key:"unfocusAt",value:function(t){var e=this.data[t];this.node.focus.enabled&&e.focused&&(e._node.context.fontSize-=3,e.focused=!1)}},{key:"selectAt",value:function(t){var e=this.data[t];if(this.node.select.enabled&&!e.selected){var i=e._node.context;i.lineWidth=this.node.select.lineWidth,i.lineAlpha=this.node.select.lineAlpha,i.strokeStyle=this.node.select.strokeStyle,e.selected=!0}}},{key:"unselectAt",value:function(t){var e=this.data[t];this.node.select.enabled&&e.selected&&(e._node.context.strokeStyle=this.node.strokeStyle,e.selected=!1)}}]),e}(),Ji=(Be.Display.Text,Be.Shapes.Circle),Ki=function(){function t(e,n,a){i(this,t),this._opt=e,this.dataFrame=n,this._graphs=a,this.app=a.app,this.field=null,this.iGroup=0,this.groupLen=1,this.rRange={start:0,to:0},this.width=0,this.height=0,this.node={shapeType:"circle",maxR:30,minR:5,lineWidth:1,strokeStyle:"#fff",fillStyle:"#f2fbfb",lineAlpha:.6,radius:15,focus:{enabled:!0,lineAlpha:.7,lineWidth:2,strokeStyle:"#fff"},select:{enabled:!1,lineAlpha:1,lineWidth:2,strokeStyle:"#fff",triggerEventType:"click"}},this.label={enabled:!0,fontColor:"#666",fontSize:13,align:"center",verticalAlign:"middle",position:"center",offsetX:0,offsetY:0},this.sort="desc",this.sortField=null,this.layoutType="radian",this.pit={radius:30},this.planets=[],this.maxRingNum=0,this.ringNum=0,o.extend(!0,this,e),this.node.maxR>this.pit.radius&&(this.pit.radius=this.node.maxR),this.init()}return n(t,[{key:"init",value:function(){var t=this.app.getComponent({name:"coord"});this.sprite=new Be.Display.Sprite({id:"group_"+this.iGroup,context:{x:t.origin.x,y:t.origin.y}}),this._trimGraphs(),this.draw()}},{key:"_trimGraphs",value:function(){var t=this,e=this.app.getComponent({name:"coord"});(e.maxR-this.rRange.to)/(2*this.pit.radius)<this.groupLen-1-this.iGroup&&(this.rRange.to=e.maxR-(this.groupLen-1-this.iGroup)*this.pit.radius*2),this.rRange.to-this.rRange.start<2*this.pit.radius&&(this.rRange.to=this.rRange.start+2*this.pit.radius),this.maxRingNum||(this.maxRingNum=parseInt((this.rRange.to-this.rRange.start)/(2*this.pit.radius),10),this.ringNum=this.maxRingNum),this.rRange.to=this.rRange.start+this.ringNum*this.pit.radius*2;for(var i=[],n=this.dataFrame.length,a=0;a<n;a++){var r=this.dataFrame.getRowDataAt(a),s={groupLen:this.groupLen,iGroup:t.iGroup,iNode:a,nodeElement:null,labelElement:null,rowData:r,iRing:null,iPlanet:null,fillStyle:null,color:null,strokeStyle:null,pit:null,ringInd:-1,field:t.field,label:r[t.field],focused:!1,selected:!!~o.indexOf(this.selectInds,r.__index__)};i.push(s)}t.sortField&&(i=i.sort(function(e,i){var n=t.sortField;return"desc"==t.sort?i.rowData[n]-e.rowData[n]:e.rowData[n]-i.rowData[n]}),o.each(i,function(t,e){t.iNode=e})),this._rings=this["_setRings_"+this.layoutType+"Range"](i),this.planets=i}},{key:"_setRings_radianRange",value:function(t){for(var e=this,i=[],n=this.app.getComponent({name:"coord"}),a=0,r=this.ringNum;a<r;a++){var s=a*this.pit.radius*2+this.pit.radius+this.rRange.start;e._graphs.center.enabled||(s=a*this.pit.radius*2+this.rRange.start);var l=n.getRadiansAtR(s,e.width,e.height);Math.atan(this.pit.radius/s);i.push({arcs:l,pits:[],planets:[],radius:s,max:0})}var h=0;o.each(i,function(t,i){var n=2*Math.asin(e.pit.radius/t.radius);0==t.radius&&(n=2*Math.PI);var a=0;o.each(t.arcs,function(i){var r=e._getDiffRadian(i[0].radian,i[1].radian);if(r>=n){var s=parseInt(r/n,10);a+=s;for(var o=0;o<s;o++){var l={hasRadish:!1,start:(i[0].radian+n*o+2*Math.PI)%(2*Math.PI)};l.middle=(l.start+n/2+2*Math.PI)%(2*Math.PI),l.to=(l.start+n+2*Math.PI)%(2*Math.PI),t.pits.push(l)}}}),t.max=a,h+=a,t.pits=o.shuffle(t.pits)});var u=0;return o.each(i,function(e,n){if(u>=t.length)return!1;var a=Math.ceil(e.max/h*t.length);a=Math.min(e.max,a),e.planets=t.slice(u,u+a),n==i.length-1&&(e.planets=t.slice(u)),u+=a,o.each(e.planets,function(t,i){if(!(i>=e.pits.length)){var n=o.filter(e.pits,function(t){return!t.hasRadish}),a=n[parseInt(Math.random()*n.length)];a.hasRadish=!0,t.pit=a}})}),i}},{key:"_getDiffRadian",value:function(t,e){var i=e-t;return e<t&&(i=(e+2*Math.PI-t)%(2*Math.PI)),i}},{key:"_setRings_indexRange",value:function(t){}},{key:"_setRings_valRange",value:function(t){}},{key:"draw",value:function(){var t=this,e=this.app.getComponent({name:"coord"});o.each(this._rings,function(i,n){var a={rotation:0};1==i.arcs.length&&0==i.arcs[0][0].radian&&i.arcs[0][1].radian==2*Math.PI&&(a.rotation=parseInt(360*Math.random()));var r=new Be.Display.Sprite({context:a});o.each(i.planets,function(s,l){if(s.pit){var h=e.getPointInRadianOfR(s.pit.middle,i.radius),u=t._getRProp(t.node.radius,n,l,s),d=t.node.maxR-u,c=parseInt(Math.random()*d),f=parseInt(360*Math.random())*Math.PI/180;0!=c&&(h.x+=Math.sin(f)*c,h.y+=Math.cos(f)*c);var p=t.node;s.selected&&(p=t.node.select);var g=t._getProp(t.node.fillStyle,s),v=t._getProp(p.strokeStyle,s),y=t._getProp(p.lineAlpha,s),x=t._getProp(p.lineWidth,s),_={x:h.x,y:h.y,r:u,fillStyle:g,lineWidth:x,strokeStyle:v,lineAlpha:y,cursor:"pointer"};s.color=s.fillStyle=g,s.strokeStyle=v,s.iRing=n,s.iPlanet=l;var m=new Ji({hoverClone:!1,context:_});m.on($.get(),function(e){e.eventInfo={title:null,nodes:[this.nodeData]},this.nodeData.label&&(e.eventInfo.title=this.nodeData.label),t.node.focus.enabled&&("mouseover"==e.type&&t.focusAt(this.nodeData),"mouseout"==e.type&&t.unfocusAt(this.nodeData)),t.app.fire(e.type,e),t.node.select.enabled&&e.type==t.node.select.triggerEventType&&(this.nodeData.selected?t.unselectAt(this.nodeData):t.selectAt(this.nodeData)),t._graphs.triggerEvent(t.node,e)}),m.nodeData=s,s.nodeElement=m,m.ringInd=n,m.planetIndInRing=l,r.addChild(m);var b={x:h.x,y:h.y,fontSize:t.label.fontSize,textAlign:t.label.align,textBaseline:t.label.verticalAlign,fillStyle:t.label.fontColor,rotation:-a.rotation,rotateOrigin:{x:0,y:0}},k=new Be.Display.Text(s.label,{context:b}),w=k.getTextWidth(),S=k.getTextHeight();if(w>2*u&&(b.fontSize=t.label.fontSize-3),o.isFunction(t.label.position)){var A=t.label.position({node:m,circleR:u,circleCenter:{x:h.x,y:h.y},textWidth:w,textHeight:S});b.rotation=-a.rotation,b.rotateOrigin={x:-(A.x-b.x),y:-(A.y-b.y)},b.x=A.x,b.y=A.y}"auto"==t.label.position&&w>2*u&&C(),"bottom"==t.label.position&&C(),b.x+=t.label.offsetX,b.y+=t.label.offsetY,k=new Be.Display.Text(s.label,{context:b}),m.labelElement=k,k.nodeData=s,s.labelElement=k,r.addChild(k)}function C(){b.y=h.y+u+3,b.rotation=-a.rotation,b.rotateOrigin={x:0,y:-(u+.7*S)}}}),t.sprite.addChild(r)})}},{key:"_getRProp",value:function(t,e,i,n){var a=this;if(o.isString(t)&&o.indexOf(a.dataFrame.fields,t)>-1){void 0==this.__rValMax&&void 0==this.__rValMax&&(this.__rValMax=0,this.__rValMin=0,o.each(a.planets,function(e){a.__rValMax=Math.max(a.__rValMax,e.rowData[t]),a.__rValMin=Math.min(a.__rValMin,e.rowData[t])}));var r=n.rowData[t];return a.node.minR+(r-this.__rValMin)/(this.__rValMax-this.__rValMin)*(a.node.maxR-a.node.minR)}return a._getProp(t,n)}},{key:"_getProp",value:function(t,e){var i=this.iGroup;return o.isFunction(t)?t.apply(this,[e,i]):t}},{key:"getPlanetAt",value:function(t){var e=t;return o.isNumber(t)&&o.each(this.planets,function(i){if(i.rowData.__index__==t)return e=i,!1}),e}},{key:"selectAt",value:function(t){if(this.node.select.enabled){var e=this.getPlanetAt(t);e.selected=!0,e.nodeElement&&(e.nodeElement.context.lineWidth=this._getProp(this.node.select.lineWidth,e),e.nodeElement.context.strokeStyle=this._getProp(this.node.select.strokeStyle,e),e.nodeElement.context.lineAlpha=this._getProp(this.node.select.lineAlpha,e));for(var i=0;i<this.selectInds.length;i++)if(t===this.selectInds[i]){this.selectInds.splice(i--,1);break}}}},{key:"unselectAt",value:function(t){if(this.node.select.enabled){var e=this.getPlanetAt(t);e.selected=!1,e.nodeElement&&(e.nodeElement.context.lineWidth=this._getProp(this.node.lineWidth,e),e.nodeElement.context.lineAlpha=this._getProp(this.node.lineAlpha,e)),this.selectInds.push(t)}}},{key:"getSelectedNodes",value:function(){return o.filter(this.planets,function(t){return t.selected})}},{key:"focusAt",value:function(t){if(this.node.focus.enabled){var e=this.getPlanetAt(t);e.selected||(e.focused=!0,e.nodeElement&&(e.nodeElement.context.lineWidth=this._getProp(this.node.focus.lineWidth,e),e.nodeElement.context.strokeStyle=this._getProp(this.node.focus.strokeStyle,e),e.nodeElement.context.lineAlpha=this._getProp(this.node.focus.lineAlpha,e)))}}},{key:"unfocusAt",value:function(t){if(this.node.focus.enabled){var e=this.getPlanetAt(t);e.selected||(e.focused=!1,e.nodeElement&&(e.nodeElement.context.lineWidth=this._getProp(this.node.lineWidth,e),e.nodeElement.context.lineAlpha=this._getProp(this.node.lineAlpha,e)))}}}]),t}(),tn=Be.Display.Text,en=Be.Shapes.Circle,nn=Be.Shapes.Line,an=Be.Shapes.Rect,rn=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="planet",a.field=null,a.center={enabled:!0,text:"center",radius:30,fillStyle:"#70629e",fontSize:15,fontColor:"#ffffff",margin:20},a.groupDataFrames=[],a.groupField=null,a._ringGroups=[],a.grid={rings:{fillStyle:null,strokeStyle:null,lineWidth:1,section:[],count:3},rays:{count:0,lineWidth:1,strokeStyle:"#10519D",globalAlpha:.4}},a.selectInds=[],o.extend(!0,a,t),0!=a.center.radius&&a.center.enabled||(a.center.radius=0,a.center.margin=0,a.center.enabled=!1),a.init(),a}return r(e,si),n(e,[{key:"init",value:function(){this.gridSp=new Be.Display.Sprite({id:"gridSp"}),this.sprite.addChild(this.gridSp),this._dataGroupHandle()}},{key:"draw",value:function(t){!t&&(t={}),o.extend(!0,this,t),this._drawGroups(),this._drawCenter(),this.fire("complete")}},{key:"_getMaxR",value:function(){var t;try{t=this.graphs.group.circle.maxR}catch(t){}return void 0==t&&(t=30),t}},{key:"_drawGroups",value:function(){var t=this,e=this.center.radius+this.center.margin,i=t.app.getComponent({name:"coord"}).maxR-t.center.radius-t.center.margin,n=this._getMaxR();o.each(this.groupDataFrames,function(a,r){var s=e+i*(a.length/t.dataFrame.length),l=new Ki(o.extend(!0,{iGroup:r,groupLen:t.groupDataFrames.length,rRange:{start:e,to:s},width:t.width-2*n,height:t.height-2*n,selectInds:t.selectInds},t._opt),a,t);e=l.rRange.to,t._ringGroups.push(l),t.grid.rings.section.push({radius:l.rRange.to})}),t._drawBack(),o.each(t._ringGroups,function(e){t.sprite.addChild(e.sprite)})}},{key:"_drawCenter",value:function(){this.center.enabled&&(this._center=new en({context:{x:this.origin.x,y:this.origin.y,fillStyle:this.center.fillStyle,r:this.center.radius}}),this._centerTxt=new tn(this.center.text,{context:{x:this.origin.x,y:this.origin.y,fontSize:this.center.fontSize,textAlign:"center",textBaseline:"middle",fillStyle:this.center.fontColor}}),this.sprite.addChild(this._center),this.sprite.addChild(this._centerTxt))}},{key:"_drawBack",value:function(){var t=this,e=this.app.getComponent({name:"coord"});if(1==t.grid.rings.section.length){var i=(t.grid.rings.section[0].radius-t.center.radius)/t.grid.rings.count;t.grid.rings.section=[];for(var n=0;n<t.grid.rings.count;n++)t.grid.rings.section.push({radius:t.center.radius+i*(n+1)})}else t.grid.rings.count=t.grid.rings.section.length;for(n=t.grid.rings.section.length-1;n>=0;n--){var a=t.grid.rings.section[n];t.gridSp.addChild(new en({context:{x:e.origin.x,y:e.origin.y,r:a.radius,lineWidth:t._getBackProp(t.grid.rings.lineWidth,n),strokeStyle:t._getBackProp(t.grid.rings.strokeStyle,n),fillStyle:t._getBackProp(t.grid.rings.fillStyle,n)}}))}if(t.grid.rays.count>1){var r=e.origin.x,s=e.origin.y,o=360/t.grid.rays.count,l=e.maxR;t.grid.rings.section.length&&(l=t.grid.rings.section.slice(-1)[0].radius);n=0;for(var h=t.grid.rays.count;n<h;n++){var u=o*n/180*Math.PI,d=r+l*Math.cos(u),c=s+l*Math.sin(u);t.gridSp.addChild(new nn({context:{start:{x:r,y:s},end:{x:d,y:c},lineWidth:t._getBackProp(t.grid.rays.lineWidth,n),strokeStyle:t._getBackProp(t.grid.rays.strokeStyle,n),globalAlpha:t.grid.rays.globalAlpha}}))}}var f=new an({name:"clipRect",context:{x:e.origin.x-t.app.width/2,y:e.origin.y-t.height/2,width:t.app.width,height:t.height}});t.gridSp.clipTo(f),t.sprite.addChild(f)}},{key:"_getBackProp",value:function(t,e){var i=null;return o.isFunction(t)&&(i=t.apply(this,[{scaleInd:e,count:this.grid.rings.section.length,groups:this._ringGroups,graphs:this}])),(o.isString(t)||o.isNumber(t))&&(i=t),o.isArray(t)&&(i=t[e]),i}},{key:"_dataGroupHandle",value:function(){var t=o.indexOf(this.dataFrame.fields,this.groupField);if(t>=0){var e=this.dataFrame.org[0],i={};for(var n in o.each(this.dataFrame.org,function(n,a){a&&(i[n[t]]||(i[n[t]]=[o.clone(e)]),i[n[t]].push(n))}),i)this.groupDataFrames.push(F(i[n]))}else this.groupDataFrames.push(this.dataFrame)}},{key:"show",value:function(t,e){this.getAgreeNodeData(e,function(t){t.nodeElement&&(t.nodeElement.context.visible=!0),t.labelElement&&(t.labelElement.context.visible=!0)})}},{key:"hide",value:function(t,e){this.getAgreeNodeData(e,function(t){t.nodeElement&&(t.nodeElement.context.visible=!1),t.labelElement&&(t.labelElement.context.visible=!1)})}},{key:"getAgreeNodeData",value:function(t,e){o.each(this._ringGroups,function(i){o.each(i._rings,function(i,n){o.each(i.planets,function(i,n){var a=i.rowData;t.params.name==a[t.params.field]&&e&&e(i)})})})}},{key:"getLayoutNodes",value:function(){var t=[];return o.each(this._ringGroups,function(e){o.each(e.planets,function(e){e.pit&&t.push(e)})}),t}},{key:"getInvalidNodes",value:function(){var t=[];return o.each(this._ringGroups,function(e){o.each(e.planets,function(e){e.pit||t.push(e)})}),t}},{key:"selectAt",value:function(t){o.each(this._ringGroups,function(e){e.selectAt(t)})}},{key:"selectAll",value:function(){var t=this;o.each(t.dataFrame.getFieldData("__index__"),function(e){t.selectAt(e)})}},{key:"unselectAt",value:function(t){o.each(this._ringGroups,function(e){e.unselectAt(t)})}},{key:"unselectAll",value:function(t){var e=this;o.each(e.dataFrame.getFieldData("__index__"),function(t){e.unselectAt(t)})}},{key:"getSelectedNodes",value:function(){var t=[];return o.each(this._ringGroups,function(e){t=t.concat(e.getSelectedNodes())}),t}},{key:"getSelectedRowList",value:function(){var t=[];return o.each(this._ringGroups,function(e){var i=[];o.each(e.getSelectedNodes(),function(t){i.push(t.rowData)}),t=t.concat(i)}),t}}]),e}(),sn=Be.Display.Text,on=Be.Shapes.Polygon,ln=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="funnel",a.field=null,a.dataOrg=[],a.data=[],a.sort=null,a.invert=!1,a._maxVal=null,a._minVal=null,a.maxNodeWidth=null,a.minNodeWidth=0,a.minVal=0,a.node={shapeType:"polygon",height:0,fillStyle:null,lineWidth:0,strokeStyle:null,focus:{enabled:!0},select:{enabled:!0,lineWidth:2,strokeStyle:"#666"}},a.label={enabled:!0,align:"center",format:function(t){return Ye(t)},fontColor:"#ffffff",fontSize:13,textBaseline:"middle"},o.extend(!0,a,t),a.init(),a}return r(e,si),n(e,[{key:"init",value:function(){}},{key:"_computerAttr",value:function(){this.field&&(this.dataOrg=this.dataFrame.getFieldData(this.field)),this._maxVal=o.max(this.dataOrg),this._minVal=o.min(this.dataOrg),this.maxNodeWidth||(this.maxNodeWidth=.7*this.width),this.node.height||(this.node.height=this.height/this.dataOrg.length),"asc"==this.sort&&(this.invert=!0),"desc"==this.sort&&(this.invert=!1)}},{key:"draw",value:function(t){!t&&(t={}),o.extend(!0,this,t);this.animation&&t.resize;this._computerAttr(),this.data=this._trimGraphs(),this._drawGraphs(),this.sprite.context.x=this.origin.x+this.width/2,this.sprite.context.y=this.origin.y}},{key:"_trimGraphs",value:function(){if(this.field){var t=this,e=[];return o.each(this.dataOrg,function(i,n){var a={type:"funnel",field:t.field,rowData:t.dataFrame.getRowDataAt(n),value:i,width:t._getNodeWidth(i),color:t.app.getTheme(n),cursor:"pointer",label:"",middlePoint:null,iNode:-1,points:[]};e.push(a)}),this.sort&&(e=e.sort(function(e,i){return"desc"==t.sort?i.value-e.value:e.value-i.value})),o.each(e,function(e,i){e.iNode=i,e.label=t.label.format(e.value,e)}),o.each(e,function(i,n){i.points=t._getPoints(i,e[n+1],e[n-1]),i.middlePoint={x:0,y:(i.iNode+.5)*t.node.height}}),e}}},{key:"_getNodeWidth",value:function(t){var e=this.minNodeWidth+(this.maxNodeWidth-this.minNodeWidth)/(this._maxVal-this.minVal)*(t-this.minVal);return parseInt(e)}},{key:"_getPoints",value:function(t,e,i){var n=[],a=t.iNode*this.node.height,r=a+this.node.height;if(this.invert){var s=this.minNodeWidth;i&&(s=i.width),n.push([-s/2,a]),n.push([s/2,a]),n.push([t.width/2,r]),n.push([-t.width/2,r])}else{n.push([-t.width/2,a]),n.push([t.width/2,a]);var o=this.minNodeWidth;e&&(o=e.width),n.push([o/2,r]),n.push([-o/2,r])}return n}},{key:"_drawGraphs",value:function(){var t=this;o.each(this.data,function(e){var i=new on({context:{pointList:e.points,fillStyle:e.color,cursor:e.cursor}});t.sprite.addChild(i),i.nodeData=e,i.on($.get(),function(e){e.eventInfo={title:t.field,nodes:[this.nodeData]},t.app.fire(e.type,e),t.triggerEvent(t.node,e)});var n="center",a={x:e.middlePoint.x,y:e.middlePoint.y};"left"==t.label.align&&(a.x=e.points[0][0]-(e.points[0][0]-e.points[3][0])/2,a.x-=15,n="right"),"right"==t.label.align&&(a.x=e.points[1][0]-(e.points[1][0]-e.points[2][0])/2,a.x+=15,n="left");var r=new sn(e.label,{context:{x:a.x,y:a.y,fontSize:t.label.fontSize,fillStyle:"center"==t.label.align?t.label.fontColor:e.color,textAlign:n,textBaseline:t.label.textBaseline}});t.sprite.addChild(r)})}}]),e}();function hn(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=0;return e}function un(t,e){return hn(t).map(function(){return hn(e)})}function dn(t,e){for(var i=0,n=0;n<t.length;++n)i+=t[n]*e[n];return i}function cn(t){return Math.sqrt(dn(t,t))}function fn(t,e,i){for(var n=0;n<e.length;++n)t[n]=e[n]*i}function pn(t,e,i,n,a){for(var r=0;r<t.length;++r)t[r]=e*i[r]+n*a[r]}function gn(t,e,i){var n,a=(i=i||{}).maxIterations||200*e.length,r=i.nonZeroDelta||1.05,s=i.zeroDelta||.001,o=i.minErrorDelta||1e-6,l=i.minErrorDelta||1e-5,h=void 0!==i.rho?i.rho:1,u=void 0!==i.chi?i.chi:2,d=void 0!==i.psi?i.psi:-.5,c=void 0!==i.sigma?i.sigma:.5,f=e.length,p=new Array(f+1);p[0]=e,p[0].fx=t(e),p[0].id=0;for(var g=0;g<f;++g){var v=e.slice();v[g]=v[g]?v[g]*r:s,p[g+1]=v,p[g+1].fx=t(v),p[g+1].id=g+1}function y(t){for(var e=0;e<t.length;e++)p[f][e]=t[e];p[f].fx=t.fx}for(var x=function(t,e){return t.fx-e.fx},_=e.slice(),m=e.slice(),b=e.slice(),k=e.slice(),w=0;w<a;++w){if(p.sort(x),i.history){var S=p.map(function(t){var e=t.slice();return e.fx=t.fx,e.id=t.id,e});S.sort(function(t,e){return t.id-e.id}),i.history.push({x:p[0].slice(),fx:p[0].fx,simplex:S})}for(n=0,g=0;g<f;++g)n=Math.max(n,Math.abs(p[0][g]-p[1][g]));if(Math.abs(p[0].fx-p[f].fx)<o&&n<l)break;for(g=0;g<f;++g){_[g]=0;for(var A=0;A<f;++A)_[g]+=p[A][g];_[g]/=f}var C=p[f];if(pn(m,1+h,_,-h,C),m.fx=t(m),m.fx<p[0].fx)pn(k,1+u,_,-u,C),k.fx=t(k),k.fx<m.fx?y(k):y(m);else if(m.fx>=p[f-1].fx){var P=!1;if(m.fx>C.fx?(pn(b,1+d,_,-d,C),b.fx=t(b),b.fx<C.fx?y(b):P=!0):(pn(b,1-d*h,_,d*h,C),b.fx=t(b),b.fx<m.fx?y(b):P=!0),P){if(c>=1)break;for(g=1;g<p.length;++g)pn(p[g],1-c,p[0],c,p[g]),p[g].fx=t(p[g])}}else y(m)}return p.sort(x),{fx:p[0].fx,x:p[0]}}function vn(t,e,i,n,a,r,s){var o=i.fx,l=dn(i.fxprime,e),h=o,u=o,d=l,c=0;function f(u,c,f){for(var p=0;p<16;++p)if(a=(u+c)/2,pn(n.x,1,i.x,a,e),h=n.fx=t(n.x,n.fxprime),d=dn(n.fxprime,e),h>o+r*a*l||h>=f)c=a;else{if(Math.abs(d)<=-s*l)return a;d*(c-u)>=0&&(c=u),u=a,f=h}return 0}a=a||1,r=r||1e-6,s=s||.1;for(var p=0;p<10;++p){if(pn(n.x,1,i.x,a,e),h=n.fx=t(n.x,n.fxprime),d=dn(n.fxprime,e),h>o+r*a*l||p&&h>=u)return f(c,a,u);if(Math.abs(d)<=-s*l)return a;if(d>=0)return f(a,c,h);u=h,c=a,a*=2}return a}function yn(t,e,i){var n,a,r,s={x:e.slice(),fx:0,fxprime:e.slice()},o={x:e.slice(),fx:0,fxprime:e.slice()},l=e.slice(),h=1;r=(i=i||{}).maxIterations||20*e.length,s.fx=t(s.x,s.fxprime),fn(n=s.fxprime.slice(),s.fxprime,-1);for(var u=0;u<r;++u){if(h=vn(t,n,s,o,h),i.history&&i.history.push({x:s.x.slice(),fx:s.fx,fxprime:s.fxprime.slice(),alpha:h}),h){pn(l,1,o.fxprime,-1,s.fxprime);var d=dn(s.fxprime,s.fxprime);pn(n,Math.max(0,dn(l,o.fxprime)/d),n,-1,o.fxprime),a=s,s=o,o=a}else fn(n,s.fxprime,-1);if(cn(s.fxprime)<=1e-5)break}return i.history&&i.history.push({x:s.x.slice(),fx:s.fx,fxprime:s.fxprime.slice(),alpha:h}),s}var xn=1e-10;function _n(t,e){var i,n=function(t){for(var e=[],i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n)for(var a=wn(t[i],t[n]),r=0;r<a.length;++r){var s=a[r];s.parentIndex=[i,n],e.push(s)}return e}(t),a=n.filter(function(e){return function(t,e){for(var i=0;i<e.length;++i)if(bn(t,e[i])>e[i].radius+xn)return!1;return!0}(e,t)}),r=0,s=0,o=[];if(a.length>1){var l=Sn(a);for(i=0;i<a.length;++i){var h=a[i];h.angle=Math.atan2(h.x-l.x,h.y-l.y)}a.sort(function(t,e){return e.angle-t.angle});var u=a[a.length-1];for(i=0;i<a.length;++i){var d=a[i];s+=(u.x+d.x)*(d.y-u.y);for(var c={x:(d.x+u.x)/2,y:(d.y+u.y)/2},f=null,p=0;p<d.parentIndex.length;++p)if(u.parentIndex.indexOf(d.parentIndex[p])>-1){var g=t[d.parentIndex[p]],v=Math.atan2(d.x-g.x,d.y-g.y),y=Math.atan2(u.x-g.x,u.y-g.y),x=y-v;x<0&&(x+=2*Math.PI);var _=y-x/2,m=bn(c,{x:g.x+g.radius*Math.sin(_),y:g.y+g.radius*Math.cos(_)});m>2*g.radius&&(m=2*g.radius),(null===f||f.width>m)&&(f={circle:g,width:m,p1:d,p2:u})}null!==f&&(o.push(f),r+=mn(f.circle.radius,f.width),u=d)}}else{var b=t[0];for(i=1;i<t.length;++i)t[i].radius<b.radius&&(b=t[i]);var k=!1;for(i=0;i<t.length;++i)if(bn(t[i],b)>Math.abs(b.radius-t[i].radius)){k=!0;break}k?r=s=0:(r=b.radius*b.radius*Math.PI,o.push({circle:b,p1:{x:b.x,y:b.y+b.radius},p2:{x:b.x-xn,y:b.y+b.radius},width:2*b.radius}))}return s/=2,e&&(e.area=r+s,e.arcArea=r,e.polygonArea=s,e.arcs=o,e.innerPoints=a,e.intersectionPoints=n),r+s}function mn(t,e){return t*t*Math.acos(1-e/t)-(t-e)*Math.sqrt(e*(2*t-e))}function bn(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function kn(t,e,i){if(i>=t+e)return 0;if(i<=Math.abs(t-e))return Math.PI*Math.min(t,e)*Math.min(t,e);var n=e-(i*i-t*t+e*e)/(2*i);return mn(t,t-(i*i-e*e+t*t)/(2*i))+mn(e,n)}function wn(t,e){var i=bn(t,e),n=t.radius,a=e.radius;if(i>=n+a||i<=Math.abs(n-a))return[];var r=(n*n-a*a+i*i)/(2*i),s=Math.sqrt(n*n-r*r),o=t.x+r*(e.x-t.x)/i,l=t.y+r*(e.y-t.y)/i,h=-(e.y-t.y)*(s/i),u=-(e.x-t.x)*(s/i);return[{x:o+h,y:l-u},{x:o-h,y:l+u}]}function Sn(t){for(var e={x:0,y:0},i=0;i<t.length;++i)e.x+=t[i].x,e.y+=t[i].y;return e.x/=t.length,e.y/=t.length,e}function An(t,e){(e=e||{}).maxIterations=e.maxIterations||500;var i,n=e.initialLayout||Tn,a=e.lossFunction||Ln,r=n(t=function(t){t=t.slice();var e,i,n,a,r=[],s={};for(e=0;e<t.length;++e){var o=t[e];1==o.sets.length?r.push(o.sets[0]):2==o.sets.length&&(n=o.sets[0],a=o.sets[1],s[[n,a]]=!0,s[[a,n]]=!0)}for(r.sort(function(t,e){return t>e}),e=0;e<r.length;++e)for(n=r[e],i=e+1;i<r.length;++i)a=r[i],[n,a]in s||t.push({sets:[n,a],size:0});return t}(t),e),s=[],o=[];for(i in r)r.hasOwnProperty(i)&&(s.push(r[i].x),s.push(r[i].y),o.push(i));for(var l=gn(function(e){for(var i={},n=0;n<o.length;++n){var s=o[n];i[s]={x:e[2*n],y:e[2*n+1],radius:r[s].radius}}return a(i,t)},s,e).x,h=0;h<o.length;++h)i=o[h],r[i].x=l[2*h],r[i].y=l[2*h+1];return r}var Cn=1e-10;function Pn(t,e,i){return Math.min(t,e)*Math.min(t,e)*Math.PI<=i+Cn?Math.abs(t-e):function(t,e,i,n){var a=(n=n||{}).maxIterations||100,r=n.tolerance||1e-10,s=t(e),o=t(i),l=i-e;if(s*o>0)throw"Initial bisect points must have opposite signs";if(0===s)return e;if(0===o)return i;for(var h=0;h<a;++h){var u=e+(l/=2),d=t(u);if(d*s>=0&&(e=u),Math.abs(l)<r||0===d)return u}return e+l}(function(n){return kn(t,e,n)-i},0,t+e)}function Tn(t,e){var i=function(t,e){for(var i,n=e&&e.lossFunction?e.lossFunction:Ln,a={},r={},s=0;s<t.length;++s){var o=t[s];1==o.sets.length&&(i=o.sets[0],a[i]={x:1e10,y:1e10,rowid:a.length,size:o.size,radius:Math.sqrt(o.size/Math.PI)},r[i]=[])}for(t=t.filter(function(t){return 2==t.sets.length}),s=0;s<t.length;++s){var l=t[s],h=l.hasOwnProperty("weight")?l.weight:1,u=l.sets[0],d=l.sets[1];l.size+Cn>=Math.min(a[u].size,a[d].size)&&(h=0),r[u].push({set:d,size:l.size,weight:h}),r[d].push({set:u,size:l.size,weight:h})}var c=[];for(i in r)if(r.hasOwnProperty(i)){var f=0;for(s=0;s<r[i].length;++s)f+=r[i][s].size*r[i][s].weight;c.push({set:i,size:f})}function p(t,e){return e.size-t.size}c.sort(p);var g={};function v(t){return t.set in g}function y(t,e){a[e].x=t.x,a[e].y=t.y,g[e]=!0}for(y({x:0,y:0},c[0].set),s=1;s<c.length;++s){var x=c[s].set,_=r[x].filter(v);if(i=a[x],_.sort(p),0===_.length)throw"ERROR: missing pairwise overlap information";for(var m=[],b=0;b<_.length;++b){var k=a[_[b].set],w=Pn(i.radius,k.radius,_[b].size);m.push({x:k.x+w,y:k.y}),m.push({x:k.x-w,y:k.y}),m.push({y:k.y+w,x:k.x}),m.push({y:k.y-w,x:k.x});for(var S=b+1;S<_.length;++S)for(var A=a[_[S].set],C=Pn(i.radius,A.radius,_[S].size),P=wn({x:k.x,y:k.y,radius:w},{x:A.x,y:A.y,radius:C}),T=0;T<P.length;++T)m.push(P[T])}var L=1e50,O=m[0];for(b=0;b<m.length;++b){a[x].x=m[b].x,a[x].y=m[b].y;var D=n(a,t);D<L&&(L=D,O=m[b])}y(O,x)}return a}(t,e),n=e.lossFunction||Ln;if(t.length>=8){var a=function(t,e){var i,n=(e=e||{}).restarts||10,a=[],r={};for(i=0;i<t.length;++i){var s=t[i];1==s.sets.length&&(r[s.sets[0]]=a.length,a.push(s))}var o=function(t,e,i){var n=un(e.length,e.length),a=un(e.length,e.length);return t.filter(function(t){return 2==t.sets.length}).map(function(t){var r=i[t.sets[0]],s=i[t.sets[1]],o=Pn(Math.sqrt(e[r].size/Math.PI),Math.sqrt(e[s].size/Math.PI),t.size);n[r][s]=n[s][r]=o;var l=0;t.size+1e-10>=Math.min(e[r].size,e[s].size)?l=1:t.size<=1e-10&&(l=-1),a[r][s]=a[s][r]=l}),{distances:n,constraints:a}}(t,a,r),l=o.distances,h=o.constraints,u=cn(l.map(cn))/l.length;l=l.map(function(t){return t.map(function(t){return t/u})});var d,c,f=function(t,e){return function(t,e,i,n){var a,r=0;for(a=0;a<e.length;++a)e[a]=0;for(a=0;a<i.length;++a)for(var s=t[2*a],o=t[2*a+1],l=a+1;l<i.length;++l){var h=t[2*l],u=t[2*l+1],d=i[a][l],c=n[a][l],f=(h-s)*(h-s)+(u-o)*(u-o),p=Math.sqrt(f),g=f-d*d;c>0&&p<=d||c<0&&p>=d||(r+=2*g*g,e[2*a]+=4*g*(s-h),e[2*a+1]+=4*g*(o-u),e[2*l]+=4*g*(h-s),e[2*l+1]+=4*g*(u-o))}return r}(t,e,l,h)};for(i=0;i<n;++i){var p=hn(2*l.length).map(Math.random);c=yn(f,p,e),(!d||c.fx<d.fx)&&(d=c)}var g=d.x,v={};for(i=0;i<a.length;++i){var y=a[i];v[y.sets[0]]={x:g[2*i]*u,y:g[2*i+1]*u,radius:Math.sqrt(y.size/Math.PI)}}if(e.history)for(i=0;i<e.history.length;++i)fn(e.history[i].x,u);return v}(t,e);n(a,t)+1e-8<n(i,t)&&(i=a)}return i}function Ln(t,e){var i=0;for(var n=0;n<e.length;++n){var a,r=e[n];if(1!=r.sets.length){if(2==r.sets.length){var s=t[r.sets[0]],o=t[r.sets[1]];a=kn(s.radius,o.radius,bn(s,o))}else a=_n(r.sets.map(function(e){return t[e]}));i+=(r.hasOwnProperty("weight")?r.weight:1)*(a-r.size)*(a-r.size)}}return i}function On(t,e,i){var n;if(null===i?t.sort(function(t,e){return e.radius-t.radius}):t.sort(i),t.length>0){var a=t[0].x,r=t[0].y;for(n=0;n<t.length;++n)t[n].x-=a,t[n].y-=r}2==t.length&&(bn(t[0],t[1])<Math.abs(t[1].radius-t[0].radius)&&(t[1].x=t[0].x+t[0].radius-t[1].radius-1e-10,t[1].y=t[0].y));if(t.length>1){var s,o,l=Math.atan2(t[1].x,t[1].y)-e,h=Math.cos(l),u=Math.sin(l);for(n=0;n<t.length;++n)s=t[n].x,o=t[n].y,t[n].x=h*s-u*o,t[n].y=u*s+h*o}if(t.length>2){for(var d=Math.atan2(t[2].x,t[2].y)-e;d<0;)d+=2*Math.PI;for(;d>2*Math.PI;)d-=2*Math.PI;if(d>Math.PI){var c=t[1].y/(1e-10+t[1].x);for(n=0;n<t.length;++n){var f=(t[n].x+c*t[n].y)/(1+c*c);t[n].x=2*f-t[n].x,t[n].y=2*f*c-t[n].y}}}}function Dn(t){var e=function(e){return{max:Math.max.apply(null,t.map(function(t){return t[e]+t.radius})),min:Math.min.apply(null,t.map(function(t){return t[e]-t.radius}))}};return{xRange:e("x"),yRange:e("y")}}function Mn(t,e,i){null===e&&(e=Math.PI/2);var n,a,r=[];for(a in t)if(t.hasOwnProperty(a)){var s=t[a];r.push({x:s.x,y:s.y,radius:s.radius,setid:a})}var o=function(t){function e(t){return t.parent!==t&&(t.parent=e(t.parent)),t.parent}t.map(function(t){t.parent=t});for(var i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n){var a=t[i].radius+t[n].radius;bn(t[i],t[n])+1e-10<a&&(r=t[n],s=t[i],o=void 0,o=e(r),l=e(s),o.parent=l)}var r,s,o,l,h,u={};for(i=0;i<t.length;++i)(h=e(t[i]).parent.setid)in u||(u[h]=[]),u[h].push(t[i]);t.map(function(t){delete t.parent});var d=[];for(h in u)u.hasOwnProperty(h)&&d.push(u[h]);return d}(r);for(n=0;n<o.length;++n){On(o[n],e,i);var l=Dn(o[n]);o[n].size=(l.xRange.max-l.xRange.min)*(l.yRange.max-l.yRange.min),o[n].bounds=l}o.sort(function(t,e){return e.size-t.size});var h=(r=o[0]).bounds,u=(h.xRange.max-h.xRange.min)/50;function d(t,e,i){if(t){var n,a,s,o=t.bounds;e?n=h.xRange.max-o.xRange.min+u:(n=h.xRange.max-o.xRange.max,(s=(o.xRange.max-o.xRange.min)/2-(h.xRange.max-h.xRange.min)/2)<0&&(n+=s)),i?a=h.yRange.max-o.yRange.min+u:(a=h.yRange.max-o.yRange.max,(s=(o.yRange.max-o.yRange.min)/2-(h.yRange.max-h.yRange.min)/2)<0&&(a+=s));for(var l=0;l<t.length;++l)t[l].x+=n,t[l].y+=a,r.push(t[l])}}for(var c=1;c<o.length;)d(o[c],!0,!1),d(o[c+1],!1,!0),d(o[c+2],!0,!0),c+=3,h=Dn(r);var f={};for(n=0;n<r.length;++n)f[r[n].setid]=r[n];return f}var In=Be.Display.Text,Rn=Be.Shapes.Path,Fn=Be.Shapes.Circle,En=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="venn",a.keyField=null,a.valueField=null,a.node={strokeStyle:null,lineWidth:2,lineAlpha:0,fillStyle:null,fillAlpha:.25,focus:{enabled:!0,lineAlpha:.3},select:{enabled:!0,lineWidth:2,strokeStyle:"#666"}},a.label={field:null,fontSize:14,fontColor:null,fontWeight:"normal",showInter:!0},a.vennData=null,o.extend(!0,a,t),a._dataCircleLen=0,a._dataLabelLen=0,a._dataPathLen=0,a.init(),a}return r(e,si),n(e,[{key:"init",value:function(){this.venn_circles=new Be.Display.Sprite({id:"venn_circles"}),this.sprite.addChild(this.venn_circles),this.venn_paths=new Be.Display.Sprite({id:"venn_paths"}),this.sprite.addChild(this.venn_paths),this.venn_labels=new Be.Display.Sprite({id:"venn_labels"}),this.sprite.addChild(this.venn_labels)}},{key:"draw",value:function(t){!t&&(t={}),o.extend(!0,this,t),this.data=this._trimGraphs(),this._widget(),this.sprite.context.x=this.app.padding.left,this.sprite.context.y=this.app.padding.top,this.fire("complete")}},{key:"resetData",value:function(t,e){this.dataFrame=t,this.data=this._trimGraphs(),this._widget()}},{key:"_trimGraphs",value:function(){var t=this,e=t._vennData(),i=An,n=Ln,a=Math.PI/2,r={},s={};if(this._dataCircleLen=0,this._dataLabelLen=0,this._dataPathLen=0,e.length>0){var l=i(e,{lossFunction:n});l=Mn(l,a,null),r=function(t,e,i,n){var a=[],r=[];for(var s in t)t.hasOwnProperty(s)&&(r.push(s),a.push(t[s]));e-=2*n,i-=2*n;var o=Dn(a),l=o.xRange,h=o.yRange;if(l.max==l.min||h.max==h.min)return console.log("not scaling solution: zero size detected"),t;for(var u=e/(l.max-l.min),d=i/(h.max-h.min),c=Math.min(d,u),f=(e-(l.max-l.min)*c)/2,p=(i-(h.max-h.min)*c)/2,g={},v=0;v<a.length;++v){var y=a[v];g[r[v]]={radius:c*y.radius,x:n+f+(y.x-l.min)*c,y:n+p+(y.y-h.min)*c}}return g}(l,this.width,this.height,0),s=function(t,e){for(var i={},n=function(t){var e={},i=[];for(var n in t)i.push(n),e[n]=[];for(var a=0;a<i.length;a++)for(var r=t[i[a]],s=a+1;s<i.length;++s){var o=t[i[s]],l=bn(r,o);l+o.radius<=r.radius+1e-10?e[i[s]].push(i[a]):l+r.radius<=o.radius+1e-10&&e[i[a]].push(i[s])}return e}(t),a=0;a<e.length;++a){for(var r=e[a].sets,s={},o={},l=0;l<r.length;++l){s[r[l]]=!0;for(var h=n[r[l]],u=0;u<h.length;++u)o[h[u]]=!0}var d=[],c=[];for(var f in t)f in s?d.push(t[f]):f in o||c.push(t[f]);var p=Wn(d,c);i[r]=p,p.disjoint&&e[a].size>0&&console.log("WARNING: area "+r+" not represented on screen")}return i}(r,e)}var h=0,u=0;return o.each(e,function(e,i){if(e.label&&(e.sets.length>1&&!t.label.showInter||(e.labelPosition=s[e.nodeId],t._dataLabelLen++)),e.sets.length>1){var n=function(t){var e={};_n(t,e);var i=e.arcs;if(0===i.length)return"M 0 0";if(1==i.length){var n=i[0].circle;return function(t,e,i){var n=[];return n.push("\nM",t,e),n.push("\nm",-i,0),n.push("\na",i,i,0,1,0,2*i,0),n.push("\na",i,i,0,1,0,2*-i,0),n.join(" ")}(n.x,n.y,n.radius)}for(var a=["\nM",i[0].p2.x,i[0].p2.y],r=0;r<i.length;++r){var s=i[r],o=s.circle.radius,l=s.width>o;a.push("\nA",o,o,0,l?1:0,1,s.p1.x,s.p1.y)}return a.join(" ")+" z"}(e.sets.map(function(t){return r[t]}));e.shape={type:"path",path:n,pathInd:u++},t._dataPathLen++}else 1==e.sets.length&&(e.shape=o.extend({type:"circle",circleInd:h++},r[e.nodeId]),t._dataCircleLen++)}),e}},{key:"_vennData",value:function(){for(var t=[],e=0,i=this.dataFrame.length;e<i;e++){var n=this.dataFrame.getRowDataAt(e),a={iNode:e,nodeId:null,rowData:n,sets:null,size:null,value:null,fillStyle:null,strokeStyle:null,label:null,labelPosition:null};for(var r in n){var s=n[r];r==this.keyField?(o.isArray(s)||(s=s.split(/[,|]/)),a.sets=s,a.nodeId=s.join()):r==this.valueField?(a.size=s,a.value=s):r==this.label.field&&(a.label=s)}t.push(a)}return t}},{key:"_getStyle",value:function(t,e,i,n){var a;return o.isString(t)&&(a=t),o.isFunction(t)&&(a=t(i)),a||void 0==e||(a=this.app.getTheme(e)),a||void 0==n||(a=n),a}},{key:"_widget",value:function(){var t=this;if(t.venn_circles.children.length>t._dataCircleLen)for(var e=t._dataCircleLen;e<t.venn_circles.children.length;e++)t.venn_circles.getChildAt(e--).destroy();if(t.venn_paths.children.length>t._dataPathLen)for(e=t._dataPathLen;e<t.venn_paths.children.length;e++)t.venn_paths.getChildAt(e--).destroy();if(t.venn_labels.children.length>t._dataLabelLen)for(e=t._dataLabelLen;e<t.venn_labels.children.length;e++)t.venn_labels.getChildAt(e--).destroy();var i=0,n=0,a=0;o.each(this.data,function(e,r){var s,o=e.shape,l=!0;if(o){var h;if("circle"==o.type){var u=t._getStyle(t.node.fillStyle,o.circleInd,e),d=t._getStyle(t.node.strokeStyle,o.circleInd,e);e.fillStyle=u,e.strokeStyle=d,h={x:o.x,y:o.y,r:o.radius,fillStyle:u,fillAlpha:t.node.fillAlpha,lineWidth:t.node.lineWidth,strokeStyle:d,lineAlpha:t.node.lineAlpha},(s=t.venn_circles.getChildAt(i++))?(l=!1,s.animate(h)):(s=new Fn({pointChkPriority:!1,hoverClone:!1,context:h}),t.venn_circles.addChild(s))}"path"==e.shape.type&&(h={path:o.path,fillStyle:"#ffffff",fillAlpha:0,lineWidth:t.node.lineWidth,strokeStyle:"#ffffff",lineAlpha:0},(s=t.venn_paths.getChildAt(n++))?(l=!1,s.context.path=o.path):(s=new Rn({pointChkPriority:!1,context:h}),t.venn_paths.addChild(s))),s.nodeData=e,e._node=s,t.node.focus.enabled&&s.hover(function(e){t.focusAt(this.nodeData.iNode)},function(e){!this.nodeData.selected&&t.unfocusAt(this.nodeData.iNode)}),l&&s.on($.get(),function(e){e.eventInfo={title:null,nodes:[this.nodeData]},t.app.fire(e.type,e),t.triggerEvent(t.node,e)})}if(e.label&&t.label.enabled){var c=t._getStyle(t.label.fontColor,o.circleInd,e,"#999"),f=t.label.fontSize;if(e.sets.length>1&&(t.label.showInter?f-=2:f=0),f){var p={x:e.labelPosition.x,y:e.labelPosition.y,fontSize:f,textBaseline:"middle",textAlign:"center",fontWeight:t.label.fontWeight,fillStyle:c},g=t.venn_labels.getChildAt(a++);g?(g.resetText(e.label),g.animate(p)):(g=new In(e.label,{context:p}),t.venn_labels.addChild(g))}}})}},{key:"focusAt",value:function(t){var e=this.data[t];if(this.node.focus.enabled&&!e.focused){var i=e._node.context;e.sets.length>1?i.lineAlpha=1:i.lineAlpha=this.node.focus.lineAlpha,e.focused=!0}}},{key:"unfocusAt",value:function(t){var e=this.data[t];this.node.focus.enabled&&e.focused&&(e._node.context.lineAlpha=this.node.lineAlpha,e.focused=!1)}},{key:"selectAt",value:function(t){var e=this.data[t];if(this.node.select.enabled&&!e.selected){var i=e._node.context;i.lineWidth=this.node.select.lineWidth,i.lineAlpha=this.node.select.lineAlpha,i.strokeStyle=this.node.select.strokeStyle,e.selected=!0}}},{key:"unselectAt",value:function(t){var e=this.data[t];this.node.select.enabled&&e.selected&&(e._node.context.strokeStyle=this.node.strokeStyle,e.selected=!1)}}]),e}();function Wn(t,e){var i,n=[];for(i=0;i<t.length;++i){var a=t[i];n.push({x:a.x,y:a.y}),n.push({x:a.x+a.radius/2,y:a.y}),n.push({x:a.x-a.radius/2,y:a.y}),n.push({x:a.x,y:a.y+a.radius/2}),n.push({x:a.x,y:a.y-a.radius/2})}var r=n[0],s=Nn(n[0],t,e);for(i=1;i<n.length;++i){var o=Nn(n[i],t,e);o>=s&&(r=n[i],s=o)}var l=gn(function(i){return-1*Nn({x:i[0],y:i[1]},t,e)},[r.x,r.y],{maxIterations:500,minErrorDelta:1e-10}).x,h={x:l[0],y:l[1]},u=!0;for(i=0;i<t.length;++i)if(bn(h,t[i])>t[i].radius){u=!1;break}for(i=0;i<e.length;++i)if(bn(h,e[i])<e[i].radius){u=!1;break}if(!u)if(1==t.length)h={x:t[0].x,y:t[0].y};else{var d={};_n(t,d),h=0===d.arcs.length?{x:0,y:-1e3,disjoint:!0}:1==d.arcs.length?{x:d.arcs[0].circle.x,y:d.arcs[0].circle.y}:e.length?Wn(t,[]):Sn(d.arcs.map(function(t){return t.p1}))}return h}function Nn(t,e,i){var n,a,r=e[0].radius-bn(e[0],t);for(n=1;n<e.length;++n)(a=e[n].radius-bn(e[n],t))<=r&&(r=a);for(n=0;n<i.length;++n)(a=bn(i[n],t)-i[n].radius)<=r&&(r=a);return r}function zn(t,e,i){return function(){var n=i.apply(e,arguments);return n===e?t:n}}var Gn={merge:function(t){for(var e,i,n,a=t.length,r=-1,s=0;++r<a;)s+=t[r].length;for(i=new Array(s);--a>=0;)for(e=(n=t[a]).length;--e>=0;)i[--s]=n[e];return i}},Bn=function(){var t=Yn,e=Hn,i=Vn;function n(a){var r,s=[a],o=[];for(a.depth=0;null!=(r=s.pop());)if(o.push(r),(h=e.call(n,r,r.depth))&&(l=h.length)){for(var l,h,u;--l>=0;)s.push(u=h[l]),u.parent=r,u.depth=r.depth+1;var d=+i.call(n,r,r.depth);d&&!isNaN(d)&&(r._value=d),i&&(r.value=0),r.children=h}else i&&(r.value=+i.call(n,r,r.depth)||0),delete r.children;return jn(a,function(e){var n,a;t&&(n=e.children)&&n.sort(t),i&&(a=e.parent)&&(a.value+=e.value),e._value&&e._value>e.value&&(e.value=e._value),delete e._value}),o}return n.sort=function(e){return arguments.length?(t=e,n):t},n.children=function(t){return arguments.length?(e=t,n):e},n.value=function(t){return arguments.length?(i=t,n):i},n.revalue=function(t){return i&&(!function(t,e){var i=[t];for(;null!=(t=i.pop());)if(e(t),(a=t.children)&&(n=a.length))for(var n,a;--n>=0;)i.push(a[n])}(t,function(t){t.children&&(t.value=0)}),jn(t,function(t){var e;t.children||(t.value=+i.call(n,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value),t._value&&t._value>t.value&&(t.value=t._value),delete t._value})),t},n};function jn(t,e){for(var i=[t],n=[];null!=(t=i.pop());)if(n.push(t),(r=t.children)&&(a=r.length))for(var a,r,s=-1;++s<a;)i.push(r[s]);for(;null!=(t=n.pop());)e(t)}function Hn(t){return t.children}function Vn(t){return t.value}function Yn(t,e){return e.value-t.value}function $n(t){return Gn.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function qn(){var t=Bn(),e=[1,1];function i(i,n){var a=t.call(this,i,n);return function t(e,i,n,a){var r=e.children;if(e.x=i,e.y=e.depth*a,e.dx=n,e.dy=a,r&&(s=r.length)){var s,o,l,h=-1;for(n=e.value?n/e.value:0;++h<s;)t(o=r[h],i,l=o.value*n,a),i+=l}}(a[0],0,e[0],e[1]/function t(e){var i=e.children,n=0;if(i&&(a=i.length))for(var a,r=-1;++r<a;)n=Math.max(n,t(i[r]));return 1+n}(a[0])),a}return i.size=function(t){return arguments.length?(e=t,i):e},Bn.layout_hierarchyRebind(i,t)}Bn.layout_hierarchyRebind=function(t,e){return function(t,e){for(var i,n=1,a=arguments.length;++n<a;)t[i=arguments[n]]=zn(t,e,e[i])}(t,e,"sort","children","value"),t.nodes=t,t.links=$n,t};var Xn=Be.Shapes.Sector,Un=(Be.Shapes.Circle,function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="sunburst",a.keyField="name",a.valueField="value",a.parentField="parent",a.node={strokeStyle:"#fff",lineWidth:1,lineAlpha:1,fillStyle:null,fillAlpha:1,blurAlpha:.4,focus:{enabled:!0,lineAlpha:1}},o.extend(!0,a,t),a.data=[],a.dataGroup=[],a.init(),a}return r(e,si),n(e,[{key:"init",value:function(){}},{key:"draw",value:function(t){!t&&(t={}),o.extend(!0,this,t),this.data=this._trimGraphs(),this.dataGroup=this._getDataGroupOfDepth(),this._widget(),this.sprite.context.x=this.width/2+this.origin.x,this.sprite.context.y=this.height/2+this.origin.y,this.fire("complete")}},{key:"_trimGraphs",value:function(){var t=this,e=parseInt(Math.min(this.width,this.height)/2),i=qn().sort(null).size([2*Math.PI,e*e]).value(function(e){return e[t.valueField]}),n=this._tansTreeData();return this.data=i(n,0),this.data}},{key:"_getDataGroupOfDepth",value:function(){var t={};o.each(this.data,function(e){t[e.depth]=[]}),o.each(this.data,function(e){t[e.depth].push(e)});var e=[];for(var i in t)e.push(t[i]);return e}},{key:"_tansTreeData",value:function(){var t=this.dataFrame,e={},i=t.getFieldData(this.keyField),n=t.getFieldData(this.valueField),a=t.getFieldData(this.parentField);return function t(e,r,s){for(var l=r?r.name:void 0,h=s||0;h<a.length;h++){var u=a[h];if(u||0===u||(u=void 0),l===u){e.name=i[h],e.iNode=h;var d=n[h];(d||0===d)&&(e.value=d),o.each(a,function(i,n){if(i===e.name){e.children||(e.children=[]);var a={};t(a,e,n),e.children.push(a)}});break}}}(e),e}},{key:"_widget",value:function(){var t=this;o.each(this.dataGroup,function(e,i){o.each(e,function(n,a){if(n.depth){var r=Math.sqrt(n.y+n.dy),s={r0:Math.sqrt(n.y),r:Math.sqrt(n.y)+2,startAngle:180*n.x/Math.PI,endAngle:180*(n.x+n.dx)/Math.PI,fillStyle:n.color||t.app.getTheme(n.iNode),strokeStyle:t.node.strokeStyle,lineWidth:t.node.lineWidth,globalAlpha:0},o=new Xn({id:"sector_"+i+"_"+a,context:s});o.layoutData=n,n.sector=o,n.group=e,t.sprite.addChild(o),o.hover(function(i){t._focus(n,e)},function(i){t._unfocus(n,e)}),o.on($.get(),function(e){e.eventInfo={iNode:n.iNode},t.app.fire(e.type,e),t.triggerEvent(t.node,e)}),i<=1?(o.context.r=r,o.context.globalAlpha=1):setTimeout(function(){o.context&&(o.context.globalAlpha=1,o.animate({r:r},{duration:350}))},350*(i-1))}})})}},{key:"getNodesAt",value:function(t){var e=[];if(void 0!==t){var i=o.find(this.data,function(e){return e.iNode==t});i&&e.push(i)}return e}},{key:"_focus",value:function(t,e){var i=this;o.each(e,function(e){e!==t&&(e.sector.context.globalAlpha=i.node.blurAlpha,i._focusChildren(e,function(t){t.sector.context.globalAlpha=i.node.blurAlpha}))}),i._focusParent(t)}},{key:"_unfocus",value:function(t,e){o.each(this.data,function(t){t.sector&&(t.sector.context.globalAlpha=1)})}},{key:"_focusChildren",value:function(t,e){var i=this;t.children&&t.children.length&&o.each(t.children,function(t){e(t),i._focusChildren(t,e)})}},{key:"_focusParent",value:function(t){var e=this;t.parent&&t.parent.sector&&t.parent.group&&o.each(t.parent.group,function(i){i===t.parent?(i.sector.context.globalAlpha=1,e._focusParent(t.parent)):i.sector.context.globalAlpha=e.node.blurAlpha})}}]),e}());function Zn(){var t={},e=24,i=8,n=[1,1],a=[],r=[];function s(t,e){var i,n=0,a=t.length,r=-1;if(1===arguments.length)for(;++r<a;)isNaN(i=+t[r])||(n+=i);else for(;++r<a;)isNaN(i=+e.call(t,t[r],r))||(n+=i);return n}t.nodeWidth=function(i){return arguments.length?(e=+i,t):e},t.nodePadding=function(e){return arguments.length?(i=+e,t):i},t.nodes=function(e){return arguments.length?(a=e,t):a},t.links=function(e){return arguments.length?(r=e,t):r},t.size=function(e){return arguments.length?(n=e,t):n},t.layout=function(l){return a.forEach(function(t){t.sourceLinks=[],t.targetLinks=[]}),r.forEach(function(t){var e=t.source,i=t.target;"number"==typeof e&&(e=t.source=a[t.source]),"number"==typeof i&&(i=t.target=a[t.target]),e.sourceLinks.push(t),i.targetLinks.push(t)}),a.forEach(function(t){t.value=Math.max(s(t.sourceLinks,y),s(t.targetLinks,y))}),function(){var t,i=a,r=0;for(;i.length;)t=[],i.forEach(function(i){i.x=r,i.dx=e,i.sourceLinks.forEach(function(e){t.indexOf(e.target)<0&&t.push(e.target)})}),i=t,++r;(function(t){a.forEach(function(e){e.sourceLinks.length||(e.x=t-1)})})(r),s=(n[0]-e)/(r-1),a.forEach(function(t){t.x*=s});var s}(),function(t){var e=o().key(function(t){return t.x}).sortKeys(p).entries(a).map(function(t){return t.values});l=function(t,e){var i,n,a=-1,r=t.length;if(1===arguments.length){for(;++a<r&&(null==(i=t[a])||i!=i);)i=void 0;for(;++a<r;)null!=(n=t[a])&&i>n&&(i=n)}else{for(;++a<r&&(null==(i=e.call(t,t[a],a))||i!=i);)i=void 0;for(;++a<r;)null!=(n=e.call(t,t[a],a))&&i>n&&(i=n)}return i}(e,function(t){return(n[1]-(t.length-1)*i)/s(t,y)}),e.forEach(function(t){t.forEach(function(t,e){t.y=e,t.dy=t.value*l})}),r.forEach(function(t){t.dy=t.value*l}),c();var l;for(var h=1;t>0;--t)d(h*=.99),c(),u(h),c();function u(t){function i(t){return v(t.source)*t.value}e.forEach(function(e,n){e.forEach(function(e){if(e.targetLinks.length){var n=s(e.targetLinks,i)/s(e.targetLinks,y);e.y+=(n-v(e))*t}})})}function d(t){function i(t){return v(t.target)*t.value}e.slice().reverse().forEach(function(e){e.forEach(function(e){if(e.sourceLinks.length){var n=s(e.sourceLinks,i)/s(e.sourceLinks,y);e.y+=(n-v(e))*t}})})}function c(){e.forEach(function(t){var e,a,r,s=0,o=t.length;for(t.sort(f),r=0;r<o;++r)e=t[r],(a=s-e.y)>0&&(e.y+=a),s=e.y+e.dy+i;if((a=s-i-n[1])>0)for(s=e.y-=a,r=o-2;r>=0;--r)e=t[r],(a=e.y+e.dy+i-s)>0&&(e.y-=a),s=e.y})}function f(t,e){return t.y-e.y}}(l),g(),t},t.relayout=function(){return g(),t},t.link=function(){var t=.5;function e(e){var i,n,a=e.source.x+e.source.dx,r=e.target.x,s=(i=+(i=a),n=+(n=r),function(t){return i*(1-t)+n*t}),o=s(t),l=s(1-t),h=e.source.y+e.sy,u=e.target.y+e.ty,d=e.dy;d<1&&(d=1);var c="M"+a+","+h+"C"+o+","+h+" "+l+","+u+" "+r+","+u;return c+="v"+d,c+="C"+l+","+(u+d)+" "+o+","+(h+d)+" "+a+","+(h+d),c+="v"+-d+"z"}return e.curvature=function(i){return arguments.length?(t=+i,e):t},e};var o=function(){var t,e,i={},n=[],a=[];function r(a,s,o){if(o>=n.length)return e?e.call(i,s):t?s.sort(t):s;for(var l,u,d,c,f=-1,p=s.length,g=n[o++],v=new h;++f<p;)(c=v.get(l=g(u=s[f])))?c.push(u):v.set(l,[u]);return a?(u=a(),d=function(t,e){u.set(t,r(a,e,o))}):(u={},d=function(t,e){u[t]=r(a,e,o)}),v.forEach(d),u}return i.map=function(t,e){return r(e,t,0)},i.entries=function(t){return function t(e,i){if(i>=n.length)return e;var r=[],s=a[i++];return e.forEach(function(e,n){r.push({key:e,values:t(n,i)})}),s?r.sort(function(t,e){return s(t.key,e.key)}):r}(r(l,t,0),0)},i.key=function(t){return n.push(t),i},i.sortKeys=function(t){return a[n.length-1]=t,i},i.sortValues=function(e){return t=e,i},i.rollup=function(t){return e=t,i},i},l=function(t,e){var i=new h;if(t instanceof h)t.forEach(function(t,e){i.set(t,e)});else if(Array.isArray(t)){var n,a=-1,r=t.length;if(1===arguments.length)for(;++a<r;)i.set(a,t[a]);else for(;++a<r;)i.set(e.call(t,n=t[a],a),n)}else for(var s in t)i.set(s,t[s]);return i};function h(){this._=Object.create(null)}var u="__proto__",d="\0";function c(t){return(t+="")===u||t[0]===d?d+t:t}function f(t){return(t+="")[0]===d?t.slice(1):t}function p(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function g(){function t(t,e){return t.source.y-e.source.y}function e(t,e){return t.target.y-e.target.y}a.forEach(function(i){i.sourceLinks.sort(e),i.targetLinks.sort(t)}),a.forEach(function(t){var e=0,i=0;t.sourceLinks.forEach(function(t){t.sy=e,e+=t.dy}),t.targetLinks.forEach(function(t){t.ty=i,i+=t.dy})})}function v(t){return t.y+t.dy/2}function y(t){return t.value}return function(t,e){if(Object.defineProperty)for(var i in e)Object.defineProperty(t.prototype,i,{value:e[i],enumerable:!1});else _.extend(t.prototype,e)}(h,{has:function(t){return c(t)in this._},get:function(t){return this._[c(t)]},set:function(t,e){return this._[c(t)]=e},remove:function(t){return(t=c(t))in this._&&delete this._[t]},keys:function(){var t=[];for(var e in this._)t.push(f(e));return t},values:function(){var t=[];for(var e in this._)t.push(this._[e]);return t},entries:function(){var t=[];for(var e in this._)t.push({key:f(e),value:this._[e]});return t},size:function(){var t=0;for(var e in this._)++t;return t},empty:function(){for(var t in this._)return!1;return!0},forEach:function(t){for(var e in this._)t.call(this,f(e),this._[e])}}),t}var Qn=Be.Shapes.Path,Jn=Be.Shapes.Rect,Kn=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.type="sankey",a.keyField=null,a.valueField="value",a.parentField=null,a.node={width:18,padding:10,fillStyle:null,fillAlpha:1,blurAlpha:.4,focus:{enabled:!0,lineAlpha:1}},a.line={strokeStyle:"blue",lineWidth:1,lineAlpha:1,blurAlpha:.4,focus:{enabled:!0,lineAlpha:1}},a.label={fontColor:"#666",fontSize:12,align:"left",verticalAlign:"middle",position:"right",offsetX:0,offsetY:0},o.extend(!0,a,t),a.init(),a}return r(e,si),n(e,[{key:"init",value:function(){this._links=new Be.Display.Sprite,this._nodes=new Be.Display.Sprite,this._labels=new Be.Display.Sprite,this.sprite.addChild(this._links),this.sprite.addChild(this._nodes),this.sprite.addChild(this._labels)}},{key:"draw",value:function(t){!t&&(t={}),o.extend(!0,this,t),this.data=this._trimGraphs(),this._widget(),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this.fire("complete")}},{key:"_trimGraphs",value:function(){var t=this,e=[],i=[],n=t.dataFrame.getFieldData(t.keyField),a=t.dataFrame.getFieldData(t.valueField),r=t.dataFrame.getFieldData(t.parentField),s={};return o.each(n,function(i,n){var a=[];t.parentField&&a.push(r[n]),a=a.concat(i.split(/[,|]/)),o.each(a,function(t){void 0===s[t]&&(s[t]=e.length,e.push({name:t}))})}),o.each(n,function(e,n){var o=[];t.parentField&&o.push(r[n]),2==(o=o.concat(e.split(/[,|]/))).length&&i.push({source:s[o[0]],target:s[o[1]],value:a[n]})}),Zn().nodeWidth(this.node.width).nodePadding(this.node.padding).size([this.width,this.height]).nodes(e).links(i).layout(16)}},{key:"_widget",value:function(){this._drawNodes(),this._drawLinks(),this._drawLabels()}},{key:"_getColor",value:function(t,e,i){var n=t;return o.isArray(n)&&(n=n[i]),o.isFunction(n)&&(n=n(e)),n||(n=this.app.getTheme(i)),n}},{key:"_drawNodes",value:function(){var t=this.data.nodes(),e=this;o.each(t,function(t,i){var n=e._getColor(e.node.fillStyle,t,i),a=new Jn({xyToInt:!1,context:{x:t.x,y:t.y,width:e.data.nodeWidth(),height:Math.max(t.dy,1),fillStyle:n}});a.data=t,e._nodes.addChild(a)})}},{key:"_drawLinks",value:function(){var t=this.data.links(),e=this;o.each(t,function(t,i){var n=e._getColor(e.line.strokeStyle,t,i),a=e.data.link()(t),r=new Qn({xyToInt:!1,context:{path:a,fillStyle:n,globalAlpha:.3,cursor:"pointer"}});r.link=t,r.on($.get(),function(t){"mouseover"==t.type&&(this.context.globalAlpha+=.2),"mouseout"==t.type&&(this.context.globalAlpha-=.2);var i=this.link;t.eventInfo={title:i.source.name+" --<span style='position:relative;top:-0.5px;font-size:16px;left:-3px;'>></span> "+i.target.name,nodes:[i]},e.app.fire(t.type,t),e.triggerEvent(e.node,t)}),e._links.addChild(r)})}},{key:"_drawLabels",value:function(){var t=this.data.nodes(),e=this;o.each(t,function(t){var i=e.label.align,n=t.x+e.data.nodeWidth()+4,a=t.y+Math.max(t.dy/2,1),r=new Be.Display.Text(t.name,{context:{x:n,y:a,fillStyle:e.label.fontColor,fontSize:e.label.fontSize,textAlign:i,textBaseline:e.label.verticalAlign}});e._labels.addChild(r),r.getTextWidth()+n>e.width&&(r.context.x=t.x-4,r.context.textAlign="right")})}}]),e}(),ta=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,t),this.comp=e,this.params=n},ea=Be.Shapes.Circle,ia=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="legend",a.data=a._getLegendData(t),a.field=null,a.icon={height:26,width:"auto",shapeType:"circle",radius:5,lineWidth:1,fillStyle:"#999",onChecked:function(){},onUnChecked:function(){}},a.label={textAlign:"left",textBaseline:"middle",fillStyle:"#333",cursor:"pointer",format:function(t,e){return t}},a._labelColor="#999",a.position="top",a.direction="h",o.extend(!0,a,{icon:{onChecked:function(t){n.show(t.name,new ta(this,t))},onUnChecked:function(t){n.hide(t.name,new ta(this,t))}}},t),!t.direction&&t.position&&("left"==a.position||"right"==a.position?a.direction="v":a.direction="h"),a.sprite=new Be.Display.Sprite({id:"LegendSprite",context:{x:a.pos.x,y:a.pos.y}}),a.app.stage.addChild(a.sprite),a.widget(),a.layout(),a}return r(e,He),n(e,[{key:"_getLegendData",value:function(t){var e=t.data;return e?(o.each(e,function(t,e){t.enabled=!0,t.ind=e}),delete t.data):e=this.app.getLegendData(),e||[]}},{key:"layout",value:function(){var t=this.app;"h"==this.direction?t.padding[this.position]+=this.height+this.margin.top+this.margin.bottom:t.padding[this.position]+=this.width+this.margin.left+this.margin.right;var e={x:t.width-t.padding.right+this.margin.left,y:t.padding.top+this.margin.top};"left"==this.position&&(e.x=t.padding.left-this.width+this.margin.left),"top"==this.position&&(e.x=t.padding.left+this.margin.left,e.y=t.padding.top-this.height-this.margin.top),"bottom"==this.position&&(e.x=t.padding.left+this.margin.left,e.y=t.height-t.padding.bottom+this.margin.bottom),this.pos=e}},{key:"draw",value:function(){var t=this.app.getComponent({name:"coord"});t&&"rect"==t.type&&("top"!=this.position&&"bottom"!=this.position||(this.pos.x=t.getSizeAndOrigin().origin.x+this.icon.radius)),this.setPosition()}},{key:"widget",value:function(){var t=this,e=this.app.width-this.app.padding.left-this.app.padding.right,i=this.app.height-this.app.padding.top-this.app.padding.bottom,n=0,a=0,r=0,s=0,l=0,h=1,u=!1;o.each(this.data,function(d,c){if(!u){var f=new ea({id:"legend_field_icon_"+c,context:{x:0,y:t.icon.height/3,fillStyle:d.enabled?d.color||t._labelColor:"#ccc",r:t.icon.radius,cursor:"pointer"}});f.hover(function(e){e.eventInfo=t._getInfoHandler(e,d)},function(t){delete t.eventInfo}),f.on("mousemove",function(e){e.eventInfo=t._getInfoHandler(e,d)}),f.on("click",function(){});var p=new Be.Display.Text(t.label.format(d.name,d),{id:"legend_field_txt_"+c,context:{x:t.icon.radius+3,y:t.icon.height/3,textAlign:t.label.textAlign,textBaseline:t.label.textBaseline,fillStyle:t.label.fillStyle,cursor:t.label.cursor}});p.hover(function(e){e.eventInfo=t._getInfoHandler(e,d)},function(t){delete t.eventInfo}),p.on("mousemove",function(e){e.eventInfo=t._getInfoHandler(e,d)}),p.on("click",function(){});var g=p.getTextWidth()+2*t.icon.radius+20;n=Math.max(n,g);var v={height:t.icon.height};if("v"==t.direction){if(l+t.icon.height>i){if(s>.3*e)return void(u=!0);s+=n,l=0}v.x=s,v.y=l,l+=t.icon.height,r=Math.max(r,l)}else{if(s+g>e){if(t.icon.height*(h+1)>.3*i)return void(u=!0);a=Math.max(a,s),s=0,h++}v.x=s,v.y=t.icon.height*(h-1),s+=g}var y=new Be.Display.Sprite({id:"legend_field_"+c,context:v});y.addChild(f),y.addChild(p),y.context.width=g,t.sprite.addChild(y),y.on("click",function(e){1==o.filter(t.data,function(t){return t.enabled}).length&&d.enabled||(d.enabled=!d.enabled,f.context.fillStyle=d.enabled?d.color||t._labelColor:"#ccc",d.enabled?t.icon.onChecked(d):t.icon.onUnChecked(d))})}}),"h"==this.direction?(t.width=t.sprite.context.width=a,t.height=t.sprite.context.height=t.icon.height*h):(t.width=t.sprite.context.width=s+n,t.height=t.sprite.context.height=r)}},{key:"_getInfoHandler",value:function(t,e){return{type:"legend",nodes:[{name:e.name,fillStyle:e.color}]}}}]),e}(),na=Be.Shapes.Line,aa=Be.Shapes.Rect,ra={height:26,width:100,range:{start:0,end:null,max:null,min:1},color:"#008ae6",left:{eventEnabled:!0,fillStyle:null},right:{eventEnabled:!0,fillStyle:null},btnOut:6,btnHeight:20,btnWidth:8,center:{eventEnabled:!0,fillStyle:"#000000",alpha:.015},bg:{enabled:!0,fillStyle:"",strokeStyle:"#e6e6e6",lineWidth:1},underline:{enabled:!0,strokeStyle:null,lineWidth:2},position:"bottom",direction:"h"},sa=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="dataZoom",a._cloneChart=null,a.count=1,a.dataLen=1,a.axisLayoutType=null,a.dragIng=function(){},a.dragEnd=function(){},a.disPart={},a._btnLeft=null,a._btnRight=null,a._underline=null,a.sprite=new Be.Display.Sprite({id:"dataZoom",context:{x:a.pos.x,y:a.pos.y}}),a.sprite.noSkip=!0,a.dataZoomBg=new Be.Display.Sprite({id:"dataZoomBg"}),a.dataZoomBtns=new Be.Display.Sprite({id:"dataZoomBtns"}),a.sprite.addChild(a.dataZoomBg),a.sprite.addChild(a.dataZoomBtns),n.stage.addChild(a.sprite),o.extend(!0,a,ra,t),a.layout(),a}return r(e,He),n(e,[{key:"layout",value:function(){var t=this.app;"bottom"==this.position&&(this.pos.y=t.height-(this.height+t.padding.bottom+this.margin.bottom),t.padding.bottom+=this.height+this.margin.top+this.margin.bottom),"top"==this.position&&(this.pos.y=t.padding.top+this.margin.top,t.padding.top+=this.height+this.margin.top+this.margin.bottom)}},{key:"_getCloneChart",value:function(){var t=this.app,e=t.constructor,i=t.el.cloneNode();i.innerHTML="",i.id=t.el.id+"_currclone",i.style.position="absolute",i.style.width=t.el.offsetWidth+"px",i.style.height=t.el.offsetHeight+"px",i.style.top="10000px",document.body.appendChild(i);var n=[];o.each(t.getComponents({name:"graphs"}),function(t){var e=t.enabledField||t.field;if(o.flatten([e]).length){var i=o.extend(!0,{},t._opt);i.field=e,"bar"==t.type&&o.extend(!0,i,{node:{fillStyle:"#ececec",radius:0},animation:!1,eventEnabled:!1,label:{enabled:!1}}),"line"==t.type&&o.extend(!0,i,{line:{strokeStyle:"#ececec"},node:{enabled:!1},area:{alpha:1,fillStyle:"#ececec"},animation:!1,eventEnabled:!1,label:{enabled:!1}}),"scat"==t.type&&o.extend(!0,i,{node:{fillStyle:"#ececec"}}),n.push(i)}});var a={coord:t._opt.coord,graphs:n};a.coord.horizontal&&delete a.coord.horizontal;var r=new e(i,t._data,a,t.componentModules);return r.draw(),{thumbChart:r,cloneEl:i}}},{key:"_setDataZoomOpt",value:function(){var t=this.app,e=t.getComponent({name:"coord"}).getSizeAndOrigin(),i=this;o.extend(!0,this,{width:parseInt(e.width),pos:{x:e.origin.x},dragIng:function(e){var n=new ta(i,{left:t.dataFrame.range.start-e.start,right:e.end-t.dataFrame.range.end});o.extend(t.dataFrame.range,e),t.resetData(null,n),t.fire("dataZoomDragIng")},dragEnd:function(e){t.updateChecked&&t.updateChecked(),t.fire("dataZoomDragEnd")}})}},{key:"draw",value:function(){this._setDataZoomOpt(),this._cloneChart=this._getCloneChart(),this.axisLayoutType=this._cloneChart.thumbChart.getComponent({name:"coord"})._xAxis.layoutType,this._computeAttrs(),this.widget(),this._setLines(),this.setZoomBg(),this.setPosition()}},{key:"destroy",value:function(){this.sprite.destroy()}},{key:"reset",value:function(t,e){!t&&(t={});var i=this.count,n=this.range.start,a=this.range.end;t&&o.extend(!0,this,t),this._cloneChart=this._getCloneChart(),this._computeAttrs(t),(i!=this.count||t.range&&(t.range.start!=n||t.range.end!=a))&&(this.widget(),this._setLines()),this.setZoomBg()}},{key:"_computeAttrs",value:function(){var t=this._cloneChart.thumbChart;this.dataLen=t.dataFrame.length,this.count="rule"==this.axisLayoutType?this.dataLen-1:this.dataLen,(!this.range.max||this.range.max>this.count)&&(this.range.max=this.count),(!this.range.end||this.range.end>this.dataLen-1)&&(this.range.end=this.dataLen-1),!this.direction&&this.position&&("left"==this.position||"right"==this.position?this.direction="v":this.direction="h"),this.disPart=this._getDisPart(),this.btnHeight=this.height-this.btnOut}},{key:"_getRangeEnd",value:function(t){return void 0===t&&(t=this.range.end),"peak"==this.axisLayoutType&&(t+=1),t}},{key:"widget",value:function(){var t=this,e=function(){t._setLines.apply(t,arguments)};if(t.bg.enabled){var i={x:0,y:0,width:t.width,height:t.btnHeight,lineWidth:t.bg.lineWidth,strokeStyle:t.bg.strokeStyle,fillStyle:t.bg.fillStyle};t._bgRect?t._bgRect.animate(i,{onUpdate:e}):(t._bgRect=new aa({context:i}),t.dataZoomBg.addChild(t._bgRect))}if(t.underline.enabled){var n={start:{x:t.range.start/t.count*t.width+t.btnWidth/2,y:t.btnHeight},end:{x:t._getRangeEnd()/t.count*t.width-t.btnWidth/2,y:t.btnHeight},lineWidth:t.underline.lineWidth,strokeStyle:t.underline.strokeStyle||t.color};t._underline?t._underline.animate(n,{onUpdate:e}):(t._underline=t._addLine(n),t.dataZoomBg.addChild(t._underline))}var a={x:t.range.start/t.count*t.width,y:-t.btnOut/2+1,width:t.btnWidth,height:t.btnHeight+t.btnOut,fillStyle:t.left.fillStyle||t.color,cursor:t.left.eventEnabled&&"move"};t._btnLeft?t._btnLeft.animate(a,{onUpdate:e}):(t._btnLeft=new aa({id:"btnLeft",dragEnabled:t.left.eventEnabled,context:a}),t._btnLeft.on("draging",function(e){this.context.y=-t.btnOut/2+1,this.context.x<0&&(this.context.x=0),this.context.x>t._btnRight.context.x-t.btnWidth-2&&(this.context.x=t._btnRight.context.x-t.btnWidth-2),t._btnRight.context.x+t.btnWidth-this.context.x>t.disPart.max&&(this.context.x=t._btnRight.context.x+t.btnWidth-t.disPart.max),t._btnRight.context.x+t.btnWidth-this.context.x<t.disPart.min&&(this.context.x=t._btnRight.context.x+t.btnWidth-t.disPart.min),t.rangeRect.context.width=t._btnRight.context.x-this.context.x-t.btnWidth,t.rangeRect.context.x=this.context.x+t.btnWidth,t._setRange()}),t._btnLeft.on("dragend",function(e){t.dragEnd(t.range)}),this.dataZoomBtns.addChild(this._btnLeft));var r={x:t._getRangeEnd()/t.count*t.width-t.btnWidth,y:-t.btnOut/2+1,width:t.btnWidth,height:t.btnHeight+t.btnOut,fillStyle:t.right.fillStyle||t.color,cursor:t.right.eventEnabled&&"move"};t._btnRight?t._btnRight.animate(r,{onUpdate:e}):(t._btnRight=new aa({id:"btnRight",dragEnabled:t.right.eventEnabled,context:r}),t._btnRight.on("draging",function(e){this.context.y=-t.btnOut/2+1,this.context.x>t.width-t.btnWidth&&(this.context.x=t.width-t.btnWidth),this.context.x+t.btnWidth-t._btnLeft.context.x>t.disPart.max&&(this.context.x=t.disPart.max-(t.btnWidth-t._btnLeft.context.x)),this.context.x+t.btnWidth-t._btnLeft.context.x<t.disPart.min&&(this.context.x=t.disPart.min-t.btnWidth+t._btnLeft.context.x),t.rangeRect.context.width=this.context.x-t._btnLeft.context.x-t.btnWidth,t._setRange()}),t._btnRight.on("dragend",function(e){t.dragEnd(t.range)}),this.dataZoomBtns.addChild(this._btnRight));var s={x:a.x+t.btnWidth,y:1,width:r.x-a.x-t.btnWidth,height:this.btnHeight-1,fillStyle:t.center.fillStyle,fillAlpha:t.center.alpha,cursor:"move"};this.rangeRect?this.rangeRect.animate(s,{onUpdate:e}):(this.rangeRect=new aa({id:"btnCenter",dragEnabled:!0,context:s}),this.rangeRect.on("draging",function(e){this.context.y=1,this.context.x<t.btnWidth&&(this.context.x=t.btnWidth),this.context.x>t.width-this.context.width-t.btnWidth&&(this.context.x=t.width-this.context.width-t.btnWidth),t._btnLeft.context.x=this.context.x-t.btnWidth,t._btnRight.context.x=this.context.x+this.context.width,t._setRange("btnCenter")}),this.rangeRect.on("dragend",function(e){t.dragEnd(t.range)}),this.dataZoomBtns.addChild(this.rangeRect)),this.linesLeft||(this.linesLeft=new Be.Display.Sprite({id:"linesLeft"}),this.left.eventEnabled&&this._addLines({sprite:this.linesLeft}),this.dataZoomBtns.addChild(this.linesLeft)),this.linesRight||(this.linesRight=new Be.Display.Sprite({id:"linesRight"}),this.right.eventEnabled&&this._addLines({sprite:this.linesRight}),this.dataZoomBtns.addChild(this.linesRight)),this.linesCenter||(this.linesCenter=new Be.Display.Sprite({id:"linesCenter"}),this._addLines({count:3,sprite:this.linesCenter,strokeStyle:this.color}),this.dataZoomBtns.addChild(this.linesCenter))}},{key:"_getDisPart",value:function(){var t=this,e=Math.max(parseInt(t.range.min/2/t.count*t.width),23);return"peak"==this.axisLayoutType&&(e=Math.max(parseInt(t.range.min/t.count*t.width),23)),{min:e,max:parseInt(t.range.max/t.count*t.width)}}},{key:"_setRange",value:function(t){var e=this,i=e._getRangeEnd(),n=i-e.range.start,a=e._btnLeft.context.x/e.width*e.count,r=(e._btnRight.context.x+e.btnWidth)/e.width*e.count;"peak"==this.axisLayoutType?(a=Math.round(a),r=Math.round(r)):(a=parseInt(a),r=parseInt(r)),"btnCenter"==t&&r-a!=n&&(r=a+n),a==e.range.start&&r==i||(e.range.start=a,"peak"==e.axisLayoutType&&(r-=1),e.range.end=r,e.dragIng(e.range)),e._setLines()}},{key:"_setLines",value:function(){var t=this,e=this.linesLeft,i=this.linesRight,n=this.linesCenter,a=this._btnLeft,r=this._btnRight,s=this.rangeRect;e.context.x=a.context.x+(a.context.width-e.context.width)/2,e.context.y=a.context.y+(a.context.height-e.context.height)/2,i.context.x=r.context.x+(r.context.width-i.context.width)/2,i.context.y=r.context.y+(r.context.height-i.context.height)/2,n.context.x=s.context.x+(s.context.width-n.context.width)/2,n.context.y=s.context.y+(s.context.height-n.context.height)/2,t.underline.enabled&&(t._underline.context.start.x=e.context.x+t.btnWidth/2,t._underline.context.end.x=i.context.x+t.btnWidth/2)}},{key:"_addLines",value:function(t){for(var e=t.count||2,i=t.sprite,n=t.dis||2,a=0,r=e;a<r;a++)i.addChild(this._addLine({x:a*n,strokeStyle:t.strokeStyle||""}));i.context.width=a*n-1,i.context.height=6}},{key:"_addLine",value:function(t){var e=t||{};return new na({id:e.id||"",context:{x:e.x||0,y:e.y||0,start:{x:e.start?e.start.x:0,y:e.start?e.start.y:0},end:{x:e.end?e.end.x:0,y:e.end?e.end.y:6},lineWidth:e.lineWidth||1,strokeStyle:e.strokeStyle||"#ffffff"}})}},{key:"setZoomBg",value:function(){this.__graphssp&&this.__graphssp.destroy();var t=this._cloneChart.thumbChart.graphsSprite,e=this._cloneChart.thumbChart.getComponent({name:"coord"});t.id=t.id+"_datazoomthumbChartbg",t.context.x=-e.origin.x,t.context.y=-2,t.context.scaleY=this.btnHeight/e.height,t.context.scaleX=this.width/e.width,this.dataZoomBg.addChild(t,0),this.__graphssp=t,this._cloneChart.thumbChart.destroy(),this._cloneChart.cloneEl.parentNode.removeChild(this._cloneChart.cloneEl)}}]),e}(),oa=Be.Shapes.BrokenLine,la=Be.Display.Sprite,ha=Be.Display.Text,ua=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="markLine",a._yAxis=null,a.field=null,a.markTo=null,a.yVal=0,a.line={y:0,list:[],strokeStyle:"#999",lineWidth:1,smooth:!1,lineType:"dashed"},a.label={enabled:!1,fillStyle:"#999999",fontSize:12,text:null,lineType:"dashed",lineWidth:1,strokeStyle:"white",format:null},a._txt=null,a._line=null,a.sprite=new la,a.app.graphsSprite.addChild(a.sprite),t&&o.extend(!0,a,t),a}return r(e,He),n(e,[{key:"draw",value:function(){this._calculateProps(),this.setPosition(),this.widget()}},{key:"_calculateProps",value:function(){var t=this._opt,e=t.markTo,i=this.app.getComponent({name:"coord"});if(!e||-1!=o.indexOf(this.app.dataFrame.fields,e)){var n,a=i._yAxis[0];e&&o.each(i._yAxis,function(t,i){var n=o.flatten([t.field]);o.indexOf(n,e)>=0&&(a=t)}),t.yAxisAlign&&(a=i._yAxis["left"==t.yAxisAlign?0:1]),n=void 0!==t.y&&null!==t.y?Number(t.y):function(){var t=this.app.dataFrame.getFieldData(e),i=0;return o.each(t,function(t){Number(t)&&(i+=t)}),i/t.length},isNaN(n)||(a.setWaterLine(n),a.draw());var r="#777",s=i.getFieldMapOf(e);s&&(r=s.color);var l=t.line&&t.line.strokeStyle||r,h=t.label&&t.label.fillStyle||r;this._yAxis=a,this.width=i.width,this.height=i.height,this.yVal=n,this.pos={x:i.origin.x,y:i.origin.y},this.line.list=[[0,0],[this.width,0]],this.label.fillStyle=h,this.field=e,l&&(this.line.strokeStyle=l)}}},{key:"widget",value:function(){var t=this,e=this._getYPos(),i=new oa({id:"line",context:{y:e,pointList:t.line.list,strokeStyle:t.line.strokeStyle,lineWidth:t.line.lineWidth,lineType:t.line.lineType}});if(t.sprite.addChild(i),t._line=i,t.label.enabled){var n=new ha(t._getLabel(),{context:t.label});this._txt=n,t.sprite.addChild(n),t._setTxtPos(e)}this.line.y=e}},{key:"reset",value:function(t){t&&o.extend(!0,this,t);var e=this,i=this._getYPos();i!=this.line.y&&this._line.animate({y:i},{duration:300,onUpdate:function(t){e.label.enabled&&(e._txt.resetText(e._getLabel()),e._setTxtPos(t.y))}}),this._line.context.strokeStyle=this.line.strokeStyle,this.line.y=i}},{key:"_setTxtPos",value:function(t){var e=this._txt;"left"==this._yAxis.align?e.context.x=5:e.context.x=this.width-e.getTextWidth()-5,o.isNumber(this.label.y)?e.context.y=this.label.y:e.context.y=t-e.getTextHeight()}},{key:"_getYVal",value:function(t){var e=t=t||this.yVal;return o.isFunction(t)&&(e=t.apply(this)),e}},{key:"_getYPos",value:function(){return-this._yAxis.getPosOfVal(this._getYVal())}},{key:"_getLabel",value:function(){var t=this._getYVal();return o.isFunction(this.label.format)?this.label.format(t,this):o.isString(this.label.text)?this.label.text:t}}]),e}(),da=Be.Shapes.Rect,ca=Be.Shapes.Line,fa=function(t){function a(t,e){i(this,a);var n=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t,e));n.name="tips",n.tipDomContainer=n.app.canvax.domView,n.cW=0,n.cH=0,n.dW=0,n.dH=0,n.borderRadius="5px",n.sprite=null,n.content=null,n.fillStyle="rgba(255,255,255,0.95)",n.fontColor="#999",n.strokeStyle="#ccc",n.position="right",n._tipDom=null,n.offsetX=10,n.offsetY=10,n.eventInfo=null,n.positionInRange=!0,n.enabled=!0,n.pointer="line",n.pointerAnim=!0,n._tipsPointer=null,n.sprite=new Be.Display.Sprite({id:"TipSprite"}),n.app.stage.addChild(n.sprite);var r=n;return n.sprite.on("destroy",function(){r._tipDom=null}),o.extend(!0,n,t),n}return r(a,He),n(a,[{key:"show",value:function(t){if(this.enabled){if(t.eventInfo){this.eventInfo=t.eventInfo;var e=t.target.getStage();e?(this.cW=e.context.width,this.cH=e.context.height):"canvax"==t.target.type&&(this.cW=t.target.width,this.cH=t.target.height),this._setContent(t)?(this._setPosition(t),this.sprite.toFront()):this.hide()}this._tipsPointerShow(t)}}},{key:"move",value:function(t){if(this.enabled){if(t.eventInfo)this.eventInfo=t.eventInfo,this._setContent(t)?this._setPosition(t):this._hideDialogTips();this._tipsPointerMove(t)}}},{key:"hide",value:function(){this.enabled&&(this._hideDialogTips(),this._tipsPointerHide())}},{key:"_hideDialogTips",value:function(){this.eventInfo&&(this.eventInfo=null,this.sprite.removeAllChildren(),this._removeContent())}},{key:"_setPosition",value:function(t){if(this.enabled&&this._tipDom){var e=t.pos||t.target.localToGlobal(t.point),i=this._checkX(e.x+this.offsetX),n=this._checkY(e.y+this.offsetY);this._tipDom.style.cssText+=";visibility:visible;left:"+i+"px;top:"+n+"px;-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;","left"==this.position&&(this._tipDom.style.left=this._checkX(e.x-this.offsetX-this._tipDom.offsetWidth)+"px")}}},{key:"_creatTipDom",value:function(t){this._tipDom=document.createElement("div"),this._tipDom.className="chart-tips",this._tipDom.style.cssText+="；-moz-border-radius:"+this.borderRadius+"; -webkit-border-radius:"+this.borderRadius+"; border-radius:"+this.borderRadius+";background:"+this.fillStyle+";border:1px solid "+this.strokeStyle+";visibility:hidden;position:absolute;enabled:inline-block;*enabled:inline;*zoom:1;padding:6px;color:"+this.fontColor+";line-height:1.5",this._tipDom.style.cssText+="; -moz-box-shadow:1px 1px 3px "+this.strokeStyle+"; -webkit-box-shadow:1px 1px 3px "+this.strokeStyle+"; box-shadow:1px 1px 3px "+this.strokeStyle+";",this._tipDom.style.cssText+="; border:none;white-space:nowrap;word-wrap:normal;",this._tipDom.style.cssText+="; text-align:left;",this.tipDomContainer.appendChild(this._tipDom)}},{key:"_removeContent",value:function(){this._tipDom&&(this.tipDomContainer.removeChild(this._tipDom),this._tipDom=null)}},{key:"_setContent",value:function(t){var e=this._getContent(t);if(e||0===e)return this._tipDom||this._creatTipDom(t),this._tipDom.innerHTML=e,this.dW=this._tipDom.offsetWidth,this.dH=this._tipDom.offsetHeight,e}},{key:"_getContent",value:function(t){return this.content?o.isFunction(this.content)?this.content(t.eventInfo):this.content:this._getDefaultContent(t.eventInfo)}},{key:"_getDefaultContent",value:function(t){var i="";return t.nodes.length?(void 0!==t.title&&null!==t.title&&""!==t.title&&(i+="<div style='font-size:14px;border-bottom:1px solid #f0f0f0;padding:4px;margin-bottom:6px;'>"+t.title+"</div>"),o.each(t.nodes,function(t,n){if(t.value||0===t.value){var a=t.color||t.fillStyle||t.strokeStyle,r=t.name||t.field,s="object"==e(t.value)?JSON.stringify(t.value):Ye(t.value);i+="<div style='line-height:1.5;font-size:12px;padding:0 4px;'>",a&&(i+="<span style='background:"+a+";margin-right:8px;margin-top:7px;float:left;width:8px;height:8px;border-radius:4px;overflow:hidden;font-size:0;'></span>"),r&&(i+="<span style='margin-right:5px;'>"+r+"：</span>"),i+=s+"</div>"}}),i):i}},{key:"_checkX",value:function(t){if(this.positionInRange){var e=this.dW+2;t<0&&(t=0),t+e>this.cW&&(t=this.cW-e)}return t}},{key:"_checkY",value:function(t){if(this.positionInRange){var e=this.dH+2;t<0&&(t=0),t+e>this.cH&&(t=this.cH-e)}return t}},{key:"_tipsPointerShow",value:function(t){var e=this.app.getComponent({name:"coord"});if(e&&"rect"==e.type&&this.pointer){var i=this._tipsPointer,n=e.origin.y-e.height,a=0;if("line"==this.pointer&&(a=e.origin.x+t.eventInfo.xAxis.x),"region"==this.pointer){var r=e._xAxis.getCellLengthOfPos(t.eventInfo.xAxis.x);a=e.origin.x+t.eventInfo.xAxis.x-r/2,t.eventInfo.xAxis.ind<0&&(a=e.origin.x)}if(i)this.pointerAnim&&"proportion"!=e._xAxis.layoutType?(i.__animation&&i.__animation.stop(),i.__animation=i.animate({x:a,y:n},{duration:200})):(i.context.x=a,i.context.y=n);else{if("line"==this.pointer&&(i=new ca({context:{x:a,y:n,start:{x:0,y:0},end:{x:0,y:e.height},lineWidth:1,strokeStyle:"#cccccc"}})),"region"==this.pointer){r=e._xAxis.getCellLengthOfPos(a);i=new da({context:{width:r,height:e.height,x:a,y:n,fillStyle:"#cccccc",globalAlpha:.3}})}this.app.graphsSprite.addChild(i,0),this._tipsPointer=i}}}},{key:"_tipsPointerHide",value:function(){var t=this.app.getComponent({name:"coord"});t&&"rect"==t.type&&this.pointer&&this._tipsPointer&&(this._tipsPointer.destroy(),this._tipsPointer=null)}},{key:"_tipsPointerMove",value:function(t){var e=this.app.getComponent({name:"coord"});if(e&&"rect"==e.type&&this.pointer&&this._tipsPointer){var i=this._tipsPointer,n=e.origin.x+t.eventInfo.xAxis.x;if("region"==this.pointer){var a=e._xAxis.getCellLengthOfPos(t.eventInfo.xAxis.x);n=e.origin.x+t.eventInfo.xAxis.x-a/2,t.eventInfo.xAxis.ind<0&&(n=e.origin.x)}var r=e.origin.y-e.height;n!=i.__targetX&&(this.pointerAnim&&"proportion"!=e._xAxis.layoutType?(i.__animation&&i.__animation.stop(),i.__targetX=n,i.__animation=i.animate({x:n,y:r},{duration:200,onComplete:function(){delete i.__targetX,delete i.__animation}})):(i.context.x=n,i.context.y=r))}}}]),a}(),pa=Be.Shapes.Line,ga=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="barTgi",a.field=null,a.barField=null,a.data=null,a.barDatas=null,a._yAxis=null,a.yAxisAlign="left",a.sprite=null,a.standardVal=100,a.pos={x:0,y:0},a.line={lineWidth:3,strokeStyle:function(t,e){return t>=this.standardVal?"#43cbb5":"#ff6060"}},o.extend(!0,a,t),a._yAxis=a.app.getComponent({name:"coord"})._yAxis["left"==a.yAxisAlign?0:1],a.sprite=new Be.Display.Sprite,a.app.graphsSprite.addChild(a.sprite),a}return r(e,He),n(e,[{key:"reset",value:function(t){o.extend(!0,this,t),this.barDatas=null,this.data=null,this.sprite.removeAllChildren(),this.draw()}},{key:"draw",value:function(){var t=this,e=this.app.getComponent({name:"coord"});this.pos={x:e.origin.x,y:e.origin.y},this.setPosition(),o.each(t.app.getComponents({name:"graphs"}),function(e){if("bar"==e.type&&e.data[t.barField])return t.barDatas=e.data[t.barField],!1}),this.data=o.flatten(t.app.dataFrame.getDataOrg(t.field)),this.barDatas&&o.each(this.data,function(e,i){var n=-t._yAxis.getPosOfVal(e),a=t.barDatas[i],r=new pa({context:{start:{x:a.x,y:n},end:{x:a.x+a.width,y:n},lineWidth:2,strokeStyle:t._getProp(t.line.strokeStyle,e,i)}});t.sprite.addChild(r)})}},{key:"_getProp",value:function(t,e,i){var n=t;return o.isFunction(t)&&(n=t.apply(this,[e,i])),n}}]),e}(),va=function(t){function e(t,n){i(this,e);var r=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.name="barGuide",r.field=null,r.barField=null,r.data=null,r.barDatas=null,r._yAxis=null,r.yAxisAlign="left",r.sprite=null,r.node=a({lineWidth:3,shapeType:"circle",radius:6,fillStyle:"#19dea1",strokeStyle:"#fff"},"lineWidth",2),r.label={fontSize:12,fontColor:"#19dea1",verticalAlign:"bottom",align:"center",strokeStyle:"#fff",lineWidth:0,format:function(t,e){return t}},o.extend(!0,r,t),r._yAxis=r.app.getComponent({name:"coord"})._yAxis["left"==r.yAxisAlign?0:1],r.sprite=new Be.Display.Sprite,r.app.graphsSprite.addChild(r.sprite),r}return r(e,He),n(e,[{key:"reset",value:function(t){o.extend(!0,this,t),this.barDatas=null,this.data=null,this.sprite.removeAllChildren(),this.draw()}},{key:"draw",value:function(){var t=this,e=this.app.getComponent({name:"coord"});this.pos={x:e.origin.x,y:e.origin.y},this.setPosition(),o.each(t.app.getComponents({name:"graphs"}),function(e){if("bar"==e.type&&e.data[t.barField])return t.barDatas=e.data[t.barField],!1}),this.data=o.flatten(t.app.dataFrame.getDataOrg(t.field)),this.barDatas&&o.each(this.data,function(e,i){var n=-t._yAxis.getPosOfVal(e),a=t.barDatas[i],r=new Be.Shapes.Circle({context:{x:a.x+a.width/2,y:n,r:t.node.radius,fillStyle:t.node.fillStyle,strokeStyle:t.node.strokeStyle,lineWidth:t.node.lineWidth}}),s=new Be.Display.Text(t.label.format(e,a),{context:{x:a.x+a.width/2,y:n-t.node.radius-1,fillStyle:t.label.fontColor,lineWidth:t.label.lineWidth,strokeStyle:t.label.strokeStyle,fontSize:t.label.fontSize,textAlign:t.label.align,textBaseline:t.label.verticalAlign}});t.sprite.addChild(r),t.sprite.addChild(s)})}},{key:"_getProp",value:function(t,e,i){var n=t;return o.isFunction(t)&&(n=t.apply(this,[e,i])),n}}]),e}(),ya=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="theme",a.colors=t||[],a}return r(e,He),n(e,[{key:"set",value:function(t){return this.colors=t,this.colors}},{key:"get",value:function(t){var e=this.colors;return o.isArray(e)||(e=[e]),e}},{key:"mergeTo",value:function(t){t||(t=[]);for(var e=0,i=this.colors.length;e<i;e++)t[e]?t[e]=this.colors[e]:t.push(this.colors[e]);return t}}]),e}(),xa=(Be.Display.Text,function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="waterMark",a.width=a.app.width,a.height=a.app.height,a.text="chartx",a.fontSize=20,a.fontColor="#ccc",a.strokeStyle="#ccc",a.lineWidth=0,a.alpha=.2,a.rotation=45,o.extend(!0,a,t),a.spripte=new Be.Display.Sprite({id:"watermark"}),a.app.stage.addChild(a.spripte),a.draw(),a}return r(e,He),n(e,[{key:"draw",value:function(){for(var t=new Be.Display.Text(this.text,{context:{fontSize:this.fontSize,fillStyle:this.fontColor}}),e=t.getTextWidth(),i=t.getTextHeight(),n=parseInt(this.height/(5*i))+1,a=parseInt(this.width/(1.5*e))+1,r=0;r<n;r++)for(var s=0;s<a;s++){var o=new Be.Display.Text(this.text,{context:{rotation:this.rotation,fontSize:this.fontSize,strokeStyle:this.strokeStyle,lineWidth:this.lineWidth,fillStyle:this.fontColor,globalAlpha:this.alpha}});o.context.x=1.5*e*s+.25*e,o.context.y=5*i*r,this.spripte.addChild(o)}}}]),e}()),_a=Be.Shapes.Line,ma=(Be.Display.Sprite,Be.Display.Text,function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="cross",a.width=t.width||0,a.height=t.height||0,a.x=null,a.y=null,a.aimPoint={x:0,y:0},a.line={y:0,strokeStyle:"#cccccc",lineWidth:1,smooth:!1,lineType:"solid"},a.node={enabled:!1,shapeType:"circle",radius:1,fillStyle:"#999"},a.label={enabled:!1,fillStyle:"#999999",fontSize:12,value:null,lineType:"dashed",lineWidth:1,strokeStyle:"white"},a._txt=null,a._node=null,a._hLine=null,a._vLine=null,t&&o.extend(!0,a,t),a._yAxis=a.app.getComponent({name:"coord"})._yAxis["left"==a.yAxisAlign?0:1],a.sprite=new Be.Display.Sprite,a.app.graphsSprite.addChild(a.sprite),a}return r(e,He),n(e,[{key:"draw",value:function(){var t=this,e=this.app.getComponent({name:"coord"});this.pos={x:e.origin.x,y:e.origin.y},this.width=e.width,this.height=e.height,this.aimPoint={x:this.width/2,y:this.height/2},this.setPosition(),t._hLine=new _a({context:{start:{x:0,y:-this.aimPoint.y},end:{x:t.width,y:-this.aimPoint.y},strokeStyle:t.line.strokeStyle,lineWidth:t.line.lineWidth,lineType:t.line.lineType}}),t.sprite.addChild(t._hLine),t._vLine=new _a({context:{start:{x:this.aimPoint.x,y:0},end:{x:this.aimPoint.x,y:-t.height},strokeStyle:t.line.strokeStyle,lineWidth:t.line.lineWidth,lineType:t.line.lineType}}),t.sprite.addChild(t._vLine)}}]),e}()),ba=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.name="lineSchedu",a.data=null,a.lineDatas=null,a.lineField=null,a.style="#3995ff",a.fillStyle="#fff",a.lineWidth=2,a.radius=6,a.timeFontSize=14,a.timeFontColor="#606060",a.listFontSize=12,a.listFontColor=null,o.extend(!0,a,t),a.sprite=new Be.Display.Sprite,a.app.graphsSprite.addChild(a.sprite),a}return r(e,He),n(e,[{key:"reset",value:function(t){o.extend(!0,this,t),this.lineDatas=null,this.data=null,this.sprite.removeAllChildren(),this.draw()}},{key:"draw",value:function(){var t=this,e=this.app.getComponent({name:"coord"});this.pos={x:e.origin.x,y:e.origin.y},this.setPosition();var i=t.app.getComponent({name:"graphs",type:"line",field:t.lineField});t.lineDatas=i.data[t.lineField].data;var n=this.app.getComponent({name:"coord"}).getAxis({type:"xAxis"}).getIndexOfVal(this.time),a=this.lineDatas[n];if(void 0!=a.y){var r=t._getNodeY(a,e),s=a.x,l=new Be.Display.Sprite({context:{x:s-20}});this.sprite.addChild(l);var h=0,u=new Be.Display.Text(t.time,{context:{fillStyle:this.timeFontColor||this.style,fontSize:this.timeFontSize}});l.addChild(u);h=u.getTextHeight();var d=u.getTextWidth(),c=new Be.Display.Text(o.flatten([t.list]).join("\n"),{context:{y:h,fillStyle:this.listFontColor||this.style,fontSize:this.listFontSize}});l.addChild(c),h+=c.getTextHeight(),(d=Math.max(d,c.getTextWidth()))+s-20>e.width+t.app.padding.right&&(l.context.x=e.width+t.app.padding.right,u.context.textAlign="right",c.context.textAlign="right");var f=0;"online"==t.status?(f=r-(this.radius+3)-h,Math.abs(f)>e.origin.y&&(f=-e.origin.y,r=-(e.origin.y-(this.radius+3)-h))):(f=r+(this.radius+3))+h>0&&(f=-h,r=-(this.radius+3)-h),l.context.y=f;var p=new Be.Shapes.BrokenLine({context:{pointList:[[s,r],[s,a.y]],strokeStyle:t.style,lineWidth:t.lineWidth}});t.sprite.addChild(p);var g=new Be.Shapes.Circle({context:{x:s,y:r,r:t.radius,fillStyle:t.fillStyle,strokeStyle:t.style,lineWidth:t.lineWidth}});t.sprite.addChild(g)}}},{key:"_getNodeY",value:function(t,e){var i=this.app.height,n=(e.height,t.y);return"online"==this.status?n-=Math.min(50,.3*(i-Math.abs(n))):n+=Math.min(50,.3*Math.abs(n)),n}}]),e}();G.registerComponent(je,"chart"),G.registerComponent(ti,"coord","rect"),G.registerComponent(ri,"coord","polar"),G.registerComponent(hi,"graphs","bar"),G.registerComponent(gi,"graphs","line"),G.registerComponent(_i,"graphs","scat"),G.registerComponent(Si,"graphs","pie"),G.registerComponent(Pi,"graphs","radar"),G.registerComponent(Qi,"graphs","cloud"),G.registerComponent(rn,"graphs","planet"),G.registerComponent(ln,"graphs","funnel"),G.registerComponent(En,"graphs","venn"),G.registerComponent(Un,"graphs","sunburst"),G.registerComponent(Kn,"graphs","sankey"),G.registerComponent(ya,"theme"),G.registerComponent(ia,"legend"),G.registerComponent(sa,"dataZoom"),G.registerComponent(ua,"markLine"),G.registerComponent(fa,"tips"),G.registerComponent(ga,"barTgi"),G.registerComponent(va,"barGuide"),G.registerComponent(xa,"waterMark"),G.registerComponent(ma,"cross"),G.registerComponent(ba,"lineSchedu");var ka=[];ka&&ka.length&&G.setGlobalTheme(ka);var wa={options:{}};for(var Sa in G)wa[Sa]=G[Sa];return wa}();
