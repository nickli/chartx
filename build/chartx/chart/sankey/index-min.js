define("chartx/chart/sankey/index",["chartx/chart/index","chartx/layout/sankey/index","canvax/shape/Rect","canvax/shape/Path","chartx/components/tips/tip"],function(a,b,c,d,e){var f=a.Canvax,g=a.extend({init:function(a,b,c){this._el=a,this._data=b,this._opts=c,this.nodeField="node",this.edgeField="edge",this.dataFrame={nodes:[],links:[]},this.tips={},this._lastLevMaxLen=0,this.colors=["#ff8533","#73ace6","#82d982","#e673ac","#cd6bed","#8282d9","#c0e650","#e6ac73","#6bcded","#73e6ac","#ed6bcd","#9966cc"],_.deepExtend(this,c)},draw:function(){this.dataFrame=this.dataFormat(this._data),this.padding.right+=this._lastLevMaxLen,this.layoutData=this.getLayoutData(),this._setStages(),this.drawNodes(),this.drawLinks(),this.drawLabels()},dataFormat:function(a){var b,c,d=this,e={nodes:[],links:[]},g={};return _.each(a,function(a,h){if(0==h)_.each(a,function(a,e){a==d.nodeField&&(b=e),a==d.edgeField&&(c=e)});else if(e.nodes.push({name:a[b]}),g[a[b]]=h-1,_.each(a[c],function(a){a.source=h-1}),0==a[c].length){var i=new f.Display.Text(a[b]).getTextWidth();d._lastLevMaxLen=Math.max(d._lastLevMaxLen,i)}}),_.each(a,function(a,b){b>0&&_.each(a[c],function(a){a.target=g[a.target],e.links.push(a)})}),e},_setStages:function(){this._links=new f.Display.Sprite({id:"links",context:{x:this.padding.left,y:this.padding.top}}),this._nodes=new f.Display.Sprite({id:"nodes",context:{x:this.padding.left,y:this.padding.top}}),this._labels=new f.Display.Sprite({id:"labels",context:{x:this.padding.left,y:this.padding.top}}),this._tips=new f.Display.Sprite({id:"tip"}),this.stage.addChild(this._links),this.stage.addChild(this._nodes),this.stage.addChild(this._labels),this.stage.addChild(this._tips),this.__tips=new e(this.tips,this.canvax.getDomContainer()),this.__tips._getDefaultContent=function(a){var b="";return b+="source:"+a.link.source.name+"<br />",b+="target:"+a.link.target.name+"<br />",b+="value:"+a.link.value},this._tips.addChild(this.__tips.sprite)},getLayoutData:function(){return b().nodeWidth(15).nodePadding(10).size([this.width-this.padding.left-this.padding.right,this.height-this.padding.top-this.padding.bottom]).nodes(this.dataFrame.nodes).links(this.dataFrame.links).layout(32)},drawNodes:function(){var a=this.layoutData.nodes(),b=this;_.each(a,function(a){var d=b.colors[parseInt(Math.random()*b.colors.length)],e=new c({xyToInt:!1,context:{x:a.x,y:a.y,width:b.layoutData.nodeWidth(),height:Math.max(a.dy,1),fillStyle:d,lineWidth:0,strokeStyle:d}});e.layoutData=a,e.on("click",function(){}),b._nodes.addChild(e)})},drawLinks:function(){var a=this.layoutData.links(),b=this;_.each(a,function(a){var c=b.layoutData.link()(a),e=new d({xyToInt:!1,context:{path:c,strokeStyle:"blue",lineWidth:Math.max(1,a.dy),globalAlpha:.2,cursor:"pointer"}});e.link=a,e.hover(function(a){this.context.globalAlpha+=.2,b.__tips.show(b._setTipsInfoHand(a,this.link))},function(a){this.context.globalAlpha-=.2,b.__tips.hide(a)}),e.on("mousemove",function(a){b.__tips.move(b._setTipsInfoHand(a,this.link))}),b._links.addChild(e)})},drawLabels:function(){var a=this.layoutData.nodes(),b=this;_.each(a,function(a){var c=new f.Display.Text(a.name,{context:{x:a.x+b.layoutData.nodeWidth(),y:a.y+Math.max(a.dy/2,1),fillStyle:"black"}});b._labels.addChild(c)})},_setTipsInfoHand:function(a,b){var c={link:b};return a.tipsInfo=c,a}});return g});