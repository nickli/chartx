define("chartx/chart/bar/3d/graphs",["canvax/index","canvax/shape/Rect","chartx/utils/tools","chartx/chart/theme","canvax/animation/AnimationFrame","canvax/shape/BrokenLine","canvax/shape/Shapes","chartx/utils/math3d/vec3","chartx/utils/colorformat","canvax/animation/AnimationFrame"],function(a,b,c,d,e,f,g,i,j,e){var k=function(a){var b=a.graphs;this.root=a,this.data=[],this.w=0,this.h=0,this.depth=50,this._yAxisFieldsMap={},this._setyAxisFieldsMap(),this.animation=!0,this.pos={x:0,y:0},this._colors=d.colors,this.bar={width:0,_width:0,radius:4},this.text={enabled:!1,fillStyle:"#999",fontSize:12,format:null,lineWidth:1,strokeStyle:"white"},this.average={enabled:!1,field:"average",fieldInd:-1,fillStyle:"#c4c9d6",data:null},this.checked={enabled:!1,fillStyle:"#00A8E6",strokeStyle:"#00A8E6",globalAlpha:.1,lineWidth:2},this.sort=null,this._barsLen=0,this.eventEnabled=!0,this.sprite=null,this.txtsSp=null,this.checkedSp=null,this.yDataSectionLen=0,this.globalAlpha=1,_.deepExtend(this,b),this._initaverage(),this.init()};return k.prototype={init:function(){this.sprite=new a.Display.Sprite({id:"graphsEl"}),this.barsSp=new a.Display.Sprite({id:"barsSp"}),this.txtsSp=new a.Display.Sprite({id:"txtsSp",context:{}}),this.checkedSp=new a.Display.Sprite({id:"checkedSp"})},setX:function(a){this.sprite.context.x=a},setY:function(a){this.sprite.context.y=a},getInfo:function(a){return this._getInfoHandler({iGroup:a})},_checked:function(a){var c=this,d=a.iNode,e=c.barsSp.getChildById("barGroup_"+d);if(e){c.checkedSp.removeChildById("line_"+d),c.checkedSp.removeChildById("rect_"+d);var g=e.getChildAt(0),h=g.context.x,i=g.context.x+g.context.width,j=-c.h;if(a.checked){var k=new b({id:"rect_"+d,pointChkPriority:!1,context:{x:h,y:j,width:g.context.width,height:g.context.height,fillStyle:c.checked.fillStyle,globalAlpha:c.checked.globalAlpha}});c.checkedSp.addChild(k);var l=new f({id:"line_"+d,context:{pointList:[[h,j],[i,j]],strokeStyle:c.checked.strokeStyle,lineWidth:c.checked.lineWidth}});c.checkedSp.addChild(l)}}},removeAllChecked:function(){var a=this;a.checkedSp.removeAllChildren()},setBarStyle:function(a){for(var b=this,c=a.iNode,d=b.barsSp.getChildById("barGroup_"+c),e=a.fillStyle||b._getColor(b.bar.fillStyle),f=0,g=d.getNumChildren();g>f;f++){var h=d.getChildAt(f);h.context.fillStyle=e}},_setyAxisFieldsMap:function(){var a=this;_.each(_.flatten(this.root.dataFrame.yAxis.field),function(b,c){a._yAxisFieldsMap[b]={index:c}})},_initaverage:function(){this.average.enabled&&_.each(this.root.dataFraem,function(a,b){a.field==this.average.field&&(this.average.fieldInd=b)})},_getColor:function(a,b,c,d,e,f,g,h){var i=null;return _.isString(a)&&(i=a),_.isArray(a)&&(i=_.flatten(a)[this._yAxisFieldsMap[h].index]),_.isFunction(a)&&(i=a.apply(this,[{iGroup:d,iNode:e,iLay:f,field:h,value:g,xAxis:{field:this.root._xAxis.field,value:this.root._xAxis.data[e].content}}])),i&&""!=i||(i=this._colors[this._yAxisFieldsMap[h].index]),i},_getFieldFromIHV:function(a,b,c){var d=this.root._yAxis.field,e=null;return _.isString(d[a])?e=d[a]:_.isArray(d[a])&&(e=d[a][c]),e},checkBarW:function(a,b){this.bar.width?_.isFunction(this.bar.width)?this.bar._width=this.bar.width(a):this.bar._width=this.bar.width:(this.bar._width=parseInt(b)-parseInt(Math.max(1,.3*b)),1==this.bar._width&&a>3&&(this.bar._width=parseInt(a)-2)),this.bar._width<1&&(this.bar._width=1)},resetData:function(a,b){this._setyAxisFieldsMap(),this.draw(a.data,b)},draw:function(d,e){if(_.deepExtend(this,e),0!=d.length){var f=0;this.data[0]&&(f=this.data[0][0].length),this.data=d;var g=this,i=d.length,j=0;_.each(d,function(b,d){var e=b.length;if(0!=e){var k=b[0].length;for(j=g.w/k,g._barsLen=k*i,h=0;h<k;h++){var l;if(0==d){if(h<=f-1?l=g.barsSp.getChildById("barGroup_"+h):(l=g.barsSp.getChildById("barGroup_"+h)||new a.Display.Sprite({id:"barGroup_"+h}),g.barsSp.addChild(l),l.iNode=h,l.on("click dblclick mousedown mousemove mouseup",function(a){a.eventInfo||(a.eventInfo=g._getInfoHandler(this))})),g.eventEnabled){var m,n=j*h,o=n+j,p=g.sort&&"desc"==g.sort?0:-g.h,q=p+g.h,r=g.root._back._depth;m=l.getChildById("bhr_polygon_"+h)||new a.Display.Sprite({id:"bhr_polygon_"+h}),g.drawHoverCube(m,n,o,p,q,r),l.addChild(m),m.iGroup=-1,m.iNode=h,m.iLay=-1,m.on("panstart mouseover mousemove mouseout click",function(a){a.eventInfo=g._getInfoHandler(this,a)})}}else l=g.barsSp.getChildById("barGroup_"+h);var s;for(0==d?h<=f-1?s=g.txtsSp.getChildById("txtGroup_"+h):(s=g.txtsSp.getChildById("txtGroup_"+h)||new a.Display.Sprite({id:"txtGroup_"+h}),g.txtsSp.addChild(s),s.iGroup=d):s=g.txtsSp.getChildById("txtGroup_"+h),v=0;v<e;v++){var t=b[v][h];t.iGroup=d,t.iNode=h,t.iLay=v;var u=parseInt(Math.abs(t.y));v>0&&(u-=parseInt(Math.abs(b[v-1][h].y)));var w=parseInt(t.y),x=g._getColor(g.bar.fillStyle,i,e,d,h,v,t.value,t.field);if(0==h){var y=g._yAxisFieldsMap[g._getFieldFromIHV(d,h,v)];y.fillStyle||(y.fillStyle=x)}t.fillStyle=x;var z={x:Math.round(t.x-g.bar._width/2),y:w,width:parseInt(g.bar._width),height:u,fillStyle:x,scaleY:1},A={x:z.x,y:0,width:z.width,height:0,fillStyle:z.fillStyle,scaleY:0};if(g.bar.radius&&v==e-1){var B=Math.min(g.bar._width/2,u);B=Math.min(B,g.bar.radius),A.radius=[B,B,0,0]}g.animation||(delete A.scaleY,A.y=z.y,A.height=z.height);var C=l.getChildById("bar_"+d+"_"+h+"_"+v)||new a.Display.Sprite({id:"bar_"+d+"_"+h+"_"+v});if(g.drawCube(C,A),l.addChild(C),C.finalPos=z,C.iGroup=d,C.iNode=h,C.iLay=v,g.eventEnabled&&C.on("panstart mouseover mousemove mouseout click dblclick",function(a){a.eventInfo=g._getInfoHandler(this,a),"mouseover"==a.type&&(this.parent.getChildById("bhr_"+this.iNode).context.globalAlpha=.1),"mouseout"==a.type&&(this.parent.getChildById("bhr_"+this.iNode).context.globalAlpha=0)}),v==e-1&&g.text.enabled){var D,E=[t];if(h<=f-1?D=s.getChildById("infosp_"+d+"_"+h):(D=s.getChildById("infosp_"+d+"_"+h)||new a.Display.Sprite({id:"infosp_"+d+"_"+h,context:{visible:!1}}),D._hGroup=h,s.addChild(D)),D.noSkip=!0,e>1)for(var F=e-2;F>=0;F--)E.unshift(b[F][h]);var G=0,H=0;_.each(E,function(b,i){var j=b.value;!g.animation&&_.isFunction(g.text.format)&&(j=g.text.format(b.value)),!g.animation&&_.isNumber(j)&&(j=c.numAddSymbol(j));var k;h<=f-1?k=D.getChildById("info_txt_"+d+"_"+h+"_"+i):(k=new a.Display.Text(j,{id:"info_txt_"+d+"_"+h+"_"+i,context:{x:G+2,fillStyle:b.fillStyle,fontSize:g.text.fontSize,lineWidth:g.text.lineWidth,strokeStyle:g.text.strokeStyle}}),k.z=.5*-g.depth,D.addChild(k)),k._text=j,G+=k.getTextWidth()+2,H=Math.max(H,k.getTextHeight()),g.animation&&k.resetText(0),e-2>=i&&(k=new a.Display.Text("/",{context:{x:G+2,fillStyle:"#999"}}),k.z=.5*-g.depth,G+=k.getTextWidth()+2,D.addChild(k))}),D._finalX=t.x-G/2,D._finalY=z.y-H,D._centerX=t.x,D.context.width=G,D.context.height=H,D.context.x=t.x-G/2,g.animation||(D.context.y=z.y-H-15,D.context.visible=!0)}}}}}),this.sprite.addChild(this.barsSp),this.sprite.addChild(this.checkedSp),this.text.enabled&&this.sprite.addChild(this.txtsSp),this.average.enabled&&this.average.data&&(!this.averageSp&&(this.averageSp=new a.Display.Sprite({id:"averageSp"})),_.each(this.average.layoutData,function(a,c){var d,e={x:j*c,y:a.y,fillStyle:g.average.fillStyle,width:j,height:2};f-1>=c?(d=g.averageSp.getChildById("average_"+c),d.context.x=e.x,d.context.y=e.y,d.context.width=e.width):(d=new b({id:"average_"+c,context:e}),g.averageSp.addChild(d))}),this.sprite.addChild(g.averageSp)),this.sprite.context.x=this.pos.x,this.sprite.context.y=this.pos.y,this.sort&&"desc"==this.sort&&(this.sprite.context.y-=this.h)}},_updateInfoTextPos:function(a,b){if("horizontal"!=this.root.type){var c=0,d=0,e=a.children.length;_.each(a.children,function(a,b){a.getTextWidth&&(a.context.x=c,c+=a.getTextWidth()+(e>b?2:0),d=Math.max(d,a.getTextHeight()))}),a.context.width=c,a.context.height=d,0===b&&this.root._to3d(a)}},grow:function(a,b){var d=this;if(!this.animation)return void(a&&a(d));var f=1;if(this.sort&&"desc"==this.sort&&(f=-1),d.data[0]&&d.barsSp.children.length>d.data[0][0].length)for(var g=d.data[0][0].length,i=d.barsSp.children.length;i>g;g++)d.barsSp.getChildAt(g).destroy(),d.text.enabled&&d.txtsSp.getChildAt(g).destroy(),d.averageSp&&d.averageSp.getChildAt(g).destroy(),g--,i--;var j=_.extend({delay:Math.min(1e3/this._barsLen,200),easing:"Back.Out",duration:500},b);_.each(d.data,function(a,b){var g=a.length;if(0!=g){var i=a[0].length;for(h=0;h<i;h++){for(v=0;v<g;v++){var k=d.barsSp.getChildById("barGroup_"+h),l=k.getChildById("bar_"+b+"_"+h+"_"+v);if(0==j.duration)l.context.scaleY=f,l.context.y=f*f*l.finalPos.y,l.context.x=l.finalPos.x,l.context.width=l.finalPos.width,l.context.height=l.finalPos.height;else{l._tweenObj&&e.destroyTween(l._tweenObj);var m={from:{y:0,height:0},to:{y:l.finalPos.y,height:l.finalPos.height},onUpdate:function(a,b){var c=a;return function(a){b.drawCube(c,{x:c.finalPos.x,y:this.y,width:c.finalPos.width,height:this.height}),b.root._to3d(c)}}(l,d),onComplete:function(){},id:l.id,duration:j.duration,easing:j.easing,delay:h*j.delay};l._tweenObj=e.registTween(m)}}if(d.text.enabled){var n=d.txtsSp.getChildById("txtGroup_"+h),o=n.getChildById("infosp_"+b+"_"+h);"horizontal"==d.root.type&&(o.context.x=o._finalX),o.animate({y:o._finalY-15,x:o._finalX},{duration:j.duration,easing:j.easing,delay:h*j.delay,onUpdate:function(){this.context.visible=!0},onComplete:function(){}}),_.each(o.children,function(a,b){a._text&&(a._tweenObj&&e.destroyTween(a._tweenObj),a._tweenObj=e.registTween({from:{v:a.text},to:{v:a._text},duration:j.duration,delay:h*j.delay,onUpdate:function(a,b){return function(){var e=this.v;_.isFunction(d.text.format)?e=d.text.format(e):_.isNumber(e)&&(e=c.numAddSymbol(parseInt(e))),a.resetText(e),a.parent?d._updateInfoTextPos(a.parent,b):a.destroy()}}(a,b)}))})}}}}),window.setTimeout(function(){a&&a(d)},300*(this.barsSp.children.length-1))},_getInfoHandler:function(a){var b={iGroup:a.iGroup,iNode:a.iNode,iLay:a.iLay,nodesInfoList:this._getNodeInfo(a.iGroup,a.iNode,a.iLay)};return b},_getNodeInfo:function(a,b,c){var d=[],e=this,f=e.data.length;return void 0==a&&(a=-1),void 0==b&&(b=0),void 0==c&&(c=-1),_.each(e.data,function(g,i){var j,k=g.length;if(0!=k){var l=g[0].length;for(h=0;h<l;h++)if(h==b)for(v=0;v<k;v++)a!=i&&-1!=a||c!=v&&-1!=c||(j=g[v][h],j.fillStyle=e._getColor(e.bar.fillStyle,f,k,i,h,v,j.value,j.field),d.push(j))}}),d},drawHoverCube:function(a,b,c,d,e,f){var g=this,h=null,i="#ccc",j="#ccc",k="#ccc",l=.3,m=g.root.drawFace,n=[[b,d,0],[b,d,f],[b,e,f],[b,e,0]],o=m("bhr_polygon_left",n,k,h,0,a),n=[[b,d,0],[c,d,0],[c,e,0],[b,e,0]],p=m("bhr_polygon_front",n,i,h,0,a),n=[[c,d,0],[c,d,f],[c,e,f],[c,e,0]],q=m("bhr_polygon_right",n,k,h,0,a),n=[[b,d,0],[c,d,0],[c,d,f],[b,d,f]],r=m("bhr_polygon_top",n,j,h,0,a),s=function(a){o.context.globalAlpha=l,p.context.globalAlpha=l,q.context.globalAlpha=l,r.context.globalAlpha=l},t=function(a){o.context.globalAlpha=0,p.context.globalAlpha=0,q.context.globalAlpha=0,r.context.globalAlpha=0};p.hover(s,t),a.addChild(o),a.addChild(p),a.addChild(q),a.addChild(r)},drawCube:function(a,b){var c=this,d=b.x,e=d+b.width,f=b.y,g=f+b.height,h=-1*c.depth,i=b.fillStyle,k=b.fillStyle,l=j.colorBrightness(b.fillStyle,.2),m=j.colorBrightness(b.fillStyle,-.2),n=c.root.drawFace,o=c.globalAlpha,p=[[d,f,0],[d,f,h],[d,g,h],[d,g,0]],q=n("polygon_left",p,m,i,o,a),p=[[d,f,0],[e,f,0],[e,g,0],[d,g,0]],r=n("polygon_front",p,k,i,o,a),p=[[e,f,0],[e,f,h],[e,g,h],[e,g,0]],s=n("polygon_right",p,m,i,o,a),p=[[d,f,0],[e,f,0],[e,f,h],[d,f,h]],t=n("polygon_top",p,l,i,o,a);a.addChild(q),a.addChild(r),a.addChild(s),a.addChild(t)}},k}),define("chartx/chart/bar/3d/xaxis",["canvax/index","canvax/core/Base","canvax/shape/Line","chartx/utils/tools"],function(a,b,c,d){var e=function(a){var b=a.xAxis,c=a.dataFrame.xAxis;this.root=a,this.graphw=0,this.graphh=0,this.yAxisW=0,this.w=0,this.h=0,this.disY=1,this.dis=6,this.label="",this._label=null,this.line={enabled:1,width:1,height:4,strokeStyle:"#cccccc"},this.text={fillStyle:"#999",fontSize:12,rotation:0,format:null,textAlign:null},this.maxTxtH=0,this.pos={x:null,y:null},this.enabled=1,this.disXAxisLine=6,this.disOriginX=0,this.xGraphsWidth=0,this.dataOrg=[],this.dataSection=[],this._layoutDataSection=[],this.data=[],this.layoutData=[],this.sprite=null,this._textMaxWidth=0,this.leftDisX=0,this.filter=null,this.isH=!1,this.animation=!1,this.resize=!1,this.init(b,c)};return e.prototype={init:function(b,c){this.sprite=new a.Display.Sprite({id:"xAxisSprite"}),this._initHandle(b,c)},_initHandle:function(a,b){b&&b.org&&(this.dataOrg=b.org),a&&_.deepExtend(this,a),0!=this.text.rotation&&this.text.rotation%90==0&&(this.isH=!0),this.line.enabled||(this.line.height=1),0==this.dataSection.length&&(this.dataSection=this._initDataSection(this.dataOrg)),this._layoutDataSection=this._formatDataSectionText(this.dataSection),this._setTextMaxWidth(),this._setXAxisHeight()},_initDataSection:function(a){return _.flatten(a)},setX:function(a){this.sprite.context.x=a},setY:function(a){this.sprite.context.y=a},resetData:function(a,b){b&&_.deepExtend(this,b),this.sprite.removeAllChildren(),this.dataSection=[],this._initHandle(null,a),this.draw()},getIndexOfVal:function(a){for(var b,c=0,d=this.data.length;d>c;c++){var e=this.data[c];if(e.content==a){b=c;break}}return b},update:function(a,b){_.deepExtend(this,a),this.resetData(b)},draw:function(a){0==this.data.length,this._getLabel(),this._initConfig(a),this.data=this._trimXAxis(this.dataSection,this.xGraphsWidth);var b=this;_.each(this.data,function(a,c){a.layoutText=b._layoutDataSection[c]}),this._trimLayoutData(),this.setX(this.pos.x),this.setY(this.pos.y),this.enabled&&(this._widget(),this.text.rotation||this._layout()),this.resize=!1},_getLabel:function(){this.label&&""!=this.label&&(this._label=this.sprite.getChildById("xAxis_label_"+this.label)||new a.Display.Text(this.label,{id:"xAxis_label_"+this.label,context:{fontSize:this.text.fontSize,textAlign:this.isH?"center":"left",textBaseline:this.isH?"top":"middle",fillStyle:this.text.fillStyle,rotation:this.isH?-90:0}}))},_initConfig:function(a){a&&_.deepExtend(this,a),this.yAxisW=Math.max(this.yAxisW,this.leftDisX),this.w=this.graphw-this.yAxisW,null==this.pos.x&&(this.pos.x=this.yAxisW+this.disOriginX),null==this.pos.y&&(this.pos.y=this.graphh-this.h),this.xGraphsWidth=parseInt(this.w-this._getXAxisDisLine()),this._label&&(this.isH?this.xGraphsWidth-=this._label.getTextHeight()+5:this.xGraphsWidth-=this._label.getTextWidth()+5),this.disOriginX=parseInt((this.w-this.xGraphsWidth)/2)},_trimXAxis:function(a,b){var c=[];this.xDis=b/a.length;for(var d=0,e=a.length;e>d;d++){var f={content:a[d],x:this.xDis*(d+1)-this.xDis/2};c.push(f)}return c},_formatDataSectionText:function(a){a||(a=this.dataSection);var b=this,c=[];return _.each(a,function(a){c.push(b._getFormatText(a))}),c},_getXAxisDisLine:function(){var a=this.disXAxisLine,b=2*a,c=a;return c=a+this.w%_.flatten(this.dataOrg).length,c=c>b?b:c,c=isNaN(c)?0:c},_setXAxisHeight:function(){if(this.enabled){var b=new a.Display.Text(this._layoutDataSection[0]||"test",{context:{fontSize:this.text.fontSize}});if(this.maxTxtH=b.getTextHeight(),this.text.rotation)if(this.text.rotation%90==0)this.h=this._textMaxWidth+this.line.height+this.disY+this.dis+3;else{var c=Math.sin(Math.abs(this.text.rotation)*Math.PI/180),d=Math.cos(Math.abs(this.text.rotation)*Math.PI/180);this.h=c*this._textMaxWidth+b.getTextHeight()+5,this.leftDisX=d*b.getTextWidth()+8}else this.h=this.disY+this.line.height+this.dis+this.maxTxtH,this.leftDisX=b.getTextWidth()/2}else this.dis=0,this.h=3},_getFormatText:function(a){var b;return b=_.isFunction(this.text.format)?this.text.format(a):a,_.isArray(b)&&(b=d.numAddSymbol(b)),b||(b=a),b},_widget:function(){var b=this.layoutData;this._label&&(this._label.context.x=this.xGraphsWidth+5,this.sprite.addChild(this._label));for(var d=(Math.min(1e3/b.length,25),0),e=b.length;e>d;d++){var f=this.sprite.getChildById("xNode"+d)||new a.Display.Sprite({id:"xNode"+d}),g=b[d],h=g.x,i=this.disY+this.line.height+this.dis,j=f.getChildById("xAxis_txt_"+d)||new a.Display.Text(g.layoutText||g.content,{id:"xAxis_txt_"+d,context:{fillStyle:this.text.fillStyle,fontSize:this.text.fontSize,rotation:-Math.abs(this.text.rotation),textAlign:this.text.textAlign||(this.text.rotation?"right":"center"),textBaseline:this.text.rotation?"middle":"top",globalAlpha:1}});if(j.context.x=h,j.context.y=i,f.addChild(j),this.text.rotation&&90!=this.text.rotation&&(j.context.x+=5,j.context.y+=3),this.line.enabled){var k=f.getChildById("xAxis_line_"+d)||new c({id:"xAxis_line_"+d,context:{lineWidth:this.line.width,strokeStyle:this.line.strokeStyle}});k.context.x=h,k.context.y=this.disY,k.xEnd=0,k.End=this.line.height+this.disY,f.addChild(k)}_.isFunction(this.filter)&&this.filter({layoutData:b,index:d,txt:j,line:k||null}),this.sprite.addChild(f)}},_layout:function(){if(0!=this.data.length){var a=this.sprite.getChildAt(this.sprite.getNumChildren()-1).getChildAt(0);if(a){var b=a.context;if("center"==b.textAlign&&b.x+a.context.width/2>this.w&&(b.x=this.w-a.context.width/2),"left"==b.textAlign&&b.x+a.context.width>this.w&&(b.x=this.w-a.context.width),this.sprite.getNumChildren()>2){var c=this.sprite.getChildAt(this.sprite.getNumChildren()-2).getChildAt(0),d=c.context;d.visible&&b.x<d.x+d.width&&(b.visible=!1)}}}},_setTextMaxWidth:function(){for(var b=this._layoutDataSection,c=b[0],d=0,e=b.length;e>d;d++)b[d].length>c.length&&(c=b[d]);var f=new a.Display.Text(c||"test",{context:{fillStyle:this.text.fillStyle,fontSize:this.text.fontSize}});return this._textMaxWidth=f.getTextWidth(),this._textMaxHeight=f.getTextHeight(),this._textMaxWidth},_trimLayoutData:function(){var a=[],b=this.data,c=this._textMaxWidth+10;this.text.rotation&&(c=1.5*this._textMaxHeight);var d=Math.min(Math.floor(this.w/c),b.length-1);if(d>=b.length-1)this.layoutData=b;else{for(var e=Math.max(Math.ceil(b.length/d-1),0),f=0;d>f;f++){var g=b[f+e*f];g&&a.push(g)}this.layoutData=a}}},e}),define("chartx/chart/bar/3d/yaxis",["canvax/index","canvax/core/Base","canvax/shape/Line","chartx/utils/tools","chartx/utils/datasection"],function(a,b,c,d,e){var f=function(a){var b=a.yAxis,c=a.dataFrame.yAxis,d=a._getaverageData();this.root=a,this.w=0,this.enabled=1,this.dis=6,this.maxW=0,this.field=null,this.label="",this._label=null,this.line={enabled:1,width:4,lineWidth:1,strokeStyle:"#cccccc"},this.text={fillStyle:"#999",fontSize:12,format:null,rotation:0},this.pos={x:0,y:0},this.place="left",this.biaxial=!1,this.layoutData=[],this.dataSection=[],this.dataSectionGroup=[],this.middleweight=null,this.dataOrg=[],this.sprite=null,this.disYAxisTopLine=6,this.yMaxHeight=0,this.yGraphsHeight=0,this.baseNumber=null,this.basePoint=null,this.filter=null,this.isH=!1,this.animation=!0,this.resize=!1,this.sort=null,this.init(b,c,d)};return f.prototype={init:function(b,c,d){_.deepExtend(this,b),0!=this.text.rotation&&this.text.rotation%90==0&&(this.isH=!0),this._initData(c,d),this.sprite=new a.Display.Sprite},setX:function(a){this.sprite.context.x=a+("left"==this.place?this.maxW:0),this.pos.x=a},setY:function(a){this.sprite.context.y=a,this.pos.y=a},setAllStyle:function(a){_.each(this.sprite.children,function(b){_.each(b.children,function(b){"text"==b.type?b.context.fillStyle=a:"line"==b.type&&(b.context.strokeStyle=a)})})},resetData:function(a,b){b&&_.deepExtend(this,b),this.sprite.removeAllChildren(),this.dataSection=[],this.dataSectionGroup=[],this._initData(a),this._trimYAxis(),this._widget()},update:function(a,b){this.sprite.removeAllChildren(),this.dataSection=[],this.dataSectionGroup=[],_.deepExtend(this,a),this._initData(b),this._trimYAxis(),this._widget()},_getLabel:function(){this.label&&""!=this.label&&(this._label=this.sprite.getChildById("yAxis_label_"+this.label)||new a.Display.Text(this.label,{id:"yAxis_label_"+this.label,context:{fontSize:this.text.fontSize,textAlign:"left",textBaseline:this.isH?"top":"bottom",fillStyle:this.text.fillStyle,rotation:this.isH?-90:0}}))},draw:function(a){this.sprite.removeAllChildren(),a&&_.deepExtend(this,a),this._getLabel(),this.yGraphsHeight=this.yMaxHeight-this._getYAxisDisLine(),this._label&&(this.isH?this.yGraphsHeight-=this._label.getTextWidth():this.yGraphsHeight-=this._label.getTextHeight(),this._label.context.y=-this.yGraphsHeight-5),this._trimYAxis(),this._widget(),this.setX(this.pos.x),this.setY(this.pos.y),this.resize=!1},getYposFromVal:function(a){for(var b=0,c=this.dataSectionGroup.length,d=this.yGraphsHeight/c,e=0,f=c;f>e;e++){var g=this.dataSectionGroup[e],h=_.min(g),i=_.max(g),j=g[0],k=g.slice(-1)[0];if(a>h&&i>=a||"desc"==this.sort&&a>=h&&i>a){var b=-((a-j)/(k-j)*d+e*d);break}}return b=isNaN(b)?0:parseInt(b)},_trimYAxis:function(){for(var a=this.dataSection[this.dataSection.length-1],b=[],c=0,d=this.dataSection.length;d>c;c++)b[c]={content:this.dataSection[c],y:this.getYposFromVal(this.dataSection[c])};this.layoutData=b;var e=-(this.baseNumber-this._bottomNumber)/(a-this._bottomNumber)*this.yGraphsHeight;e=isNaN(e)?0:parseInt(e),this.basePoint={content:this.baseNumber,y:e}},_getYAxisDisLine:function(){var a=this.disYAxisTopLine,b=2*a,c=a;return c=a+this.yMaxHeight%this.dataSection.length,c=c>b?b:c},_setDataSection:function(a,b){var c=[];return _.each(a.org,function(a,b){if(a.length){if(!_.isArray(a[0]))return void c.push(a);for(var d=[],e=a[0].length,f=a.length,g=0,b=0;e>b;b++){for(var h=0,i=0;f>i;i++)h+=a[i][b],g=Math.min(a[i][b],g);d.push(h)}d.push(g),c.push(d)}}),_.flatten(c)},_initData:function(a,b){var c=this._setDataSection(a,b);this.dataOrg=a.org||a.data,0==this.dataSection.length&&(this.dataSection=e.section(c,3)),0==this.dataSection.length&&(this.dataSection=[0]),this.dataSectionGroup=[_.clone(this.dataSection)],this._sort(),this._setBottomAndBaseNumber(),this._middleweight()},_sort:function(){if(this.sort){var a="asc";if(_.isString(this.sort)&&(a=this.sort),_.isArray(this.sort)){var b=0;"right"==this.place&&(b=1),this.sort[b]&&(a=this.sort[b])}"desc"==a&&(this.dataSection.reverse(),_.each(this.dataSectionGroup,function(a,b){a.reverse()}),this.dataSectionGroup.reverse())}},_setBottomAndBaseNumber:function(){if(this._bottomNumber=this.dataSection[0],null==this.baseNumber){var a=_.min(this.dataSection);this.baseNumber=a>0?a:0}},_middleweight:function(){if(this.middleweight){_.isArray(this.middleweight)||(this.middleweight=[this.middleweight]);for(var a=_.min(this.dataSection),b=_.max(this.dataSection),c=[a],d=[],e=0,f=this.middleweight.length;f>e;e++){var g=a;e>0&&(g=this.middleweight[e-1]);var h=g+parseInt((this.middleweight[e]-g)/2);c.push(h),c.push(this.middleweight[e]),d.push([g,h,this.middleweight[e]])}var i=parseInt(this.middleweight.slice(-1)[0]);c.push(i+parseInt((b-i)/2)),c.push(b),d.push([i,i+parseInt((b-i)/2),b]),this.dataSection=c,this.dataSectionGroup=d,this._sort(),this._setBottomAndBaseNumber()}},resetWidth:function(a){var b=this;b.w=a,b.line.enabled?b.sprite.context.x=a-b.dis-b.line.width:b.sprite.context.x=a-b.dis},_widget:function(){var b=this;if(!b.enabled)return void(b.w=0);var e=this.layoutData;b.maxW=0,b._label&&b.sprite.addChild(b._label);for(var f=0,g=e.length;g>f;f++){var h=e[f],i=0,j=h.y,k=h.content;_.isFunction(b.text.format)&&(k=b.text.format(k,b)),(void 0===k||null===k)&&(k=d.numAddSymbol(h.content));var l=b.sprite.getChildById("yNode"+f)||new a.Display.Sprite({id:"yNode"+f}),m="left"==b.place?"right":"left";(90==b.text.rotation||-90==b.text.rotation)&&(m="center",f==e.length-1&&(m="right"));var n=j+(0==f?-3:0)+(f==e.length-1?3:0);(90==b.text.rotation||-90==b.text.rotation)&&(f==e.length-1&&(n=j-2),0==f&&(n=j));var o=l.getChildById("yAxis_txt_"+f)||new a.Display.Text(k,{id:"yAxis_txt_"+f,context:{fillStyle:b.text.fillStyle,fontSize:b.text.fontSize,rotation:-Math.abs(this.text.rotation),textAlign:m,textBaseline:"middle",globalAlpha:0}});if(o.context.x=i+("left"==b.place?-5:5),o.context.y=n+20,l.addChild(o),b.maxW=Math.max(b.maxW,o.getTextWidth()),(90==b.text.rotation||-90==b.text.rotation)&&(b.maxW=Math.max(b.maxW,o.getTextHeight())),b.line.enabled){var p=l.getChildById("yAxis_line_"+f)||new c({id:"yAxis_line_"+f,context:{lineWidth:b.line.lineWidth,strokeStyle:b.line.strokeStyle}});p.context.x=0+("left"==b.place?1:-1)*b.dis-2,p.context.y=j,p.context.xEnd=b.line.width,p.context.yEnd=0,l.addChild(p)}_.isFunction(b.filter)&&b.filter({layoutData:b.layoutData,index:f,txt:o,line:p}),b.sprite.addChild(l),o.context.y=o.context.y-20,o.context.globalAlpha=1}b.maxW+=b.dis,b.line.enabled?b.w=b.maxW+b.dis+b.line.width+b.pos.x:b.w=b.maxW+b.dis+b.pos.x}},f}),define("chartx/chart/bar/3d/back",["canvax/index","canvax/shape/Line","chartx/utils/tools","canvax/shape/Shapes","chartx/utils/colorformat"],function(a,b,c,d,e){var f=function(a){var b=a.back;this.root=a,this.w=0,this.h=0,this._depth=-100,this.pos={x:0,y:0},this.enabled=1,this.xOrigin={enabled:1,lineWidth:1,strokeStyle:"#eee"},_.extend(this.yOrigin={},this.xOrigin,{biaxial:!1}),this.xAxis={enabled:1,data:[],org:null,lineType:"solid",lineWidth:1,strokeStyle:"#f5f5f5",filter:null},_.extend(this.yAxis={},this.xAxis),this.sprite=null,this.xAxisSp=null,this.yAxisSp=null,this.resize=!1,this.isFillBackColor=1,this.init(b)};return f.prototype={init:function(b){_.deepExtend(this,b),b&&b.depth&&(this._depth=-b.depth),this.sprite=new a.Display.Sprite},setX:function(a){this.sprite.context.x=a},setY:function(a){this.sprite.context.y=a},draw:function(a){_.deepExtend(this,a),this._widget(),this.setX(this.pos.x),this.setY(this.pos.y)},update:function(a){this.sprite.removeAllChildren(),this.draw(a)},_drawLine:function(a,c,d,e){var f=c.getChildById(a)||new b({id:a,context:{lineType:e.lineType,lineWidth:e.lineWidth,strokeStyle:e.strokeStyle}});return _.extend(f.context,d),f.zStart=d.zStart,f.zEnd=d.zEnd,f},drawBackground:function(a,b,c,d,e){var f=this,g="#000",h=b.context,i=c.context,j=[[h.xStart,h.yStart,b.zStart],[h.xEnd,h.yEnd,b.zEnd],[i.xEnd,i.yEnd,c.zEnd],[i.xStart,i.yStart,c.zStart]],k=f.root.drawFace(a,j,g,g,d,e);f.sprite.addChild(k)},_widget:function(){var b=this,c=this._depth;if(this.enabled){if(b.root&&b.root._yAxis&&b.root._yAxis.dataSectionGroup){b.yGroupSp=new a.Display.Sprite,b.sprite.addChild(b.yGroupSp);for(var d=0,e=b.root._yAxis.dataSectionGroup.length;e>d;d++){var f=b.root._yAxis.yGraphsHeight/e,g="Back_section_"+d,h=0,i=h+b.w,j=-f*d,k=j-f,l=[[h,j,0],[h,j,c],[i,j,c],[i,k,c],[h,k,c],[h,k,0]],m=b.root.drawFace(g,l,"#000","#000",.04*(d%2),b.yGroupSp);b.yGroupSp.addChild(m)}}b.xAxisSp=b.sprite.getChildById("Back_xAsix")||new a.Display.Sprite({id:"Back_xAsix"}),b.sprite.addChild(b.xAxisSp),b.yAxisSp=b.sprite.getChildById("Back_yAsix")||new a.Display.Sprite({id:"Back_yAsix"}),b.sprite.addChild(b.yAxisSp);var n=b.xAxis.data;if(b.xAxis.enabled){for(var o=0,p=n.length;p>o;o++){var q=n[o],g="back_line_xAxis_"+o,r={xStart:0,yStart:q.y,xEnd:b.w,yEnd:q.y,zStart:c,zEnd:c},s=b._drawLine(g,b.xAxisSp,r,b.xAxis);_.isFunction(b.xAxis.filter)&&b.xAxis.filter({layoutData:b.yAxis.data,index:o,line:s}),b.xAxisSp.addChild(s);var g="back_line_xAxis_z_"+o,r={xStart:0,yStart:q.y,xEnd:0,yEnd:q.y,zStart:0,zEnd:c},s=b._drawLine(g,b.xAxisSp,r,b.xAxis);b.xAxisSp.addChild(s)}if(b.xOrigin.enabled){var t=null==b.xAxis.org?0:_.find(b.xAxis.data,function(a){return a.content==b.xAxis.org}).y,g="Back_xAxisOrg",r={xStart:t,yStart:0,xEnd:b.w,yEnd:t,zStart:0,zEnd:0},s=b._drawLine(g,b.xAxisSp,r,b.xOrigin);b.xAxisSp.addChild(s)}if(b.isFillBackColor){var g="Back_xBackground",u=b.xAxisSp.getChildById("Back_xAxisOrg"),v=b.xAxisSp.getChildById("back_line_xAxis_0"),w=.04;b.drawBackground(g,u,v,w,b.sprite)}}var n=b.yAxis.data;if(b.yAxis.enabled){n.unshift({x:.5}),n.push({x:b.w});for(var o=0,p=n.length;p>o;o++){var q=n[o],g="back_line_yAxis_"+o,r={xStart:q.x,yStart:0,xEnd:q.x,yEnd:-b.h,zStart:c,zEnd:c},s=b._drawLine(g,b.yAxisSp,r,b.yAxis);s.context.visible=q.x?!0:!1,_.isFunction(b.yAxis.filter)&&b.yAxis.filter({layoutData:b.xAxis.data,index:o,line:s}),b.yAxisSp.addChild(s);var g="back_line_yAxis_z_"+o,r={xStart:q.x,yStart:0,xEnd:q.x,yEnd:0,zStart:0,zEnd:c},s=b._drawLine(g,b.yAxisSp,r,b.yAxis);s.context.visible=q.x?!0:!1,b.yAxisSp.addChild(s)}if(b.yOrigin.enabled){var t=null==b.yAxis.org?0:_.find(b.yAxis.data,function(a){return a.content==b.yAxis.org}).x,g="Back_yAxisOrg",r={xStart:t,yStart:0,xEnd:t,yEnd:-b.h,zStart:0,zEnd:0},s=b._drawLine(g,b.yAxisSp,r,b.yOrigin);b.yAxisSp.addChild(s)}if(b.isFillBackColor){var g="Back_yBackground",u=b.yAxisSp.getChildById("Back_yAxisOrg"),v=b.yAxisSp.getChildById("back_line_yAxis_0"),w=.1;b.drawBackground(g,u,v,w,b.sprite)}}if(b.yOrigin.biaxial,b.isFillBackColor){var g="Back_Background",x=b.xAxis.data.length-1,u=b.xAxisSp.getChildById("back_line_xAxis_"+x),v=b.xAxisSp.getChildById("back_line_xAxis_0"),w=.02;b.drawBackground(g,u,v,w,b.sprite)}}}},f}),define("chartx/chart/bar/3d",["chartx/chart/index","chartx/utils/tools","chartx/utils/datasection","chartx/components/tips/tip","chartx/utils/dataformat","chartx/components/datazoom/index","chartx/components/legend/index","chartx/chart/bar/3d/xaxis","chartx/chart/bar/3d/yaxis","chartx/chart/bar/3d/back","chartx/chart/bar/3d/graphs","canvax/shape/Shapes","chartx/utils/math3d/vec3","chartx/utils/math3d/vec4","chartx/utils/math3d/mat4","chartx/utils/math3d/quat"],function(a,b,c,d,e,f,g,h,j,k,l,m,n,o,p,q){var r=a.Canvax,s=a.extend({init:function(a,b,c){this._xAxis=null,this._yAxis=null,this._back=null,this._graphs=null,this._tip=null,this._checkedList=[],this._currCheckedList=[],this._node=a,this._data=b,this._opts=c,this.padding.top=20,this.dataZoom={enabled:!1,range:{start:0,end:b.length-1}},c.dataZoom&&(this.dataZoom.enabled=!0,this.padding.bottom+=c.dataZoom.height||46),this.mode=0,c.proportion?(this.proportion=c.proportion,this._initProportion(a,b,c)):_.deepExtend(this,c),this.dataFrame=this._initData(b),this._setLegend(),this._fieldsDisplayMap=this.__setFieldsDisplay(this._opts.yAxis.field||this._opts.yAxis.bar.field),this._init&&this._init(a,b,c),this._projectMatrix=p.create(),this._viewMatrix=p.create(),this._viewProjectMatrix=p.create(),this._initProjection(),this._eye=n.fromValues(0,0,2*this.height),this._rotation={x:15,y:15},_.extend(this._rotation,this._opts.rotation),this._rotationCamera(),1==this.mode&&this._adjustmentFitPosition()},_reset:function(a){this._initProjection(),this._eye=n.fromValues(0,0,this.height),this._rotation={x:15,y:15},_.extend(this,a.options),this._rotationCamera(),1==this.mode&&this._adjustmentFitPosition()},_initProjection:function(){if(1==this.mode){var a=45*Math.PI/180,b=this.width/this.height,c=.1,d=1e3;p.perspective(this._projectMatrix,a,b,c,d)}else{var e=-1*(.5*this.width+this.padding.left),f=.5*this.width+this.padding.right,g=.5*this.height+this.padding.top,h=-1*(.5*this.height+this.padding.bottom),c=1e3,d=-1e3;p.ortho(this._projectMatrix,e,f,h,g,c,d)}},_initCamera:function(){var a=[0,0,0],b=[0,1,0],c=this._eye;p.lookAt(this._viewMatrix,c,a,b),p.multiply(this._viewProjectMatrix,this._projectMatrix,this._viewMatrix)},_rotationCamera:function(){var a=this,b=a._rotation.x,c=a._rotation.y,d=q.create(),e=p.create(),f=n.length(this._eye),g=n.fromValues(0,0,f);1==a.mode&&(b=void 0!==b?Math.max(10,Math.min(b,45)):25,c=void 0!==c?Math.max(10,Math.min(c,45)):25),q.rotateY(d,d,c*Math.PI/180),q.rotateX(d,d,-1*b*Math.PI/180),p.fromQuat(e,d),n.transformMat4(a._eye,g,e),a._initCamera()},_adjustmentFitPosition:function(){var a=this,b=.5*a.width,c=.5*a.height,d=a.back&&a.back.depth||100,e=[],f=[],g=!1,h=n.create(),j=5;for(i=0,t=0;i<24;i+=3)e[i]=i%2===0?-1*b:b,e[i+1]=-1===_.indexOf([2,3,6,7],t)?c:-1*c,e[i+2]=t<4?0:-1*d,t++;for(;;){a._initCamera(),f=a._worldToScreen(e);var k=1/0,l=1/0,m=-(1/0),o=-(1/0);for(i=0;i<f.length;i+=3)k=Math.min(k,f[i]),m=Math.max(m,f[i]),l=Math.min(l,f[i+1]),o=Math.max(o,f[i+1]);if(j>k||j>l||m>a.width-j||o>a.height-j){if(g){g=!1,n.scale(a._eye,a._eye,.9),a._initCamera();break}n.scale(h,a._eye,.5),n.add(a._eye,a._eye,h)}else g=!0,n.scale(h,a._eye,.1),n.sub(a._eye,a._eye,h)}},resetData:function(a){this._data=a,this.dataFrame=this._initData(a,this),this._xAxis.resetData(this.dataFrame.xAxis,this.xAxis),this.dataZoom.enabled?(this.__cloneBar=this._getCloneBar(),this._yAxis.resetData(this.__cloneBar.thumbBar.dataFrame.yAxis,{}),
this._dataZoom.sprite.destroy(),this._initDataZoom()):this._yAxis.resetData(this.dataFrame.yAxis,this.yAxis),this._graphs.resetData(this._trimGraphs()),this._graphs.grow(function(){},{delay:0}),this.fire("_resetData")},getCheckedCurrList:function(){var a=this;return _.filter(a._getCurrCheckedList(),function(a){return a})},getCheckedList:function(){var a=this;return _.filter(a._checkedList,function(a){return a})},__setFieldsDisplay:function(a){for(var b=_.clone(a),c=0,d=a.length;d>c;c++)_.isString(a[c])&&(b[c]={field:a[c],enabled:!0}),_.isArray(a[c])&&(b[c]=this.__setFieldsDisplay(a[c]));return b},_getFieldsOfDisplay:function(a){var b=[];!a&&(a=this._fieldsDisplayMap);for(var c=0,d=a.length;d>c;c++)if(_.isArray(a[c])){var e=this._getFieldsOfDisplay(a[c]);e.length>0&&(b[c]=e)}else a[c].field&&a[c].enabled&&(b[c]=a[c].field);return b},_setFieldDisplay:function(a){function b(c){_.each(c,function(c,d){_.isArray(c)?b(c):c.field&&c.field==a&&(c.enabled=!c.enabled)})}var c=this;b(c._fieldsDisplayMap)},_resetOfLengend:function(a){var b=this;if(b._setFieldDisplay(a),_.deepExtend(this,{yAxis:{field:b._getFieldsOfDisplay()}}),this.graphs&&this.graphs.bar&&_.isFunction(this.graphs.bar.fillStyle)){var c=this.graphs.bar.fillStyle;this.graphs.bar.fillStyle=function(a){var d=c(a);return d||b._legend&&(d=b._legend.getStyle(a.field).fillStyle),d}}else _.deepExtend(this,{graphs:{bar:{fillStyle:function(a){return b._legend?b._legend.getStyle(a.field).fillStyle:void 0}}}});for(var d=0,e=this.canvax.children.length;e>d;d++)for(var f=this.canvax.getChildAt(d),g=0,h=f.children.length;h>g;g++){var i=f.getChildAt(g);"LegendSprite"!=i.id&&"legend_tip"!=i.id&&(f.getChildAt(g).destroy(),g--,h--)}this.dataFrame=this._initData(this._data),this.draw()},_setLegend:function(){var a=this;if(!(!this.legend||this.legend&&"enabled"in this.legend&&!this.legend.enabled)){var b=_.deepExtend({enabled:!0,label:function(a){return a.field},onChecked:function(b){a._resetOfLengend(b)},onUnChecked:function(b){a._resetOfLengend(b)}},this._opts.legend);this._legend=new g(this._getLegendData(),b),this._legend.sprite.noTransform=!0,this.stage.addChild(this._legend.sprite),this._legend.pos({x:0,y:this.padding.top}),this.padding.top+=this._legend.height}},_getLegendData:function(){var a=this,b=[];return _.each(_.flatten(a.dataFrame.yAxis.field),function(a,c){b.push({field:a,value:null,fillStyle:null})}),b},checkAt:function(a){var b=this,c=a-b.dataZoom.range.start,d=b._graphs.getInfo(c);b._checkedList[a]=d,b._checkedBar({iNode:c,checked:!0}),b._checkedMiniBar({iNode:a,checked:!0}),d.iNode=a},uncheckAt:function(a){var b=this,c=a-b.dataZoom.range.start;b._checkedList[a]&&b._checked(b._graphs.getInfo(c))},uncheckAll:function(){for(var a=0,b=this._checkedList.length;b>a;a++){var c=this._checkedList[a];c&&this.uncheckAt(a)}this._checkedList=[],this._currCheckedList=[]},checkOf:function(a){this.checkAt(this._xAxis.getIndexOfVal(a)+this.dataZoom.range.start)},uncheckOf:function(a){this.uncheckAt(this._xAxis.getIndexOfVal(a)+this.dataZoom.range.start)},getGroupChecked:function(a){var b=!1;return _.each(this.getCheckedList(),function(c){c&&c.iNode==a.eventInfo.iNode&&(b=!0)}),b},_initProportion:function(a,c,d){!d.tips&&(d.tips={}),d.tips=_.deepExtend(d.tips,{content:function(a){var c="<table>",d=this;return _.each(a.nodesInfoList,function(a,e){c+="<tr style='color:"+a.fillStyle+"'>";var f=d.prefix[e];f?c+="<td>"+f+"：</td>":a.field&&(c+="<td>"+a.field+"：</td>"),c+="<td>"+b.numAddSymbol(a.value)+"（"+Math.round(a.value/a.vCount*100)+"%）</td></tr>"}),c+="</table>"}}),_.deepExtend(this,d),_.deepExtend(this.yAxis,{dataSection:[0,20,40,60,80,100],text:{format:function(a){return a+"%"}}}),!this.graphs&&(this.graphs={}),_.deepExtend(this.graphs,{bar:{radius:0}})},_setStages:function(){this.core=new r.Display.Sprite({id:"core"}),this.stageBg=new r.Display.Sprite({id:"bg"}),this.stageTip=new r.Display.Sprite({id:"tip"}),this.stage.addChild(this.stageBg),this.stage.addChild(this.core),this.stage.addChild(this.stageTip),this.rotate&&this._rotate(this.rotate)},draw:function(){this._setStages(),this._initModule(),this._startDraw(),this._drawEnd(),this.inited=!0,this._to3d(this.stage)},_initData:function(a,b){var c;if(this.dataZoom.enabled){var d=[a[0]];d=d.concat(a.slice(this.dataZoom.range.start+1,this.dataZoom.range.end+1+1)),c=e.apply(this,[d,b])}else c=e.apply(this,arguments);return _.each(c.yAxis.field,function(a,b){_.isArray(a)||(a=[a],c.yAxis.org[b]=[c.yAxis.org[b]])}),c},_getaverageData:function(){var a=[],b=this;return this._graphs&&this._graphs.average&&this._graphs.average.data?this._graphs.average.data:(this._graphs.average.enabled&&_.each(this.dataFrame.data,function(c,d){c.field==b._graphs.average.field&&(a=c.data)}),this._graphs.average.data=a,a)},_setaverageLayoutData:function(){var a=[],b=this;if(this._graphs.average.enabled){var c=this._yAxis.dataSection[this._yAxis.dataSection.length-1];_.each(this._graphs.average.data,function(d,e){a.push({value:d,y:-(d-b._yAxis._bottomNumber)/Math.abs(c-b._yAxis._bottomNumber)*b._yAxis.yGraphsHeight})}),this._graphs.average.layoutData=a}},_initModule:function(){this._graphs=new l(this),this._xAxis=new h(this),this._yAxis=new j(this),this._back=new k(this),this._tip=new d(this.tips,this.canvax.getDomContainer())},_startDraw:function(a){var b=a&&a.w||this.width,c=a&&a.h||this.height,d=parseInt(c-this._xAxis.h),e=d-this.padding.top-this.padding.bottom;this._yAxis.draw({pos:{x:this.padding.left,y:d-this.padding.bottom},yMaxHeight:e}),this.dataZoom.enabled&&(this.__cloneBar=this._getCloneBar(),this._yAxis.resetData(this.__cloneBar.thumbBar.dataFrame.yAxis,{}),this._yAxis.setX(this._yAxis.pos.x));var f=this._yAxis.w;this._xAxis.draw({graphh:c-this.padding.bottom,graphw:b-this.padding.right,yAxisW:f}),this._xAxis.yAxisW!=f&&(this._yAxis.resetWidth(this._xAxis.yAxisW),f=this._xAxis.yAxisW);var g=this._yAxis.yGraphsHeight;this._back.draw({w:this._xAxis.xGraphsWidth,h:g,xAxis:{data:this._yAxis.layoutData},yAxis:{data:this._xAxis.layoutData},pos:{x:f,y:d-this.padding.bottom}}),this._setaverageLayoutData();var h=this._trimGraphs();if(this._graphs.draw(h.data,{w:this._xAxis.xGraphsWidth,h:this._yAxis.yGraphsHeight,pos:{x:f,y:d-this.padding.bottom},yDataSectionLen:this._yAxis.dataSection.length,sort:this._yAxis.sort}),this.dataZoom.enabled&&this._initDataZoom(),this._legend&&!this._legend.inited){this._legend.pos({x:f});for(var i in this._graphs._yAxisFieldsMap){var j=this._graphs._yAxisFieldsMap[i].fillStyle;this._legend.setStyle(i,{fillStyle:j})}this._legend.inited=!0}},_setXaxisYaxisToTipsInfo:function(a){if(a.eventInfo){a.eventInfo.xAxis={field:this.dataFrame.xAxis.field,value:this.dataFrame.xAxis.org[0][a.eventInfo.iNode]};var b=this;_.each(a.eventInfo.nodesInfoList,function(a,c){b._checkedList[a.iNode+b.dataZoom.range.start]?a.checked=!0:a.checked=!1}),a.eventInfo.dataZoom=b.dataZoom,a.eventInfo.rowData=this.dataFrame.getRowData(a.eventInfo.iNode),a.eventInfo.iNode+=this.dataZoom.range.start}},_trimGraphs:function(a,b){a||(a=this._xAxis),b||(b=this._yAxis);var c=a.data,d=b.dataOrg,e=d.length,f=a.xDis,g=f/(e+1);this._graphs.checkBarW&&this._graphs.checkBarW(f,g);for(var h=b.dataSection[b.dataSection.length-1],i=[],j=[],k=[],l=[],m=this,n=0;e>n;n++){!i[n]&&(i[n]=[]),k[n]=0,j[n]={};var o=d[n];_.each(o,function(a,d){!i[n][d]&&(i[n][d]=[]),m.dataZoom.enabled&&(a=a.slice(m.dataZoom.range.start,m.dataZoom.range.end+1)),_.each(a,function(e,h){if(c[h]){var j=0;m.proportion&&_.each(o,function(a,b){j+=a[h]});var p=c[h].x-f/2+g*(n+1),q=0;q=m.proportion?-e/j*b.yGraphsHeight:b.getYposFromVal(e),d>0&&(q+=i[n][d-1][h].y),m._yAxis.sort&&"desc"==m._yAxis.sort&&(q=-(b.yGraphsHeight-Math.abs(q)));var r={value:e,field:m._getTargetField(n,d,h,b.field),x:p,y:q};m.proportion&&(r.vCount=j),i[n][d].push(r),k[n]+=Number(e),l=a.length}})})}for(var p=0,q=k.length;q>p;p++)j[p].agValue=k[p]/l,j[p].agPosition=-(k[p]/l-b._bottomNumber)/(h-b._bottomNumber)*b.yGraphsHeight;return this.dataFrame.yAxis.center=j,{data:i}},_getTargetField:function(a,b,c,d){if(d||(d=this._yAxis.field),_.isString(d))return d;if(_.isArray(d)){var e=d[a];if(_.isString(e))return e;if(_.isArray(e))return e[b]}},_drawEnd:function(){var a=this;this.stageBg.addChild(this._back.sprite),this.core.addChild(this._xAxis.sprite),this.core.addChild(this._graphs.sprite),this.core.addChild(this._yAxis.sprite),this.stageTip.addChild(this._tip.sprite),this._graphs.grow(function(b){a._opts.markLine&&a._initMarkLine(b),a._opts.markPoint&&a._initMarkPoint(b)}),this.bindEvent()},_initDataZoom:function(){var a=this,b=_.deepExtend({w:a._xAxis.xGraphsWidth,count:a._data.length-1,pos:{x:a._xAxis.pos.x,y:a._xAxis.pos.y+a._xAxis.h},dragIng:function(b){(parseInt(a.dataZoom.range.start)!=parseInt(b.start)||parseInt(a.dataZoom.range.end)!=parseInt(b.end))&&(a.dataZoom.range.start=parseInt(b.start),a.dataZoom.range.end=parseInt(b.end),a.dataFrame=a._initData(a._data,this),a._xAxis.reset({animation:!1},a.dataFrame.xAxis),a._graphs.average.data=null,a._graphs.w=a._xAxis.xGraphsWidth,a._getaverageData(),a._setaverageLayoutData(),a._graphs.resetData(a._trimGraphs()),a._graphs.grow(function(){},{delay:0,easing:"Quadratic.Out",duration:300}),a._removeChecked(),a.fire("_dataZoomDragIng"))},dragEnd:function(b){a._updateChecked()}},a.dataZoom);a._dataZoom=new f(b);var c=this.__cloneBar.thumbBar._graphs.sprite;c.id=c.id+"_datazoomthumbbarbg",c.context.x=0,c.context.y=a._dataZoom.barH+a._dataZoom.barY,c.context.scaleY=a._dataZoom.barH/this.__cloneBar.thumbBar._graphs.h,a._dataZoom.dataZoomBg.addChild(c),a.core.addChild(a._dataZoom.sprite),this.__cloneBar.thumbBar.destroy(),this.__cloneBar.cloneEl.parentNode.removeChild(this.__cloneBar.cloneEl)},_getCloneBar:function(){var a=this;barConstructor=this.constructor;var b=a.el.cloneNode();b.innerHTML="",b.id=a.el.id+"_currclone",b.style.position="absolute",b.style.width=a.el.offsetWidth+"px",b.style.height=a.el.offsetHeight+"px",b.style.top="10000px",document.body.appendChild(b);var c=_.deepExtend({},a._opts);_.deepExtend(c,{graphs:{bar:{fillStyle:a.dataZoom.normalColor||"#ececec"},animation:!1,eventEnabled:!1,text:{enabled:!1},average:{enabled:!1}},dataZoom:{enabled:!1},xAxis:{},yAxis:{}});var d=new barConstructor(b,a._data,c);return d.draw(),{thumbBar:d,cloneEl:b}},_initMarkLine:function(a){var b=this;require(["chartx/components/markline/index"],function(c){for(var d=_.flatten(b._yAxis.field),e=0,f=d.length;f>e;e++){var g=e,h=null;if(b.dataFrame.yAxis.center[e]){h=b.dataFrame.yAxis.center[e].agPosition;var i=a._yAxisFieldsMap[d[e]].fillStyle,j=b.dataFrame.yAxis.field[e]+"均值";if(b.markLine.text&&b.markLine.text.enabled&&_.isFunction(b.markLine.text.format)){var k={iGroup:g,value:b.dataFrame.yAxis.center[g].agValue};j=b.markLine.text.format(k)}var k={w:b._xAxis.xGraphsWidth,h:b._yAxis.yGraphsHeight,origin:{x:b._back.pos.x,y:b._back.pos.y},field:_.isArray(b._yAxis.field[e])?b._yAxis.field[e][0]:b._yAxis.field[e],line:{y:h,list:[[0,0],[b._xAxis.xGraphsWidth,0]],strokeStyle:i},text:{content:j,fillStyle:i}};new c(_.deepExtend(k,b._opts.markLine)).done(function(){b.core.addChild(this.sprite),b._to3d(this.sprite);var a=null;_.each(this.sprite.children,function(b){b instanceof m.BrokenLine&&(a=b.context.pointList)});var c=n.fromValues(a[0][0],a[0][1],0),d=n.fromValues(a[1][0],a[1][1],0),e=n.create();n.sub(e,d,c);var f=n.fromValues(1,0,0),g=n.angle(e,f);this.txt.context.rotation=180*g/Math.PI})}}})},_initMarkPoint:function(a){var b=this,c={x:a.sprite.context.x,y:a.sprite.context.y};require(["chartx/components/markpoint/index"],function(d){_.each(a.data,function(a,e){a.length;_.each(a,function(a){_.each(a,function(a){var e=_.clone(a);e.x+=c.x,e.y+=c.y;var f={value:e.value,shapeType:"droplet",markTarget:e.field,iGroup:e.iGroup,iNode:e.iNode,iLay:e.iLay,point:{x:e.x,y:e.y}};new d(b._opts,f).done(function(){b.core.addChild(this.sprite),this.shape&&(this.shape.z=-25),this.shapeBg&&(this.shapeBg.z=-25),this.shapeCircle&&(this.shapeCircle.z=-25),b._to3d(this.sprite);var a=this;this.shape.hover(function(a){this.context.hr++,this.context.cursor="pointer",a.stopPropagation()},function(a){this.context.hr--,a.stopPropagation()}),this.shape.on("mousemove",function(a){a.stopPropagation()}),this.shape.on("tap click",function(c){c.stopPropagation(),c.eventInfo=a,b.fire("markpointclick",c)})})})})})})},_removeChecked:function(){this._graphs.removeAllChecked()},_updateChecked:function(){var a=this;a._currCheckedList=a._getCurrCheckedList();for(var b=0,c=a._currCheckedList.length;c>b;b++){var d=a._currCheckedList[b];a._checkedBar({iNode:d.iNode-a.dataZoom.range.start,checked:!0})}},_getCurrCheckedList:function(){var a=this;return _.filter(a._checkedList,function(b){return b&&b.iNode>=a.dataZoom.range.start&&b.iNode<=a.dataZoom.range.end?b:void 0})},_checked:function(a){var b=this;if(b._graphs.checked.enabled){var c=a.iNode+b.dataZoom.range.start,d=!0;b._checkedList[c]?(b._checkedList[c]=null,d=!1):b._checkedList[c]=a,b._checkedBar({iNode:a.iNode,checked:d}),b._checkedMiniBar({iNode:c,checked:d}),a.iNode=c}},_checkedBar:function(a){var b=this,c=b._graphs;c._checked(a)},_checkedMiniBar:function(a){if(this.dataZoom.enabled){var b=this,c=b.__cloneBar.thumbBar._graphs,d="";a.checked&&(d=b._opts.dataZoom.checked&&b._opts.dataZoom.checked.fillStyle||d),c.setBarStyle({iNode:a.iNode,fillStyle:d})}},bindEvent:function(){var a=this;this._graphs.sprite.on("panstart mouseover",function(b){a._setXaxisYaxisToTipsInfo(b),a._tip.show(b),a.fire(b.type,b)}),this._graphs.sprite.on("panmove mousemove",function(b){a._setXaxisYaxisToTipsInfo(b),a._tip.move(b),a.fire(b.type,b)}),this._graphs.sprite.on("panend mouseout",function(b){a._tip.hide(b),a.fire(b.type,b)}),this._graphs.sprite.on("tap click dblclick mousedown mouseup",function(b){"click"==b.type&&(a.fire("checkedBefor"),a._checked(_.clone(b.eventInfo))),a._setXaxisYaxisToTipsInfo(b),a.fire(b.type,b)}),this.on("_to3d",function(){a._to3d(a.stage)})},drawFace:function(a,b,c,d,e,f){var g=f.getChildById(a)||new m.Polygon({id:a,pointChkPriority:!1,context:{pointList:b,strokeStyle:d,fillStyle:c,globalAlpha:e}});return g.context.pointList=b,g.context.x=0,g.context.y=0,g},_worldToScreen:function(a){for(var b=this,c=new Array(a.length),d=o.create(),e=o.create(),f=0,g=0,h=0;f<a.length;f+=3)g=f+1,h=f+2,o.set(d,a[f],a[g],a[h],1),n.transformMat4(e,d,b._viewProjectMatrix),c[f]=(e[0]+1)*b.width/2,c[g]=(e[1]-1)*b.height/-2,c[h]=e[2];return c},_projectionToScreen:function(a,b){var c,d,e,f=this,g=null;return a instanceof m.Line?(d=[],g=[],c=[a.zStart,a.zEnd],_.each(b,function(a,d){e=f._worldToScreen([b[d].x,b[d].y,c[d]||0]),g.push({x:e[0],y:e[1]})})):a instanceof m.Polygon||a instanceof m.BrokenLine?(g=[],_.each(b,function(b,c){e=f._worldToScreen([b.x,b.y,a.context.pointList[c][2]||0]),g.push({x:e[0],y:e[1]})})):(e=f._worldToScreen([b.x,b.y,a.z||0]),g={x:e[0],y:e[1]}),g},_localToScreen:function(a){var b=null,c=a.parent;if(a instanceof m.Line){var d=c.localToGlobal({x:a.context.xStart+a.context.x,y:a.context.yStart+a.context.y}),e=c.localToGlobal({x:a.context.xEnd+a.context.x,y:a.context.yEnd+a.context.y});b=[d,e]}else a instanceof m.Polygon||a instanceof m.BrokenLine?(b=[],_.each(a.context.pointList,function(d,e){var f=c.localToGlobal({x:d[0]+a.context.x,y:d[1]+a.context.y});b.push(f)})):b=c.localToGlobal({x:a.context.x,y:a.context.y});return b},_screenToWorld:function(a,b,c,d){var e=null;if(a instanceof m.Line){var f={x:d[0].x-.5*b,y:.5*c-d[0].y},g={x:d[1].x-.5*b,y:.5*c-d[1].y};e=[f,g]}else a instanceof m.Polygon||a instanceof m.BrokenLine?(e=[],_.each(d,function(a,d){var f={x:a.x-.5*b,y:.5*c-a.y};e.push(f)})):e={x:d.x-.5*b,y:.5*c-d.y};return e},_screenToLocal:function(a,b){var c=a.parent,d=[];if(a instanceof m.Line){var e=c.globalToLocal({x:b[0].x,y:b[0].y}),f=c.globalToLocal({x:b[1].x,y:b[1].y});a.context.xStart=e.x,a.context.yStart=e.y,a.context.xEnd=f.x,a.context.yEnd=f.y,a.context.x=0,a.context.y=0}else if(a instanceof m.Polygon||a instanceof m.BrokenLine)_.each(b,function(a,b){var e=c.globalToLocal({x:a.x,y:a.y});d.push([e.x,e.y])}),a.context.pointList=d,a.context.x=0,a.context.y=0;else{var g=c.globalToLocal({x:b.x,y:b.y});a.context.x=g.x,a.context.y=g.y}a.xyToInt=!1,a.context.xyToInt=!1},_depthTest:function(a){!function(a){var b=arguments.callee;if(a.children&&a.children.length>0)_.each(a.children,function(a,c){b(a)});else{var c=a.parent;if(a instanceof m.Polygon&&~c.id.indexOf("bar_")){var d=null,e=a.context.pointList;if(_.each(c.children,function(a,b){~a.id.indexOf("front")&&(d=a.context.pointList)}),~a.id.indexOf("left")||~a.id.indexOf("right")){var f=!1,g=n.fromValues(e[1][0],e[1][1],0);if(~a.id.indexOf("left"))var h=n.fromValues(d[0][0],d[0][1],0),i=n.fromValues(d[3][0],d[3][1],0);if(~a.id.indexOf("right"))var h=n.fromValues(d[1][0],d[1][1],0),i=n.fromValues(d[2][0],d[2][1],0);var j=n.create(),k=n.create(),l=n.create();n.sub(j,g,h),n.normalize(j,j),n.sub(k,h,i),n.normalize(k,k),n.cross(l,j,k),~a.id.indexOf("left")&&l[2]<0?f=!0:~a.id.indexOf("right")&&l[2]>0&&(f=!0),f?a.context.visible=!1:a.context.visible=!0}}}}(a)},_to3d:function(a){var b,c,d,e=this;!function(a){var f=arguments.callee;a.noTransform||(a.children&&a.children.length>0&&!a.noSkip?_.each(a.children,function(a,b){f(a)}):(b=e._localToScreen(a),c=e._screenToWorld(a,e.width,e.height,b),d=e._projectionToScreen(a,c),e._screenToLocal(a,d)))}(a),e._depthTest(a)}});return s});