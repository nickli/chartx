define("chartx/chart/line/graphs",["canvax/index","canvax/shape/Rect","chartx/utils/tools","chartx/chart/line/group","chartx/chart/line/markcolumn","canvax/core/Base","canvax/event/EventDispatcher"],function(a,b,c,d,e,f,g){var h=function(a,b){this.w=0,this.h=0,this.y=0,this.opt=a,this.root=b,this.ctx=b.stage.context2D,this.dataFrame=a.dataFrame||b.dataFrame,this.data=[],this.field=this.dataFrame.yAxis.field,this._yAxisFieldsMap={},this._setyAxisFieldsMap(this.field),this.disX=0,this.groups=[],this.iGroup=0,this.iNode=-1,this.sprite=null,this.induce=null,this.eventEnabled=!0,this._eventMap={},this.init(a)};return f.creatClass(h,g,{init:function(b){this.opt=b,_.deepExtend(this,b),this.sprite=new a.Display.Sprite},setX:function(a){this.sprite.context.x=a},setY:function(a){this.sprite.context.y=a},getX:function(){return this.sprite.context.x},getY:function(){return this.sprite.context.y},draw:function(a){_.deepExtend(this,a),this.disX=this._getGraphsDisX(),this.data=this._trimGraphs(),this._widget(a);var b=this;_.each(this.groups,function(a){b._yAxisFieldsMap[a.field].line=a.line})},reset:function(a,b){var c=this;b&&(c.dataFrame=b,c.data=c._trimGraphs()),a&&(_.deepExtend(c,a),a.yAxisChange&&c.yAxisFieldChange(a.yAxisChange,this.dataFrame)),this.disX=this._getGraphsDisX();for(var d=0,e=c.field.length;e>d;d++){var f=c.groups[d];f.reset({data:c.data[f.field]})}},_trimGraphs:function(){function a(g,h,i){for(var j=0,k=g.length;k>j;j++){var l=g[j];if(i&&b.root.biaxial&&j>0&&(b._yAxisFieldsMap[l].yAxisInd=1,c=b.root._yAxisR,e=c.dataSection[c.dataSection.length-1]),_.isArray(l)){var m=[];h.push(m),a(l,m)}else{var n=0;h[j]={};var o=d.getFieldData(l);if(!o)return;for(var p=[],q=0,r=o.length;r>q;q++){var s=b.root._xAxis.getPosX({ind:q,dataLen:r,layoutType:b.root.xAxis.layoutType}),t=-(o[q]-c._bottomNumber)/(e-c._bottomNumber)*c.yGraphsHeight;t=isNaN(t)?0:t,p.push({value:o[q],x:s,y:t}),n+=o[q]}f[l]=p,h[j].agValue=n/r,h[j].agPosition=-(h[j].agValue-c._bottomNumber)/(e-c._bottomNumber)*c.yGraphsHeight}}}var b=this,c=b._yAxis||b.root._yAxis,d=b.dataFrame||b.root.dataFrame,e=c.dataSection[c.dataSection.length-1],f={},g=[];return a(b._getYaxisField(),g,!0),d.yAxis.center=g,f},grow:function(a){var b=0,c=this.groups.length,d=this;return _.each(this.groups,function(e,f){e._grow(function(){b++,a(e),b==c&&d.fire("growComplete")})}),this},_setyAxisFieldsMap:function(a){var b=this;b._yAxisFieldsMap={},_.each(_.flatten(a),function(a,c){var d=b._yAxisFieldsMap[a];d?b._yAxisFieldsMap[a].ind=c:b._yAxisFieldsMap[a]={ind:c,yAxisInd:0}})},_addNewField:function(a){if(!this._yAxisFieldsMap[a]){var b;for(var c in this._yAxisFieldsMap)isNaN(b)&&(b=0),b=Math.max(this._yAxisFieldsMap[c].ind,b);this._yAxisFieldsMap[a]={ind:isNaN(b)?0:++b,yAxisInd:0}}},_getYaxisField:function(a){return this.field},creatFields:function(a,b){var c=this,d=[];return _.each(b,function(b,e){_.isArray(b)?d.push(c.creatFields(a,b)):a==b?d.push(b):d.push(null)}),d},yAxisFieldChange:function(a,b){this.dataFrame=b,this.data=this._trimGraphs();var c=this;_.isString(a)&&(a=[a]);for(var d=0,e=c.field.length;e>d;d++){var f=c.field[d],g=_.find(a,function(a){return a==f});g||(c.remove(d),c.field.splice(d,1),delete c._yAxisFieldsMap[f],d--,e--)}this.field=this.dataFrame.yAxis.field,c._setyAxisFieldsMap(this.field),_.each(a,function(a,b){var d=_.find(c.groups,function(b){return b.field==a});d||c.add(a)}),_.each(c.groups,function(a,b){a.update(_.extend({_groupInd:b},c.opt))})},add:function(a,b){_.deepExtend(this,b),this._addNewField(a),this.data=this._trimGraphs();var c=this.creatFields(a,this._getYaxisField());this._setGroupsForYfield(c),this.update()},remove:function(a){this.groups.splice(a,1)[0].destroy(),this.data=this._trimGraphs(),this.update()},update:function(a){var b=this;_.each(this.groups,function(a,c){a.update({data:b.data[a.field]})})},_setGroupsForYfield:function(a){for(var b=[],c=this,e=0,f=a.length;f>e;e++)if(_.isArray(a[e]))c._setGroupsForYfield(a[e]);else{var g=this.data[a[e]];if(!a[e]||!g)continue;var h=c.root._yAxis.sort,i=c.root.biaxial,j=c.root._yAxis,k=c._yAxisFieldsMap[a[e]];_.isArray(h)&&(h=h[k.yAxisInd]||"asc"),i&&k.yAxisInd>0&&(j=c.root._yAxisR);var l=k.ind,m=new d(a[e],l,c.opt,c.ctx,h,j,c.h,c.w);m.draw({data:g,resize:c.resize}),c.sprite.addChildAt(m.sprite,e);for(var n=!1,o=0,p=c.groups.length;p>o;o++)if(l<c.groups[o]._groupInd){c.groups.splice(o,0,m),n=!0;break}n||c.groups.push(m),b.push(m)}return b},_widget:function(a){var c=this;c._setGroupsForYfield(c.field),c.induce=new b({id:"induce",context:{y:-c.h,width:c.w,height:c.h,fillStyle:"#000000",globalAlpha:0,cursor:"pointer"}}),c.sprite.addChild(c.induce),c.eventEnabled&&(c.induce.on("panstart mouseover",function(a){a.eventInfo=c._getInfoHandler(a)}),c.induce.on("panmove mousemove",function(a){a.eventInfo=c._getInfoHandler(a)}),c.induce.on("panend mouseout",function(a){a.eventInfo=c._getInfoHandler(a),c.iGroup=0,c.iNode=-1}),c.induce.on("tap click",function(a){a.eventInfo=c._getInfoHandler(a)})),c.resize=!1},_getInfoHandler:function(a){var b=a.point.x,d=a.point.y-this.h;b=b>this.w?this.w:b;for(var e=0==this.disX?0:parseInt((b+this.disX/2)/this.disX),f=[],g=0,h=this.groups.length;h>g;g++){var i=this.groups[g].getNodeInfoAt(e);i&&f.push(i)}var j=c.getDisMinATArr(d,_.pluck(f,"y"));this.iGroup=j,this.iNode=e;var k={iGroup:this.iGroup,iNode:this.iNode,nodesInfoList:_.clone(f)};return k},getNodesInfoOfx:function(a){for(var b=[],c=0,d=this.groups.length;d>c;c++){var e=this.groups[c].getNodeInfoOfX(a);e&&b.push(e)}var f={iGroup:-1,iNode:-1,nodesInfoList:_.clone(b)};return f},createMarkColumn:function(a,b){var c=new e(b);this.sprite.addChild(c.sprite),c.h=this.induce.context.height,c.y=-c.h;var d={eventInfo:this.getNodesInfoOfx(a)};return c.show(d,{x:a}),c.data=d.eventInfo,c},_getGraphsDisX:function(){var a=this.dataFrame.org.length-1,b=this.w/(a-1);return 1==a&&(b=0),b}}),h});