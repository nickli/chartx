define("chartx/chart/venn/index",["chartx/chart/index","canvax/shape/Circle","canvax/shape/Path","chartx/layout/venn/index","chartx/utils/colorformat","chartx/components/tips/tip","chartx/chart/theme"],function(a,b,c,d,e,f,g){var h=a.Canvax;return a.extend({init:function(a,b,c){this.colors=g.colors,this.padding=15,this.nodeField="sets",this.valueField="size",this.labelField="label",this._hasLabel=!1,this.text={enabled:0,fillStyle:null,fontSize:18,textAlign:"center",textBaseline:"middle",format:null},this.circle={fillAlpha:.25,fillStyle:null,strokeStyle:null,lineWidth:2},_.deepExtend(this,c),this._initData(_.clone(b))},_initData:function(a){var b=[],c=this,d=a.shift(0);return _.each(a,function(a,e){var f={iNode:e};_.each(d,function(b,d){if(b==c.nodeField){var e=a[d];_.isArray(e)||(e=[e]),f.sets=e}else b==c.valueField?f.size=a[d]:b==c.labelField&&(f.label=a[d],c._hasLabel=!0);f[b]=a[d]}),b.push(f)}),c.dataFrame=b,c._hasLabel&&_.each(b,function(a){if(a.sets.length>1&&!a.label){var b=[];_.each(a.sets,function(a){b.push(c._getNodeDataFromNode(a).label)}),a.label=b}}),b},_getNodeDataFromNode:function(a){var b=null;return _.each(this.dataFrame,function(c,d){return c.sets==a?(b=c,!1):void 0}),b},draw:function(){this.stageTip=new h.Display.Sprite({id:"tip"}),this.core=new h.Display.Sprite({id:"core"}),this.stage.addChild(this.core),this.stage.addChild(this.stageTip),this._initModule(),this._startDraw(),this._drawEnd(),this.inited=!0},_initModule:function(){this._tip=new f(this.tips,this.canvax.getDomContainer()),this._tip._getDefaultContent=this._getTipDefaultContent},_getColor:function(a,b,c){if(_.isString(a))return a;if(_.isArray(a))return a[b];if(_.isFunction(a)){var d=a.apply(this,[b,c]);if(d)return d}return this.colors[b]},getLabel:function(a){var b=null;return _.each(this.dataFrame,function(c){c.sets.join(",")==a&&c.label&&(b=c.label)}),b},_startDraw:function(){var a=this;!function(f){"use strict";function g(a){var b={};f.intersectionArea(a,b);var c=b.arcs;if(0===c.length)return"M 0 0";if(1==c.length){var d=c[0].circle;return i(d.x,d.y,d.radius)}for(var e=["\nM",c[0].p2.x,c[0].p2.y],g=0;g<c.length;++g){var h=c[g],j=h.circle.radius,k=h.width>j;e.push("\nA",j,j,0,k?1:0,1,h.p1.x,h.p1.y)}return e.join(" ")}function i(a,b,c){var d=[];return d.push("\nM",a,b),d.push("\nm",-c,0),d.push("\na",c,c,0,1,0,2*c,0),d.push("\na",c,c,0,1,0,2*-c,0),d.join(" ")}function j(a,b,c){var d,e,g=b[0].radius-f.distance(b[0],a);for(d=1;d<b.length;++d)e=b[d].radius-f.distance(b[d],a),g>=e&&(g=e);for(d=0;d<c.length;++d)e=f.distance(c[d],a)-c[d].radius,g>=e&&(g=e);return g}function k(a,b){var c,d=[];for(c=0;c<a.length;++c){var e=a[c];d.push({x:e.x,y:e.y}),d.push({x:e.x+e.radius/2,y:e.y}),d.push({x:e.x-e.radius/2,y:e.y}),d.push({x:e.x,y:e.y+e.radius/2}),d.push({x:e.x,y:e.y-e.radius/2})}var g=d[0],h=j(d[0],a,b);for(c=1;c<d.length;++c){var i=j(d[c],a,b);i>=h&&(g=d[c],h=i)}var k=f.fmin(function(c){return-1*j({x:c[0],y:c[1]},a,b)},[g.x,g.y],{maxIterations:500,minErrorDelta:1e-10}).solution,l={x:k[0],y:k[1]},m=!0;for(c=0;c<a.length;++c)if(f.distance(l,a[c])>a[c].radius){m=!1;break}for(c=0;c<b.length;++c)if(f.distance(l,b[c])<b[c].radius){m=!1;break}if(!m)if(1==a.length)l={x:a[0].x,y:a[0].y};else{var n={};f.intersectionArea(a,n),l=0===n.arcs.length?{x:0,y:-1e3,disjoint:!0}:f.getCenter(n.arcs.map(function(a){return a.p1}))}return l}function l(a,b){for(var c={},d=0;d<b.length;++d){for(var e=b[d].sets,f={},g=0;g<e.length;++g)f[e[g]]=!0;var h=[],i=[];for(var j in a)j in f?h.push(a[j]):i.push(a[j]);var l=k(h,i);c[e]=l,l.disjoint&&b[d].size>0}return c}f.VennDiagram=function(){var f=Math.PI/2,i=!0,j=d.venn(a.dataFrame);i&&(j=d.normalizeSolution(j,f));var k=d.scaleSolution(j,a.width,a.height,a.padding),m=l(k,a.dataFrame),n=0;for(var o in k){var p=k[o];if(p.radius){var q=e.colorRgb(a._getColor(a.circle.fillStyle,n,o)),r=a._getColor(a.circle.strokeStyle,n,o),s=new b({pointChkPriority:!1,context:{x:p.x,y:p.y,r:p.radius,fillStyle:q.replace(")",","+a.circle.fillAlpha+")").replace("RGB","RGBA"),strokeStyle:r,lineWidth:a.circle.lineWidth}});s.index=n,s.name=o,s.data=a._getNodeDataFromNode(o),a.core.addChild(s),s.hover(function(b){var c=e.colorRgb(a._getColor(a.circle.fillStyle,this.index,this.name)),d=c.replace(")",","+(a.circle.fillAlpha+.1)+")").replace("RGB","RGBA");this.context.fillStyle=d,b.tipsInfo=a._getInfoHandler(this,b),a._tip.show(b)},function(b){var c=e.colorRgb(a._getColor(a.circle.fillStyle,this.index,this.name)),d=c.replace(")",","+a.circle.fillAlpha+")").replace("RGB","RGBA");this.context.fillStyle=d,a._tip.hide(b)}),s.on("mousemove",function(b){b.tipsInfo=a._getInfoHandler(this,b),a._tip.move(b)}),n++}}n=0;for(var t in m){if(t.indexOf(",")<0&&!isNaN(m[t].x)){var u=m[t],v=a.getLabel(t)||t,q=a._getColor(a.text.fillStyle,n,t),w=new h.Display.Text(v,{context:{x:u.x,y:u.y,fillStyle:q,fontSize:a.text.fontSize,textAlign:a.text.textAlign,textBaseline:a.text.textBaseline}});a.core.addChild(w)}n++}var x={},y=function(b){return function(c){var d=b.sets.map(function(b){var d=x[b],e=k[b];return d||(d={x:a.width/2,y:a.height/2,radius:1}),e||(e={x:a.width/2,y:a.height/2,radius:1}),{x:d.x*(1-c)+e.x*c,y:d.y*(1-c)+e.y*c,radius:d.radius*(1-c)+e.radius*c}});return g(d)}},z=[];_.each(a.dataFrame,function(a){if(a.sets.length>1){var b=y(a)(1);z.push({path:b,data:a})}}),_.each(z,function(b,d){var e=b.path;window.bpath=new c({hoverClone:!1,context:{path:e,lineWidth:2,strokeStyle:"RGBA(255,255,255,0)",fillStyle:"RGBA(255,255,255,0)"}}),bpath.data=b.data,bpath.hover(function(b){this.context.strokeStyle="RGBA(255,255,255,1)",b.tipsInfo=a._getInfoHandler(this,b),a._tip.show(b)},function(){this.context.strokeStyle="RGBA(255,255,255,0)",a._tip.hide()}),bpath.on("mousemove",function(b){b.tipsInfo=a._getInfoHandler(this,b),a._tip.move(b)}),a.core.addChild(bpath)})},f.computeTextCentre=k,f.computeTextCentres=l}(d),d.VennDiagram()},_getTipDefaultContent:function(a){return"<div><div style='padding-bottom:3px;'>"+(a.label||a.name)+"ï¼š"+a.value+"</div></div>"},_getInfoHandler:function(a){var b={iNode:a.data.iNode,name:a.data.sets,label:a.data[this.labelField],value:a.data[this.valueField],fillStyle:a.context.strokeStyle};return b},_drawEnd:function(){this.stageTip.addChild(this._tip.sprite)}})});