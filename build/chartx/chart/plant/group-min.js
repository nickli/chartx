define("chartx/chart/plant/group",["canvax/index","canvax/shape/Circle","canvax/shape/Sector"],function(a,b,c){var d=function(a){this.sprite=null,this.data=a.data,this.ind=a.ind,this.groupLen=a.groupLen,this.coordinate=a.coordinate,this.rRange={start:0,to:0},this.circle={maxR:15,minR:5,fillStyle:"#f2fbfb",name:"circle",r:15},this.label={fillStyle:"#666",fontSize:13},this.layout={type:"radian"},this.pit={r:30},this.maxRingNum=0,this.ringNum=0,_.deepExtend(this,a.options),this.circle.maxR>this.pit.r&&(this.pit.r=1.3*this.circle.maxR),this.init()};return d.prototype={init:function(){var b=this;this.sprite=new a.Display.Sprite({id:"group_"+this.ind,context:{x:this.coordinate.origin.x,y:this.coordinate.origin.y}}),this.maxRingNum||(this.maxRingNum=parseInt((this.rRange.to-this.rRange.start)/(2*this.pit.r),10),this.ringNum=Math.min(this.maxRingNum,this.data.org.length-1)),this._resetrRangeTo();var c=[],d=this.data.org[0];_.each(this.data.org,function(a,b){if(b>0){var e={data:{},fillStyle:null,pit:null};_.each(d,function(b,c){e.data[b]=a[c]}),c.push(e)}});var e=b.coordinate.rAxis.field;c=c.sort(function(a,b){return b.data[e]-a.data[e]}),this._rings=this["_setRings_"+this.layout.type+"Range"](c),this.draw()},draw:function(){var c=this;_.each(this._rings,function(d,e){var f={rotation:0};1==d.arcs.length&&0==d.arcs[0][0].radian&&d.arcs[0][1].radian==2*Math.PI&&(f.rotation=parseInt(360*Math.random()));var g=new a.Display.Sprite({context:f});_.each(d.plants,function(h,i){if(h.pit){var j=c.coordinate.getPointInRadian(h.pit.middle,d.r),k=c._getProp(c.circle.r,e,i,h.data),l={x:j.x,y:j.y,r:k,fillStyle:c._getProp(c.circle.fillStyle,e,i,h.data),lineWidth:2,strokeStyle:"#fff"},m=new b({context:l});m.plant=h,m.ringInd=e,m.plantInd=i,g.addChild(m),m.on("panstart mouseover",function(a){a.eventInfo=c._getInfoHandler(a),this.context.r++}),m.on("panmove mousemove",function(a){a.eventInfo=c._getInfoHandler(a)}),m.on("panend mouseout",function(a){a.eventInfo={},this.context.r--}),m.on("tap click",function(a){a.eventInfo=c._getInfoHandler(a)}),m.on("doubletap dblclick",function(a){a.eventInfo=c._getInfoHandler(a)});var n=new a.Display.Text(h.data.name,{context:{x:j.x,y:j.y+k+3,fontSize:c.label.fontSize,textAlign:"center",textBaseline:"top",fillStyle:c.label.fillStyle,rotation:-f.rotation,rotateOrigin:{x:0,y:-(k+3)}}});m.label=n,g.addChild(n)}}),c.sprite.addChild(g)})},_getInfoHandler:function(a){var b=a.target,c={iGroup:this.ind,iNode:b.plantInd,node:b.plant};return c},_resetrRangeTo:function(){this.rRange.to=this.rRange.start+this.ringNum*this.pit.r*2},_getDiffRadian:function(a,b){var c=b-a;return a>b&&(c=(b+2*Math.PI-a)%(2*Math.PI)),c},_setRings_radianRange:function(a){for(var b=this,c=[],d=0,e=this.ringNum;e>d;d++){var f=d*this.pit.r*2+this.pit.r+this.rRange.start,g=this.coordinate.getRadiansAtR(f);Math.atan(this.pit.r/f);c.push({arcs:g,pits:[],plants:[],r:f,max:0})}var h=0;_.each(c,function(a,c){var d=2*Math.asin(b.pit.r/a.r),e=0;_.each(a.arcs,function(c){var f=b._getDiffRadian(c[0].radian,c[1].radian);if(f>=d){var g=parseInt(f/d,10);e+=g;for(var h=0;g>h;h++){var i={hasRadish:!1,start:(c[0].radian+d*h+2*Math.PI)%(2*Math.PI)};i.middle=(i.start+d/2+2*Math.PI)%(2*Math.PI),i.to=(i.start+d+2*Math.PI)%(2*Math.PI),a.pits.push(i)}}}),a.max=e,h+=e,a.pits=_.shuffle(a.pits)});var i=0;return _.each(c,function(b,d){if(i>=a.length)return!1;var e=Math.ceil(b.max/h*a.length);e=Math.min(b.max,e),b.plants=a.slice(i,i+e),d==c.length-1&&(b.plants=a.slice(i)),i+=e,_.each(b.plants,function(a,c){if(!(c>=b.pits.length)){var d=_.filter(b.pits,function(a){return!a.hasRadish}),e=d[parseInt(Math.random()*d.length)];e.hasRadish=!0,a.pit=e}})}),c},_setRings_indexRange:function(a){},_setRings_valRange:function(a){},_getProp:function(a,b,c,d){var e=this.ind;return _.isFunction(a)?a.apply(this,[{groupInd:e,groupLen:this.groupLen,nodeInd:c,ringInd:b,ringLen:this._rings.length,nodeData:d}]):_.isString(a)?a:void 0}},d});