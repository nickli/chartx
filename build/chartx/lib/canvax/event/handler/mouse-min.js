define("canvax/event/handler/mouse",["canvax/core/Base","canvax/display/Point","canvax/event/CanvaxEvent"],function(a,b,c){var d=function(){};return d.prototype={init:function(){var b=this,c=this.canvax;_.each(["click","dblclick","mousedown","mousemove","mouseup","mouseout"],function(d){a.addEvent(c.el,d,function(a){c.updateRootOffset(),b.__mouseHandler(a)})})},__mouseHandler:function(a){var d=this,e=d.canvax;d.curPoints=[new b(c.pageX(a)-e.rootOffset.left,c.pageY(a)-e.rootOffset.top)];var f=d.curPoints[0],g=d.curPointsTarget[0];if("mousedown"==a.type){if(!g){var h=e.getObjectsUnderPoint(f,1)[0];h&&(d.curPointsTarget=[h])}g=d.curPointsTarget[0],g&&g.dragEnabled&&(d._touching=!0)}var i=document.compareDocumentPosition?function(a,b){return b?!!(16&a.compareDocumentPosition(b)):!1}:function(a,b){return b?b!==b&&(a.contains?a.contains(b):!0):!1};if(("mouseup"==a.type||"mouseout"==a.type&&!i(e.el,a.toElement||a.relatedTarget))&&(1==d._draging&&(d._dragEnd(a,g,0),g.fire("dragend",{point:f})),d._draging=!1,d._touching=!1),"mouseout"==a.type)i(e.el,a.toElement||a.relatedTarget)||d.__getcurPointsTarget(a,f);else if("mousemove"==a.type)if(d._touching&&"mousemove"==a.type&&g){if(d._draging){d._dragHander(a,g,0),g._notWatch=!0,g.fire("draging",{point:f}),g._notWatch=!1;var j=e._hoverStage.getChildById(g.id),k=g.getConcatenatedMatrix();j.context.x=k.tx,j.context.y=k.ty}else{g.fire("dragbegin",{point:f}),g._globalAlpha=g.context.globalAlpha,g.context.globalAlpha=0;var l=d._clone2hoverStage(g,0);l.context.globalAlpha=g._globalAlpha}d._draging=!0}else d.__getcurPointsTarget(a,f);else{var m=g;m||(m=e),d.__dispatchEventInChilds(a,[m]),d._cursorHander(m)}e.preventDefault&&(a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1)},__getcurPointsTarget:function(a,b){var d=this,e=d.canvax,f=d.curPointsTarget[0];f&&!f.context&&(f=null);var a=new c(a);if("mousemove"==a.type&&f&&f._hoverClass&&f.pointChkPriority&&f.getChildInPoint(b))return a.target=a.currentTarget=f,a.point=f.globalToLocal(b),void f.dispatchEvent(a);var g=e.getObjectsUnderPoint(b,1)[0];(f&&f!=g||"mouseout"==a.type)&&f&&f.context&&(d.curPointsTarget[0]=null,a.type="mouseout",a.toTarget=g,a.target=a.currentTarget=f,a.point=f.globalToLocal(b),f.dispatchEvent(a)),g&&f!=g&&(d.curPointsTarget[0]=g,a.type="mouseover",a.fromTarget=f,a.target=a.currentTarget=g,a.point=g.globalToLocal(b),g.dispatchEvent(a)),"mousemove"==a.type&&g&&(a.target=a.currentTarget=f,a.point=f.globalToLocal(b),f.dispatchEvent(a)),d._cursorHander(g,f)},_cursorHander:function(a,b){a||b||this._setCursor("default"),a&&b!=a&&a.context&&this._setCursor(a.context.cursor)},_setCursor:function(a){this._cursor!=a&&(this.canvax.el.style.cursor=a,this._cursor=a)}},d});