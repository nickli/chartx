define("components/tips/index",["../component","canvax","../../utils/tools"],function(t,i,e){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])},function(t,i){function e(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)});i.__esModule=!0;var s=t("../component"),r=t("canvax"),p=t("../../utils/tools"),h=r.default._,l=r.default.Shapes.Rect,a=r.default.Shapes.Line,c=function(t){function i(i,e){var o=t.call(this)||this;o.root=e,o.tipDomContainer=e.canvax.domView,o.cW=0,o.cH=0,o.dW=0,o.dH=0,o.borderRadius="5px",o.sprite=null,o.content=null,o.fillStyle="rgba(255,255,255,0.95)",o.fontColor="#999",o.strokeStyle="#ccc",o.position="right",o._tipDom=null,o.offsetX=10,o.offsetY=10,o.eventInfo=null,o.positionInRange=!0,o.enabled=!0,o.pointer="line",o.pointerAnim=!0,o._tipsPointer=null,h.extend(!0,o,i),o.sprite=new r.default.Display.Sprite({id:"TipSprite"});var n=o;return o.sprite.on("destroy",function(){n._tipDom=null}),o}return n(i,t),i.register=function(t,i){var e=new this(t,i);i.stage.addChild(e.sprite),i.components.push({type:"tips",id:"tips",plug:e})},i.prototype.show=function(t){if(this.enabled){if(t.eventInfo){this.eventInfo=t.eventInfo;var i=t.target.getStage();this.cW=i.context.width,this.cH=i.context.height,this._setContent(t)?(this._setPosition(t),this.sprite.toFront()):this.hide()}this._tipsPointerShow(t)}},i.prototype.move=function(t){if(this.enabled){if(t.eventInfo)this.eventInfo=t.eventInfo,this._setContent(t)?this._setPosition(t):this._hideDialogTips();this._tipsPointerMove(t)}},i.prototype.hide=function(){this.enabled&&(this._hideDialogTips(),this._tipsPointerHide())},i.prototype._hideDialogTips=function(){this.eventInfo&&(this.eventInfo=null,this.sprite.removeAllChildren(),this._removeContent())},i.prototype._setPosition=function(t){if(this.enabled&&this._tipDom){var i=t.pos||t.target.localToGlobal(t.point),e=this._checkX(i.x+this.offsetX),o=this._checkY(i.y+this.offsetY);this._tipDom.style.cssText+=";visibility:visible;left:"+e+"px;top:"+o+"px;-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;","left"==this.position&&(this._tipDom.style.left=this._checkX(i.x-this.offsetX-this._tipDom.offsetWidth)+"px")}},i.prototype._creatTipDom=function(t){this._tipDom=document.createElement("div"),this._tipDom.className="chart-tips",this._tipDom.style.cssText+="\uff1b-moz-border-radius:"+this.borderRadius+"; -webkit-border-radius:"+this.borderRadius+"; border-radius:"+this.borderRadius+";background:"+this.fillStyle+";border:1px solid "+this.strokeStyle+";visibility:hidden;position:absolute;enabled:inline-block;*enabled:inline;*zoom:1;padding:6px;color:"+this.fontColor+";line-height:1.5",this._tipDom.style.cssText+="; -moz-box-shadow:1px 1px 3px "+this.strokeStyle+"; -webkit-box-shadow:1px 1px 3px "+this.strokeStyle+"; box-shadow:1px 1px 3px "+this.strokeStyle+";",this._tipDom.style.cssText+="; border:none;white-space:nowrap;word-wrap:normal;",this._tipDom.style.cssText+="; text-align:left;",this.tipDomContainer.appendChild(this._tipDom)},i.prototype._removeContent=function(){this._tipDom&&(this.tipDomContainer.removeChild(this._tipDom),this._tipDom=null)},i.prototype._setContent=function(t){var i=this._getContent(t);if(i||0===i)return this._tipDom||this._creatTipDom(t),this._tipDom.innerHTML=i,this.dW=this._tipDom.offsetWidth,this.dH=this._tipDom.offsetHeight,i},i.prototype._getContent=function(t){return this.content?h.isFunction(this.content)?this.content(t.eventInfo):this.content:this._getDefaultContent(t.eventInfo)},i.prototype._getDefaultContent=function(t){var i="";return void 0!==t.title&&null!==t.title&&""!==t.title&&(i+="<div style='font-size:14px;border-bottom:1px solid #f0f0f0;padding:4px;margin-bottom:6px;'>"+t.title+"</div>"),h.each(t.nodes,function(t,e){if(t.value||0===t.value){var o=t.color||t.fillStyle||t.strokeStyle,n="object"==typeof t.value?JSON.stringify(t.value):p.numAddSymbol(t.value);i+="<div style='line-height:1.5;font-size:12px;padding:0 4px;'>",o&&(i+="<span style='background:"+o+";margin-right:8px;margin-top:5px;float:left;width:8px;height:8px;border-radius:4px;overflow:hidden;font-size:0;'></span>"),i+=n+"</div>"}}),i},i.prototype._checkX=function(t){if(this.positionInRange){var i=this.dW+2;t<0&&(t=0),t+i>this.cW&&(t=this.cW-i)}return t},i.prototype._checkY=function(t){if(this.positionInRange){var i=this.dH+2;t<0&&(t=0),t+i>this.cH&&(t=this.cH-i)}return t},i.prototype._tipsPointerShow=function(t){var i=this.root._coord;if(i&&"rect"==i.type&&this.pointer){var e=this._tipsPointer,o=i.origin.y-i.height,n=0;"line"==this.pointer&&(n=i.origin.x+t.eventInfo.xAxis.x),"region"==this.pointer&&(n=i.origin.x+t.eventInfo.xAxis.x-i._xAxis.ceilWidth/2,t.eventInfo.xAxis.ind<0&&(n=i.origin.x)),e?this.pointerAnim&&"proportion"!=i._xAxis.layoutType?(e.__animation&&e.__animation.stop(),e.__animation=e.animate({x:n,y:o},{duration:200})):(e.context.x=n,e.context.y=o):("line"==this.pointer&&(e=new a({context:{x:n,y:o,start:{x:0,y:0},end:{x:0,y:i.height},lineWidth:1,strokeStyle:"#cccccc"}})),"region"==this.pointer&&(e=new l({context:{width:i._xAxis.ceilWidth,height:i.height,x:n,y:o,fillStyle:"#cccccc",globalAlpha:.3}})),this.root.graphsSprite.addChild(e,0),this._tipsPointer=e)}},i.prototype._tipsPointerHide=function(){var t=this.root._coord;t&&"rect"==t.type&&this.pointer&&this._tipsPointer&&(this._tipsPointer.destroy(),this._tipsPointer=null)},i.prototype._tipsPointerMove=function(t){var i=this.root._coord;if(i&&"rect"==i.type&&this.pointer&&this._tipsPointer){var e=this._tipsPointer,o=i.origin.x+t.eventInfo.xAxis.x;"region"==this.pointer&&(o=i.origin.x+t.eventInfo.xAxis.x-i._xAxis.ceilWidth/2,t.eventInfo.xAxis.ind<0&&(o=i.origin.x));var n=i.origin.y-i.height;o!=e.__targetX&&(this.pointerAnim&&"proportion"!=i._xAxis.layoutType?(e.__animation&&e.__animation.stop(),e.__targetX=o,e.__animation=e.animate({x:o,y:n},{duration:200,onComplete:function(){delete e.__targetX,delete e.__animation}})):(e.context.x=o,e.context.y=n))}},i}(s.default);i.default=c});