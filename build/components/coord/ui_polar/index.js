define("components/coord/ui_polar/index",["../ui_coord_base","canvax","./grid","../../../utils/datasection"],function(t,i,e){"use strict";var a,n=this&&this.__extends||(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)});i.__esModule=!0;var o=t("../ui_coord_base"),s=t("canvax"),r=t("./grid"),h=t("../../../utils/datasection"),l=s.default._,d=function(t){function i(i,e){var a=t.call(this,i,e)||this;return a.type="polar",a.allAngle=360,a.aAxis={field:null,layoutType:"average",data:[],angleList:[],beginAngle:-90,layoutData:[],enabled:i.aAxis&&i.aAxis.field,label:{enabled:!0,format:function(t){return t},fontColor:"#666"}},a.rAxis={field:[],dataSection:null,enabled:!1},a.grid={enabled:!1},a.maxR=null,a.squareRange=!0,l.extend(!0,a,i),a.aAxis.field||(a.grid.enabled=!1),a.init(i),a}return n(i,t),i.prototype.init=function(t){this.sprite=new s.default.Display.Sprite({id:"coord_polar"}),this._initModules(),this.fieldsMap=this._setFieldsMap()},i.prototype.resetData=function(t,i){},i.prototype.draw=function(t){!t&&(t={}),this._computeAttr(),this.rAxis.dataSection=this._getRDataSection(),this.aAxis.data=this.root.dataFrame.getFieldData(this.aAxis.field),this._setAAxisAngleList(),this.grid.enabled&&(this._grid.draw({pos:this.origin,width:this.width,height:this.height,dataSection:this.rAxis.dataSection},this),this.aAxis.enabled&&this._drawAAxisScale(),this._initInduce())},i.prototype.changeFieldEnabled=function(t){this.setFieldEnabled(t),this.rAxis.dataSection=this._getRDataSection(),this.aAxis.data=this.root.dataFrame.getFieldData(this.aAxis.field),this.grid.enabled&&this._grid.reset({dataSection:this.rAxis.dataSection},this)},i.prototype.getEnabledFields=function(t){if(t)return this.filterEnabledFields(t);var i=[];return l.each(this.fieldsMap,function(t,e){if(l.isArray(t)){var a=[];l.each(t,function(t,i){t.field&&t.enabled&&a.push(t.field)}),a.length&&i.push(a)}else t.field&&t.enabled&&i.push(t.field)}),i},i.prototype._setFieldsMap=function(){var t=this,i=0;return function e(a){a||(a=t.rAxis.field),l.isString(a)&&(a=[a]);for(var n=l.clone(a),o=0,s=a.length;o<s;o++)l.isString(a[o])&&(n[o]={field:a[o],enabled:!0,color:t.root.getTheme(i),ind:i++,group:null}),l.isArray(a[o])&&(n[o]=e(a[o]));return n}()},i.prototype._getRDataSection=function(){var t=this;if(!this._opt.rAxis.dataSection){var i=[];return l.each(l.flatten([t.rAxis.field]),function(e){i=i.concat(t.root.dataFrame.getFieldData(e))}),h.default.section(i,3)}},i.prototype._initModules=function(){this.grid.enabled&&(this._grid=new r.default(this.grid,this),this.sprite.addChild(this._grid.sprite)),this.aAxis.enabled&&this.grid.enabled&&(this._aAxisScaleSp=new s.default.Display.Sprite({id:"aAxisScaleSp"}),this.sprite.addChild(this._aAxisScaleSp))},i.prototype._computeAttr=function(){var t=this.root.padding,i=this.root.width,e=this.root.height;if("width"in this._opt||(this.width=i-t.left-t.right),"height"in this._opt||(this.height=e-t.top-t.bottom),this.aAxis.enabled&&(this.width-=40,this.height-=40),this.squareRange){var a=Math.min(this.width,this.height);this.width=this.height=a}"origin"in this._opt||(this.origin={x:t.left+(i-t.left-t.right)/2,y:t.top+(e-t.top-t.bottom)/2});var n,o=this.origin;if(o.x!=this.width/2||o.y!=this.height/2){var s=[o.x,this.width-o.x,o.y,this.height-o.y];n=l.max(s)}else n=Math.max(this.width/2,this.height/2);null!=this.maxR&&this.maxR<=n||(this.maxR=n)},i.prototype.getRadiansAtR=function(t,i,e){var a=this;void 0==i&&(i=this.width),void 0==e&&(e=this.height);var n=[];if(t>this.maxR)return[];var o,s,r=this.root.padding,h={x:this.origin.x-r.left-(this.width-i)/2,y:this.origin.y-r.top-(this.height-e)/2},d=h.y;d<t&&(o=Math.sqrt(Math.pow(t,2)-Math.pow(d,2)),n=n.concat(this._filterPointsInRect([{x:-o,y:-d},{x:o,y:-d}],h,i,e)));var c=i-h.x;c<t&&(s=Math.sqrt(Math.pow(t,2)-Math.pow(c,2)),n=n.concat(this._filterPointsInRect([{x:c,y:-s},{x:c,y:s}],h,i,e)));var p=e-h.y;p<t&&(o=Math.sqrt(Math.pow(t,2)-Math.pow(p,2)),n=n.concat(this._filterPointsInRect([{x:o,y:p},{x:-o,y:p}],h,i,e)));var u=h.x;u<t&&(s=Math.sqrt(Math.pow(t,2)-Math.pow(u,2)),n=n.concat(this._filterPointsInRect([{x:-u,y:s},{x:-u,y:-s}],h,i,e)));var f=[];0==n.length?f.push([{point:{x:t,y:0},radian:0},{point:{x:t,y:0},radian:2*Math.PI}]):l.each(n,function(t,i){var e=i==n.length-1?0:i+1,o=n.slice(e,e+1)[0];f.push([{point:t,radian:a.getRadianInPoint(t)},{point:o,radian:a.getRadianInPoint(o)}])});for(var g=0,x=f.length;g<x;g++)this._checkArcInRect(f[g],t,h,i,e)||(f.splice(g,1),g--,x--);return f},i.prototype._filterPointsInRect=function(t,i,e,a){for(var n=0,o=t.length;n<o;n++)this._checkPointInRect(t[n],i,e,a)||(t.splice(n,1),n--,o--);return t},i.prototype._checkPointInRect=function(t,i,e,a){var n=t.x+i.x,o=t.y+i.y;return!(n<0||n>e||o<0||o>a)},i.prototype._checkArcInRect=function(t,i,e,a,n){var o=t[0],s=t[1],r=s.radian-o.radian;s.radian<o.radian&&(r=2*Math.PI+s.radian-o.radian);var h=(o.radian+r/2)%(2*Math.PI);return this._checkPointInRect(this.getPointInRadianOfR(h,i),e,a,n)},i.prototype.getRadianInPoint=function(t){var i=2*Math.PI;return(Math.atan2(t.y,t.x)+i)%i},i.prototype.getPointInRadianOfR=function(t,i){var e=Math.PI,a=Math.cos(t)*i;t!=e/2&&t!=3*e/2||(a=0);var n=Math.sin(t)*i;return t%e==0&&(n=0),{x:a,y:n}},i.prototype.getROfNum=function(t){var i=l.max(this.rAxis.dataSection);return parseInt(Math.max(this.width,this.height)/2)*((t-0)/(i-0))},i.prototype.getPointsOfR=function(t){var i=this,e=[];return l.each(i.aAxis.angleList,function(a){var n=Math.PI*a/180,o=i.getPointInRadianOfR(n,t);e.push(o)}),e},i.prototype._setAAxisAngleList=function(){var t=this;t.aAxis.angleList=[];var i=this.aAxis.data;if("average"==this.aAxis.layoutType){i=[];for(var e=0,a=this.aAxis.data.length;e<a;e++)i.push(e)}var n=this.allAngle,o=l.max(i);"average"==this.aAxis.layoutType&&o++,l.each(i,function(i){var e=(n*((i-0)/(o-0))+t.aAxis.beginAngle+n)%n;t.aAxis.angleList.push(e)})},i.prototype._drawAAxisScale=function(){var t=this,i=t.getROfNum(l.max(this.rAxis.dataSection)),e=t.getPointsOfR(i+3);t._aAxisScaleSp.context.x=this.origin.x,t._aAxisScaleSp.context.y=this.origin.y,l.each(this.aAxis.data,function(i,a){if(t.aAxis.label.enabled){var n=e[a],o={x:n.x,y:n.y,fillStyle:t.aAxis.label.fontColor},r=t.aAxis.label.format(i);l.extend(o,t._getTextAlignForPoint(Math.atan2(n.y,n.x))),t._aAxisScaleSp.addChild(new s.default.Display.Text(r,{context:o})),t.aAxis.layoutData.push(r)}})},i.prototype._getTextAlignForPoint=function(t){var i="center",e="bottom";return t>-Math.PI/2&&t<0&&(i="left",e="bottom"),0==t&&(i="left",e="middle"),t>0&&t<Math.PI/2&&(i="left",e="top"),t==Math.PI/2&&(i="center",e="top"),t>Math.PI/2&&t<Math.PI&&(i="right",e="top"),t!=Math.PI&&t!=-Math.PI||(i="right",e="middle"),t>-Math.PI&&t<-Math.PI/2&&(i="right",e="bottom"),{textAlign:i,textBaseline:e}},i.prototype.getAxisNodeOf=function(t){var i=this.getAAxisIndOf(t);if(void 0!==i)return{ind:i,value:this.aAxis.data[i],text:this.aAxis.layoutData[i],angle:this.aAxis.angleList[i]}},i.prototype.getAAxisIndOf=function(t){var i=this;if(void 0!==t.aAxisInd)return t.aAxisInd;if(i.aAxis.angleList.length){var e=t.point,a=(180*i.getRadianInPoint(e)/Math.PI-i.aAxis.beginAngle)%i.allAngle,n=(Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)),0),o=i.aAxis.angleList.length;return l.each(i.aAxis.angleList,function(t,e){t=(t-i.aAxis.beginAngle)%i.allAngle;var s=e+1,r=(i.aAxis.angleList[s]-i.aAxis.beginAngle)%i.allAngle;if(e==o-1&&(s=0,r=i.allAngle),a>=t&&a<=r)return n=a-t<r-a?e:s,!1}),n}},i.prototype._initInduce=function(){var t=this;t.induce=this._grid.induce,t.induce&&t.induce.on("panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(i){t.fire(i.type,i),t.root.fire(i.type,i)})},i.prototype.getTipsInfoHandler=function(t){var i=this.getAxisNodeOf(t),e={nodes:[]};return i&&(e.aAxis=i,e.title=i.text),t.eventInfo&&(e=l.extend(e,t.eventInfo)),e},i}(o.default);i.default=d});