define("components/coord/ui_rect/xaxis",["canvax","../../../utils/datasection"],function(t,i,e){"use strict";var a,n=this&&this.__extends||(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)});i.__esModule=!0;var l=t("canvax"),s=t("../../../utils/datasection"),o=l.default.Shapes.Line,h=l.default._,r=function(t){function i(i,e,a){var n=t.call(this)||this;return n._opt=i,n._coord=a||{},n.width=0,n.height=0,n.title={text:"",shapeType:"text",fontColor:"#999",fontSize:12,offset:2,textAlign:"center",textBaseline:"middle",strokeStyle:null,lineHeight:0},n._title=null,n.enabled=!0,n.tickLine={enabled:1,lineWidth:1,lineLength:4,offset:2,strokeStyle:"#cccccc"},n.axisLine={enabled:1,lineWidth:1,strokeStyle:"#cccccc"},n.label={enabled:1,fontColor:"#999",fontSize:12,rotation:0,format:null,offset:2,textAlign:"center",lineHeight:1,evade:!0},!i.isH||i.label&&void 0!==i.label.rotaion||(n.label.rotation=90),n.maxTxtH=0,n.pos={x:0,y:0},n.dataOrg=[],n.dataSection=[],n._formatTextSection=[],n._textElements=[],n.layoutData=[],n.sprite=null,n.filter=null,n.isH=!1,n.animation=!0,n.maxVal=null,n.minVal=null,n.ceilWidth=0,n.layoutType="rule",n.trimLayout=null,n.posParseToInt=!1,h.extend(!0,n,i),n.init(i,e),n.field=h.flatten([n.field])[0],n._txts=[],n}return n(i,t),i.prototype.init=function(t,i){this.sprite=new l.default.Display.Sprite({id:"xAxisSprite"}),this.rulesSprite=new l.default.Display.Sprite({id:"rulesSprite"}),this.sprite.addChild(this.rulesSprite),this._initHandle(i)},i.prototype._initHandle=function(t){var i=this;t&&t.field&&(this.field=t.field),t&&t.org&&(this.dataOrg=h.flatten(t.org)),!this._opt.dataSection&&this.dataOrg&&(this.dataSection=this._initDataSection(this.dataOrg)),i._formatTextSection=[],i._textElements=[],h.each(i.dataSection,function(t,e){i._formatTextSection[e]=i._getFormatText(t,e);var a=new l.default.Display.Text(i._formatTextSection[e],{context:{fontSize:i.label.fontSize}});i._textElements[e]=a}),0!=this.label.rotation&&(this.label.textAlign="right"),!("minVal"in this._opt)&&(this.minVal=h.min(this.dataSection)),(isNaN(this.minVal)||this.minVal==1/0)&&(this.minVal=0),!("maxVal"in this._opt)&&(this.maxVal=h.max(this.dataSection)),(isNaN(this.maxVal)||this.maxVal==1/0)&&(this.maxVal=1),this._getName(),this._setXAxisHeight()},i.prototype._initDataSection=function(t){var i=h.flatten(t);return"proportion"==this.layoutType&&(1==i.length&&(i.push(0),i.push(2*i[0])),i=i.sort(function(t,i){return t-i}),i=s.default.section(i)),i},i.prototype.resetData=function(t){this._initHandle(t),this.draw()},i.prototype.getIndexOfVal=function(t){for(var i,e=0,a=this.layoutData.length;e<a;e++){if(this.layoutData[e].value==t){i=e;break}}return i},i.prototype.getIndexOfX=function(t){var i=0;return"peak"==this.layoutType&&(i=parseInt(t/this.ceilWidth))==this.dataOrg.length&&(i=this.dataOrg.length-1),"rule"==this.layoutType&&(i=parseInt((t+this.ceilWidth/2)/this.ceilWidth),1==this.dataOrg.length&&(i=0)),"proportion"==this.layoutType&&(i=parseInt(t/((this.maxVal-this.minVal)/this.width))),i},i.prototype.getNodeInfoOfX=function(t){var i=this.getIndexOfX(t),e=this.dataOrg[i],a=this.dataOrg.length;t=t;"proportion"==this.layoutType?e=(this.maxVal-this.minVal)*(t/this.width)+this.minVal:t=this.getPosX({val:e,ind:i,dataLen:a,width:this.width});var n={ind:i,value:e,text:e,x:t,field:this.field};return n.text=this._getFormatText(e,i,n),n},i.prototype._setXAxisHeight=function(){var t=this;if(t.enabled){var i=0;this.label.enabled&&h.each(t.dataSection,function(e,a){var n=t._textElements[a],l=n.getTextWidth(),s=n.getTextHeight(),o=s;if(t.label.rotation)if(90==t.label.rotation)s,o=l;else{var h=Math.sin(Math.abs(t.label.rotation)*Math.PI/180),r=Math.cos(Math.abs(t.label.rotation)*Math.PI/180);o=parseInt(h*l),parseInt(r*l)}i=Math.max(i,o)}),this.height=i+this.tickLine.lineLength+this.tickLine.offset+this.label.offset,this._title&&(this.height+=this._title.getTextHeight())}else t.height=0},i.prototype._getName=function(){this.title.text&&(this._title?this._title.resetText(this.title.text):this._title=new l.default.Display.Text(this.title.text,{context:{fontSize:this.title.fontSize,textAlign:this.title.textAlign,textBaseline:this.title.textBaseline,fillStyle:this.title.fontColor,strokeStyle:this.title.strokeStyle,lineWidth:this.title.lineWidth,rotation:this.isH?-180:0}}))},i.prototype.draw=function(t){t&&h.extend(!0,this,t),this.layoutData=this._trimXAxis(this.dataSection),this._trimLayoutData(),this.sprite.context.x=this.pos.x,this.sprite.context.y=this.pos.y,this._widget(t)},i.prototype.getPosX=function(t){var i=0,e=t.val,a="ind"in t?t.ind:h.indexOf(this.dataSection,e),n="dataLen"in t?t.dataLen:this.dataSection.length,l="width"in t?t.width:this.width,s="layoutType"in t?t.layoutType:this.layoutType;if(1==n)i=l/2;else if("rule"==s&&(i=a/(n-1)*l),"proportion"==s&&(void 0==e&&(e=a*(this.maxVal-this.minVal)/(n-1)+this.minVal),i=l*((e-this.minVal)/(this.maxVal-this.minVal))),"peak"==s){var o=l/n;this.posParseToInt&&(o=parseInt(o)),i=o*(a+1)-o/2}return isNaN(i)&&(i=0),parseInt(i,10)},i.prototype._computerCeilWidth=function(){var t=this.width,i=t;return this.dataOrg.length&&(i=t/this.dataOrg.length,"rule"==this.layoutType&&(i=1==this.dataOrg.length?t/2:t/(this.dataOrg.length-1))),this.posParseToInt&&(i=parseInt(i)),i},i.prototype._trimXAxis=function(t){var i=[],e=t||this.dataSection;this.ceilWidth=this._computerCeilWidth();for(var a=0,n=e.length;a<n;a++){var l=this._formatTextSection[a],s=this._textElements[a],o={ind:a,value:e[a],text:l,x:this.getPosX({val:e[a],ind:a,dataLen:n,width:this.width}),textWidth:s.getTextWidth(),field:this.field,visible:null};i.push(o)}return i},i.prototype._getFormatText=function(t,i){var e;return e=h.isFunction(this.label.format)?this.label.format.apply(this,arguments):t,h.isArray(e)&&(e=Tools.numAddSymbol(e)),e||(e=t),e},i.prototype._widget=function(t){if(this.enabled){!t&&(t={});var i=this,e=this.layoutData;this._title&&(this._title.context.y=this.height-this._title.getTextHeight()/2,this._title.context.x=this.width/2,this.sprite.addChild(this._title));for(var a=Math.min(1e3/e.length,25),n=0,s=0,r=e.length;s<r;s++){var d="xNode"+s,x=this.rulesSprite.getChildById(d);x||(x=new l.default.Display.Sprite({id:d}),this.rulesSprite.addChild(x));var c=e[s],p=c.x,f=this.tickLine.lineLength+this.tickLine.offset+this.label.offset;if(this.label.enabled&&e[s].visible){var u={x:c._text_x||c.x,y:f+20,fillStyle:this.label.fontColor,fontSize:this.label.fontSize,rotation:-Math.abs(this.label.rotation),textAlign:this.label.textAlign,lineHeight:this.label.lineHeight,textBaseline:this.label.rotation?"middle":"top",globalAlpha:0};this.label.rotation&&90!=this.label.rotation&&(u.x+=5,u.y+=3),n<i._txts.length?(x._txt=i._txts[n],x._txt.resetText(c.text+""),this.animation?x._txt.animate({x:u.x},{duration:300}):x._txt.context.x=u.x):(x._txt=new l.default.Display.Text(c.text,{id:"xAxis_txt_"+s,context:u}),x.addChild(x._txt),i._txts.push(x._txt),this.animation&&!t.resize?x._txt.animate({globalAlpha:1,y:x._txt.context.y-20},{duration:500,easing:"Back.Out",delay:s*a,id:x._txt.id}):(x._txt.context.y=x._txt.context.y-20,x._txt.context.globalAlpha=1)),n++}if(this.tickLine.enabled)if(e[s].visible){var _={x:p,y:this.tickLine.offset,end:{x:0,y:this.tickLine.lineLength},lineWidth:this.tickLine.lineWidth,strokeStyle:this.tickLine.strokeStyle};x._line?this.animation?x._line.animate({x:_.x},{duration:300}):x._line.context.x=_.x:(x._line=new o({context:_}),x.addChild(x._line))}else x._line&&(x._line.destroy(),x._line=null);h.isFunction(this.filter)&&this.filter({layoutData:e,index:s,txt:x._txt,line:x._line||null})}if(i._txts.length>n)for(var y=n;y<i._txts.length;y++)i._txts.splice(y--,1)[0].destroy();if(this.rulesSprite.children.length>e.length){r=e.length;for(var g=this.rulesSprite.children.length;r<g;r++)this.rulesSprite.getChildAt(r).remove(),r--,g--}if(this.axisLine.enabled){var m=new o({context:{start:{x:0,y:0},end:{x:this.width,y:0},lineWidth:this.axisLine.lineWidth,strokeStyle:this.axisLine.strokeStyle}});this.sprite.addChild(m)}}},i.prototype._trimLayoutData=function(){var t=this.layoutData.length;this.enabled&&t&&("proportion"==this.layoutType&&this._checkOver(),"peak"==this.layoutType&&this._checkOver(),"rule"==this.layoutType&&this._checkOver())},i.prototype._getRootPR=function(){var t=0;return this._coord._root&&(t=this._coord._root.padding.right),t},i.prototype._checkOver=function(){var t=this,i=t.layoutData;if(t.trimLayout)t.trimLayout(i);else if(this.label.evade){var e=i.length,a=t.label.textAlign;!function n(l){var s=i[l];if(void 0!==s){s.visible=!0;for(var o=l;o<e-1;o++){var h=i[o+1],r=h.textWidth,d=s.textWidth;t.label.rotation&&(r=Math.min(r,22),d=Math.min(d,22));var x=h.x,c=s.x+d;if("center"==a&&(x=h.x-r/2,c=s.x+d/2),"right"==a&&(x=h.x-r,c=s.x),o==e-2&&("center"==a&&h.x+r/2>t.width&&(x=t.width-r,h._text_x=t.width-r/2),"left"==a&&h.x+r>t.width&&(x=t.width-r,h._text_x=t.width-r)),!(x-c<-2)){n(o+1);break}if(o==e-2)return h.visible=!0,void(s.visible=!1);h.visible=!1}}}(0)}else h.each(i,function(t){t.visible=!0})},i}(l.default.Event.EventDispatcher);i.default=r});