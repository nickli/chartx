define("components/coord/ui_rect/yaxis",["canvax","../../../utils/tools","../../../utils/datasection"],function(t,i,e){"use strict";var a,n=this&&this.__extends||(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)});i.__esModule=!0;var s=t("canvax"),o=t("../../../utils/tools"),l=t("../../../utils/datasection"),h=s.default.Shapes.Line,r=s.default._,d=function(t){function i(i,e){var a=t.call(this)||this;return a._opt=i,a.width=null,a.yMaxHeight=0,a.height=0,a.maxW=0,a.field=[],a.title={text:"",shapeType:"text",fontColor:"#999",fontSize:12,offset:2,textAlign:"center",textBaseline:"middle",strokeStyle:null,lineHeight:0},a._title=null,a.enabled=!0,a.tickLine={enabled:1,lineWidth:1,lineLength:4,strokeStyle:"#cccccc",distance:2},a.axisLine={enabled:1,lineWidth:1,strokeStyle:"#cccccc"},a.label={enabled:1,fontColor:"#999",fontSize:12,format:null,rotation:0,distance:3,textAlign:null,lineHeight:1},!i.isH||i.label&&void 0!==i.label.rotaion||(a.label.rotation=90),a.pos={x:0,y:0},a.align="left",a.layoutData=[],a.dataSection=[],a.waterLine=null,a.dataSectionGroup=[],a.middleweight=null,a.dataOrg=e.org||[],a.sprite=null,a.baseNumber=null,a.basePoint=null,a.min=null,a.max=null,a._yOriginTrans=0,a.filter=null,a.isH=!1,a.animation=!0,a.sort=null,a.layoutType="proportion",a.init(i,e),a._getName(),a}return n(i,t),i.prototype.init=function(t,i){r.extend(!0,this,t),r.isArray(this.field)||(this.field=[this.field]),this._initData(),this.sprite=new s.default.Display.Sprite({id:"yAxisSprite_"+(new Date).getTime()}),this.rulesSprite=new s.default.Display.Sprite({id:"yRulesSprite_"+(new Date).getTime()}),this.sprite.addChild(this.rulesSprite)},i.prototype.resetData=function(t){this.dataSection=[],this.dataSectionGroup=[],t&&t.field&&(this.field=t.field),t&&t.org&&(this.dataOrg=t.org),this._initData(),this._trimYAxis(),this._widget()},i.prototype.setX=function(t){this.sprite.context.x=t,this.pos.x=t},i.prototype.setY=function(t){this.sprite.context.y=t,this.pos.y=t},i.prototype._getName=function(){if(this.title.text)if(this._title)this._title.resetText(this.title.text);else{var t=0;"left"==this.align?t=-90:(t=90,this.isH&&(t=270)),this._title=new s.default.Display.Text(this.title.text,{context:{fontSize:this.title.fontSize,textAlign:this.title.textAlign,textBaseline:this.title.textBaseline,fillStyle:this.title.fontColor,strokeStyle:this.title.strokeStyle,lineWidth:this.title.lineWidth,rotation:t}})}},i.prototype.draw=function(t){!t&&(t={}),t&&r.extend(!0,this,t),this.height=parseInt(this.yMaxHeight-this._getYAxisDisLine()),this._trimYAxis(),this._widget(t),this.setX(this.pos.x),this.setY(this.pos.y)},i.prototype.getYposFromVal=function(t){for(var i=0,e=this.dataSectionGroup.length,a=this.height/e,n=0,s=e;n<s;n++){var o=this.dataSectionGroup[n],l=r.min(o),h=r.max(o),d=r.indexOf(o,t);if(t>=l&&t<=h||d>=0){if("proportion"==this.layoutType){var u=this.baseNumber;(u<l||u>h)&&(u=l);var c=Math.max(Math.abs(h-u),Math.abs(u-l));i=(t-u)/c*(c/Math.abs(h-l)*a)+n*a,isNaN(i)&&(i=n*a)}"rule"==this.layoutType&&(i=d/(o.length-1)*a),"peak"==this.layoutType&&(i=a/o.length*(d+1)-a/o.length/2),i+=this._yOriginTrans;break}}return isNaN(i)&&(i=0),-Math.abs(i)},i.prototype.getValFromYpos=function(t){var i=this.layoutData[0],e=this.layoutData.slice(-1)[0];return(e.value-i.value)*((t-i.y)/(e.y-i.y))+i.value},i.prototype._getYOriginTrans=function(t){for(var i=0,e=this.dataSectionGroup.length,a=this.height/e,n=0,s=e;n<s;n++){var o=this.dataSectionGroup[n],l=r.min(o),h=r.max(o),d=Math.abs(h-l);if(t>=l&&t<=h){i=(t-l)/d*a+n*a;break}}return i=isNaN(i)?0:parseInt(i),"desc"==this.sort&&(i=-(a-Math.abs(i))),i},i.prototype._trimYAxis=function(){var t=[],i=this.baseNumber;this._yOriginTrans=this._getYOriginTrans(i),this.basePoint={value:this.baseNumber,y:this.getYposFromVal(this.baseNumber)};for(var e=0,a=this.dataSection.length;e<a;e++){var n={value:this.dataSection[e],y:this.getYposFromVal(this.dataSection[e]),visible:!0,text:""},s=n.value;r.isFunction(this.label.format)&&(s=this.label.format.apply(this,[s,e])),void 0!==s&&null!==s||(s=o.numAddSymbol(n.value)),n.text=s,t.push(n)}for(var l=0,h=0,d=t.length;h<d;h++)0!=h&&(0==l?t[h].text==t[l].text?t[h].visible=!1:l=h:(t[h].text==t[l].text&&(t[l].visible=!1),l=h));this.layoutData=t},i.prototype._getYAxisDisLine=function(){var t=0;return t=(t=0+this.yMaxHeight%this.dataSection.length)>0?0:t},i.prototype._setDataSection=function(){var t=1;return r.each(this.field,function(i){t=Math.max(t,1),r.isArray(i)&&r.each(i,function(i){t=Math.max(t,2)})}),1==t?this._oneDimensional():2==t?this._twoDimensional():void 0},i.prototype._oneDimensional=function(){for(var t=r.flatten(this.dataOrg),i=0,e=t.length;i<e;i++)t[i]=t[i]||0;return t},i.prototype._twoDimensional=function(){var t,i=this.dataOrg,e=[];return r.each(i,function(i,a){if(i.length)if(r.isArray(i[0])){var n=[],s=i[0].length,o=i.length;for(a=0;a<s;a++){for(var l=0,h=0,d=0,u=0,c=0;c<o;c++){var p=i[c][a];(p||0===p)&&(void 0==t&&(t=p),t=Math.min(t,p),p>=0?(l+=p,h++):(d+=p,u++))}h&&n.push(l),u&&n.push(d)}e.push(n)}else e.push(i)}),e.push(t),r.flatten(e)},i.prototype._initData=function(){var t=this,i=this._setDataSection();if(null!=this.waterLine&&i.push(this.waterLine),null!=this._opt.min&&i.push(this.min),1==i.length&&i.push(2*i[0]),this._opt.dataSection)this.dataSection=this._opt.dataSection;else{void 0!=this._opt.baseNumber&&i.push(this.baseNumber),void 0!=this._opt.minNumber&&i.push(this.minNumber),void 0!=this._opt.maxNumber&&i.push(this.maxNumber);for(var e=0,a=i.length;e<a;e++)i[e]=Number(i[e]),isNaN(i[e])&&(i.splice(e,1),e--,a--);this.dataSection=l.default.section(i,3)}if(0==this.dataSection.length&&(this.dataSection=[0]),r.min(this.dataSection)<this._opt.min){var n=t._opt.min-r.min(t.dataSection);r.each(this.dataSection,function(i,e){t.dataSection[e]+=n})}this.dataSectionGroup=[r.clone(this.dataSection)],this._sort(),this._setBottomAndBaseNumber(),this._middleweight()},i.prototype.setWaterLine=function(t){t<=this.waterLine||(this.waterLine=t,(t<r.min(this.dataSection)||t>r.max(this.dataSection))&&this._initData())},i.prototype._sort=function(){this.sort&&("desc"==this._getSortType()&&(this.dataSection.reverse(),r.each(this.dataSectionGroup,function(t,i){t.reverse()}),this.dataSectionGroup.reverse()))},i.prototype._getSortType=function(){var t;return r.isString(this.sort)&&(t=this.sort),r.isArray(this.sort)&&(t=this.sort["left"==this.align?0:1]),t||(t="asc"),t},i.prototype._setBottomAndBaseNumber=function(){null==this.min&&(this.min=r.min(this.dataSection)),void 0!=this._opt.baseNumber&&null!=this._opt.baseNumber||(this.baseNumber=0,r.max(this.dataSection)<0&&(this.baseNumber=r.max(this.dataSection)),r.min(this.dataSection)>0&&(this.baseNumber=r.min(this.dataSection)))},i.prototype._middleweight=function(){if(this.middleweight){r.isArray(this.middleweight)||(this.middleweight=[this.middleweight]);for(var t=r.min(this.dataSection),i=r.max(this.dataSection),e=[t],a=[],n=0,s=this.middleweight.length;n<s;n++){var o=t;n>0&&(o=this.middleweight[n-1]);var l=o+parseInt((this.middleweight[n]-o)/2);e.push(l),e.push(this.middleweight[n]),a.push([o,l,this.middleweight[n]])}var h=this.middleweight.slice(-1)[0];i>h&&(e.push(h+(i-h)/2),e.push(i),a.push([h,h+(i-h)/2,i])),this.dataSection=e,this.dataSectionGroup=a,this._sort(),this._setBottomAndBaseNumber()}},i.prototype.resetWidth=function(t){this.width=t,"left"==this.align&&(this.rulesSprite.context.x=this.width)},i.prototype._widget=function(t){var i=this;if(!t&&(t={}),i.enabled){var e=this.layoutData;i.maxW=0;for(var a=0,n=e.length;a<n;a++){var o=e[a];if(o.visible){var l=o.y,d=(o.value,i.label.textAlign||("left"==i.align?"right":"left")),u=l+(0==a?-3:0)+(a==e.length-1?3:0);90!=i.label.rotation&&-90!=i.label.rotation||(d="center",a==e.length-1&&(u=l-2,d="right"),0==a&&(u=l));var c=this.rulesSprite.getChildAt(a);if(c)c._txt&&this.label.enabled&&(i.animation&&!t.resize?c._txt.animate({y:u},{duration:500,delay:80*a,id:c._txt.id}):c._txt.context.y=u,c._txt.resetText(o.text)),c._tickLine&&this.tickLine.enabled&&(i.animation&&!t.resize?c._tickLine.animate({y:l},{duration:500,delay:80*a,id:c._tickLine.id}):c._tickLine.context.y=l);else{c=new s.default.Display.Sprite({id:"yNode"+a});var p=20;o.value==i.baseNumber&&(p=0),o.value<i.baseNumber&&(p=-20);var g=0;if(i.tickLine.enabled){g="left"==i.align?-i.tickLine.lineLength-i.tickLine.distance:i.tickLine.distance;var f=new h({context:{x:g,y:l,end:{x:i.tickLine.lineLength,y:0},lineWidth:i.tickLine.lineWidth,strokeStyle:i._getProp(i.tickLine.strokeStyle)}});c.addChild(f),c._tickLine=f}if(i.label.enabled){var x="left"==i.align?g-i.label.distance:g+i.tickLine.lineLength+i.label.distance;this.isH&&(x+=4*("left"==i.align?-1:1));var m=new s.default.Display.Text(o.text,{id:"yAxis_txt_"+i.align+"_"+a,context:{x:x,y:u+p,fillStyle:i._getProp(i.label.fontColor),fontSize:i.label.fontSize,rotation:-Math.abs(i.label.rotation),textAlign:d,textBaseline:"middle",lineHeight:i.label.lineHeight,globalAlpha:0}});c.addChild(m),c._txt=m,90==i.label.rotation||-90==i.label.rotation?i.maxW=Math.max(i.maxW,m.getTextHeight()):i.maxW=Math.max(i.maxW,m.getTextWidth()),r.isFunction(i.filter)&&i.filter({layoutData:i.layoutData,index:a,txt:m,line:f}),i.rulesSprite.addChild(c),i.animation&&!t.resize?m.animate({globalAlpha:1,y:m.context.y-p},{duration:500,easing:"Back.Out",delay:80*(a+1),id:m.id}):(m.context.y=m.context.y-p,m.context.globalAlpha=1)}}}}if(i.rulesSprite.children.length>e.length){n=e.length;for(var y=i.rulesSprite.children.length;n<y;n++)i.rulesSprite.getChildAt(n).remove(),n--,y--}null===i.width&&(i.width=parseInt(i.maxW+i.label.distance),i.tickLine.enabled&&(i.width+=parseInt(i.tickLine.lineLength+i.tickLine.distance)),i._title&&(i.width+=i._title.getTextHeight()));var _=0;if("left"==i.align&&(i.rulesSprite.context.x=i.width,_=i.width),i.axisLine.enabled){var b=new h({context:{start:{x:_,y:0},end:{x:_,y:-i.height},lineWidth:i.axisLine.lineWidth,strokeStyle:i._getProp(i.axisLine.strokeStyle)}});this.sprite.addChild(b)}this._title&&(this._title.context.y=-this.height/2,this._title.context.x=this._title.getTextHeight()/2,"right"==this.align&&(this._title.context.x=this.width-this._title.getTextHeight()/2),this.sprite.addChild(this._title))}else i.width=0},i.prototype._getProp=function(t){var i=t;return r.isFunction(t)&&(i=t.call(this,this)),t||(i="#999"),i},i}(s.default.Event.EventDispatcher);i.default=d});