define("components/coord/ui_rect/index",["../ui_coord_base","canvax","./xaxis","./yaxis","./grid"],function(i,t,e){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e])},function(i,t){function e(){this.constructor=i}s(i,t),i.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)});t.__esModule=!0;var a=i("../ui_coord_base"),r=i("canvax"),h=i("./xaxis"),o=i("./yaxis"),d=i("./grid"),x=r.default._,l=r.default.Shapes.Rect,f=function(i){function t(t,e){var s=i.call(this,t,e)||this;return s.type="rect",s._xAxis=null,s._yAxis=[],s._yAxisLeft=null,s._yAxisRight=null,s._grid=null,s.horizontal=!1,s.xAxis={field:s.dataFrame.fields[0]},s.yAxis=[{field:s.dataFrame.fields.slice(1)}],s.grid={},x.extend(!0,s,t),t.horizontal&&(s.xAxis.isH=!0,x.each(s.yAxis,function(i){i.isH=!0})),"enabled"in t&&(x.extend(!0,s.xAxis,{enabled:t.enabled}),x.each(s.yAxis,function(i){x.extend(!0,i,{enabled:t.enabled})}),s.grid.enabled=t.enabled),s.init(t),s}return n(t,i),t.prototype.init=function(i){this.sprite=new r.default.Display.Sprite({id:"coord"}),this._initModules(),this.fieldsMap=this._setFieldsMap()},t.prototype.resetData=function(i,t){var e=this;this.dataFrame=i;var s=this._getAxisDataFrame(this.xAxis.field);this._xAxis.resetData(s),x.each(this._yAxis,function(i){var t=e._getAxisDataFrame(i.field);i.resetData(t)});var n=this._yAxisLeft||this._yAxisRight;this._grid.reset({animation:!1,xDirection:{data:n.layoutData}})},t.prototype.draw=function(i){!i&&(i={});var t=this.root.padding,e=i.height||this.root.height,s=i.width||this.root.width;if(this.horizontal){var n=s;s=e,e=n}var a=e-this._xAxis.height-t.bottom,r=0,h=0;this._yAxisLeft&&(this._yAxisLeft.draw({pos:{x:t.left,y:a},yMaxHeight:a-t.top,resize:i.resize}),r=this._yAxisLeft.width),this._yAxisRight&&(this._yAxisRight.draw({pos:{x:0,y:a},yMaxHeight:a-t.top,resize:i.resize}),h=this._yAxisRight.width),this._xAxis.draw({pos:{x:t.left+r,y:a},width:s-r-t.left-h-t.right,resize:i.resize}),this._yAxisRight&&this._yAxisRight.setX(r+t.left+this._xAxis.width),this._grid.draw({width:this._xAxis.width,height:this._yAxis[0].height,xDirection:{data:this._yAxis[0].layoutData},yDirection:{data:this._xAxis.layoutData},pos:{x:r+t.left,y:a},resize:i.resize}),this.width=this._xAxis.width,this.height=this._yAxis[0].height,this.origin.x=r+t.left,this.origin.y=a,this._initInduce(),this.horizontal&&this._horizontal({w:s,h:e})},t.prototype.getSizeAndOrigin=function(){var i={width:this.width,height:this.height,origin:this.origin};if(this.horizontal){var t=this.root.padding,e=t.bottom,s=t.right;i={width:this._yAxis[0].height,height:this._xAxis.width,origin:{x:this._xAxis.height+e,y:this._yAxis[0].height+s}}}return i},t.prototype._initModules=function(){this._grid=new d.default(this.grid,this),this.sprite.addChild(this._grid.sprite);var i=this._getAxisDataFrame(this.xAxis.field);this._xAxis=new h.default(this.xAxis,i,this),this.sprite.addChild(this._xAxis.sprite);var t,e,s,n,a=this.yAxis;x.isArray(a)||(a=[a]),(t=x.find(a,function(i){return"left"==i.align}))&&(s=this._getAxisDataFrame(t.field),this._yAxisLeft=new o.default(t,s),this._yAxisLeft.axis=t,this.sprite.addChild(this._yAxisLeft.sprite),this._yAxis.push(this._yAxisLeft)),(e=x.find(a,function(i){return"right"==i.align}))&&(n=this._getAxisDataFrame(e.field),this._yAxisRight=new o.default(e,n),this._yAxisRight.axis=e,this.sprite.addChild(this._yAxisRight.sprite),this._yAxis.push(this._yAxisRight))},t.prototype._horizontal=function(i){var t=i.h,e=i.w;x.each([this.sprite.context],function(i){i.x+=(t-e)/2,i.y+=(e-t)/2;var s={x:e/2,y:t/2};i.rotation=90,i.rotateOrigin=s})},t.prototype.getPosX=function(i){return this._xAxis.getPosX(i)},t.prototype._getAxisDataFrame=function(i){return{field:i,org:this.dataFrame.getDataOrg(i,function(i){return void 0===i||null===i||""==i?i:isNaN(Number(i))?i:Number(i)})}},t.prototype.getEnabledFields=function(i){if(i)return this.filterEnabledFields(i);var t={left:[],right:[]};return x.each(this.fieldsMap,function(i,e){if(x.isArray(i)){var s,n=[];x.each(i,function(i,t){i.field&&i.enabled&&(s=i.yAxis.align,n.push(i.field))}),n.length&&t[s].push(n)}else i.field&&i.enabled&&t[i.yAxis.align].push(i.field)}),t},t.prototype.changeFieldEnabled=function(i){this.setFieldEnabled(i);var t=this.getFieldMapOf(i),e=this.getEnabledFields()[t.yAxis.align];t.yAxis.resetData(this._getAxisDataFrame(e)),this._grid.reset({animation:!1,xDirection:{data:this._yAxisLeft?this._yAxisLeft.layoutData:this._yAxisRight.layoutData}})},t.prototype._getYaxisOfField=function(i){var t;return x.each(this._yAxis,function(e,s){var n=e.field,a=x.flatten([n]);if(x.indexOf(a,i)>-1)return t=e,!1}),t},t.prototype._setFieldsMap=function(){var i=this,t=0;return function e(s){if(!s){var n=i.yAxis;x.isArray(n)||(n=[n]),s=[],x.each(n,function(i,t){i.field&&(s=s.concat(i.field))})}x.isString(s)&&(s=[s]);for(var a=x.clone(s),r=0,h=s.length;r<h;r++)x.isString(s[r])&&(a[r]={field:s[r],enabled:!0,yAxis:i._getYaxisOfField(s[r]),color:i.root.getTheme(t),ind:t++}),x.isArray(s[r])&&(a[r]=e(s[r]));return a}()},t.prototype._initInduce=function(){var i=this;i.induce=new l({id:"induce",context:{x:i.origin.x,y:i.origin.y-i.height,width:i.width,height:i.height,fillStyle:"#000000",globalAlpha:0,cursor:"pointer"}}),i.sprite.getChildById("induce")||i.sprite.addChild(i.induce),i.induce.on("panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(t){i.fire(t.type,t),i.root.fire(t.type,t)})},t.prototype.getTipsInfoHandler=function(i){var t=i.point.x;i.target!==this.induce&&(t=this.induce.globalToLocal(i.target.localToGlobal(i.point)).x);var e=this._xAxis.getNodeInfoOfX(t),s={xAxis:e,title:e.text,nodes:[]};return i.eventInfo&&(s=x.extend(s,i.eventInfo)).xAxis&&(i.eventInfo.xAxis=e),s},t}(a.default);t.default=f});