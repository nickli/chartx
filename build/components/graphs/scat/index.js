define("components/graphs/scat/index",["canvax","../index"],function(t,e,i){"use strict";var l,n=this&&this.__extends||(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s=t("canvax"),o=t("../index"),a=s.default.Shapes.Circle,h=s.default.Shapes.Rect,r=s.default.Shapes.Line,d=s.default._,p=function(t){function e(e,i){var l=t.call(this,e,i)||this;return l.type="scat",l.field=null,l.groupField=null,l.node={shapeType:"circle",maxRadius:25,minRadius:5,radius:null,normalR:15,fillStyle:null,fillAlpha:.8,strokeStyle:null,lineWidth:0,lineAlpha:0,focus:{enabled:!0,lineWidth:6,lineAlpha:.2,fillAlpha:.8},select:{enabled:!0,lineWidth:8,lineAlpha:.4,fillAlpha:1}},l.line={enabled:!1,lineWidth:1,strokeStyle:"#ccc",lineType:"dashed"},l.label={enabled:!0,field:null,format:function(t,e){return t},fontSize:13,fontColor:"#888",strokeStyle:"#ffffff",lineWidth:0,align:"center",verticalAlign:"middle",position:"center",offsetX:0,offsetY:0},l.aniOrigin="default",d.extend(!0,l,e),l._rData=null,l._rMaxValue=null,l._rMinValue=null,l.init(),l}return n(e,t),e.prototype.init=function(){this.sprite=new s.default.Display.Sprite({id:"graphsEl"}),this._shapesp=new s.default.Display.Sprite({id:"shapesp"}),this._textsp=new s.default.Display.Sprite({id:"textsp"}),this._linesp=new s.default.Display.Sprite({id:"textsp"}),this.sprite.addChild(this._linesp),this.sprite.addChild(this._shapesp),this.sprite.addChild(this._textsp)},e.prototype.draw=function(t){!t&&(t={}),d.extend(!0,this,t),this.data=this._trimGraphs(),this._widget(),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y;var e=this;return!this.animation||t.resize||e.inited?this.fire("complete"):this.grow(function(){e.fire("complete")}),this},e.prototype.resetData=function(t,e){this.dataFrame=t,this.data=this._trimGraphs(),this._widget()},e.prototype.getNodesAt=function(){return[]},e.prototype._trimGraphs=function(){var t=[],e=this.dataFrame.length,i=this.root._coord._xAxis.field;this._rData=null,this._rMaxValue=null,this._rMinValue=null;for(var l=0;l<e;l++){var n=this.dataFrame.getRowData(l),s=n[i],o=n[this.field],a=this.root._coord._xAxis.getPosX({val:s}),h=this.root._coord._getYaxisOfField(this.field).getYposFromVal(o),r=this.root._coord.getFieldMapOf(this.field),d={rowData:n,x:a,y:h,value:{x:s,y:o},field:this.field,fieldColor:r.color,iNode:l,focused:!1,selected:!1,radius:null,fillStyle:null,color:null,strokeStyle:null,lineWidth:0,shapeType:null,label:null,nodeElement:null};this._setR(d),this._setFillStyle(d),this._setStrokeStyle(d),this._setLineWidth(d),this._setNodeType(d),this._setText(d),t.push(d)}return t},e.prototype._setR=function(t){var e=this.node.normalR,i=t.rowData;if(null!=this.node.radius){if(d.isString(this.node.radius)&&i[this.node.radius]){this._rData||this._rMaxValue||this._rMinValue||(this._rData=this.dataFrame.getFieldData(this.node.radius),this._rMaxValue=d.max(this._rData),this._rMinValue=d.min(this._rData));var l=i[this.node.radius];e=this._rMaxValue==this._rMinValue?this.node.minRadius+(this.node.maxRadius-this.node.minRadius)/2:this.node.minRadius+(l-this._rMinValue)/(this._rMaxValue-this._rMinValue)*(this.node.maxRadius-this.node.minRadius)}d.isFunction(this.node.radius)&&(e=this.node.radius(i)),isNaN(parseInt(this.node.radius))||(e=parseInt(this.node.radius))}return t.radius=e,this},e.prototype._setText=function(t){null!=this.label.field&&d.isString(this.label.field)&&t.rowData[this.label.field]&&(t.label=this.label.format(t.rowData[this.label.field],t))},e.prototype._setFillStyle=function(t){return t.color=t.fillStyle=this._getStyle(this.node.fillStyle,t),this},e.prototype._setStrokeStyle=function(t){return t.strokeStyle=this._getStyle(this.node.strokeStyle||this.node.fillStyle,t),this},e.prototype._getStyle=function(t,e){var i=t;return d.isArray(t)&&(i=t[e.iGroup]),d.isFunction(t)&&(i=t(e)),i||(i=e.fieldColor),i},e.prototype._setLineWidth=function(t){return t.lineWidth=this.node.lineWidth,this},e.prototype._setNodeType=function(t){var e=this.node.shapeType;return d.isArray(e)&&(e=e[t.iGroup]),d.isFunction(e)&&(e=e(t)),e||(e="circle"),t.shapeType=e,this},e.prototype._widget=function(){var t=this;if(t._shapesp.children.length>t.data.length)for(var e=t.data.length;e<t._shapesp.children.length;e++)t._shapesp.getChildAt(e--).destroy();if(t._textsp.children.length>t.data.length)for(e=t.data.length;e<t._textsp.children.length;e++)t._textsp.getChildAt(e--).destroy();if(t._linesp.children.length>t.data.length)for(e=t.data.length;e<t._linesp.children.length;e++)t._linesp.getChildAt(e--).destroy();d.each(t.data,function(e,i){var l=t._getNodeContext(e),n="circle"==e.shapeType?a:h,o=t._shapesp.getChildAt(i);if(o?o.animate(l):(o=new n({id:"shape_"+i,hoverClone:!1,context:l}),t._shapesp.addChild(o),o.on("mousedown mouseup panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){e.eventInfo={title:null,nodes:[this.nodeData]},this.nodeData.label&&(e.eventInfo.title=this.nodeData.label),t.root.fire(e.type,e),t.triggerEvent(t.node,e)})),o.nodeData=e,o.iNode=i,e.nodeElement=o,t.node.focus.enabled&&o.hover(function(e){t.focusAt(this.nodeData.iNode)},function(e){!this.nodeData.selected&&t.unfocusAt(this.nodeData.iNode)}),t.line.enabled){var p=t._linesp.getChildAt(i),u={start:{x:l.x,y:l.y+l.r},end:{x:l.x,y:0},lineWidth:t.line.lineWidth,strokeStyle:t.line.strokeStyle,lineType:t.line.lineType};p?p.animate(u):(p=new r({context:u}),t._linesp.addChild(p)),o._line=p}if(e.label&&t.label.enabled){var c=t._textsp.getChildAt(i),f={};c?(c.resetText(e.label),f=t._getTextContext(c,o),c.animate(f)):(c=new s.default.Display.Text(e.label,{id:"scat_text_"+i,context:{}}),f=t._getTextContext(c,o),d.extend(c.context,f),t._textsp.addChild(c)),o._label=c,c.nodeElement=o}})},e.prototype._getTextPosition=function(t,e){var i=0,l=0;switch(this.label.position){case"center":i=e.x,l=e.y;break;case"top":i=e.x,l=e.y-e.r;break;case"right":i=e.x+e.r,l=e.y;break;case"bottom":i=e.x,l=e.y+e.r;break;case"left":i=e.x-e.r,l=e.y;break;case"auto":i=e.x,l=e.y,t.getTextWidth()>2*e.r&&(l=e.y+e.r+.5*t.getTextHeight())}return{x:i+this.label.offsetX,y:l+this.label.offsetY}},e.prototype._getTextContext=function(t,e){var i=this._getTextPosition(t,e.context),l=this.label.fontSize;t.getTextWidth()>2*e.context.r&&(l-=2);var n={x:i.x,y:i.y,fillStyle:this.label.fontColor||e.context.fillStyle,fontSize:l,strokeStyle:this.label.strokeStyle||e.context.fillStyle,lineWidth:this.label.lineWidth,textAlign:this.label.align,textBaseline:this.label.verticalAlign};return this.animation&&!this.inited&&this._setCtxAniOrigin(n),n},e.prototype._setCtxAniOrigin=function(t){"default"==this.aniOrigin&&(t.y=0),"origin"==this.aniOrigin&&(t.x=this.root._coord._yAxis[0]._axisLine.context.x,t.y=this.root._coord._xAxis._axisLine.context.y),"center"==this.aniOrigin&&(t.x=this.width/2,t.y=-this.height/2)},e.prototype._getNodeContext=function(t){if("circle"==t.shapeType)return this._getCircleContext(t)},e.prototype._getCircleContext=function(t){var e={x:t.x,y:t.y,r:t.radius,fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,lineWidth:t.lineWidth,fillAlpha:this.node.fillAlpha,cursor:"pointer"};return this.animation&&!this.inited&&(this._setCtxAniOrigin(e),e.r=1),e},e.prototype.grow=function(t){var e=0,i=this.data.length-1,l=this;d.each(this.data,function(n){n.nodeElement.animate({x:n.x,y:n.y,r:n.radius},{onUpdate:function(t){if(this._label&&this._label.context){var e=l._getTextPosition(this._label,t);this._label.context.x=e.x,this._label.context.y=e.y}this._line&&this._line.context&&(this._line.context.start.y=t.y+t.r)},delay:Math.round(300*Math.random()),onComplete:function(){(e+=1)==i&&t&&t()}})})},e.prototype.focusAt=function(t){var e=this.data[t];if(this.node.focus.enabled&&!e.focused){var i=e.nodeElement.context;i.lineWidth=this.node.focus.lineWidth,i.lineAlpha=this.node.focus.lineAlpha,i.fillAlpha=this.node.focus.fillAlpha,e.focused=!0}},e.prototype.unfocusAt=function(t){var e=this.data[t];if(this.node.focus.enabled&&e.focused){var i=e.nodeElement.context;i.lineWidth=this.node.lineWidth,i.lineAlpha=this.node.lineAlpha,i.fillAlpha=this.node.fillAlpha,e.focused=!1}},e.prototype.selectAt=function(t){var e=this.data[t];if(this.node.select.enabled&&!e.selected){var i=e.nodeElement.context;i.lineWidth=this.node.select.lineWidth,i.lineAlpha=this.node.select.lineAlpha,i.fillAlpha=this.node.select.fillAlpha,e.selected=!0}},e.prototype.unselectAt=function(t){var e=this.data[t];if(this.node.select.enabled&&e.selected){var i=e.nodeElement.context;e.focused?(i.lineWidth=this.node.focus.lineWidth,i.lineAlpha=this.node.focus.lineAlpha,i.fillAlpha=this.node.focus.fillAlpha):(i.lineWidth=this.node.lineWidth,i.lineAlpha=this.node.lineAlpha,i.fillAlpha=this.node.fillAlpha),e.selected=!1}},e}(o.default);e.default=p});