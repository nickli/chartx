define("components/graphs/funnel/index",["canvax","../index","../../../utils/tools"],function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var a=t("canvax"),s=t("../index"),l=t("../../../utils/tools"),r=a.default._,h=a.default.Display.Text,d=a.default.Shapes.Polygon,u=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.type="funnel",n.field=null,n.dataOrg=[],n.data=[],n.sort=null,n.invert=!1,n._maxVal=null,n._minVal=null,n.maxNodeWidth=null,n.minNodeWidth=0,n.minVal=0,n.node={shapeType:"polygon",height:0,fillStyle:null,lineWidth:0,strokeStyle:null,focus:{enabled:!0},select:{enabled:!0,lineWidth:2,strokeStyle:"#666"}},n.label={enabled:!0,align:"center",format:function(t){return l.numAddSymbol(t)},fontColor:"#ffffff",fontSize:13,textBaseline:"middle"},r.extend(!0,n,e),n.init(),n}return o(e,t),e.prototype.init=function(){this.sprite=new a.default.Display.Sprite({name:"funnelGraphsEl"})},e.prototype._computerAttr=function(){this.field&&(this.dataOrg=this.dataFrame.getFieldData(this.field)),this._maxVal=r.max(this.dataOrg),this._minVal=r.min(this.dataOrg),this.maxNodeWidth||(this.maxNodeWidth=.7*this.width),this.node.height||(this.node.height=this.height/this.dataOrg.length),"asc"==this.sort&&(this.invert=!0),"desc"==this.sort&&(this.invert=!1)},e.prototype.draw=function(t){!t&&(t={}),r.extend(!0,this,t);this.animation&&t.resize;this._computerAttr(),this.data=this._trimGraphs(),this._drawGraphs(),this.sprite.context.x=this.origin.x+this.width/2,this.sprite.context.y=this.origin.y},e.prototype._trimGraphs=function(){if(this.field){var t=this,e=[];return r.each(this.dataOrg,function(i,n){var o={type:"funnel",field:t.field,rowData:t.dataFrame.getRowData(n),value:i,width:t._getNodeWidth(i),color:t.root.getTheme(n),cursor:"pointer",label:"",middlePoint:null,iNode:-1,points:[]};e.push(o)}),this.sort&&(e=e.sort(function(e,i){return"desc"==t.sort?i.value-e.value:e.value-i.value})),r.each(e,function(e,i){e.iNode=i,e.label=t.label.format(e.value,e)}),r.each(e,function(i,n){i.points=t._getPoints(i,e[n+1],e[n-1]),i.middlePoint={x:0,y:(i.iNode+.5)*t.node.height}}),e}},e.prototype._getNodeWidth=function(t){var e=this.minNodeWidth+(this.maxNodeWidth-this.minNodeWidth)/(this._maxVal-this.minVal)*(t-this.minVal);return parseInt(e)},e.prototype._getPoints=function(t,e,i){var n=[],o=t.iNode*this.node.height,a=o+this.node.height;if(this.invert){var s=this.minNodeWidth;i&&(s=i.width),n.push([-s/2,o]),n.push([s/2,o]),n.push([t.width/2,a]),n.push([-t.width/2,a])}else{n.push([-t.width/2,o]),n.push([t.width/2,o]);var l=this.minNodeWidth;e&&(l=e.width),n.push([l/2,a]),n.push([-l/2,a])}return n},e.prototype._drawGraphs=function(){var t=this;r.each(this.data,function(e){var i=new d({context:{pointList:e.points,fillStyle:e.color,cursor:e.cursor}});t.sprite.addChild(i),i.nodeData=e,i.on("mousedown mouseup panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){e.eventInfo={title:t.field,nodes:[this.nodeData]},t.root.fire(e.type,e),t.triggerEvent(t.node,e)});var n="center",o={x:e.middlePoint.x,y:e.middlePoint.y};"left"==t.label.align&&(o.x=e.points[0][0]-(e.points[0][0]-e.points[3][0])/2,o.x-=15,n="right"),"right"==t.label.align&&(o.x=e.points[1][0]-(e.points[1][0]-e.points[2][0])/2,o.x+=15,n="left");var a=new h(e.label,{context:{x:o.x,y:o.y,fontSize:t.label.fontSize,fillStyle:"center"==t.label.align?t.label.fontColor:e.color,textAlign:n,textBaseline:t.label.textBaseline}});t.sprite.addChild(a)})},e}(s.default);e.default=u});