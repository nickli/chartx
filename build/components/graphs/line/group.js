define("components/graphs/line/group",["canvax","../../../utils/tools","../../../utils/colorformat"],function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var o=t("canvax"),l=t("../../../utils/tools"),a=t("../../../utils/colorformat"),s=o.default.AnimationFrame,c=o.default.Shapes.BrokenLine,h=(o.default.Shapes.Rect,o.default.Shapes.Circle),p=o.default.Shapes.Path,u=o.default._,_=function(t){function e(e,i,n,r,o,l){var a=t.call(this)||this;return a._opt=n,a.fieldMap=e,a.field=null,a.iGroup=i,a._yAxis=e.yAxis,a.ctx=r,a.w=l,a.h=o,a.y=0,a.line={enabled:1,shapeType:"brokenLine",strokeStyle:e.color,lineWidth:2,lineType:"solid",smooth:!0},a.icon={enabled:1,shapeType:"circle",corner:!1,radius:3,fillStyle:"#ffffff",strokeStyle:null,lineWidth:2},a.label={enabled:0,fontColor:null,strokeStyle:null,fontSize:12,format:null},a.area={shapeType:"path",enabled:1,fillStyle:null,alpha:.3},a.data=[],a.sprite=null,a._pointList=[],a._currPointList=[],a._bline=null,u.extend(!0,a,n),a.field=e.field,a.init(n),a}return r(e,t),e.prototype.init=function(t){this.sprite=new o.default.Display.Sprite;var e=this;this.sprite.on("destroy",function(){e._growTween&&s.destroyTween(e._growTween)})},e.prototype.draw=function(t,e){u.extend(!0,this,t),this.data=e,this._widget(t)},e.prototype.destroy=function(){var t=this;t.sprite.animate({globalAlpha:0},{duration:300,onComplete:function(){t.sprite.remove()}})},e.prototype._getColor=function(t,e){var i=this._getProp(t,e);return void 0!==i&&null!==i||(i=this._getLineStrokeStyle())&&u.isString(i)||(i=this.fieldMap.color),i},e.prototype._getProp=function(t,e){return u.isArray(t)?t[this.iGroup]:u.isFunction(t)?t.apply(this,[this.getNodeInfoAt(e)]):t},e.prototype.getNodeInfoAt=function(t){return this.data[t]},e.prototype.resetData=function(t,e){var i=this;t&&(this.data=t),i._pointList=this._getPointList(this.data);var n=i._pointList.length,r=i._currPointList.length;e||(e={name:"normal",left:0,right:n-r}),e.left&&(e.left>0&&(this._currPointList=this._pointList.slice(0,e.left).concat(this._currPointList)),e.left<0&&this._currPointList.splice(0,Math.abs(e.left))),e.right&&(e.right>0&&(this._currPointList=this._currPointList.concat(this._pointList.slice(-e.right))),e.right<0&&this._currPointList.splice(this._currPointList.length-Math.abs(e.right))),i._createNodes(),i._createTexts(),i._grow()},e.prototype._grow=function(t,e){var i=this;function n(t){i._bline.context.pointList=u.clone(t),i._bline.context.strokeStyle=i._getLineStrokeStyle(t),i._area.context.path=i._fillLine(i._bline),i._area.context.fillStyle=i._getFillStyle();var e=0;u.each(t,function(t,n){if(u.isNumber(t[1])){if(i._circles){var r=i._circles.getChildAt(e);r&&(r.context.x=t[0],r.context.y=t[1])}if(i._labels){var o=i._labels.getChildAt(e);o&&(o.context.x=t[0],o.context.y=t[1]-3,i._checkTextPos(o,n))}e++}})}i.data.length?this._growTween=s.registTween({from:i._getPointPosStr(i._currPointList),to:i._getPointPosStr(i._pointList),desc:i.field,onUpdate:function(t){for(var e in t){var r=parseInt(e.split("_")[2]),o=parseInt(e.split("_")[1]);i._currPointList[r]&&(i._currPointList[r][o]=t[e])}n(i._currPointList)},onComplete:function(){i._growTween=null,n(i._pointList),t&&t(i)}}):t&&t(i)},e.prototype._getPointPosStr=function(t){var e={};return u.each(t,function(t,i){t&&(e["p_1_"+i]=t[1],e["p_0_"+i]=t[0])}),e},e.prototype._getPointList=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];e.push([r.x,r.y])}return e},e.prototype._widget=function(t){var e=this;if(!t&&(t={}),e._pointList=this._getPointList(e.data),0!=e._pointList.length){var i=[];if(t.animation)for(var n=this._getFirstNode(),r=n?n.y:void 0,o=0,l=e.data.length;o<l;o++){var a=e.data[o];i.push([a.x,u.isNumber(a.y)?r:a.y])}else i=e._pointList;e._currPointList=i;var s=new c({context:{pointList:i,lineWidth:e.line.lineWidth,y:e.y,strokeStyle:e._getLineStrokeStyle(i),smooth:e.line.smooth,lineType:e._getProp(e.line.lineType),smoothFilter:function(t){t[1]>0?t[1]=0:Math.abs(t[1])>e.h&&(t[1]=-e.h)},lineCap:"round"}});this.line.enabled||(s.context.visible=!1),e.sprite.addChild(s),e._bline=s;var h=new p({context:{path:e._fillLine(s),fillStyle:e._getFillStyle(),globalAlpha:u.isArray(e.area.alpha)?1:e.area.alpha}});this.area.enabled||(h.context.visible=!1),e.sprite.addChild(h),e._area=h,e._createNodes(),e._createTexts()}},e.prototype._getFirstNode=function(){for(var t=null,e=0,i=this.data.length;e<i;e++){var n=this.data[e];if(u.isNumber(n.y)&&(null!==t&&"right"!=this._yAxis.place||(t=n),"right"!==this._yAxis.place&&null!==t))break}return t},e.prototype._getFillStyle=function(){var t=this,e=null,i=t._getProp(t.area.fillStyle)||t._getLineStrokeStyle(null,"fillStyle");if(u.isArray(t.area.alpha)&&!(i instanceof CanvasGradient)){t.area.alpha.length=2,void 0==t.area.alpha[0]&&(t.area.alpha[0]=0),void 0==t.area.alpha[1]&&(t.area.alpha[1]=0);var n=u.min(t._bline.context.pointList,function(t){return t[1]});if(void 0===n[0]||void 0===n[1])return null;e=t.ctx.createLinearGradient(n[0],n[1],n[0],0);var r=a.default.colorRgb(i),o=r.replace(")",", "+t._getProp(t.area.alpha[0])+")").replace("RGB","RGBA");e.addColorStop(0,o);var l=r.replace(")",", "+t.area.alpha[1]+")").replace("RGB","RGBA");e.addColorStop(1,l),i=e}return i},e.prototype._getLineStrokeStyle=function(t,e){var i;if(!this._opt.line||!this._opt.line.strokeStyle)return this.line.strokeStyle;if(this._opt.line.strokeStyle.lineargradient){!t&&(t=this._bline.context.pointList);var n=u.min(t,function(t){return t[1]}),r=u.max(t,function(t){return t[1]});return"fillStyle"==e&&(r=[0,0]),void 0===n[0]||void 0===n[1]||void 0===r[1]?null:(i=this.ctx.createLinearGradient(n[0],n[1],n[0],r[1]),u.each(this._opt.line.strokeStyle.lineargradient,function(t,e){i.addColorStop(t.position,t.color)}),i)}return i=this._getColor(this._opt.line.strokeStyle)},e.prototype._createNodes=function(){var t=this,e=t._currPointList;if((t.icon.enabled||1==e.length)&&t.line.lineWidth){this._circles||(this._circles=new o.default.Display.Sprite({}),this.sprite.addChild(this._circles));for(var i=0,n=0,r=e.length;n<r;n++){var l=t._currPointList[n];if(l&&u.isNumber(l[1])){var a={x:l[0],y:l[1],r:t._getProp(t.icon.radius,n),lineWidth:t._getProp(t.icon.lineWidth,n)||2,strokeStyle:t._getColor(t.icon.strokeStyle,n),fillStyle:t.icon.fillStyle},s=t._circles.children[i];if(s?u.extend(s.context,a):(s=new h({context:a}),t._circles.addChild(s)),t.icon.corner){var c=t._pointList[n][1],p=t._pointList[n-1],_=t._pointList[n+1];p&&_&&c==p[1]&&c==_[1]&&(s.context.visible=!1)}i++}}if(t._circles.children.length>i)for(var f=i,d=t._circles.children.length;f<d;f++)t._circles.children[f].destroy(),f--,d--}},e.prototype._createTexts=function(){var t=this,e=t._currPointList;if(t.label.enabled){this._labels||(this._labels=new o.default.Display.Sprite({}),this.sprite.addChild(this._labels));for(var i=0,n=0,r=e.length;n<r;n++){var l=e[n];if(l&&u.isNumber(l[1])){var a={x:l[0],y:l[1]-3,fontSize:this.label.fontSize,textAlign:"center",textBaseline:"bottom",fillStyle:t._getColor(t.label.fontColor,n),lineWidth:1,strokeStyle:"#ffffff"},s=t.data[n].value;if(u.isFunction(t.label.format)&&(s=t.label.format(s,t.data[n])||s),void 0!=s&&null!=s){var c=this._labels.children[i];c?(c.resetText(s),u.extend(c.context,a)):(c=new o.default.Display.Text(s,{context:a}),t._labels.addChild(c),t._checkTextPos(c,n)),i++}}}if(t._labels.children.length>i)for(var h=i,p=t._labels.children.length;h<p;h++)t._labels.children[h].destroy(),h--,p--}},e.prototype._checkTextPos=function(t,e){var i=this._currPointList,n=i[e-1],r=i[e+1];n&&r&&n[1]<t.context.y&&r[1]<t.context.y&&(t.context.y+=7,t.context.textBaseline="top")},e.prototype._fillLine=function(t){var e=u.clone(t.context.pointList),i="",n=this._yAxis.basePoint.y,r=null;function o(){r.push([r[r.length-1][0],n],[r[0][0],n],[r[0][0],r[0][1]]),i+=l.getPath(r),r=null}return u.each(e,function(t,i){u.isNumber(t[1])?(null===r&&(r=[]),r.push(t)):r&&r.length&&o(),i==e.length-1&&u.isNumber(t[1])&&o()}),i},e}(o.default.Event.EventDispatcher);e.default=_});