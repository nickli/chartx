define("components/graphs/planet/index",["canvax","../index","../../../utils/dataframe","./group"],function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var o=t("canvax"),a=t("../index"),s=t("../../../utils/dataframe"),c=t("./group"),d=o.default._,l=o.default.Display.Text,h=o.default.Shapes.Circle,u=o.default.Shapes.Line,g=o.default.Shapes.Rect,p=function(t){function e(e,i){var r=t.call(this,e,i)||this;r.type="planet",r.field=null;return r.center={enabled:!0,text:"center",radius:30,fillStyle:"#70629e",fontSize:15,fontColor:"#ffffff",margin:20},r.groupDataFrames=[],r.groupField=null,r._ringGroups=[],r.grid={rings:{fillStyle:null,strokeStyle:null,lineWidth:1,section:[],count:3},rays:{count:0,lineWidth:1,strokeStyle:"#10519D",globalAlpha:.4}},r.selectInds=[],d.extend(!0,r,e),0!=r.center.radius&&r.center.enabled||(r.center.radius=0,r.center.margin=0,r.center.enabled=!1),r.init(),r}return n(e,t),e.prototype.init=function(){this.sprite=new o.default.Display.Sprite({id:"graphsEl"}),this.gridSp=new o.default.Display.Sprite({id:"gridSp"}),this.sprite.addChild(this.gridSp),this._dataGroupHandle()},e.prototype.draw=function(t){!t&&(t={}),d.extend(!0,this,t),this._drawGroups(),this._drawCenter(),this.fire("complete")},e.prototype.getLegendData=function(){var t=[],e=[];return this.legendField&&d.each(this.dataFrame.getFieldData(this.legendField),function(i){-1==d.indexOf(t,i)&&(t.push(i),e.push({name:i,field:this.legendField,color:"#ff8533",enabled:!0,ind:0}))}),e},e.prototype._getMaxR=function(){var t;try{t=this.graphs.group.circle.maxR}catch(t){}return void 0==t&&(t=30),t},e.prototype._drawGroups=function(){var t=this,e=this.center.radius+this.center.margin,i=t.root._coord.maxR-t.center.radius-t.center.margin,r=this._getMaxR();d.each(this.groupDataFrames,function(n,o){var a=e+i*(n.length/t.dataFrame.length),s=new c.default(d.extend(!0,{iGroup:o,groupLen:t.groupDataFrames.length,rRange:{start:e,to:a},width:t.width-2*r,height:t.height-2*r,selectInds:t.selectInds},t._opt),n,t);e=s.rRange.to,t._ringGroups.push(s),t.grid.rings.section.push({radius:s.rRange.to})}),t._drawBack(),d.each(t._ringGroups,function(e){t.sprite.addChild(e.sprite)})},e.prototype._drawCenter=function(){this.center.enabled&&(this._center=new h({context:{x:this.origin.x,y:this.origin.y,fillStyle:this.center.fillStyle,r:this.center.radius}}),this._centerTxt=new l(this.center.text,{context:{x:this.origin.x,y:this.origin.y,fontSize:this.center.fontSize,textAlign:"center",textBaseline:"middle",fillStyle:this.center.fontColor}}),this.sprite.addChild(this._center),this.sprite.addChild(this._centerTxt))},e.prototype._drawBack=function(){var t=this;if(1==t.grid.rings.section.length){var e=(t.grid.rings.section[0].radius-t.center.radius)/t.grid.rings.count;t.grid.rings.section=[];for(var i=0;i<t.grid.rings.count;i++)t.grid.rings.section.push({radius:t.center.radius+e*(i+1)})}else t.grid.rings.count=t.grid.rings.section.length;for(i=t.grid.rings.section.length-1;i>=0;i--){var r=t.grid.rings.section[i];t.gridSp.addChild(new h({context:{x:t.root._coord.origin.x,y:t.root._coord.origin.y,r:r.radius,lineWidth:t._getBackProp(t.grid.rings.lineWidth,i),strokeStyle:t._getBackProp(t.grid.rings.strokeStyle,i),fillStyle:t._getBackProp(t.grid.rings.fillStyle,i)}}))}if(t.grid.rays.count>1){var n=this.root._coord.origin.x,o=this.root._coord.origin.y,a=360/t.grid.rays.count,s=t.root._coord.maxR;t.grid.rings.section.length&&(s=t.grid.rings.section.slice(-1)[0].radius);i=0;for(var c=t.grid.rays.count;i<c;i++){var d=a*i/180*Math.PI,l=n+s*Math.cos(d),p=o+s*Math.sin(d);t.gridSp.addChild(new u({context:{start:{x:n,y:o},end:{x:l,y:p},lineWidth:t._getBackProp(t.grid.rays.lineWidth,i),strokeStyle:t._getBackProp(t.grid.rays.strokeStyle,i),globalAlpha:t.grid.rays.globalAlpha}}))}}var f=new g({name:"clipRect",context:{x:t.root._coord.origin.x-t.root.width/2,y:t.root._coord.origin.y-t.height/2,width:t.root.width,height:t.height}});t.gridSp.clipTo(f),t.sprite.addChild(f)},e.prototype._getBackProp=function(t,e){var i=null;return d.isFunction(t)&&(i=t.apply(this,[{scaleInd:e,count:this.grid.rings.section.length,groups:this._ringGroups,graphs:this}])),(d.isString(t)||d.isNumber(t))&&(i=t),d.isArray(t)&&(i=t[e]),i},e.prototype._dataGroupHandle=function(){var t=d.indexOf(this.dataFrame.fields,this.groupField);if(t>=0){var e=this.dataFrame.org[0],i={};for(var r in d.each(this.dataFrame.org,function(r,n){n&&(i[r[t]]||(i[r[t]]=[d.clone(e)]),i[r[t]].push(r))}),i)this.groupDataFrames.push(s.default(i[r]))}else this.groupDataFrames.push(this.dataFrame)},e.prototype.show=function(t,e){this.getAgreeNodeData(e,function(t){t.nodeElement&&(t.nodeElement.context.visible=!0),t.labelElement&&(t.labelElement.context.visible=!0)})},e.prototype.hide=function(t,e){this.getAgreeNodeData(e,function(t){t.nodeElement&&(t.nodeElement.context.visible=!1),t.labelElement&&(t.labelElement.context.visible=!1)})},e.prototype.getAgreeNodeData=function(t,e){d.each(this._ringGroups,function(i){d.each(i._rings,function(i,r){d.each(i.planets,function(i,r){var n=i.rowData;t.name==n[t.field]&&e&&e(i)})})})},e.prototype.getLayoutNodes=function(){var t=[];return d.each(this._ringGroups,function(e){d.each(e.planets,function(e){e.pit&&t.push(e)})}),t},e.prototype.getInvalidNodes=function(){var t=[];return d.each(this._ringGroups,function(e){d.each(e.planets,function(e){e.pit||t.push(e)})}),t},e.prototype.selectAt=function(t){d.each(this._ringGroups,function(e){e.selectAt(t)})},e.prototype.selectAll=function(){var t=this;d.each(t.dataFrame.getFieldData("__index__"),function(e){t.selectAt(e)})},e.prototype.unselectAt=function(t){d.each(this._ringGroups,function(e){e.unselectAt(t)})},e.prototype.unselectAll=function(t){var e=this;d.each(e.dataFrame.getFieldData("__index__"),function(t){e.unselectAt(t)})},e.prototype.getSelectedNodes=function(){var t=[];return d.each(this._ringGroups,function(e){t=t.concat(e.getSelectedNodes())}),t},e.prototype.getSelectedRowList=function(){var t=[];return d.each(this._ringGroups,function(e){var i=[];d.each(e.getSelectedNodes(),function(t){i.push(t.rowData)}),t=t.concat(i)}),t},e}(a.default);e.default=p});