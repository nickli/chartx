define("components/graphs/cloud/index",["canvax","../index","../../../layout/cloud"],function(t,e,n){"use strict";var o,i=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var a=t("canvax"),d=t("../index"),r=t("../../../layout/cloud"),s=a.default._,l=a.default.Display.Text,f=function(t){function e(e,n){var o=t.call(this,e,n)||this;o.type="cloud",o.field=null;var i=o;return o.node={fontFamily:"Impact",fontColor:function(t){return i.root.getTheme(t.iNode)},fontSize:function(){return this.minFontSize+Math.random()*this.maxFontSize},maxFontSize:30,_maxFontSizeVal:0,minFontSize:16,_minFontSizeVal:null,fontWeight:"normal",format:function(t,e){return t},padding:10,rotation:function(){return 30*(~~(6*Math.random())-3)},strokeStyle:null,focus:{enabled:!0},select:{enabled:!0,lineWidth:2,strokeStyle:"#666"}},s.extend(!0,o,e),o.init(),o}return i(e,t),e.prototype.init=function(){this.sprite=new a.default.Display.Sprite({id:"graphsEl"})},e.prototype.draw=function(t){!t&&(t={}),s.extend(!0,this,t),this._drawGraphs(),this.sprite.context.x=this.width/2,this.sprite.context.y=this.height/2,this.fire("complete")},e.prototype.getDaraFrameIndOfVal=function(t){var e=this,n=this.dataFrame,o=s.find(n.data,function(t){return t.field==e.field});return s.indexOf(o.data,t)},e.prototype._getFontSize=function(t,e){var n=this.node.minFontSize;if(s.isFunction(this.node.fontSize)&&(n=this.node.fontSize(t)),s.isString(this.node.fontSize)&&this.node.fontSize in t){e=Number(t[this.node.fontSize]);isNaN(e)||(n=this.node.minFontSize+(this.node.maxFontSize-this.node.minFontSize)/(this.node._maxFontSizeVal-this.node._minFontSizeVal)*(e-this.node._minFontSizeVal))}return s.isNumber(this.node.fontSize)&&(n=this.node.fontSize),n},e.prototype._getRotate=function(t,e){var n=this.node.rotation;return s.isFunction(this.node.rotation)&&(n=this.node.rotation(t,e)||0),n},e.prototype._getFontColor=function(t){var e;return s.isString(this.node.fontColor)&&(e=this.node.fontColor),s.isFunction(this.node.fontColor)&&(e=this.node.fontColor(t)),void 0!==e&&null!==e||(e="#ccc"),e},e.prototype._drawGraphs=function(){var t=this;s.isString(this.node.fontSize)&&s.each(t.dataFrame.getFieldData(this.node.fontSize),function(e){t.node._maxFontSizeVal=Math.max(t.node._maxFontSizeVal,e),t.node._minFontSizeVal=Math.min(t.node._minFontSizeVal,e)}),r.default().size([t.width,t.height]).words(t.dataFrame.getFieldData(t.field).map(function(e,n){var o=t.root.dataFrame.getRowData(t.getDaraFrameIndOfVal(e)),i={rowData:o,field:t.field,value:e,text:null,size:t._getFontSize(o,e),iNode:n,color:null};return i.fontColor=t._getFontColor(i),i.text=t.node.format(e,i)||e,i})).padding(t.node.padding).rotate(function(e,n){return t._getRotate(e,n)}).font(t.node.fontFamily).fontSize(function(t){return t.size}).on("end",function(e,n){t.data=e,t.sprite.removeAllChildren(),s.each(e,function(n,o){n.iNode=o,n.dataLen=e.length,n.focused=!1,n.selected=!1;var i=new l(n.text,{context:{x:n.x,y:n.y,fontSize:n.size,fontFamily:n.font,rotation:n.rotate,textBaseline:"middle",textAlign:"center",cursor:"pointer",fontWeight:t.node.fontWeight,fillStyle:n.fontColor}});t.sprite.addChild(i),t.node.focus.enabled&&i.hover(function(e){t.focusAt(this.nodeData.iNode)},function(e){!this.nodeData.selected&&t.unfocusAt(this.nodeData.iNode)}),i.nodeData=n,n._node=i,i.on("mousedown mouseup panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){e.eventInfo={title:null,nodes:[this.nodeData]},this.nodeData.text&&(e.eventInfo.title=this.nodeData.text),t.root.fire(e.type,e),t.triggerEvent(t.node,e)})})}).start()},e.prototype.focusAt=function(t){var e=this.data[t];this.node.focus.enabled&&!e.focused&&(e._node.context.fontSize+=3,e.focused=!0)},e.prototype.unfocusAt=function(t){var e=this.data[t];this.node.focus.enabled&&e.focused&&(e._node.context.fontSize-=3,e.focused=!1)},e.prototype.selectAt=function(t){var e=this.data[t];if(this.node.select.enabled&&!e.selected){var n=e._node.context;n.lineWidth=this.node.select.lineWidth,n.lineAlpha=this.node.select.lineAlpha,n.strokeStyle=this.node.select.strokeStyle,e.selected=!0}},e.prototype.unselectAt=function(t){var e=this.data[t];this.node.select.enabled&&e.selected&&(e._node.context.strokeStyle=this.node.strokeStyle,e.selected=!1)},e}(d.default);e.default=f});