define("components/graphs/pie/pie",["canvax"],function(t,e,n){"use strict";var o,s=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var i=t("canvax"),a=i.default.Shapes.Sector,r=i.default.Shapes.Path,l=(i.default.Shapes.Rect,i.default.AnimationFrame),d=i.default._,c=function(t){function e(e,n){var o=t.call(this)||this;return o.width=0,o.height=0,o.origin={x:0,y:0},o._graphs=e,o.domContainer=e.root.canvax.domView,o.data=n,o.sprite=null,o.textSp=null,o.sectorsSp=null,o.selectedSp=null,o.init(),o.sectors=[],o.textMaxCount=15,o.textList=[],o.completed=!1,o}return s(e,t),e.prototype.init=function(){this.sprite=new i.default.Display.Sprite,this.sectorsSp=new i.default.Display.Sprite,this.sprite.addChild(this.sectorsSp),this.selectedSp=new i.default.Display.Sprite,this.sprite.addChild(this.selectedSp),this._graphs.label.enabled&&(this.textSp=new i.default.Display.Sprite)},e.prototype.draw=function(t){d.extend(!0,this,t),this.sprite.context.x=this.origin.x,this.sprite.context.y=this.origin.y,this._widget()},e.prototype.resetData=function(t){var e=this;this.data=t,e.destroyLabel();for(var n=0,o=0;o<e.sectors.length;o++){var s=e.sectors[o],i=this.data.list[o];s.animate({r:i.outRadius,startAngle:i.startAngle,endAngle:i.endAngle},{duration:280,onComplete:function(){++n==e.sectors.length&&e._graphs.label.enabled&&e._startWidgetLabel()}})}},e.prototype._widget=function(){var t=this,e=t.data.list,n=t.data.total;if(e.length>0&&n>0){t.textSp&&t.sprite.addChild(t.textSp);for(var o=0;o<e.length;o++){var s=e[o],i=new a({hoverClone:!1,xyToInt:!1,context:{x:s.focused?s.outOffsetx:0,y:s.focused?s.outOffsety:0,r0:s.innerRadius,r:s.outRadius,startAngle:s.startAngle,endAngle:s.endAngle,fillStyle:s.fillStyle,cursor:"pointer"},id:"sector"+o});i.nodeData=s,s.focusEnabled&&i.hover(function(e){t.focusOf(this.nodeData)},function(e){!this.nodeData.selected&&t.unfocusOf(this.nodeData)}),i.on("mousedown mouseup panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){e.eventInfo={nodes:[this.nodeData]},t._graphs.root.fire(e.type,e),t._graphs.triggerEvent(t._graphs.node,e)}),t.sectorsSp.addChildAt(i,0),t.sectors.push(i)}t._graphs.label.enabled&&t._startWidgetLabel()}},e.prototype.focusOf=function(t,e){if(!t.focused){this.sectors[t.iNode].animate({x:t.outOffsetx,y:t.outOffsety},{duration:100,onComplete:function(){e&&e()}}),t.focused=!0}},e.prototype.unfocusOf=function(t,e){if(t.focused){this.sectors[t.iNode].animate({x:0,y:0},{duration:100,onComplete:function(){e&&e()}}),t.focused=!1}},e.prototype.selectOf=function(t,e){var n=this;if(this.sectors.length&&t.selectEnabled){var o=this.sectors[t.iNode];t.selected||(t.focused?this.addCheckedSec(o):(t._focusTigger="select",this.focusOf(t,function(){n.addCheckedSec(o)})),t.selected=!0)}},e.prototype.unselectOf=function(t,e){var n=this.sectors[t.iNode];if(t.selected&&t.selectEnabled){var o=this;o.cancelCheckedSec(n,function(){"select"==t._focusTigger&&o.unfocusOf(t)}),t.selected=!1}},e.prototype.addCheckedSec=function(t,e){var n=t.context,o=t.nodeData;if(n){var s=new a({xyToInt:!1,context:{x:n.x,y:n.y,r0:n.r-1,r:n.r+o.selectedR,startAngle:n.startAngle,endAngle:n.startAngle,fillStyle:n.fillStyle,globalAlpha:o.selectedAlpha},id:"selected_"+t.id});t._selectedSec=s,this.selectedSp.addChild(s),this.completed?s.animate({endAngle:n.endAngle},{duration:this._getAngleTime(n),onComplete:function(){e&&e()}}):s.context.endAngle=n.endAngle}},e.prototype.cancelCheckedSec=function(t,e){var n=t._selectedSec;n.animate({startAngle:n.context.endAngle-.5},{duration:this._getAngleTime(t.context),onComplete:function(){delete t._selectedSec,n.destroy(),e&&e()}})},e.prototype._getAngleTime=function(t){return Math.abs(t.startAngle-t.endAngle)/360*500},e.prototype.grow=function(t){var e=this;d.each(e.sectors,function(t,n){t.context&&(t.context.r0=0,t.context.r=0,t.context.startAngle=e._graphs.startAngle,t.context.endAngle=e._graphs.startAngle)}),e._hideGrowLabel(),l.registTween({from:{process:0},to:{process:1},duration:500,onUpdate:function(t){for(var n=0;n<e.sectors.length;n++){var o=e.sectors[n],s=o.nodeData,i=o.context,a=s.startAngle,r=s.endAngle,l=s.outRadius,d=s.innerRadius;if(i){if(i.r=l*t.process,i.r0=d*t.process,0==n)i.startAngle=a,i.endAngle=a+(r-a)*t.process;else{var c=function(t){var n=t-1,o=e.sectors[n].context;return 0==n?o?o.endAngle:0:o?o.endAngle:arguments.callee(n)}(n);i.startAngle=c,i.endAngle=i.startAngle+(r-a)*t.process}o._selectedSec&&(o._selectedSec.context.r0=i.r-1,o._selectedSec.context.r=i.r+s.selectedR,o._selectedSec.context.startAngle=i.startAngle,o._selectedSec.context.endAngle=i.endAngle)}}},onComplete:function(){e._showGrowLabel(),e.completed=!0,t&&t()}})},e.prototype._widgetLabel=function(t,e,n,o,s,i){var a,l,d,c,u,h,p,f,g,x,y,v,S=this,_=0,A=S.data.list,b=2==t||3==t,m=3==t||4==t,w=b?n:o;e.length>0&&e.sort(function(t,e){return m?A[t].edgey-A[e].edgey:A[e].edgey-A[t].edgey});for(var C=0;C<e.length;C++){a=e[C];var L=A[a],M=L.outRadius+L.moveDis;if(!(!L.enabled||L.y<w||_>=S.textMaxCount)){_++,d=L.edgey,c=Math.abs(L.edgex),u=d-l,0!=C&&(Math.abs(u)<15||m&&u<0||!m&&u>0)&&(d=m?l+15:l-15,M-Math.abs(d)>0&&(c=Math.sqrt(Math.pow(M,2)-Math.pow(d,2))),(b&&-c>L.edgex||!b&&c<L.edgex)&&(c=Math.abs(L.edgex))),s&&(x=b?i.left:i.right,y=e.length-C,v=m?x-15*y:x+15*y,(m&&d>v||!m&&d<v)&&(d=v)),l=d,s||(b?i.left=l:i.right=l);var Q=b?-c-5:c+5,O=Q+S.origin.x,k=d+S.origin.y;if(O>S._graphs.root.width||k<0||k>S._graphs.root.height)return;var D="M"+L.centerx+","+L.centery;D+="Q"+L.outx+","+L.outy+","+Q+","+d;var T=new r({context:{lineType:"solid",path:D,lineWidth:1,strokeStyle:L.fillStyle}}),E=L.labelText,R=document.createElement("div");switch(R.style.cssText=" ;position:absolute;left:-1000px;top:-1000px;color:"+L.fillStyle,R.innerHTML=E,S.domContainer.appendChild(R),h=R.offsetWidth,p=R.offsetHeight,f=b?-c:c,g=d,t){case 1:f+=5,g-=p/2;break;case 2:case 3:f-=h+5,g-=p/2;break;case 4:f+=5,g-=p/2}R.style.left=f+S.origin.x+"px",R.style.top=g+S.origin.y+"px",S.textSp.addChild(T),S.textList.push({width:h,height:p,x:f+S.origin.x,y:g+S.origin.y,data:L,textTxt:E,textEle:R})}}},e.prototype._startWidgetLabel=function(){for(var t,e,n=this,o=n.data.list,s=0,i=0,a=[],r=[{indexs:[],count:0},{indexs:[],count:0},{indexs:[],count:0},{indexs:[],count:0}],l={right:{startQuadrant:4,endQuadrant:1,clockwise:!0,indexs:[]},left:{startQuadrant:3,endQuadrant:2,clockwise:!1,indexs:[]}},d=0;d<o.length;d++){var c=o[d].quadrant;r[c-1].indexs.push(d),r[c-1].count++}r[0].count>1&&r[0].indexs.reverse(),r[2].count>1&&r[2].indexs.reverse(),r[0].count>r[3].count&&(l.right.startQuadrant=1,l.right.endQuadrant=4,l.right.clockwise=!1),r[1].count>r[2].count&&(l.left.startQuadrant=2,l.left.endQuadrant=3,l.left.clockwise=!0),l.right.indexs=r[l.right.startQuadrant-1].indexs.concat(r[l.right.endQuadrant-1].indexs),l.left.indexs=r[l.left.startQuadrant-1].indexs.concat(r[l.left.endQuadrant-1].indexs),l.right.indexs.length>n.textMaxCount&&((e=l.right.indexs.slice(0)).sort(function(t,e){return o[e].y-o[t].y}),t=e.slice(n.textMaxCount),o[t[0]].percentage,s=o[t[0]].y),l.left.indexs.length>n.textMaxCount&&((e=l.left.indexs.slice(0)).sort(function(t,e){return o[e].y-o[t].y}),t=e.slice(n.textMaxCount),o[t[0]].percentage,i=o[t[0]].y),a.push(l.right.startQuadrant),a.push(l.right.endQuadrant),a.push(l.left.startQuadrant),a.push(l.left.endQuadrant);var u={};for(d=0;d<a.length;d++){var h=1==d||3==d;n._widgetLabel(a[d],r[a[d]-1].indexs,i,s,h,u)}},e.prototype.destroyLabel=function(){var t=this;this.textSp&&this.textSp.removeAllChildren(),d.each(this.textList,function(e){t.domContainer.removeChild(e.textEle)}),this.textList=[]},e.prototype._showGrowLabel=function(){this.textSp&&this.textSp.context&&(this.textSp.context.globalAlpha=1,d.each(this.textList,function(t){t.textEle.style.visibility="visible"}))},e.prototype._hideGrowLabel=function(){this.textSp&&this.textSp.context&&(this.textSp.context.globalAlpha=0,d.each(this.textList,function(t){t.textEle.style.visibility="hidden"}))},e}(i.default.Event.EventDispatcher);e.default=c});