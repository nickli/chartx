define("components/graphs/sunburst/index",["canvax","../index","../../../layout/partition"],function(t,e,n){"use strict";var o,a=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var i=t("canvax"),r=t("../index"),u=t("../../../layout/partition"),h=i.default._,l=i.default.Shapes.Sector,s=(i.default.Shapes.Circle,function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.type="sunburst",o.keyField="name",o.valueField="value",o.parentField="parent",o.node={strokeStyle:"#fff",lineWidth:1,lineAlpha:1,fillStyle:null,fillAlpha:1,blurAlpha:.4,focus:{enabled:!0,lineAlpha:1}},h.extend(!0,o,e),o.data=[],o.dataGroup=[],o.init(),o}return a(e,t),e.prototype.init=function(){this.sprite=new i.default.Display.Sprite({id:"sunburst_graphs"})},e.prototype.draw=function(t){!t&&(t={}),h.extend(!0,this,t),this.data=this._trimGraphs(),this.dataGroup=this._getDataGroupOfDepth(),this._widget(),this.sprite.context.x=this.width/2+this.origin.x,this.sprite.context.y=this.height/2+this.origin.y,this.fire("complete")},e.prototype._trimGraphs=function(){var t=this,e=parseInt(Math.min(this.width,this.height)/2),n=u.default().sort(null).size([2*Math.PI,e*e]).value(function(e){return e[t.valueField]}),o=this._tansTreeData();return this.data=n(o,0),this.data},e.prototype._getDataGroupOfDepth=function(){var t={};h.each(this.data,function(e){t[e.depth]=[]}),h.each(this.data,function(e){t[e.depth].push(e)});var e=[];for(var n in t)e.push(t[n]);return e},e.prototype._tansTreeData=function(){var t=this.dataFrame,e={},n=t.getFieldData(this.keyField),o=t.getFieldData(this.valueField),a=t.getFieldData(this.parentField);return function t(e,i,r){for(var u=i?i.name:void 0,l=r||0;l<a.length;l++){var s=a[l];if(s||0===s||(s=void 0),u===s){e.name=n[l],e.iNode=l;var c=o[l];(c||0===c)&&(e.value=c),h.each(a,function(n,o){if(n===e.name){e.children||(e.children=[]);var a={};t(a,e,o),e.children.push(a)}});break}}}(e),e},e.prototype._widget=function(){var t=this;h.each(this.dataGroup,function(e,n){h.each(e,function(o,a){if(o.depth){var i=Math.sqrt(o.y+o.dy),r={r0:Math.sqrt(o.y),r:Math.sqrt(o.y)+2,startAngle:180*o.x/Math.PI,endAngle:180*(o.x+o.dx)/Math.PI,fillStyle:o.color||t.root.getTheme(o.iNode),strokeStyle:t.node.strokeStyle,lineWidth:t.node.lineWidth,globalAlpha:0},u=new l({id:"sector_"+n+"_"+a,context:r});u.layoutData=o,o.sector=u,o.group=e,t.sprite.addChild(u),u.hover(function(n){t._focus(o,e)},function(n){t._unfocus(o,e)}),u.on("mousedown mouseup panstart mouseover panmove mousemove panend mouseout tap click dblclick",function(e){e.eventInfo={iNode:o.iNode},t.root.fire(e.type,e),t.triggerEvent(t.node,e)}),n<=1?(u.context.r=i,u.context.globalAlpha=1):setTimeout(function(){u.context&&(u.context.globalAlpha=1,u.animate({r:i},{duration:350}))},350*(n-1))}})})},e.prototype.getNodesAt=function(t){var e=[],n=t.eventInfo.iNode;if(void 0!==n){var o=h.find(this.data,function(t){return t.iNode==n});o&&e.push(o)}return e},e.prototype._focus=function(t,e){var n=this;h.each(e,function(e){e!==t&&(e.sector.context.globalAlpha=n.node.blurAlpha,n._focusChildren(e,function(t){t.sector.context.globalAlpha=n.node.blurAlpha}))}),n._focusParent(t)},e.prototype._unfocus=function(t,e){h.each(this.data,function(t){t.sector&&(t.sector.context.globalAlpha=1)})},e.prototype._focusChildren=function(t,e){var n=this;t.children&&t.children.length&&h.each(t.children,function(t){e(t),n._focusChildren(t,e)})},e.prototype._focusParent=function(t){var e=this;t.parent&&t.parent.sector&&t.parent.group&&h.each(t.parent.group,function(n){n===t.parent?(n.sector.context.globalAlpha=1,e._focusParent(t.parent)):n.sector.context.globalAlpha=e.node.blurAlpha})},e}(r.default));e.default=s});