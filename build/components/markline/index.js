define("components/markline/index",["../component","canvax"],function(t,e,i){"use strict";var n,l=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var o=t("../component"),r=t("canvax"),a=r.default.Shapes.BrokenLine,s=r.default.Display.Sprite,c=r.default.Display.Text,d=r.default._,y=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._yAxis=i,n.w=0,n.h=0,n.field=null,n.origin={x:0,y:0},n.markTo=null,n.yVal=0,n.line={y:0,list:[],strokeStyle:"#999",lineWidth:1,smooth:!1,lineType:"dashed"},n.label={enabled:!1,fillStyle:"#999999",fontSize:12,text:null,lineType:"dashed",lineWidth:1,strokeStyle:"white",format:null},n._txt=null,n._line=null,e&&d.extend(!0,n,e),n.sprite=new s,n.core=new s({context:{x:n.origin.x,y:n.origin.y}}),n.sprite.addChild(n.core),n}return l(e,t),e.register=function(t,e){e=e;var i=this;d.isArray(t)||(t=[t]),d.each(t,function(t){var n=t.markTo;if(!n||-1!=d.indexOf(e.dataFrame.fields,n)){var l,o=e._coord._yAxis[0];n&&d.each(e._coord._yAxis,function(t,e){var i=d.flatten([t.field]);d.indexOf(i,n)>=0&&(o=t)}),t.yAxisAlign&&(o=e._coord._yAxis["left"==t.yAxisAlign?0:1]),l=void 0!==t.y&&null!==t.y?Number(t.y):function(){var t=e.dataFrame.getFieldData(n),i=0;return d.each(t,function(t){Number(t)&&(i+=t)}),i/t.length},isNaN(l)||o.setWaterLine(l),e.components.push({type:"once",plug:{draw:function(){var r="#777",a=e._coord.getFieldMapOf(n);a&&(r=a.color);var s=t.line&&t.line.strokeStyle||r,c=t.label&&t.label.fillStyle||r;i.creatOneMarkLine(e,t,l,o,s,c,n)}}})}})},e.creatOneMarkLine=function(t,e,i,n,l,o,r){var a={w:t._coord.width,h:t._coord.height,yVal:i,origin:{x:t._coord.origin.x,y:t._coord.origin.y},line:{list:[[0,0],[t._coord.width,0]]},label:{fillStyle:o},field:r};l&&(a.line.strokeStyle=l);var s=new this(d.extend(!0,e,a),n);t.components.push({type:"markLine",plug:s}),t.graphsSprite.addChild(s.sprite)},e.prototype._getYVal=function(){var t=this.yVal;return d.isFunction(this.yVal)&&(t=this.yVal(this)),t},e.prototype._getYPos=function(){return this._yAxis.getYposFromVal(this._getYVal())},e.prototype._getLabel=function(){var t=this._getYVal();return d.isFunction(this.label.format)?this.label.format(t,this):d.isString(this.label.text)?this.label.text:t},e.prototype.draw=function(){var t=this,e=this._getYPos(),i=new a({id:"line",context:{y:e,pointList:t.line.list,strokeStyle:t.line.strokeStyle,lineWidth:t.line.lineWidth,lineType:t.line.lineType}});if(t.core.addChild(i),t._line=i,t.label.enabled){var n=new c(t._getLabel(),{context:t.label});this._txt=n,t.core.addChild(n),t._setTxtPos(e)}this.line.y=e},e.prototype.reset=function(t){t&&d.extend(!0,this,t);var e=this,i=this._getYPos();i!=this.line.y&&this._line.animate({y:i},{duration:300,onUpdate:function(t){e.label.enabled&&(e._txt.resetText(e._getLabel()),e._setTxtPos(t.y))}}),this._line.context.strokeStyle=this.line.strokeStyle,this.line.y=i},e.prototype._setTxtPos=function(t){var e=this,i=e._txt;d.isNumber(e.label.x)?i.context.x=e.label.x:i.context.x=this.w-i.getTextWidth()-5,d.isNumber(e.label.y)?i.context.y=e.label.y:i.context.y=t-i.getTextHeight()},e}(o.default);e.default=y});