define("components/datazoom/index",["../component","canvax"],function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var a=t("../component"),h=t("canvax"),d=h.default.Shapes.Line,s=h.default.Shapes.Rect,r=h.default._,l={height:26,width:100,pos:{x:0,y:0},offset:{x:0,y:0},margin:{top:5,right:0,bottom:5,left:0},range:{start:0,end:null,max:null,min:1},color:"#008ae6",left:{eventEnabled:!0,fillStyle:null},right:{eventEnabled:!0,fillStyle:null},btnOut:6,btnHeight:20,btnWidth:8,center:{eventEnabled:!0,fillStyle:"#000000",alpha:.015},bg:{enabled:!0,fillStyle:"",strokeStyle:"#e6e6e6",lineWidth:1},underline:{enabled:!0,strokeStyle:null,lineWidth:2},position:"bottom",hv:"h"},c=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i._cloneChart=n,i.count=1,i.dataLen=1,i.axisLayoutType=n.thumbChart._coord._xAxis.layoutType,i.dragIng=function(){},i.dragEnd=function(){},i.disPart={},i._btnLeft=null,i._btnRight=null,i._underline=null,e&&r.extend(!0,i,e),i._computeAttrs(e),i.sprite=new h.default.Display.Sprite({id:"dataZoom",context:{x:i.pos.x,y:i.pos.y}}),i.sprite.noSkip=!0,i.dataZoomBg=new h.default.Display.Sprite({id:"dataZoomBg"}),i.dataZoomBtns=new h.default.Display.Sprite({id:"dataZoomBtns"}),i.sprite.addChild(i.dataZoomBg),i.sprite.addChild(i.dataZoomBtns),i.widget(),i._setLines(),i.setZoomBg(),i}return o(e,t),e.register=function(t,e){var n=this;"bottom"==(t=r.extend(!0,l,t)).position&&(t.pos={x:0,y:e.height-(t.height+e.padding.bottom+t.margin.bottom)},e.padding.bottom+=t.height+t.margin.top+t.margin.bottom),"top"==t.position&&(t.pos={x:0,y:e.padding.top+t.margin.top},e.padding.top+=t.height+t.margin.top+t.margin.bottom),e.components.push({type:"once",plug:{draw:function(){var i=new n(n._getDataZoomOpt(t,e),n._getCloneChart(t,e));e.components.push({type:"dataZoom",plug:i}),e.stage.addChild(i.sprite)}}})},e._getCloneChart=function(t,e){var n=e.constructor,i=e.el.cloneNode();i.innerHTML="",i.id=e.el.id+"_currclone",i.style.position="absolute",i.style.width=e.el.offsetWidth+"px",i.style.height=e.el.offsetHeight+"px",i.style.top="10000px",document.body.appendChild(i);var o=[];r.each(e._graphs,function(t){var e=t.enabledField||t.field;if(r.flatten([e]).length){var n=r.extend(!0,{},t._opt);n.field=e,"bar"==t.type&&r.extend(!0,n,{node:{fillStyle:"#ececec",radius:0},animation:!1,eventEnabled:!1,label:{enabled:!1}}),"line"==t.type&&r.extend(!0,n,{line:{strokeStyle:"#ececec"},icon:{enabled:!1},area:{alpha:1,fillStyle:"#ececec"},animation:!1,eventEnabled:!1,label:{enabled:!1}}),"scat"==t.type&&r.extend(!0,n,{node:{fillStyle:"#ececec"}}),o.push(n)}}),(t={coord:e._opt.coord,graphs:o}).coord.horizontal&&delete t.coord.horizontal;var a=new n(i,e._data,t,e.graphsMap,e.componentsMap);return a.draw(),{thumbChart:a,cloneEl:i}},e._getDataZoomOpt=function(t,e){e._coord.width;e._coord._opt.horizontal&&e._coord.height;var n=e._coord.getSizeAndOrigin();return r.extend(!0,t,{width:n.width,pos:{x:n.origin.x},dragIng:function(t){var n={name:"dataZoom",left:e.dataFrame.range.start-t.start,right:t.end-e.dataFrame.range.end};r.extend(e.dataFrame.range,t),e.resetData(null,n),e.fire("dataZoomDragIng")},dragEnd:function(t){e.updateChecked&&e.updateChecked(),e.fire("dataZoomDragEnd")}})},e.prototype.draw=function(){},e.prototype.destroy=function(){this.sprite.destroy()},e.prototype.reset=function(t,n){!t&&(t={});var i=this.count,o=this.range.start,a=this.range.end;t&&r.extend(!0,this,t),this._cloneChart=e._getCloneChart(t,this.app),this._computeAttrs(t),(i!=this.count||t.range&&(t.range.start!=o||t.range.end!=a))&&(this.widget(),this._setLines()),this.setZoomBg()},e.prototype._computeAttrs=function(t){var e=this._cloneChart.thumbChart;this.dataLen=e._data.length-1,this.count="rule"==this.axisLayoutType?this.dataLen-1:this.dataLen,(!this.range.max||this.range.max>this.count)&&(this.range.max=this.count),(!this.range.end||this.range.end>this.dataLen-1)&&(this.range.end=this.dataLen-1),!t.hv&&t.position&&("left"==this.position||"right"==this.position?this.hv="v":this.hv="h"),this.disPart=this._getDisPart(),this.btnHeight=this.height-this.btnOut},e.prototype._getRangeEnd=function(t){return void 0===t&&(t=this.range.end),"peak"==this.axisLayoutType&&(t+=1),t},e.prototype.widget=function(){var t=this,e=function(){t._setLines.apply(t,arguments)};if(t.bg.enabled){var n={x:0,y:0,width:t.width,height:t.btnHeight,lineWidth:t.bg.lineWidth,strokeStyle:t.bg.strokeStyle,fillStyle:t.bg.fillStyle};t._bgRect?t._bgRect.animate(n,{onUpdate:e}):(t._bgRect=new s({context:n}),t.dataZoomBg.addChild(t._bgRect))}if(t.underline.enabled){var i={start:{x:t.range.start/t.count*t.width+t.btnWidth/2,y:t.btnHeight},end:{x:t._getRangeEnd()/t.count*t.width-t.btnWidth/2,y:t.btnHeight},lineWidth:t.underline.lineWidth,strokeStyle:t.underline.strokeStyle||t.color};t._underline?t._underline.animate(i,{onUpdate:e}):(t._underline=t._addLine(i),t.dataZoomBg.addChild(t._underline))}var o={x:t.range.start/t.count*t.width,y:-t.btnOut/2+1,width:t.btnWidth,height:t.btnHeight+t.btnOut,fillStyle:t.left.fillStyle||t.color,cursor:t.left.eventEnabled&&"move"};t._btnLeft?t._btnLeft.animate(o,{onUpdate:e}):(t._btnLeft=new s({id:"btnLeft",dragEnabled:t.left.eventEnabled,context:o}),t._btnLeft.on("draging",function(e){this.context.y=-t.btnOut/2+1,this.context.x<0&&(this.context.x=0),this.context.x>t._btnRight.context.x-t.btnWidth-2&&(this.context.x=t._btnRight.context.x-t.btnWidth-2),t._btnRight.context.x+t.btnWidth-this.context.x>t.disPart.max&&(this.context.x=t._btnRight.context.x+t.btnWidth-t.disPart.max),t._btnRight.context.x+t.btnWidth-this.context.x<t.disPart.min&&(this.context.x=t._btnRight.context.x+t.btnWidth-t.disPart.min),t.rangeRect.context.width=t._btnRight.context.x-this.context.x-t.btnWidth,t.rangeRect.context.x=this.context.x+t.btnWidth,t._setRange()}),t._btnLeft.on("dragend",function(e){t.dragEnd(t.range)}),this.dataZoomBtns.addChild(this._btnLeft));var a={x:t._getRangeEnd()/t.count*t.width-t.btnWidth,y:-t.btnOut/2+1,width:t.btnWidth,height:t.btnHeight+t.btnOut,fillStyle:t.right.fillStyle||t.color,cursor:t.right.eventEnabled&&"move"};t._btnRight?t._btnRight.animate(a,{onUpdate:e}):(t._btnRight=new s({id:"btnRight",dragEnabled:t.right.eventEnabled,context:a}),t._btnRight.on("draging",function(e){this.context.y=-t.btnOut/2+1,this.context.x>t.width-t.btnWidth&&(this.context.x=t.width-t.btnWidth),this.context.x+t.btnWidth-t._btnLeft.context.x>t.disPart.max&&(this.context.x=t.disPart.max-(t.btnWidth-t._btnLeft.context.x)),this.context.x+t.btnWidth-t._btnLeft.context.x<t.disPart.min&&(this.context.x=t.disPart.min-t.btnWidth+t._btnLeft.context.x),t.rangeRect.context.width=this.context.x-t._btnLeft.context.x-t.btnWidth,t._setRange()}),t._btnRight.on("dragend",function(e){t.dragEnd(t.range)}),this.dataZoomBtns.addChild(this._btnRight));var d={x:o.x+t.btnWidth,y:1,width:a.x-o.x-t.btnWidth,height:this.btnHeight-1,fillStyle:t.center.fillStyle,fillAlpha:t.center.alpha,cursor:"move"};this.rangeRect?this.rangeRect.animate(d,{onUpdate:e}):(this.rangeRect=new s({id:"btnCenter",dragEnabled:!0,context:d}),this.rangeRect.on("draging",function(e){this.context.y=1,this.context.x<t.btnWidth&&(this.context.x=t.btnWidth),this.context.x>t.width-this.context.width-t.btnWidth&&(this.context.x=t.width-this.context.width-t.btnWidth),t._btnLeft.context.x=this.context.x-t.btnWidth,t._btnRight.context.x=this.context.x+this.context.width,t._setRange("btnCenter")}),this.rangeRect.on("dragend",function(e){t.dragEnd(t.range)}),this.dataZoomBtns.addChild(this.rangeRect)),this.linesLeft||(this.linesLeft=new h.default.Display.Sprite({id:"linesLeft"}),this.left.eventEnabled&&this._addLines({sprite:this.linesLeft}),this.dataZoomBtns.addChild(this.linesLeft)),this.linesRight||(this.linesRight=new h.default.Display.Sprite({id:"linesRight"}),this.right.eventEnabled&&this._addLines({sprite:this.linesRight}),this.dataZoomBtns.addChild(this.linesRight)),this.linesCenter||(this.linesCenter=new h.default.Display.Sprite({id:"linesCenter"}),this._addLines({count:3,sprite:this.linesCenter,strokeStyle:this.color}),this.dataZoomBtns.addChild(this.linesCenter))},e.prototype._getDisPart=function(){var t=this,e=Math.max(parseInt(t.range.min/2/t.count*t.width),23);return"peak"==this.axisLayoutType&&(e=Math.max(parseInt(t.range.min/t.count*t.width),23)),{min:e,max:parseInt(t.range.max/t.count*t.width)}},e.prototype._setRange=function(t){var e=this,n=e._getRangeEnd(),i=n-e.range.start,o=e._btnLeft.context.x/e.width*e.count,a=(e._btnRight.context.x+e.btnWidth)/e.width*e.count;"peak"==this.axisLayoutType?(o=Math.round(o),a=Math.round(a)):(o=parseInt(o),a=parseInt(a)),"btnCenter"==t&&a-o!=i&&(a=o+i),o==e.range.start&&a==n||(e.range.start=o,"peak"==e.axisLayoutType&&(a-=1),e.range.end=a,e.dragIng(e.range)),e._setLines()},e.prototype._setLines=function(){var t=this,e=this.linesLeft,n=this.linesRight,i=this.linesCenter,o=this._btnLeft,a=this._btnRight,h=this.rangeRect;e.context.x=o.context.x+(o.context.width-e.context.width)/2,e.context.y=o.context.y+(o.context.height-e.context.height)/2,n.context.x=a.context.x+(a.context.width-n.context.width)/2,n.context.y=a.context.y+(a.context.height-n.context.height)/2,i.context.x=h.context.x+(h.context.width-i.context.width)/2,i.context.y=h.context.y+(h.context.height-i.context.height)/2,t.underline.enabled&&(t._underline.context.start.x=e.context.x+t.btnWidth/2,t._underline.context.end.x=n.context.x+t.btnWidth/2)},e.prototype._addLines=function(t){for(var e=t.count||2,n=t.sprite,i=t.dis||2,o=0,a=e;o<a;o++)n.addChild(this._addLine({x:o*i,strokeStyle:t.strokeStyle||""}));n.context.width=o*i-1,n.context.height=6},e.prototype._addLine=function(t){var e=t||{};return new d({id:e.id||"",context:{x:e.x||0,y:e.y||0,start:{x:e.start?e.start.x:0,y:e.start?e.start.y:0},end:{x:e.end?e.end.x:0,y:e.end?e.end.y:6},lineWidth:e.lineWidth||1,strokeStyle:e.strokeStyle||"#ffffff"}})},e.prototype.setZoomBg=function(){this.__graphssp&&this.__graphssp.destroy();var t=this._cloneChart.thumbChart.graphsSprite,e=this._cloneChart.thumbChart._coord;t.id=t.id+"_datazoomthumbChartbg",t.context.x=-e.origin.x,t.context.y=-2,t.context.scaleY=this.btnHeight/e.height,t.context.scaleX=this.width/e.width,this.dataZoomBg.addChild(t,0),this.__graphssp=t,this._cloneChart.thumbChart.destroy(),this._cloneChart.cloneEl.parentNode.removeChild(this._cloneChart.cloneEl)},e}(a.default);e.default=c});